<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-0.9.550">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Ronan Ysebaert">
<meta name="dcterms.date" content="2022-06-01">

<title>OSRM Travel-time calculation with R and data visualization with Observable</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>


<script src="index_files/libs/clipboard/clipboard.min.js"></script>
<script src="index_files/libs/quarto-html/quarto.js"></script>
<script src="index_files/libs/quarto-html/popper.min.js"></script>
<script src="index_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="index_files/libs/quarto-html/anchor.min.js"></script>
<link href="index_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="index_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="index_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="index_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="index_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet">
<script type="module" src="index_files/libs/quarto-ojs/quarto-ojs-runtime.js"></script>
<link href="index_files/libs/quarto-ojs/quarto-ojs.css" rel="stylesheet">


<link rel="stylesheet" href="styles.css">
</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#data-processing-with-r" id="toc-data-processing-with-r" class="nav-link active" data-scroll-target="#data-processing-with-r">Data processing with R</a>
  <ul class="collapse">
  <li><a href="#data-sources" id="toc-data-sources" class="nav-link" data-scroll-target="#data-sources">Data sources</a></li>
  <li><a href="#map-layout" id="toc-map-layout" class="nav-link" data-scroll-target="#map-layout">Map layout</a></li>
  <li><a href="#feed-iris-with-socio-economic-data-insee" id="toc-feed-iris-with-socio-economic-data-insee" class="nav-link" data-scroll-target="#feed-iris-with-socio-economic-data-insee">Feed IRIS with socio-economic data (INSEE)</a></li>
  <li><a href="#prepare-iris-for-travel-time-calculation" id="toc-prepare-iris-for-travel-time-calculation" class="nav-link" data-scroll-target="#prepare-iris-for-travel-time-calculation">Prepare IRIS for travel-time calculation</a></li>
  <li><a href="#import-osm-points-of-interest" id="toc-import-osm-points-of-interest" class="nav-link" data-scroll-target="#import-osm-points-of-interest">Import OSM points of interest</a></li>
  <li><a href="#travel-time-calculation-with-osrm" id="toc-travel-time-calculation-with-osrm" class="nav-link" data-scroll-target="#travel-time-calculation-with-osrm">Travel-time calculation with OSRM</a></li>
  <li><a href="#indicators-creation" id="toc-indicators-creation" class="nav-link" data-scroll-target="#indicators-creation">Indicators creation</a></li>
  <li><a href="#simplify-geometries" id="toc-simplify-geometries" class="nav-link" data-scroll-target="#simplify-geometries">Simplify geometries</a></li>
  <li><a href="#export-results" id="toc-export-results" class="nav-link" data-scroll-target="#export-results">Export results</a></li>
  <li><a href="#session-info-r" id="toc-session-info-r" class="nav-link" data-scroll-target="#session-info-r">Session info (R)</a></li>
  </ul></li>
  <li><a href="#data-visualization-with-observable-javascript-ojs" id="toc-data-visualization-with-observable-javascript-ojs" class="nav-link" data-scroll-target="#data-visualization-with-observable-javascript-ojs">Data visualization with Observable JavaScript (ojs)</a>
  <ul class="collapse">
  <li><a href="#import-consolidated-data" id="toc-import-consolidated-data" class="nav-link" data-scroll-target="#import-consolidated-data">Import consolidated data</a></li>
  <li><a href="#layers-attributes-and-metadata" id="toc-layers-attributes-and-metadata" class="nav-link" data-scroll-target="#layers-attributes-and-metadata">Layers attributes and metadata</a></li>
  <li><a href="#walls-characteristics" id="toc-walls-characteristics" class="nav-link" data-scroll-target="#walls-characteristics">Wall’s characteristics</a></li>
  </ul></li>
  <li><a href="#concluding-methodological-remarks" id="toc-concluding-methodological-remarks" class="nav-link" data-scroll-target="#concluding-methodological-remarks">Concluding methodological remarks</a>
  <ul class="collapse">
  <li><a href="#extend-the-analysis" id="toc-extend-the-analysis" class="nav-link" data-scroll-target="#extend-the-analysis">Extend the analysis</a></li>
  <li><a href="#usage-precautions" id="toc-usage-precautions" class="nav-link" data-scroll-target="#usage-precautions">Usage precautions</a></li>
  </ul></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">OSRM Travel-time calculation with R and data visualization with Observable</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
<p class="subtitle lead">Application to artifical climbing walls in Paris and its neighbourhood</p>
</div>


<div class="quarto-title-meta-author">
  <div class="quarto-title-meta-heading">Author</div>
  <div class="quarto-title-meta-heading">Affiliation</div>
  
    <div class="quarto-title-meta-contents">
    <a href="https://rysebaert.github.io/climbing_paris/">Ronan Ysebaert</a> 
  </div>
    <div class="quarto-title-meta-contents">
        <p class="affiliation">
            <a href="https://riate.cnrs.fr/">
            UAR RIATE, Université Paris Cité, CNRS
            </a>
          </p>
      </div>
    </div>

<div class="quarto-title-meta">

      
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">June 1, 2022</p>
    </div>
  </div>
    
  </div>
  

</header>

<p><strong>Work in progress</strong></p>
<p>The aim of this document consists in showing how to build, visualize and reproduce accessibility indicators by combining points of interest (POI) coming from the OpenStreetMap database, socio-economic indicators included in small territorial division (IRIS) and routing engines (OSRM).</p>
<p>The graphical outputs displayed in this notebook are also available in an <a href="https://observablehq.com/collection/@rysebaert/climbing_paris" title="Go to Observable Notebook">Observable collection</a>.</p>
<p>To introduce the reader to the issues raised by indoor sport-climbing in Paris, have a look to <a href="https://observablehq.com/d/d2be39c4dd55a32d?collection=@rysebaert/climbing_paris" title="Go to Observable Notebook">this notebook</a>.</p>
<p>This Quarto document combines 2 computer languages : R for data processing, and D3.js for data visualizations.</p>
<section id="data-processing-with-r" class="level1">
<h1>Data processing with R</h1>
<section id="data-sources" class="level2">
<h2 class="anchored" data-anchor-id="data-sources">Data sources</h2>
<p>Three data providers are used to build the consolidated data of this document.</p>
<ul>
<li><p><strong>IGN</strong> : <a href="https://geoservices.ign.fr/contoursiris" title="Access to input geometries (France)">The Contour…IRIS® édition 2020</a>, which corresponds to the lowest territorial division in France (below the commune level).</p></li>
<li><p><strong>INSEE</strong> : IRIS <a href="https://www.insee.fr/fr/statistiques/6049648" title="Go to input data">Median income</a> and <a href="https://www.insee.fr/fr/statistiques/5650720?sommaire=4658626" title="Go to input data">population</a> in 2019.</p></li>
<li><p><strong>OpenStreetMap</strong> : download of Point Of Interest (POI) and travel time calculation by bike between IRIS centroids and POI, using the <a href="http://project-osrm.org/" title="Access to OSRM Website">OSRM routing engine</a>.</p></li>
</ul>
<p>Input data is not provided in the Github repository (too large files), but can be easily be downloaded.</p>
</section>
<section id="map-layout" class="level2">
<h2 class="anchored" data-anchor-id="map-layout">Map layout</h2>
<p>A bounding box of 5 km around Paris, without Bois de Boulogne et Bois de Vincennes for a better centering of the map layout.</p>
<p>A second bounding box (10 km around Paris) is created to catch OpenStreetMap POI in the neighbourhood of this study area.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Map layout preparation at IRIS scale (source IGN)----</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>iris <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">"data-raw/CONTOURS-IRIS.shp"</span>, <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract Paris and delete </span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Bois-de-Vincennes / Boulogne Iris for map template</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>iris<span class="sc">$</span>dep <span class="ot">&lt;-</span> <span class="fu">substr</span>(iris<span class="sc">$</span>INSEE_COM, <span class="dv">1</span>, <span class="dv">2</span>)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>paris <span class="ot">&lt;-</span> iris[iris<span class="sc">$</span>dep <span class="sc">==</span> <span class="st">"75"</span>,]</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>paris <span class="ot">&lt;-</span> paris[<span class="sc">!</span>paris<span class="sc">$</span>NOM_IRIS <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Bois de Vincennes 1"</span>,</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"Bois de Vincennes 2"</span>,</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"Bois de Boulogne 1"</span>,</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"Bois de Boulogne 2"</span>,</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"Bois de Boulogne 3"</span>),]</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>paris <span class="ot">&lt;-</span> <span class="fu">st_union</span>(paris)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="co"># 5 km around Paris map layout</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>paris5k <span class="ot">&lt;-</span> <span class="fu">st_buffer</span>(paris, <span class="dv">5000</span>)</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>paris5k <span class="ot">&lt;-</span> <span class="fu">st_as_sfc</span>(<span class="fu">st_bbox</span>(paris5k, <span class="at">crs =</span> <span class="dv">2154</span>))</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="co"># 10 km around Paris (get OSM data) in long/lat</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>paris10k <span class="ot">&lt;-</span> <span class="fu">st_buffer</span>(paris, <span class="dv">10000</span>)</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>paris10k <span class="ot">&lt;-</span> <span class="fu">st_as_sfc</span>(<span class="fu">st_bbox</span>(paris10k, <span class="at">crs =</span> <span class="dv">2154</span>))</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Intersection with IRIS</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>iris10k <span class="ot">&lt;-</span> <span class="fu">st_intersection</span>(iris, paris10k)</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Bounding box for osm extraxt</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>paris10k <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(paris10k, <span class="dv">4326</span>)</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>paris10k <span class="ot">&lt;-</span> <span class="fu">st_bbox</span>(paris10k) </span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>paris10k <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(paris10k)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="feed-iris-with-socio-economic-data-insee" class="level2">
<h2 class="anchored" data-anchor-id="feed-iris-with-socio-economic-data-insee">Feed IRIS with socio-economic data (INSEE)</h2>
<p>Data is enriched by socio-economic data (disposible median income 2019 and total population 2018) for further analysis. We keep only “Habitation” IRIS (dedicated to dwellings) for origins-destinations calculations.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">read_xlsx</span>(<span class="st">"data-raw/base-ic-evol-struct-pop-2018.xlsx"</span>, <span class="at">skip =</span> <span class="dv">5</span>, <span class="at">sheet =</span> <span class="st">"IRIS"</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>iris10k <span class="ot">&lt;-</span> <span class="fu">merge</span>(iris10k[,<span class="fu">c</span>(<span class="st">"CODE_IRIS"</span>, <span class="st">"NOM_IRIS"</span>, <span class="st">"TYP_IRIS"</span>, <span class="st">"NOM_COM"</span>)], </span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>              df[,<span class="fu">c</span>(<span class="st">"IRIS"</span>,<span class="st">"P18_POP"</span>)],</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">by.x =</span> <span class="st">"CODE_IRIS"</span>, <span class="at">by.y =</span> <span class="st">"IRIS"</span>, <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">read_xlsx</span>(<span class="st">"data-raw/BASE_TD_FILO_DISP_IRIS_2019.xlsx"</span>, <span class="at">skip =</span> <span class="dv">5</span>, <span class="at">sheet =</span> <span class="st">"IRIS_DISP"</span>)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>iris10k <span class="ot">&lt;-</span> <span class="fu">merge</span>(iris10k, df[,<span class="fu">c</span>(<span class="st">"IRIS"</span>,<span class="st">"DISP_MED19"</span>)],</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>              <span class="at">by.x =</span> <span class="st">"CODE_IRIS"</span>, <span class="at">by.y =</span> <span class="st">"IRIS"</span>, <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>iris <span class="ot">&lt;-</span> <span class="fu">st_intersection</span>(iris, paris5k)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="prepare-iris-for-travel-time-calculation" class="level2">
<h2 class="anchored" data-anchor-id="prepare-iris-for-travel-time-calculation">Prepare IRIS for travel-time calculation</h2>
<p>IRIS centroids are extracted. These points will be used for the origins of travel-time calculations. Only IRIS including dwellings are kept (TYP_IRIS == “H”).</p>
<p>These <code>sf</code> objects are transformed in latitude/longitude (origin-destination calculations requirements and for final export in geojson format).</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Keep only habitation IRIS for origins calculation</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>ori <span class="ot">&lt;-</span> iris10k[iris10k<span class="sc">$</span>TYP_IRIS <span class="sc">==</span> <span class="st">"H"</span>,]</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>ori <span class="ot">&lt;-</span> <span class="fu">st_centroid</span>(ori)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>ori <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(ori, <span class="at">crs =</span> <span class="dv">4326</span>)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>iris <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(iris, <span class="at">crs =</span> <span class="dv">4326</span>)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>com <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(com, <span class="at">crs =</span> <span class="dv">4326</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="import-osm-points-of-interest" class="level2">
<h2 class="anchored" data-anchor-id="import-osm-points-of-interest">Import OSM points of interest</h2>
<p>Indoor sport climbing points of interest are downloaded from OpenStreetMap thanks to the <code>osmdata</code> R package (<span class="citation" data-cites="osmdata">Mark Padgham (<a href="#ref-osmdata" role="doc-biblioref">2022</a>)</span>).</p>
<p>To access to these OSM features, the OSM key-value pair must be set. For climbing areas, it corresponds to the sport = climbing OSM tag. In the <a href="https://wiki.openstreetmap.org/wiki/Tag:sport%3Dclimbing" title="Tag:sport=climbing in OSM wiki">OpenStreetMap wiki</a>, it is mentioned that “<em>sport=climbing should be preferably applied to noded for artificial climbing walls”.</em> Thus, we only consider points responding to the query.</p>
<p>The geographical coverage of the query covers a bounding box of 10 km around Paris (<code>paris10k</code>`). At the end, only useful OSM attributes are kept. Associative and private structures are differentiated for thematic purpose.</p>
<p>I argue that the accuracy and completeness of the data is quite good : I have edited missing points on OpenStreetMap with my personal knowledge and upstream investigation :-)</p>
<p>For the presentation of the artificial climbing landscape in Paris and the difference between private - FSGT and FFME structures, have a look to <a href="https://observablehq.com/@rysebaert/forewords">this notebook</a>.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Extract sport climbing areas from OSM ----</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(osmdata)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co"># define a bounding box</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>q0 <span class="ot">&lt;-</span> <span class="fu">opq</span>(<span class="at">bbox =</span> paris10k) </span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="co"># extract climbing areas</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>q <span class="ot">&lt;-</span> <span class="fu">add_osm_feature</span>(<span class="at">opq =</span> q0, <span class="at">key =</span> <span class="st">'sport'</span>, <span class="at">value =</span> <span class="st">"climbing"</span>)</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">osmdata_sf</span>(q)</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>dest <span class="ot">&lt;-</span> res<span class="sc">$</span>osm_points</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Manage private and associative areas</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>private <span class="ot">&lt;-</span> dest[<span class="sc">!</span><span class="fu">is.na</span>(dest<span class="sc">$</span>brand),]</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>asso <span class="ot">&lt;-</span> dest[<span class="sc">!</span><span class="fu">is.na</span>(dest<span class="sc">$</span>federation),]</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>asso<span class="sc">$</span>type <span class="ot">&lt;-</span> <span class="st">"Associative structure"</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>private<span class="sc">$</span>type <span class="ot">&lt;-</span> <span class="st">"Speculative structure"</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>dest <span class="ot">&lt;-</span> <span class="fu">rbind</span>(asso, private)</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>dest <span class="ot">&lt;-</span> dest[,cols]</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>dest<span class="sc">$</span>federation[<span class="fu">is.na</span>(dest<span class="sc">$</span>federation)] <span class="ot">&lt;-</span> <span class="st">"Private"</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Manage artificial area type</span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>dest[<span class="fu">c</span>(<span class="st">"climbing.toprope"</span>, <span class="st">"climbing.boulder"</span>)][<span class="fu">is.na</span>(dest[<span class="fu">c</span>(<span class="st">"climbing.toprope"</span>, <span class="st">"climbing.boulder"</span>)])] <span class="ot">&lt;-</span> <span class="st">"no"</span></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>dest<span class="sc">$</span>climbing_type <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(dest<span class="sc">$</span>climbing.toprope <span class="sc">==</span> <span class="st">'yes'</span>  <span class="sc">&amp;</span> </span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>                               dest<span class="sc">$</span>climbing.boulder <span class="sc">==</span> <span class="st">"yes"</span>,<span class="st">'Wall and bouldering'</span>,</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">ifelse</span>(dest<span class="sc">$</span>climbing.toprope <span class="sc">==</span> <span class="st">'yes'</span> <span class="sc">&amp;</span> </span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>                                      dest<span class="sc">$</span>climbing.boulder <span class="sc">==</span> <span class="st">"no"</span> , <span class="st">'Wall'</span>,</span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">ifelse</span>(dest<span class="sc">$</span>climbing.toprope <span class="sc">==</span> <span class="st">'no'</span> <span class="sc">&amp;</span></span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>                                             dest<span class="sc">$</span>climbing.boulder <span class="sc">==</span> <span class="st">"yes"</span> , <span class="st">'Bouldering'</span>,</span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>                                           <span class="cn">NA</span>)))</span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>cols <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"osm_id"</span>, <span class="st">"name"</span>, <span class="st">"climbing_type"</span>, <span class="st">"climbing.length"</span>,</span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>          <span class="st">"climbing.routes"</span>, <span class="st">"type"</span>, <span class="st">"federation"</span>, <span class="st">"brand"</span>, <span class="st">"SUM_POP18"</span>, <span class="st">"MIN_REV19"</span>, <span class="st">"MOY_REV19"</span>, <span class="st">"MAX_REV19"</span>)</span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>dest <span class="ot">&lt;-</span> dest[,cols]</span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Intersection with bouding box </span></span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a>poi <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(dest, <span class="dv">2154</span>)</span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a>poi <span class="ot">&lt;-</span> <span class="fu">st_intersection</span>(poi, paris5k)</span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>poi <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(poi, <span class="dv">4326</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The data preparation allows to prepare origins-destinations layers for travel-time calculation. Origins correspond to the IRIS layer (only type H : 2141 points). Destinations to artificial climbing areas (45 points).</p>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>Linking to GEOS 3.9.1, GDAL 3.2.1, PROJ 7.2.1; sf_use_s2() is TRUE</code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mapsf)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract centroids from IRIS dedicated to dwellings</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>ori <span class="ot">&lt;-</span> <span class="fu">st_centroid</span>(iris)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>ori <span class="ot">&lt;-</span> ori[ori<span class="sc">$</span>TYP_IRIS <span class="sc">==</span> <span class="st">"H"</span>,]</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Map creation</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>))</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Set a map theme (library mapsf)</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>my_theme <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">bg =</span> <span class="cn">NA</span>, <span class="at">fg =</span> <span class="cn">NA</span>, <span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>), <span class="at">tab =</span> <span class="cn">TRUE</span>, <span class="at">pos =</span> <span class="st">"left"</span>, </span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>                  <span class="at">inner =</span> <span class="cn">TRUE</span>, <span class="at">line =</span> <span class="fl">1.3</span>, <span class="at">cex =</span> <span class="dv">1</span>, <span class="at">font =</span> <span class="dv">2</span>)</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the map</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_init</span>(com, <span class="at">expandBB =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.4</span>,<span class="dv">0</span>,<span class="dv">0</span>), <span class="at">theme =</span> my_theme)</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_typo</span>(</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> iris, <span class="at">var =</span> <span class="st">"TYP_IRIS"</span>, </span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">pal =</span> <span class="fu">c</span>(<span class="st">"peachpuff"</span>, <span class="st">"#feb8ff"</span>, <span class="st">"#f0e6f0"</span>, <span class="st">"#f1f7ab"</span>), <span class="at">lwd =</span> <span class="fl">0.25</span>,</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">val_order =</span> <span class="fu">c</span>(<span class="st">"H"</span>, <span class="st">"A"</span>, <span class="st">"D"</span>, <span class="st">"Z"</span>), <span class="at">border =</span> <span class="st">"white"</span>, <span class="at">leg_pos =</span> <span class="fu">c</span>(<span class="dv">631000</span>, <span class="dv">6872000</span>),</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">leg_title =</span> <span class="st">"IRIS types (H = dwellings)"</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_map</span>(ori, <span class="at">pch =</span> <span class="dv">20</span>, <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">cex =</span> .<span class="dv">2</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_legend</span>(</span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">"symb"</span>, <span class="at">pos =</span>  <span class="fu">c</span>(<span class="dv">631000</span>, <span class="dv">6864000</span>), <span class="at">val =</span> <span class="fu">c</span>(<span class="st">"H"</span>, <span class="st">"H"</span>),</span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">pt_pch =</span> <span class="fu">c</span>(<span class="dv">20</span>,<span class="dv">20</span>), <span class="at">pt_cex =</span>.<span class="dv">2</span>, <span class="at">title =</span> <span class="st">"Origins : IRIS centroids type H"</span>,</span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">pal =</span> <span class="fu">c</span>(<span class="st">"red"</span>, <span class="st">"red"</span>))</span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_typo</span>(<span class="at">x =</span> poi, <span class="at">var =</span> <span class="st">"federation"</span>, <span class="at">pch =</span> <span class="dv">21</span>, <span class="at">cex =</span> .<span class="dv">7</span>,</span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>        <span class="at">val_order =</span> <span class="fu">c</span>(<span class="st">"Private"</span>, <span class="st">"FSGT"</span>, <span class="st">"FFME"</span>),</span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>        <span class="at">pal =</span> <span class="fu">c</span>(<span class="st">"#377eb8"</span>, <span class="st">"#e41a1c"</span>, <span class="st">"#ff7f00"</span>),</span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>        <span class="at">leg_title =</span> <span class="st">"Destinations:</span><span class="sc">\n</span><span class="st">Artificial climbing areas"</span>,</span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>        <span class="at">leg_pos =</span> <span class="fu">c</span>(<span class="dv">631000</span>, <span class="dv">6860000</span>),</span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>        <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_map</span>(com, <span class="at">col =</span> <span class="cn">NA</span>, <span class="at">border =</span> <span class="st">"black"</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_title</span>(<span class="st">"Layers presentation for origins-destinations calculation"</span>)</span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_scale</span>(<span class="at">size =</span> <span class="dv">5</span>, <span class="at">col =</span> <span class="st">"black"</span>, <span class="at">pos =</span> <span class="st">"bottomright"</span>)</span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_credits</span>(<span class="fu">paste0</span>(<span class="st">"Sources : © OpenStreetMap and Contributors, IGN, INSEE, 2022</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Realisation : Ronan Ysebaert, 2022"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid" style="width:100.0%"></p>
</div>
</div>
</section>
<section id="travel-time-calculation-with-osrm" class="level2">
<h2 class="anchored" data-anchor-id="travel-time-calculation-with-osrm">Travel-time calculation with OSRM</h2>
<p>We have now required origins and destinations required to compute travel-time calculations. The computation is realized using the <code>osrm</code> R package (<span class="citation" data-cites="osrm">Giraud (<a href="#ref-osrm" role="doc-biblioref">2022</a>)</span>). This package allows to compute routes, trips, isochrones and travel distances matrices (travel time and kilometric distance).</p>
<p>Considering that the input data are quite important (more than 2000 origin points and 48 destination points) and to avoid to overload the OSRM demo server, I have run my own instance of OSRM based on docker container. To do so the procedure is explained in the <a href="https://github.com/Project-OSRM/osrm-backend#using-docker" title="Run OSRM with docker">following documentation</a>, or more specifically for Windows <a href="https://gist.github.com/AlexandraKapp/e0eee2beacc93e765113aff43ec77789" title="How to set up your own OSRM backend with Docker on Windows">here</a>.</p>
<p>Once it is done, the connection to the rounting engine is operational with the url <code>http://localhost:5000/</code>`.</p>
<p>With OSRM, it is possible to choose several profiles depending on what kind of routing we want to use (car, bike, walking). In our case, we choose by bike considering the fact this is a widespread practice for climbers to reach climbing areas with this transport mean. Moreover, it allows also to avoid to use the car profile, which underestimates the travel-time in metropolitan areas (trafic congestion not taken into account).</p>
<p>The bicycle profile is described in the <a href="https://github.com/Project-OSRM/osrm-backend/blob/master/profiles/bicycle.lua" title="OSRM bicycle profile">github OSRM repository</a>. Basically, the default speed is 15 km/h. It avoids the access to highways, reduce the driving speed by 30 % for unsafe roads. It is important to keep in mind that landforms (elevation) are not considered in the default profile. Some thoughts and solutions exist on the subject, using elevation rasters (<a href="https://www.liedman.net/2015/04/13/add-elevation-data-to-osrm/" title="Adding elevation data to OSRM">Liedman, 2022</a> ; <a href="https://blog.mapbox.com/elevation-aware-routing-profiles-in-mapbox-directions-21e182a85165" title="Elevation-aware routing profiles in Mapbox Directions">Mapbox, 2015</a>).</p>
<p>The code below compute travel-time calculation between the geometric center of IRIS (<code>ori</code>) and artificial climbing areas (<code>poi</code>). It is done for all climbing structures and reproduced according to the type of climbing structure : private or associative structures. For associative structures, we distinguish the FSGT and FFME federations, who do not exactly the same goals in term of practice.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(osrm)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Manage ids</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="fu">row.names</span>(ori) <span class="ot">&lt;-</span> ori<span class="sc">$</span>CODE_IRIS</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Connexion to osrm local server</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">osrm.server =</span> <span class="st">"http://localhost:5000/"</span>, <span class="at">osrm.profile =</span> <span class="st">"bike"</span>)</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Origin-destination calculation</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="co"># All structures</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">osrmTable</span>(<span class="at">src =</span> ori, <span class="at">dst =</span> dest, <span class="at">measure =</span> <span class="st">"duration"</span>)</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(df<span class="sc">$</span>duration)</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(df) <span class="ot">&lt;-</span> <span class="fu">as.character</span>(dest<span class="sc">$</span>osm_id)</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a><span class="fu">row.names</span>(df) <span class="ot">&lt;-</span> <span class="fu">as.character</span>(ori<span class="sc">$</span>CODE_IRIS)</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(df, <span class="st">"data-conso/bike-duration.csv"</span>)</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Private structures</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>dest_priv <span class="ot">&lt;-</span> dest[dest<span class="sc">$</span>type <span class="sc">==</span> <span class="st">"Speculative structure"</span>,] </span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>df2 <span class="ot">&lt;-</span> <span class="fu">osrmTable</span>(<span class="at">src =</span> ori, <span class="at">dst =</span> dest_priv, <span class="at">measure =</span> <span class="st">"duration"</span>)</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>df2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(df2<span class="sc">$</span>duration)</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(df2) <span class="ot">&lt;-</span> <span class="fu">as.character</span>(dest_priv<span class="sc">$</span>osm_id)</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a><span class="fu">row.names</span>(df2) <span class="ot">&lt;-</span> <span class="fu">as.character</span>(ori<span class="sc">$</span>CODE_IRIS)</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(df2, <span class="st">"data-conso/bike-duration-priv.csv"</span>)</span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a><span class="co"># FFME</span></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>dest_asso <span class="ot">&lt;-</span>dest[dest<span class="sc">$</span>type <span class="sc">==</span> <span class="st">"Associative structure"</span>,] </span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>dest_ffme <span class="ot">&lt;-</span> dest_asso[dest_asso<span class="sc">$</span>federation <span class="sc">==</span> <span class="st">"FFME"</span>,]</span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>df3 <span class="ot">&lt;-</span> <span class="fu">osrmTable</span>(<span class="at">src =</span> ori, <span class="at">dst =</span> dest_ffme, <span class="at">measure =</span> <span class="st">"duration"</span>)</span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>df3 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(df3<span class="sc">$</span>duration)</span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(df3) <span class="ot">&lt;-</span> <span class="fu">as.character</span>(dest_ffme<span class="sc">$</span>osm_id)</span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a><span class="fu">row.names</span>(df3) <span class="ot">&lt;-</span> <span class="fu">as.character</span>(ori<span class="sc">$</span>CODE_IRIS)</span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(df3, <span class="st">"data-conso/bike-duration-ffme.csv"</span>)</span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a><span class="co"># FSGT</span></span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a>dest_fsgt <span class="ot">&lt;-</span> dest_asso[poi_asso<span class="sc">$</span>federation <span class="sc">==</span> <span class="st">"FSGT"</span>,]</span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a>df4 <span class="ot">&lt;-</span> <span class="fu">osrmTable</span>(<span class="at">src =</span> ori, <span class="at">dst =</span> dest_fsgt, <span class="at">measure =</span> <span class="st">"duration"</span>)</span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a>df4 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(df4<span class="sc">$</span>duration)</span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(df4) <span class="ot">&lt;-</span> <span class="fu">as.character</span>(poi_fsgt<span class="sc">$</span>osm_id)</span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a><span class="fu">row.names</span>(df4) <span class="ot">&lt;-</span> <span class="fu">as.character</span>(ori<span class="sc">$</span>CODE_IRIS)</span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(df4, <span class="st">"data-conso/bike-duration-fsgt.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="indicators-creation" class="level2">
<h2 class="anchored" data-anchor-id="indicators-creation">Indicators creation</h2>
<section id="at-iris-level" class="level3">
<h3 class="anchored" data-anchor-id="at-iris-level">At IRIS level</h3>
<p>This heavy matrix is then manipulated to extract for each IRIS the following information :</p>
<ul>
<li><p>Name of the nearest climbing structure by bike</p></li>
<li><p>Type of structure (associative or speculative)</p></li>
<li><p>Time to reach it (in minutes)</p></li>
<li><p>Number of artificial climbing areas at less than 15 minutes by bike (N)</p></li>
</ul>
<p>This calculation is done for all climbing structures (ALL), private ones (PRIV), the FFME federation (FFME) and the FSGT one (FSGT). It is done with R base code.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Name of the nearest structure</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>osm_id <span class="ot">&lt;-</span> <span class="fu">colnames</span>(df)[<span class="fu">apply</span>(df, <span class="dv">1</span>, which.min)] <span class="co"># Name</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>osm_id <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(osm_id, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>osm_id<span class="sc">$</span>iris <span class="ot">&lt;-</span> <span class="fu">row.names</span>(df)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>osm_id <span class="ot">&lt;-</span> <span class="fu">merge</span>(osm_id, poi[,<span class="fu">c</span>(<span class="st">"osm_id"</span>, <span class="st">"name"</span>, <span class="st">"type"</span>)], </span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">by =</span> <span class="st">"osm_id"</span>, <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Time to the nearest climbing area</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>time <span class="ot">&lt;-</span> <span class="fu">apply</span>(df, <span class="dv">1</span>, min) <span class="co"># Time</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>time <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(time, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>time<span class="sc">$</span>iris <span class="ot">&lt;-</span> <span class="fu">row.names</span>(time)</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>osm_id <span class="ot">&lt;-</span> <span class="fu">merge</span>(osm_id, time, <span class="at">by =</span> <span class="st">"iris"</span>, <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>osm_id<span class="sc">$</span>geometry <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Number of climbing area at less than 15 minutes by bike</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>n15mn <span class="ot">&lt;-</span> df</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>n15mn <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(df, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>n15mn[n15mn <span class="sc">&lt;</span> <span class="dv">15</span>] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>n15mn[n15mn <span class="sc">&gt;</span> <span class="dv">15</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>n15mn<span class="sc">$</span>N <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(n15mn)</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>n15mn<span class="sc">$</span>iris <span class="ot">&lt;-</span> <span class="fu">row.names</span>(n15mn)</span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>osm_id <span class="ot">&lt;-</span> <span class="fu">merge</span>(osm_id, n15mn[,<span class="fu">c</span>(<span class="st">"iris"</span>, <span class="st">"N"</span>)], <span class="at">by =</span> <span class="st">"iris"</span>,</span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>                <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>osm_id <span class="ot">&lt;-</span> osm_id[,<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span><span class="sc">:</span><span class="dv">6</span>)]</span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(osm_id) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"CODE_IRIS"</span>, <span class="st">"ALL_NAME"</span>, <span class="st">"TYPE_STRUCT"</span>, <span class="st">"ALL_TIME"</span>,</span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"N_15MN"</span>)</span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>iris <span class="ot">&lt;-</span> <span class="fu">merge</span>(iris, osm_id, <span class="at">by =</span> <span class="st">"CODE_IRIS"</span>, <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Prive climbing club (fees $$$)</span></span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Name of the nearest structure</span></span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>osm_id <span class="ot">&lt;-</span> <span class="fu">colnames</span>(df2)[<span class="fu">apply</span>(df2, <span class="dv">1</span>, which.min)] <span class="co"># Name</span></span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>osm_id <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(osm_id, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a>osm_id<span class="sc">$</span>iris <span class="ot">&lt;-</span> <span class="fu">row.names</span>(df2)</span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a>osm_id <span class="ot">&lt;-</span> <span class="fu">merge</span>(osm_id, poi[,<span class="fu">c</span>(<span class="st">"osm_id"</span>, <span class="st">"name"</span>, <span class="st">"type"</span>)], </span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a>                <span class="at">by =</span> <span class="st">"osm_id"</span>, <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Time to the nearest climbing area</span></span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a>time <span class="ot">&lt;-</span> <span class="fu">apply</span>(df2, <span class="dv">1</span>, min) <span class="co"># Time</span></span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a>time <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(time, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a>time<span class="sc">$</span>iris <span class="ot">&lt;-</span> <span class="fu">row.names</span>(time)</span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a>osm_id <span class="ot">&lt;-</span> <span class="fu">merge</span>(osm_id, time, <span class="at">by =</span> <span class="st">"iris"</span>, <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a>osm_id<span class="sc">$</span>geometry <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a><span class="co"># Number of climbing area at less than 15 minutes by bike</span></span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a>n15mn <span class="ot">&lt;-</span> df2</span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a>n15mn <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(df2, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb8-47"><a href="#cb8-47" aria-hidden="true" tabindex="-1"></a>n15mn[n15mn <span class="sc">&lt;</span> <span class="dv">15</span>] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb8-48"><a href="#cb8-48" aria-hidden="true" tabindex="-1"></a>n15mn[n15mn <span class="sc">&gt;</span> <span class="dv">15</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb8-49"><a href="#cb8-49" aria-hidden="true" tabindex="-1"></a>n15mn<span class="sc">$</span>N <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(n15mn)</span>
<span id="cb8-50"><a href="#cb8-50" aria-hidden="true" tabindex="-1"></a>n15mn<span class="sc">$</span>iris <span class="ot">&lt;-</span> <span class="fu">row.names</span>(n15mn)</span>
<span id="cb8-51"><a href="#cb8-51" aria-hidden="true" tabindex="-1"></a>osm_id <span class="ot">&lt;-</span> <span class="fu">merge</span>(osm_id, n15mn[,<span class="fu">c</span>(<span class="st">"iris"</span>, <span class="st">"N"</span>)], <span class="at">by =</span> <span class="st">"iris"</span>,</span>
<span id="cb8-52"><a href="#cb8-52" aria-hidden="true" tabindex="-1"></a>                <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span>
<span id="cb8-53"><a href="#cb8-53" aria-hidden="true" tabindex="-1"></a>osm_id <span class="ot">&lt;-</span> osm_id[,<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">5</span><span class="sc">:</span><span class="dv">6</span>)]</span>
<span id="cb8-54"><a href="#cb8-54" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(osm_id) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"CODE_IRIS"</span>, <span class="st">"PRIV_NAME"</span>, <span class="st">"PRIV_TIME"</span>,</span>
<span id="cb8-55"><a href="#cb8-55" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"N_PRIV_15MN"</span>)</span>
<span id="cb8-56"><a href="#cb8-56" aria-hidden="true" tabindex="-1"></a>iris <span class="ot">&lt;-</span> <span class="fu">merge</span>(iris, osm_id, <span class="at">by =</span> <span class="st">"CODE_IRIS"</span>, <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span>
<span id="cb8-57"><a href="#cb8-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-58"><a href="#cb8-58" aria-hidden="true" tabindex="-1"></a><span class="co"># FFME associative structure</span></span>
<span id="cb8-59"><a href="#cb8-59" aria-hidden="true" tabindex="-1"></a><span class="co"># Name of the nearest structure</span></span>
<span id="cb8-60"><a href="#cb8-60" aria-hidden="true" tabindex="-1"></a>osm_id <span class="ot">&lt;-</span> <span class="fu">colnames</span>(df3)[<span class="fu">apply</span>(df3, <span class="dv">1</span>, which.min)] <span class="co"># Name</span></span>
<span id="cb8-61"><a href="#cb8-61" aria-hidden="true" tabindex="-1"></a>osm_id <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(osm_id, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb8-62"><a href="#cb8-62" aria-hidden="true" tabindex="-1"></a>osm_id<span class="sc">$</span>iris <span class="ot">&lt;-</span> <span class="fu">row.names</span>(df3)</span>
<span id="cb8-63"><a href="#cb8-63" aria-hidden="true" tabindex="-1"></a>osm_id <span class="ot">&lt;-</span> <span class="fu">merge</span>(osm_id, poi[,<span class="fu">c</span>(<span class="st">"osm_id"</span>, <span class="st">"name"</span>, <span class="st">"type"</span>)], </span>
<span id="cb8-64"><a href="#cb8-64" aria-hidden="true" tabindex="-1"></a>                <span class="at">by =</span> <span class="st">"osm_id"</span>, <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span>
<span id="cb8-65"><a href="#cb8-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-66"><a href="#cb8-66" aria-hidden="true" tabindex="-1"></a><span class="co"># Time to the nearest climbing area</span></span>
<span id="cb8-67"><a href="#cb8-67" aria-hidden="true" tabindex="-1"></a>time <span class="ot">&lt;-</span> <span class="fu">apply</span>(df3, <span class="dv">1</span>, min) <span class="co"># Time</span></span>
<span id="cb8-68"><a href="#cb8-68" aria-hidden="true" tabindex="-1"></a>time <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(time, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb8-69"><a href="#cb8-69" aria-hidden="true" tabindex="-1"></a>time<span class="sc">$</span>iris <span class="ot">&lt;-</span> <span class="fu">row.names</span>(time)</span>
<span id="cb8-70"><a href="#cb8-70" aria-hidden="true" tabindex="-1"></a>osm_id <span class="ot">&lt;-</span> <span class="fu">merge</span>(osm_id, time, <span class="at">by =</span> <span class="st">"iris"</span>, <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span>
<span id="cb8-71"><a href="#cb8-71" aria-hidden="true" tabindex="-1"></a>osm_id<span class="sc">$</span>geometry <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb8-72"><a href="#cb8-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-73"><a href="#cb8-73" aria-hidden="true" tabindex="-1"></a><span class="co"># Number of climbing area at less than 15 minutes by bike</span></span>
<span id="cb8-74"><a href="#cb8-74" aria-hidden="true" tabindex="-1"></a>n15mn <span class="ot">&lt;-</span> df3</span>
<span id="cb8-75"><a href="#cb8-75" aria-hidden="true" tabindex="-1"></a>n15mn <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(df3, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb8-76"><a href="#cb8-76" aria-hidden="true" tabindex="-1"></a>n15mn[n15mn <span class="sc">&lt;</span> <span class="dv">15</span>] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb8-77"><a href="#cb8-77" aria-hidden="true" tabindex="-1"></a>n15mn[n15mn <span class="sc">&gt;</span> <span class="dv">15</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb8-78"><a href="#cb8-78" aria-hidden="true" tabindex="-1"></a>n15mn<span class="sc">$</span>N <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(n15mn)</span>
<span id="cb8-79"><a href="#cb8-79" aria-hidden="true" tabindex="-1"></a>n15mn<span class="sc">$</span>iris <span class="ot">&lt;-</span> <span class="fu">row.names</span>(n15mn)</span>
<span id="cb8-80"><a href="#cb8-80" aria-hidden="true" tabindex="-1"></a>osm_id <span class="ot">&lt;-</span> <span class="fu">merge</span>(osm_id, n15mn[,<span class="fu">c</span>(<span class="st">"iris"</span>, <span class="st">"N"</span>)], <span class="at">by =</span> <span class="st">"iris"</span>,</span>
<span id="cb8-81"><a href="#cb8-81" aria-hidden="true" tabindex="-1"></a>                <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span>
<span id="cb8-82"><a href="#cb8-82" aria-hidden="true" tabindex="-1"></a>osm_id <span class="ot">&lt;-</span> osm_id[,<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">5</span><span class="sc">:</span><span class="dv">6</span>)]</span>
<span id="cb8-83"><a href="#cb8-83" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(osm_id) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"CODE_IRIS"</span>, <span class="st">"FFME_NAME"</span>, <span class="st">"FFME_TIME"</span>,</span>
<span id="cb8-84"><a href="#cb8-84" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"N_FFME_15MN"</span>)</span>
<span id="cb8-85"><a href="#cb8-85" aria-hidden="true" tabindex="-1"></a>iris <span class="ot">&lt;-</span> <span class="fu">merge</span>(iris, osm_id, <span class="at">by =</span> <span class="st">"CODE_IRIS"</span>, <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span>
<span id="cb8-86"><a href="#cb8-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-87"><a href="#cb8-87" aria-hidden="true" tabindex="-1"></a><span class="co"># FSGT associative structure</span></span>
<span id="cb8-88"><a href="#cb8-88" aria-hidden="true" tabindex="-1"></a><span class="co"># Name of the nearest structure</span></span>
<span id="cb8-89"><a href="#cb8-89" aria-hidden="true" tabindex="-1"></a>osm_id <span class="ot">&lt;-</span> <span class="fu">colnames</span>(df4)[<span class="fu">apply</span>(df4, <span class="dv">1</span>, which.min)] <span class="co"># Name</span></span>
<span id="cb8-90"><a href="#cb8-90" aria-hidden="true" tabindex="-1"></a>osm_id <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(osm_id, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb8-91"><a href="#cb8-91" aria-hidden="true" tabindex="-1"></a>osm_id<span class="sc">$</span>iris <span class="ot">&lt;-</span> <span class="fu">row.names</span>(df4)</span>
<span id="cb8-92"><a href="#cb8-92" aria-hidden="true" tabindex="-1"></a>osm_id <span class="ot">&lt;-</span> <span class="fu">merge</span>(osm_id, poi[,<span class="fu">c</span>(<span class="st">"osm_id"</span>, <span class="st">"name"</span>, <span class="st">"type"</span>)], </span>
<span id="cb8-93"><a href="#cb8-93" aria-hidden="true" tabindex="-1"></a>                <span class="at">by =</span> <span class="st">"osm_id"</span>, <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span>
<span id="cb8-94"><a href="#cb8-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-95"><a href="#cb8-95" aria-hidden="true" tabindex="-1"></a><span class="co"># Time to the nearest climbing area</span></span>
<span id="cb8-96"><a href="#cb8-96" aria-hidden="true" tabindex="-1"></a>time <span class="ot">&lt;-</span> <span class="fu">apply</span>(df4, <span class="dv">1</span>, min) <span class="co"># Time</span></span>
<span id="cb8-97"><a href="#cb8-97" aria-hidden="true" tabindex="-1"></a>time <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(time, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb8-98"><a href="#cb8-98" aria-hidden="true" tabindex="-1"></a>time<span class="sc">$</span>iris <span class="ot">&lt;-</span> <span class="fu">row.names</span>(time)</span>
<span id="cb8-99"><a href="#cb8-99" aria-hidden="true" tabindex="-1"></a>osm_id <span class="ot">&lt;-</span> <span class="fu">merge</span>(osm_id, time, <span class="at">by =</span> <span class="st">"iris"</span>, <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span>
<span id="cb8-100"><a href="#cb8-100" aria-hidden="true" tabindex="-1"></a>osm_id<span class="sc">$</span>geometry <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb8-101"><a href="#cb8-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-102"><a href="#cb8-102" aria-hidden="true" tabindex="-1"></a><span class="co"># Number of climbing area at less than 15 minutes by bike</span></span>
<span id="cb8-103"><a href="#cb8-103" aria-hidden="true" tabindex="-1"></a>n15mn <span class="ot">&lt;-</span> df4</span>
<span id="cb8-104"><a href="#cb8-104" aria-hidden="true" tabindex="-1"></a>n15mn <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(df4, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb8-105"><a href="#cb8-105" aria-hidden="true" tabindex="-1"></a>n15mn[n15mn <span class="sc">&lt;</span> <span class="dv">15</span>] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb8-106"><a href="#cb8-106" aria-hidden="true" tabindex="-1"></a>n15mn[n15mn <span class="sc">&gt;</span> <span class="dv">15</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb8-107"><a href="#cb8-107" aria-hidden="true" tabindex="-1"></a>n15mn<span class="sc">$</span>N <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(n15mn)</span>
<span id="cb8-108"><a href="#cb8-108" aria-hidden="true" tabindex="-1"></a>n15mn<span class="sc">$</span>iris <span class="ot">&lt;-</span> <span class="fu">row.names</span>(n15mn)</span>
<span id="cb8-109"><a href="#cb8-109" aria-hidden="true" tabindex="-1"></a>osm_id <span class="ot">&lt;-</span> <span class="fu">merge</span>(osm_id, n15mn[,<span class="fu">c</span>(<span class="st">"iris"</span>, <span class="st">"N"</span>)], <span class="at">by =</span> <span class="st">"iris"</span>,</span>
<span id="cb8-110"><a href="#cb8-110" aria-hidden="true" tabindex="-1"></a>                <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span>
<span id="cb8-111"><a href="#cb8-111" aria-hidden="true" tabindex="-1"></a>osm_id <span class="ot">&lt;-</span> osm_id[,<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">5</span><span class="sc">:</span><span class="dv">6</span>)]</span>
<span id="cb8-112"><a href="#cb8-112" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(osm_id) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"CODE_IRIS"</span>, <span class="st">"FSGT_NAME"</span>, <span class="st">"FSGT_TIME"</span>,</span>
<span id="cb8-113"><a href="#cb8-113" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"N_FSGT_15MN"</span>)</span>
<span id="cb8-114"><a href="#cb8-114" aria-hidden="true" tabindex="-1"></a>iris <span class="ot">&lt;-</span> <span class="fu">merge</span>(iris, osm_id, <span class="at">by =</span> <span class="st">"CODE_IRIS"</span>, <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="characterizing-the-poi-neighbourhood" class="level3">
<h3 class="anchored" data-anchor-id="characterizing-the-poi-neighbourhood">Characterizing the POI neighbourhood</h3>
<p>For each climbing areas, we are interested in defining the socio-economic characteristics of their neighbourhood.</p>
<p>The previous matrix is transposed (lines &lt;&gt; columns). For each climbing structure, we extract the IRIS located at less than 15 minutes by bike and to produce the following indicators :</p>
<ul>
<li><p>Total population at less than 15 minutes by bike. This can be considered as an amount of “social demand”.</p></li>
<li><p>Minimum, mean and maximum of median income of IRIS at less than 15 minutes by bike.</p></li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Transpose dataframe</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>t.df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">t</span>(df))</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(t.df) <span class="ot">&lt;-</span> iris10k[iris10k<span class="sc">$</span>TYP_IRIS <span class="sc">==</span> <span class="st">"H"</span>,]<span class="sc">$</span>CODE_IRIS</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>t.df<span class="sc">$</span>osm_id <span class="ot">&lt;-</span> dest<span class="sc">$</span>osm_id</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>t.df <span class="ot">&lt;-</span> t.df[t.df<span class="sc">$</span>osm_id <span class="sc">%in%</span> poi<span class="sc">$</span>osm_id,]</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="co"># For each climbing area, get indicators of interest</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>poi_socio <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">matrix</span>(<span class="at">nrow =</span> <span class="dv">0</span>, <span class="at">ncol =</span> <span class="dv">5</span>))</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(poi_socio) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"osm_id"</span>, <span class="st">"SUM_POP18"</span>, <span class="st">"MIN_REV19"</span>, <span class="st">"MOY_REV19"</span>, <span class="st">"MAX_REV19"</span>)</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(t.df)){</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>  tmp1 <span class="ot">&lt;-</span> t.df[, t.df[i, ] <span class="sc">&lt;</span> <span class="dv">15</span>]</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>  tmp2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">CODE_IRIS =</span> <span class="fu">colnames</span>(tmp1))</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>  tmp2 <span class="ot">&lt;-</span> <span class="fu">merge</span>(tmp2, iris10k[,<span class="fu">c</span>(<span class="st">"CODE_IRIS"</span>, <span class="st">"P18_POP"</span>, <span class="st">"DISP_MED19"</span>)],</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>             <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>  poi_socio[i,<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">row.names</span>(tmp1)[i]</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>  poi_socio[i,<span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="fu">sum</span>(tmp2<span class="sc">$</span>P18_POP, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>  poi_socio[i,<span class="dv">3</span>] <span class="ot">&lt;-</span> <span class="fu">min</span>(tmp2<span class="sc">$</span>DISP_MED19, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>  poi_socio[i,<span class="dv">4</span>] <span class="ot">&lt;-</span> <span class="fu">mean</span>(tmp2<span class="sc">$</span>DISP_MED19, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>  poi_socio[i,<span class="dv">5</span>] <span class="ot">&lt;-</span> <span class="fu">max</span>(tmp2<span class="sc">$</span>DISP_MED19, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>poi <span class="ot">&lt;-</span> <span class="fu">merge</span>(poi, poi_socio, <span class="at">by =</span> <span class="st">"osm_id"</span>, <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="simplify-geometries" class="level2">
<h2 class="anchored" data-anchor-id="simplify-geometries">Simplify geometries</h2>
<p>Geometries are quite detailed. The library <code>rmapshaper</code> (<span class="citation" data-cites="rmapshaper">Andy Teucher (<a href="#ref-rmapshaper" role="doc-biblioref">2022</a>)</span>) is used to simplify the layer. 9 % of the points constituting the polygons are kept. Then, the IRIS layer is aggregated in communes for the map layout.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rmapshaper)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>iris <span class="ot">&lt;-</span> <span class="fu">ms_simplify</span>(iris, <span class="at">keep =</span> <span class="fl">0.09</span>)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Communes aggregation (layout)</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>com <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(iris[,<span class="fu">c</span>(<span class="st">"INSEE_COM"</span>, <span class="st">"NOM_COM"</span>)],</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>                 <span class="at">by =</span> <span class="fu">list</span>(iris<span class="sc">$</span>INSEE_COM),</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>                 <span class="at">FUN =</span> head, <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="export-results" class="level2">
<h2 class="anchored" data-anchor-id="export-results">Export results</h2>
<p>Data preparation is over, we can go the data visualization section. Resulting geojson (poi, iris ad communes) are exported in three separated geojson. These files are available in the <a href="https://github.com/rysebaert/climbing_paris/tree/main/data-conso">Github repository</a>.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_write</span>(com, <span class="st">"data-conso/com.geojson"</span>)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">st_write</span>(iris, <span class="st">"data-conso/iris.geojson"</span>)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="fu">st_write</span>(poi, <span class="st">"data-conso/poi.geojson"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="session-info-r" class="level2">
<h2 class="anchored" data-anchor-id="session-info-r">Session info (R)</h2>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>R version 4.1.2 (2021-11-01)
Platform: x86_64-w64-mingw32/x64 (64-bit)
Running under: Windows 10 x64 (build 19043)

Matrix products: default

locale:
[1] LC_COLLATE=French_France.1252  LC_CTYPE=French_France.1252   
[3] LC_MONETARY=French_France.1252 LC_NUMERIC=C                  
[5] LC_TIME=French_France.1252    

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

other attached packages:
[1] readxl_1.3.1     rmapshaper_0.4.5 osrm_3.5.0       osmdata_0.1.8   
[5] mapsf_0.3.0      sf_1.0-5        

loaded via a namespace (and not attached):
 [1] tidyselect_1.1.1   xfun_0.29          purrr_0.3.4        lattice_0.20-45   
 [5] V8_4.0.0           vctrs_0.3.8        generics_0.1.1     htmltools_0.5.2   
 [9] yaml_2.2.1         utf8_1.2.2         rlang_0.4.11       geojsonlint_0.4.0 
[13] e1071_1.7-9        pillar_1.6.4       glue_1.6.0         httpcode_0.3.0    
[17] DBI_1.1.2          sp_1.4-6           lifecycle_1.0.1    stringr_1.4.0     
[21] cellranger_1.1.0   rvest_1.0.2        htmlwidgets_1.5.4  evaluate_0.14     
[25] knitr_1.37         fastmap_1.1.0      curl_4.3.2         class_7.3-19      
[29] fansi_0.5.0        Rcpp_1.0.7         KernSmooth_2.23-20 classInt_0.4-3    
[33] jsonvalidate_1.3.2 jsonlite_1.7.2     digest_0.6.28      stringi_1.7.6     
[37] dplyr_1.0.7        grid_4.1.2         tools_4.1.2        magrittr_2.0.1    
[41] proxy_0.4-26       tibble_3.1.6       crul_1.2.0         crayon_1.4.2      
[45] pkgconfig_2.0.3    ellipsis_0.3.2     xml2_1.3.3         lubridate_1.8.0   
[49] assertthat_0.2.1   rmarkdown_2.11     httr_1.4.2         R6_2.5.1          
[53] units_0.7-2        compiler_4.1.2    </code></pre>
</div>
</div>
</section>
</section>
<section id="data-visualization-with-observable-javascript-ojs" class="level1">
<h1>Data visualization with Observable JavaScript (ojs)</h1>
<p>Observable is a startup founded by Mike Bostock and Melody Mechfessel, who initiated an on-line plateform to collaboratively explore, analyze, visualize and communicate with data on the Web.</p>
<p>The computing language is <a href="https://observablehq.com/@observablehq/observables-not-javascript">Observable JavaScript (ojs)</a>. It is possible to include this programming language in Quarto chunks.</p>
<p>This section imports some visualizations realized in an <a href="https://observablehq.com/collection/@rysebaert/climbing_paris">Observable collection</a>. We invite the reader to consult the Observable collection to have a look to all the data visualizations produced within this project.</p>
<section id="import-consolidated-data" class="level2">
<h2 class="anchored" data-anchor-id="import-consolidated-data">Import consolidated data</h2>
<p>Geojson files coming from the data preparation precessing realized in a R programming language and described above are imported.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13" data-startfrom="519" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 518;"><span id="cb13-519"><a href="#cb13-519" aria-hidden="true" tabindex="-1"></a>iris <span class="op">=</span> <span class="fu">FileAttachment</span>(<span class="st">"data-conso/iris.geojson"</span>)<span class="op">.</span><span class="fu">json</span>()</span>
<span id="cb13-520"><a href="#cb13-520" aria-hidden="true" tabindex="-1"></a>poi <span class="op">=</span> <span class="fu">FileAttachment</span>(<span class="st">"data-conso/poi.geojson"</span>)<span class="op">.</span><span class="fu">json</span>()</span>
<span id="cb13-521"><a href="#cb13-521" aria-hidden="true" tabindex="-1"></a>com <span class="op">=</span> <span class="fu">FileAttachment</span>(<span class="st">"data-conso/com.geojson"</span>)<span class="op">.</span><span class="fu">json</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-3" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<p>Bertin.js (<span class="citation" data-cites="bertin">Lambert (<a href="#ref-bertin" role="doc-biblioref">2022a</a>)</span>) and geoverview.js (<span class="citation" data-cites="geoverview">Lambert (<a href="#ref-geoverview" role="doc-biblioref">2022b</a>)</span>) libraries are imported. These libraries will be used for creating the maps.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14" data-startfrom="527" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 526;"><span id="cb14-527"><a href="#cb14-527" aria-hidden="true" tabindex="-1"></a>bertin <span class="op">=</span> <span class="pp">require</span>(<span class="st">'bertin@0.9.16'</span>)</span>
<span id="cb14-528"><a href="#cb14-528" aria-hidden="true" tabindex="-1"></a>view <span class="op">=</span> <span class="pp">require</span>(<span class="st">"geoverview@1.2"</span>)<span class="op">.</span><span class="fu">then</span>((f) <span class="kw">=&gt;</span> f<span class="op">.</span><span class="at">view</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-2-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-2-2" data-nodetype="declaration">

</div>
</div>
</div>
</div>
</section>
<section id="layers-attributes-and-metadata" class="level2">
<h2 class="anchored" data-anchor-id="layers-attributes-and-metadata">Layers attributes and metadata</h2>
<p>Three geographical layers will be used :</p>
<ul>
<li><strong>iris</strong> : IRIS intersecting the study area (polygons layer).</li>
<li><strong>poi</strong> : climbing structures included the study area (points layer).</li>
<li><strong>com</strong> : Muncipilaties interesecting thhe study area (polygons layer). This layer will only be used for the map layout and better understand the location of the poi and iris layers : IRIS, the lowest territorial division in France, is not really known by the population.</li>
</ul>
<p>The first two geographical layers include attributes coming from the data preparation process, that will be mapped and ploted in the next section of the document. In this part, we present the layers in several ways to understand the information we have in hand for producing the data visualization.</p>
<section id="interactive-map" class="level3">
<h3 class="anchored" data-anchor-id="interactive-map">Interactive map</h3>
<p>Made with geoverview library. Click on the points / polygons to have an overview of their respective attributes and values.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15" data-startfrom="547" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 546;"><span id="cb15-547"><a href="#cb15-547" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> <span class="kw">new</span> <span class="bu">Map</span>([</span>
<span id="cb15-548"><a href="#cb15-548" aria-hidden="true" tabindex="-1"></a>  [<span class="st">"Climbing areas (dots)"</span><span class="op">,</span> poi]<span class="op">,</span></span>
<span id="cb15-549"><a href="#cb15-549" aria-hidden="true" tabindex="-1"></a>  [<span class="st">"IRIS (polygons)"</span><span class="op">,</span> iris]<span class="op">,</span></span>
<span id="cb15-550"><a href="#cb15-550" aria-hidden="true" tabindex="-1"></a>  [<span class="st">"Layout municipalities (polygons)"</span><span class="op">,</span> com]</span>
<span id="cb15-551"><a href="#cb15-551" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb15-552"><a href="#cb15-552" aria-hidden="true" tabindex="-1"></a>viewof geojson <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">select</span>(data<span class="op">,</span> { <span class="dt">label</span><span class="op">:</span> <span class="st">"Select a geojson"</span> })</span>
<span id="cb15-553"><a href="#cb15-553" aria-hidden="true" tabindex="-1"></a>viewof style <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">select</span>([<span class="st">"voyager"</span><span class="op">,</span> <span class="st">"night"</span><span class="op">,</span> <span class="st">"fulldark"</span><span class="op">,</span><span class="st">"positron"</span><span class="op">,</span><span class="st">"icgc"</span><span class="op">,</span><span class="st">"osmbright"</span><span class="op">,</span><span class="st">"hibrid"</span>]<span class="op">,</span> { <span class="dt">label</span><span class="op">:</span> <span class="st">"Select a style"</span> })</span>
<span id="cb15-554"><a href="#cb15-554" aria-hidden="true" tabindex="-1"></a>map2 <span class="op">=</span> <span class="fu">view</span>(geojson<span class="op">,</span> {</span>
<span id="cb15-555"><a href="#cb15-555" aria-hidden="true" tabindex="-1"></a>  <span class="dt">style</span><span class="op">:</span> style</span>
<span id="cb15-556"><a href="#cb15-556" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-3-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-3-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-3-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-3-4" data-nodetype="declaration">

</div>
</div>
</div>
</div>
</section>
<section id="attributes-and-metadata" class="level3">
<h3 class="anchored" data-anchor-id="attributes-and-metadata">Attributes and metadata</h3>
<p><strong>Attribute table (iris layer)</strong></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16" data-startfrom="563" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 562;"><span id="cb16-563"><a href="#cb16-563" aria-hidden="true" tabindex="-1"></a>Inputs<span class="op">.</span><span class="fu">table</span>(iris<span class="op">.</span><span class="at">features</span><span class="op">.</span><span class="fu">map</span>((d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">properties</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="ojs-cell-4" data-nodetype="expression">

</div>
</div>
</div>
<p><strong>Indicators definition (iris layer)</strong></p>
<table class="table">
<colgroup>
<col style="width: 6%">
<col style="width: 66%">
<col style="width: 26%">
</colgroup>
<thead>
<tr class="header">
<th>id</th>
<th>Description</th>
<th>Data source</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>CODE_IRIS</td>
<td>IRIS code</td>
<td>INSEE, IGN</td>
</tr>
<tr class="even">
<td>NOM_IRIS</td>
<td>IRIS Name</td>
<td>INSEE, IGN</td>
</tr>
<tr class="odd">
<td>TYP_IRIS</td>
<td>IRIS type (H for dwellings)</td>
<td>INSEE, IGN</td>
</tr>
<tr class="even">
<td>P18_POP</td>
<td>Population in 2018</td>
<td>INSEE</td>
</tr>
<tr class="odd">
<td>DISP_MED19</td>
<td>Disposable median income in 2019</td>
<td>INSEE</td>
</tr>
<tr class="even">
<td>ALL_NAME</td>
<td>Name of the nearest artificial climbing area reachable by bike (all structures)</td>
<td>(c)OpenStreetMap and contributors, Ronan Ysebaert</td>
</tr>
<tr class="odd">
<td>TYPE_STRUCT</td>
<td>Manager of the nearest artificial climbing area reachable by bike (private, FSGT or FFME)</td>
<td>(c)OpenStreetMap and contributors, Ronan Ysebaert</td>
</tr>
<tr class="even">
<td>ALL_TIME</td>
<td>Time by bike to reach the nearest artificial climbing area.</td>
<td>(c)OpenStreetMap and contributors, Ronan Ysebaert</td>
</tr>
<tr class="odd">
<td>N_15MN</td>
<td>Number of climbing areas accessible in 15 minutes by bike from the IRIS centroid (all structures)</td>
<td>(c)OpenStreetMap and contributors, Ronan Ysebaert</td>
</tr>
<tr class="even">
<td>PRIV_NAME</td>
<td>Name of the nearest artificial climbing area by bike (Private structure)</td>
<td>(c)OpenStreetMap and contributors, Ronan Ysebaert</td>
</tr>
<tr class="odd">
<td>PRIV_TIME</td>
<td>Time by bike to reach the nearest artificial climbing area (Private structure)</td>
<td>(c)OpenStreetMap and contributors, Ronan Ysebaert</td>
</tr>
<tr class="even">
<td>N_PRIV_15MN</td>
<td>Number of climbing areas accessible in 15 minutes by bike from the IRIS centroid (private structures)</td>
<td>(c)OpenStreetMap and contributors, Ronan Ysebaert</td>
</tr>
<tr class="odd">
<td>FFME_NAME</td>
<td>Name of the nearest artificial climbing area by bike (Associative structure, federation : FFME)</td>
<td>(c)OpenStreetMap and contributors, Ronan Ysebaert</td>
</tr>
<tr class="even">
<td>FFME_TIME</td>
<td>Time by bike to reach the nearest artificial climbing area (Associative structure, federation : FFME)</td>
<td>(c)OpenStreetMap and contributors, Ronan Ysebaert</td>
</tr>
<tr class="odd">
<td>N_FFME_15MN</td>
<td>Number of climbing areas accessible in 15 minutes by bike from the IRIS centroid (Associative structure, federation : FFME)</td>
<td>(c)OpenStreetMap and contributors, Ronan Ysebaert</td>
</tr>
<tr class="even">
<td>FSGT_NAME</td>
<td>Name of the nearest artificial climbing area by bike (Associative structure, federation : FSGT)</td>
<td>(c)OpenStreetMap and contributors, Ronan Ysebaert</td>
</tr>
<tr class="odd">
<td>FSGT_TIME</td>
<td>Time by bike to reach the nearest artificial climbing area (Associative structure, federation : FSGT)</td>
<td>(c)OpenStreetMap and contributors, Ronan Ysebaert</td>
</tr>
<tr class="even">
<td>N_FSGT_15MN</td>
<td>Number of climbing areas accessible in 15 minutes by bike from the IRIS centroid (Associative structure, federation : FSGT)</td>
<td>(c)OpenStreetMap and contributors, Ronan Ysebaert</td>
</tr>
</tbody>
</table>
<p><strong>Attribute table (poi layer)</strong></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17" data-startfrom="593" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 592;"><span id="cb17-593"><a href="#cb17-593" aria-hidden="true" tabindex="-1"></a>Inputs<span class="op">.</span><span class="fu">table</span>(poi<span class="op">.</span><span class="at">features</span><span class="op">.</span><span class="fu">map</span>((d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">properties</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="ojs-cell-5" data-nodetype="expression">

</div>
</div>
</div>
<p><strong>Indicators definition (poi layer)</strong></p>
<table class="table">
<colgroup>
<col style="width: 6%">
<col style="width: 72%">
<col style="width: 21%">
</colgroup>
<thead>
<tr class="header">
<th>id</th>
<th>Description</th>
<th>Data source</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>osm_id</td>
<td>OpenStreetMap identifier (responding to the query sport=climbing in the bounding box of the study area)</td>
<td>(c)OpenStreetMap and contributors</td>
</tr>
<tr class="even">
<td>name</td>
<td>Name of the artificial climbing area</td>
<td>(c)OpenStreetMap and contributors</td>
</tr>
<tr class="odd">
<td>climbing_type</td>
<td>If the articial climbing area is a wall (need a rope to climb), dedicated to bouldering, or both</td>
<td>(c)OpenStreetMap and contributors, Ronan Ysebaert</td>
</tr>
<tr class="even">
<td>climbing_length</td>
<td>Max. height of the wall (if adapted, for walls and not for bouldering)</td>
<td>(c)OpenStreetMap and contributors</td>
</tr>
<tr class="odd">
<td>climbing_routes</td>
<td>Number of climbing routes, materialized by belay station (if adapted, for walls and not for bouldering). Note that in artificial climbing, a same belay station can serve several climbing routes</td>
<td>(c)OpenStreetMap and contributors</td>
</tr>
<tr class="even">
<td>type</td>
<td>If the climbing area is speculative (manage by a private brand) or associative</td>
<td>(c)OpenStreetMap and contributors, Ronan Ysebaert</td>
</tr>
<tr class="odd">
<td>federation</td>
<td>Name of the manager (FFME, FSGT or private)</td>
<td>(c)OpenStreetMap and contributors, Ronan Ysebaert</td>
</tr>
<tr class="even">
<td>brand</td>
<td>Name of the brand managing the private structure</td>
<td>(c)OpenStreetMap and contributors</td>
</tr>
<tr class="odd">
<td>SUM_POP18</td>
<td>Population at less than 15 minutes by bike of the artificial climbing area (IRIS centroids).</td>
<td>INSEE, (c)OpenStreetMap and contributors, Ronan Ysebaert</td>
</tr>
<tr class="even">
<td>MIN_REV19</td>
<td>Mininum of the median income for the IRIS located at less than 15 minutes by bike</td>
<td>INSEE, (c)OpenStreetMap and contributors, Ronan Ysebaert</td>
</tr>
<tr class="odd">
<td>MOY_REV19</td>
<td>Mean of the Median income for the IRIS located at less than 15 minutes by bike</td>
<td>INSEE, (c)OpenStreetMap and contributors, Ronan Ysebaert</td>
</tr>
<tr class="even">
<td>MAX_REV19</td>
<td>Maximum of the Median income for the IRIS located at less than 15 minutes by bike</td>
<td>INSEE, (c)OpenStreetMap and contributors, Ronan Ysebaert</td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="walls-characteristics" class="level2">
<h2 class="anchored" data-anchor-id="walls-characteristics">Wall’s characteristics</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18" data-startfrom="618" data-source-offset="-24"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 617;"><span id="cb18-618"><a href="#cb18-618" aria-hidden="true" tabindex="-1"></a>lambert93 <span class="op">=</span> <span class="st">"+proj=lcc +lat_1=49 +lat_2=44 +lat_0=46.5 +lon_0=3 +x_0=700000 +y_0=6600000 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs"</span></span>
<span id="cb18-619"><a href="#cb18-619" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-620"><a href="#cb18-620" aria-hidden="true" tabindex="-1"></a><span class="co">// Map parameters to play with it</span></span>
<span id="cb18-621"><a href="#cb18-621" aria-hidden="true" tabindex="-1"></a>viewof ind <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">radio</span>([<span class="st">"climbing_length"</span><span class="op">,</span> <span class="st">"climbing_routes"</span>]<span class="op">,</span> {<span class="dt">label</span><span class="op">:</span> <span class="st">"Wall height / Number of routes"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="st">"climbing_length"</span>})</span>
<span id="cb18-622"><a href="#cb18-622" aria-hidden="true" tabindex="-1"></a>viewof k <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">10</span><span class="op">,</span> <span class="dv">300</span>]<span class="op">,</span> { <span class="dt">label</span><span class="op">:</span> <span class="st">"Spikes height"</span><span class="op">,</span> <span class="dt">step</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="dv">90</span> })</span>
<span id="cb18-623"><a href="#cb18-623" aria-hidden="true" tabindex="-1"></a>viewof w <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">2</span><span class="op">,</span> <span class="dv">30</span>]<span class="op">,</span> { <span class="dt">label</span><span class="op">:</span> <span class="st">"Spikes / dots width"</span><span class="op">,</span> <span class="dt">step</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="dv">15</span> })</span>
<span id="cb18-624"><a href="#cb18-624" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-625"><a href="#cb18-625" aria-hidden="true" tabindex="-1"></a><span class="co">// Spike map </span></span>
<span id="cb18-626"><a href="#cb18-626" aria-hidden="true" tabindex="-1"></a>map <span class="op">=</span> bertin<span class="op">.</span><span class="fu">draw</span>({</span>
<span id="cb18-627"><a href="#cb18-627" aria-hidden="true" tabindex="-1"></a>  <span class="dt">params</span><span class="op">:</span> {</span>
<span id="cb18-628"><a href="#cb18-628" aria-hidden="true" tabindex="-1"></a>    <span class="dt">width</span><span class="op">:</span> <span class="dv">750</span><span class="op">,</span></span>
<span id="cb18-629"><a href="#cb18-629" aria-hidden="true" tabindex="-1"></a>    <span class="dt">projection</span><span class="op">:</span> lambert93<span class="op">,</span></span>
<span id="cb18-630"><a href="#cb18-630" aria-hidden="true" tabindex="-1"></a>    <span class="dt">extent</span><span class="op">:</span> com</span>
<span id="cb18-631"><a href="#cb18-631" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb18-632"><a href="#cb18-632" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-633"><a href="#cb18-633" aria-hidden="true" tabindex="-1"></a>  <span class="dt">layers</span><span class="op">:</span> [</span>
<span id="cb18-634"><a href="#cb18-634" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb18-635"><a href="#cb18-635" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"spikes"</span><span class="op">,</span></span>
<span id="cb18-636"><a href="#cb18-636" aria-hidden="true" tabindex="-1"></a>      <span class="dt">geojson</span><span class="op">:</span> poi<span class="op">,</span></span>
<span id="cb18-637"><a href="#cb18-637" aria-hidden="true" tabindex="-1"></a>      <span class="dt">values</span><span class="op">:</span> ind<span class="op">,</span></span>
<span id="cb18-638"><a href="#cb18-638" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fillOpacity</span><span class="op">:</span> <span class="fl">0.2</span><span class="op">,</span></span>
<span id="cb18-639"><a href="#cb18-639" aria-hidden="true" tabindex="-1"></a>      <span class="dt">k</span><span class="op">:</span> k<span class="op">,</span></span>
<span id="cb18-640"><a href="#cb18-640" aria-hidden="true" tabindex="-1"></a>      <span class="dt">w</span><span class="op">:</span> w<span class="op">,</span></span>
<span id="cb18-641"><a href="#cb18-641" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> {</span>
<span id="cb18-642"><a href="#cb18-642" aria-hidden="true" tabindex="-1"></a>        <span class="dt">type</span><span class="op">:</span> <span class="st">"typo"</span><span class="op">,</span></span>
<span id="cb18-643"><a href="#cb18-643" aria-hidden="true" tabindex="-1"></a>        <span class="dt">values</span><span class="op">:</span> <span class="st">"federation"</span><span class="op">,</span></span>
<span id="cb18-644"><a href="#cb18-644" aria-hidden="true" tabindex="-1"></a>        <span class="dt">colors</span><span class="op">:</span> [<span class="st">"#9990f0"</span><span class="op">,</span> <span class="st">"#fcb456"</span><span class="op">,</span> <span class="st">"#ba0b25"</span>]<span class="op">,</span></span>
<span id="cb18-645"><a href="#cb18-645" aria-hidden="true" tabindex="-1"></a>        <span class="dt">leg_title</span><span class="op">:</span> <span class="vs">`Wall's managers`</span><span class="op">,</span></span>
<span id="cb18-646"><a href="#cb18-646" aria-hidden="true" tabindex="-1"></a>        <span class="dt">leg_x</span><span class="op">:</span> <span class="dv">600</span><span class="op">,</span></span>
<span id="cb18-647"><a href="#cb18-647" aria-hidden="true" tabindex="-1"></a>        <span class="dt">leg_y</span><span class="op">:</span> <span class="dv">550</span></span>
<span id="cb18-648"><a href="#cb18-648" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb18-649"><a href="#cb18-649" aria-hidden="true" tabindex="-1"></a>      <span class="dt">stroke</span><span class="op">:</span> {</span>
<span id="cb18-650"><a href="#cb18-650" aria-hidden="true" tabindex="-1"></a>        <span class="dt">type</span><span class="op">:</span> <span class="st">"typo"</span><span class="op">,</span></span>
<span id="cb18-651"><a href="#cb18-651" aria-hidden="true" tabindex="-1"></a>        <span class="dt">values</span><span class="op">:</span> <span class="st">"federation"</span><span class="op">,</span></span>
<span id="cb18-652"><a href="#cb18-652" aria-hidden="true" tabindex="-1"></a>        <span class="dt">colors</span><span class="op">:</span> [<span class="st">"#9990f0"</span><span class="op">,</span> <span class="st">"#fcb456"</span><span class="op">,</span> <span class="st">"#ba0b25"</span>]</span>
<span id="cb18-653"><a href="#cb18-653" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb18-654"><a href="#cb18-654" aria-hidden="true" tabindex="-1"></a>      <span class="dt">leg_x</span><span class="op">:</span> <span class="dv">15</span><span class="op">,</span></span>
<span id="cb18-655"><a href="#cb18-655" aria-hidden="true" tabindex="-1"></a>      <span class="dt">leg_y</span><span class="op">:</span> <span class="dv">15</span><span class="op">,</span></span>
<span id="cb18-656"><a href="#cb18-656" aria-hidden="true" tabindex="-1"></a>      <span class="dt">leg_round</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb18-657"><a href="#cb18-657" aria-hidden="true" tabindex="-1"></a>      <span class="dt">leg_title</span><span class="op">:</span> <span class="vs">`Height (meters) or routes number`</span><span class="op">,</span></span>
<span id="cb18-658"><a href="#cb18-658" aria-hidden="true" tabindex="-1"></a>      <span class="dt">tooltip</span><span class="op">:</span> {</span>
<span id="cb18-659"><a href="#cb18-659" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fields</span><span class="op">:</span> [</span>
<span id="cb18-660"><a href="#cb18-660" aria-hidden="true" tabindex="-1"></a>          <span class="st">"$name"</span><span class="op">,</span></span>
<span id="cb18-661"><a href="#cb18-661" aria-hidden="true" tabindex="-1"></a>          <span class="st">"$climbing_length"</span><span class="op">,</span></span>
<span id="cb18-662"><a href="#cb18-662" aria-hidden="true" tabindex="-1"></a>          <span class="st">"(height in meters)"</span><span class="op">,</span></span>
<span id="cb18-663"><a href="#cb18-663" aria-hidden="true" tabindex="-1"></a>          <span class="st">"$climbing_routes"</span><span class="op">,</span></span>
<span id="cb18-664"><a href="#cb18-664" aria-hidden="true" tabindex="-1"></a>          <span class="st">"(nb. routes)"</span><span class="op">,</span></span>
<span id="cb18-665"><a href="#cb18-665" aria-hidden="true" tabindex="-1"></a>          <span class="st">"$federation"</span><span class="op">,</span></span>
<span id="cb18-666"><a href="#cb18-666" aria-hidden="true" tabindex="-1"></a>          <span class="st">"(manager)"</span></span>
<span id="cb18-667"><a href="#cb18-667" aria-hidden="true" tabindex="-1"></a>        ]<span class="op">,</span></span>
<span id="cb18-668"><a href="#cb18-668" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fill</span><span class="op">:</span> [<span class="st">"black"</span><span class="op">,</span> <span class="st">"black"</span><span class="op">,</span> <span class="st">"black"</span><span class="op">,</span> <span class="st">"black"</span><span class="op">,</span> <span class="st">"black"</span><span class="op">,</span> <span class="st">"black"</span><span class="op">,</span> <span class="st">"black"</span>]<span class="op">,</span></span>
<span id="cb18-669"><a href="#cb18-669" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fontWeight</span><span class="op">:</span> [</span>
<span id="cb18-670"><a href="#cb18-670" aria-hidden="true" tabindex="-1"></a>          <span class="st">"bold"</span><span class="op">,</span></span>
<span id="cb18-671"><a href="#cb18-671" aria-hidden="true" tabindex="-1"></a>          <span class="st">"normal"</span><span class="op">,</span></span>
<span id="cb18-672"><a href="#cb18-672" aria-hidden="true" tabindex="-1"></a>          <span class="st">"normal"</span><span class="op">,</span></span>
<span id="cb18-673"><a href="#cb18-673" aria-hidden="true" tabindex="-1"></a>          <span class="st">"normal"</span><span class="op">,</span></span>
<span id="cb18-674"><a href="#cb18-674" aria-hidden="true" tabindex="-1"></a>          <span class="st">"normal"</span><span class="op">,</span></span>
<span id="cb18-675"><a href="#cb18-675" aria-hidden="true" tabindex="-1"></a>          <span class="st">"normal"</span><span class="op">,</span></span>
<span id="cb18-676"><a href="#cb18-676" aria-hidden="true" tabindex="-1"></a>          <span class="st">"normal"</span></span>
<span id="cb18-677"><a href="#cb18-677" aria-hidden="true" tabindex="-1"></a>        ]<span class="op">,</span></span>
<span id="cb18-678"><a href="#cb18-678" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fontSize</span><span class="op">:</span> [<span class="dv">14</span><span class="op">,</span> <span class="dv">12</span><span class="op">,</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">12</span><span class="op">,</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">12</span><span class="op">,</span> <span class="dv">10</span>]<span class="op">,</span></span>
<span id="cb18-679"><a href="#cb18-679" aria-hidden="true" tabindex="-1"></a>        <span class="dt">col</span><span class="op">:</span> <span class="st">"white"</span></span>
<span id="cb18-680"><a href="#cb18-680" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb18-681"><a href="#cb18-681" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb18-682"><a href="#cb18-682" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-683"><a href="#cb18-683" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb18-684"><a href="#cb18-684" aria-hidden="true" tabindex="-1"></a>      <span class="dt">geojson</span><span class="op">:</span> poi<span class="op">,</span></span>
<span id="cb18-685"><a href="#cb18-685" aria-hidden="true" tabindex="-1"></a>      <span class="dt">symbol_size</span><span class="op">:</span> <span class="dv">10</span> <span class="op">*</span> w<span class="op">,</span></span>
<span id="cb18-686"><a href="#cb18-686" aria-hidden="true" tabindex="-1"></a>      <span class="dt">symbol</span><span class="op">:</span> <span class="st">"circle"</span><span class="op">,</span></span>
<span id="cb18-687"><a href="#cb18-687" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> {</span>
<span id="cb18-688"><a href="#cb18-688" aria-hidden="true" tabindex="-1"></a>        <span class="dt">type</span><span class="op">:</span> <span class="st">"typo"</span><span class="op">,</span></span>
<span id="cb18-689"><a href="#cb18-689" aria-hidden="true" tabindex="-1"></a>        <span class="dt">values</span><span class="op">:</span> <span class="st">"climbing_type"</span><span class="op">,</span></span>
<span id="cb18-690"><a href="#cb18-690" aria-hidden="true" tabindex="-1"></a>        <span class="dt">colors</span><span class="op">:</span> [<span class="st">"white"</span><span class="op">,</span> <span class="st">"lightgrey"</span><span class="op">,</span> <span class="st">"grey"</span>]<span class="op">,</span></span>
<span id="cb18-691"><a href="#cb18-691" aria-hidden="true" tabindex="-1"></a>        <span class="dt">leg_title</span><span class="op">:</span> <span class="vs">`Climbing type`</span><span class="op">,</span></span>
<span id="cb18-692"><a href="#cb18-692" aria-hidden="true" tabindex="-1"></a>        <span class="dt">leg_x</span><span class="op">:</span> <span class="dv">600</span><span class="op">,</span></span>
<span id="cb18-693"><a href="#cb18-693" aria-hidden="true" tabindex="-1"></a>        <span class="dt">leg_y</span><span class="op">:</span> <span class="dv">430</span></span>
<span id="cb18-694"><a href="#cb18-694" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb18-695"><a href="#cb18-695" aria-hidden="true" tabindex="-1"></a>      <span class="dt">stroke</span><span class="op">:</span> {</span>
<span id="cb18-696"><a href="#cb18-696" aria-hidden="true" tabindex="-1"></a>        <span class="dt">type</span><span class="op">:</span> <span class="st">"typo"</span><span class="op">,</span></span>
<span id="cb18-697"><a href="#cb18-697" aria-hidden="true" tabindex="-1"></a>        <span class="dt">values</span><span class="op">:</span> <span class="st">"federation"</span><span class="op">,</span></span>
<span id="cb18-698"><a href="#cb18-698" aria-hidden="true" tabindex="-1"></a>        <span class="dt">colors</span><span class="op">:</span> [<span class="st">"#9990f0"</span><span class="op">,</span> <span class="st">"#fcb456"</span><span class="op">,</span> <span class="st">"#ba0b25"</span>]</span>
<span id="cb18-699"><a href="#cb18-699" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb18-700"><a href="#cb18-700" aria-hidden="true" tabindex="-1"></a>      <span class="dt">strokeWidth</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span></span>
<span id="cb18-701"><a href="#cb18-701" aria-hidden="true" tabindex="-1"></a>      <span class="dt">tooltip</span><span class="op">:</span> {</span>
<span id="cb18-702"><a href="#cb18-702" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fields</span><span class="op">:</span> [<span class="st">"$name"</span><span class="op">,</span> <span class="st">"$climbing_type"</span>]<span class="op">,</span></span>
<span id="cb18-703"><a href="#cb18-703" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fill</span><span class="op">:</span> [<span class="st">"black"</span><span class="op">,</span> <span class="st">"black"</span>]<span class="op">,</span></span>
<span id="cb18-704"><a href="#cb18-704" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fontWeight</span><span class="op">:</span> [<span class="st">"bold"</span><span class="op">,</span> <span class="st">"normal"</span>]<span class="op">,</span></span>
<span id="cb18-705"><a href="#cb18-705" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fontSize</span><span class="op">:</span> [<span class="dv">12</span><span class="op">,</span> <span class="dv">10</span>]<span class="op">,</span></span>
<span id="cb18-706"><a href="#cb18-706" aria-hidden="true" tabindex="-1"></a>        <span class="dt">col</span><span class="op">:</span> <span class="st">"white"</span></span>
<span id="cb18-707"><a href="#cb18-707" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb18-708"><a href="#cb18-708" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb18-709"><a href="#cb18-709" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-710"><a href="#cb18-710" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb18-711"><a href="#cb18-711" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"text"</span><span class="op">,</span></span>
<span id="cb18-712"><a href="#cb18-712" aria-hidden="true" tabindex="-1"></a>      <span class="dt">position</span><span class="op">:</span> <span class="st">"topright"</span><span class="op">,</span></span>
<span id="cb18-713"><a href="#cb18-713" aria-hidden="true" tabindex="-1"></a>      <span class="dt">text</span><span class="op">:</span> <span class="st">"Climbing hot spots"</span><span class="op">,</span></span>
<span id="cb18-714"><a href="#cb18-714" aria-hidden="true" tabindex="-1"></a>      <span class="dt">frame_opacity</span><span class="op">:</span> <span class="fl">0.7</span><span class="op">,</span></span>
<span id="cb18-715"><a href="#cb18-715" aria-hidden="true" tabindex="-1"></a>      <span class="dt">baseline</span><span class="op">:</span> <span class="st">"hanging"</span><span class="op">,</span></span>
<span id="cb18-716"><a href="#cb18-716" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> <span class="st">"black"</span><span class="op">,</span></span>
<span id="cb18-717"><a href="#cb18-717" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fontSize</span><span class="op">:</span> <span class="dv">25</span><span class="op">,</span></span>
<span id="cb18-718"><a href="#cb18-718" aria-hidden="true" tabindex="-1"></a>      <span class="dt">margin</span><span class="op">:</span> <span class="dv">4</span><span class="op">,</span></span>
<span id="cb18-719"><a href="#cb18-719" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fontWeight</span><span class="op">:</span> <span class="st">"bold"</span><span class="op">,</span></span>
<span id="cb18-720"><a href="#cb18-720" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fontFamily</span><span class="op">:</span> <span class="st">"Ubuntu"</span></span>
<span id="cb18-721"><a href="#cb18-721" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb18-722"><a href="#cb18-722" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-723"><a href="#cb18-723" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb18-724"><a href="#cb18-724" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"layer"</span><span class="op">,</span></span>
<span id="cb18-725"><a href="#cb18-725" aria-hidden="true" tabindex="-1"></a>      <span class="dt">geojson</span><span class="op">:</span> com<span class="op">,</span></span>
<span id="cb18-726"><a href="#cb18-726" aria-hidden="true" tabindex="-1"></a>      <span class="dt">stroke</span><span class="op">:</span> <span class="st">"white"</span><span class="op">,</span></span>
<span id="cb18-727"><a href="#cb18-727" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> <span class="st">"peachpuff"</span><span class="op">,</span></span>
<span id="cb18-728"><a href="#cb18-728" aria-hidden="true" tabindex="-1"></a>      <span class="dt">tooltip</span><span class="op">:</span> [<span class="st">"$NOM_COM"</span>]</span>
<span id="cb18-729"><a href="#cb18-729" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb18-730"><a href="#cb18-730" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-731"><a href="#cb18-731" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb18-732"><a href="#cb18-732" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"scalebar"</span><span class="op">,</span></span>
<span id="cb18-733"><a href="#cb18-733" aria-hidden="true" tabindex="-1"></a>      <span class="dt">units</span><span class="op">:</span> <span class="st">"miles"</span></span>
<span id="cb18-734"><a href="#cb18-734" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb18-735"><a href="#cb18-735" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-736"><a href="#cb18-736" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb18-737"><a href="#cb18-737" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"footer"</span><span class="op">,</span></span>
<span id="cb18-738"><a href="#cb18-738" aria-hidden="true" tabindex="-1"></a>      <span class="dt">text</span><span class="op">:</span></span>
<span id="cb18-739"><a href="#cb18-739" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Sources: (c)OpenStreetMap and contributors, INSEE, IGN, 2022</span><span class="sc">\n</span><span class="st">Realisation: Ronan Ysebaert, 2022"</span></span>
<span id="cb18-740"><a href="#cb18-740" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb18-741"><a href="#cb18-741" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb18-742"><a href="#cb18-742" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-6-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-6-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-6-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-6-4" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-6-5" data-nodetype="declaration">

</div>
</div>
</div>
</div>
</section>
</section>
<section id="concluding-methodological-remarks" class="level1">
<h1>Concluding methodological remarks</h1>
<section id="extend-the-analysis" class="level2">
<h2 class="anchored" data-anchor-id="extend-the-analysis">Extend the analysis</h2>
<p>This methodological example showed a general methodology to combine institutional and crowd-sourced data to develop some simple indicators of accessibility to services of interest using open-source routing engines, and disseminate this with data visualizations frameworks. It is one possible implementation, among others. Other implementations could easily be envisaged.</p>
<ul>
<li><strong>Geographical coverage</strong>: The data preparation process presented above requires the definition of a geographical bounding box to extract OpenStreetMap points of interest (destinations of travel-time calculations) and an existing territorial division (the centroids being the origins of the travel-time calculations). This could be easily extented to other areas of interest, by modifying the Xmin, Xmax, Ymin and Ymax of the bounding box, or using other territorial divisions (a regular grid, for instance). The important things to consider is<br>
</li>
<li><strong>Use other points of interest</strong>: This example used the OpenStreetMap tag defined by the key-value <code>sport=climbing</code>. Other <a href="https://wiki.openstreetmap.org/wiki/Map_features">map features</a> could be investigated, such as <a href="https://wiki.openstreetmap.org/wiki/Key:amenity">amenities</a>, <a href="https://wiki.openstreetmap.org/wiki/Map_features#Tourism">tourism facilities</a> or <a href="https://wiki.openstreetmap.org/wiki/Map_features#Shop">shops</a>. The only element to consider is the geometric reference of the object in the OpenStreetMap database ; it could be nodes, ways or relations. In the case of sport=climbing tag, the <a href="https://wiki.openstreetmap.org/wiki/Tag%3Asport%3Dclimbing">OpenStreetMap Wiki</a> reminds that <em>sport=climbing should preferably applied to nodes for artificial climbing walls</em>, our case. If the tag combines nodes and areas, it requires also to extract polygons responding to the tag and transform it into points, checking if the information is not included twice in the OpenStreetMap database.<br>
</li>
<li><strong>Apply other profiles</strong>: In this example, the standard bike profile has been applied. The pedestrian and the car profile are also available and may be also used depending on the objective of the analysis. Whatever the profile used, it reminds important to the parameters of the profiles (<a href="https://github.com/Project-OSRM/osrm-backend/blob/master/profiles/car.lua">car here</a>, <a href="https://github.com/Project-OSRM/osrm-backend/blob/master/profiles/bicycle.lua">bike here</a> and <a href="https://github.com/Project-OSRM/osrm-backend/blob/master/profiles/foot.lua">pedestrian here</a>) to understand the calculations realized with routing engines, and their limitations. It is also possible to implement its <a href="https://github.com/Project-OSRM/osrm-backend/blob/master/docs/profiles.md">own profile</a>.</li>
</ul>
</section>
<section id="usage-precautions" class="level2">
<h2 class="anchored" data-anchor-id="usage-precautions">Usage precautions</h2>
<p>One persisting criticism made to OpenStreetMap is its lack of quality, mainly due to its general and contributive organisations implying a high heterogeneity of contribution practices. Known problems are due to <a href="https://wiki.openstreetmap.org/wiki/Accuracy">geometric accuracy</a> (geographical positioning of OSM objects), completeness <a href="https://wiki.openstreetmap.org/wiki/Accuracy">accuracy</a> and <a href="https://wiki.openstreetmap.org/wiki/Completeness">completeness</a> (missing information, not up-to-date) or problems due to the <a href="https://wiki.openstreetmap.org/wiki/Category:Tagging_Mistakes">tags</a> describing OSM objects (missing important tags, bad practices).</p>
<p>In that case, I made a personal survey to complete missing information (around 30 % of the information was missing) in OpenStreetMap database. It meant add some missing points in some cases, and in others to describe it with <a href="https://wiki.openstreetmap.org/wiki/Climbing">relevant climbing tags</a> identified in the OpenStreetMap Wiki. At the end, it is sure that the input information is not perfect and would require double-checks by the community, but we can argue that it was not worst than in the begginning.</p>
<p><strong>Whatever the use of OpenStreetMap you may made, taking a step back to these questions is very important to control</strong> <strong><em>a minima</em></strong> <strong>the input information used for the travel-time calculations</strong>.</p>
<p>Another point to have in mind is the default parameters of osrm profiles: bike profile does not take into account the slope of the road ; the car profile does not take into account the trafic congestion. It may have significant impact on the travel-time calculations.</p>
<p>Nevertheless, we argue that OpenStreetMap is a wonderful initiative and as we try to demonstrate in this notebook, it is not too difficult to produce innovative indicators and data visualizations using open-source database and libraries.</p>
<p>Enjoy !</p>
</section>
</section>
<section id="references" class="level1">

<!-- -->


</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" role="doc-bibliography">
<div id="ref-rmapshaper" class="csl-entry" role="doc-biblioentry">
Andy Teucher, Kenton Russell. 2022. <em>Rmapshaper: Client for ’Mapshaper’ for ’Geospatial’ Operations</em>. <a href="https://www.npmjs.com/package/geoverview">https://www.npmjs.com/package/geoverview</a>.
</div>
<div id="ref-osrm" class="csl-entry" role="doc-biblioentry">
Giraud, Timothée. 2022. <em>Osrm: Interface Between r and the OpenStreetMap-Based Routing Service OSRM</em>. <a href="https://CRAN.R-project.org/package=osrm">https://CRAN.R-project.org/package=osrm</a>.
</div>
<div id="ref-bertin" class="csl-entry" role="doc-biblioentry">
Lambert, Nicolas. 2022a. <em>Bertin.js: A JavaScript Library for Visualizing Geospatial Data and Make Thematic Maps for the Web</em>. <a href="https://www.npmjs.com/package/bertin">https://www.npmjs.com/package/bertin</a>.
</div>
<div id="ref-geoverview" class="csl-entry" role="doc-biblioentry">
———. 2022b. <em>Geoverview.js: A Tool for Giving a Quick and Easy Geographic Overview of Any Geojson</em>. <a href="https://www.npmjs.com/package/geoverview">https://www.npmjs.com/package/geoverview</a>.
</div>
<div id="ref-osmdata" class="csl-entry" role="doc-biblioentry">
Mark Padgham, Robin Lovelace, Bob Rudis. 2022. <em>Osmdata: Import ‘OpenStreetMap‘ Data as Simple Features of Spatial Objects</em>. <a href="https://CRAN.R-project.org/package=osmdata">https://CRAN.R-project.org/package=osmdata</a>.
</div>
</div></section><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{ysebaert2022,
  author = {Ronan Ysebaert},
  title = {OSRM {Travel-time} Calculation with {R} and Data
    Visualization with {Observable}},
  date = {2022-06},
  langid = {en}
}
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-ysebaert2022" class="csl-entry quarto-appendix-citeas" role="doc-biblioentry">
Ronan Ysebaert. 2022. <span>“OSRM Travel-Time Calculation with R and
Data Visualization with Observable.”</span> June 2022.
</div></div></section></div></main>
<!-- /main column -->

<script type="ojs-module-contents">
{"contents":[{"methodName":"interpret","cellName":"ojs-cell-1","inline":false,"source":"iris = FileAttachment(\"data-conso/iris.geojson\").json()\npoi = FileAttachment(\"data-conso/poi.geojson\").json()\ncom = FileAttachment(\"data-conso/com.geojson\").json()\n"},{"methodName":"interpret","cellName":"ojs-cell-2","inline":false,"source":"bertin = require('bertin@0.9.16')\nview = require(\"geoverview@1.2\").then((f) => f.view)\n"},{"methodName":"interpret","cellName":"ojs-cell-3","inline":false,"source":"data = new Map([\n  [\"Climbing areas (dots)\", poi],\n  [\"IRIS (polygons)\", iris],\n  [\"Layout municipalities (polygons)\", com]\n])\nviewof geojson = Inputs.select(data, { label: \"Select a geojson\" })\nviewof style = Inputs.select([\"voyager\", \"night\", \"fulldark\",\"positron\",\"icgc\",\"osmbright\",\"hibrid\"], { label: \"Select a style\" })\nmap2 = view(geojson, {\n  style: style\n})\n"},{"methodName":"interpret","cellName":"ojs-cell-4","inline":false,"source":"Inputs.table(iris.features.map((d) => d.properties))\n"},{"methodName":"interpret","cellName":"ojs-cell-5","inline":false,"source":"Inputs.table(poi.features.map((d) => d.properties))\n"},{"methodName":"interpret","cellName":"ojs-cell-6","inline":false,"source":"//Manage map projection\nlambert93 = \"+proj=lcc +lat_1=49 +lat_2=44 +lat_0=46.5 +lon_0=3 +x_0=700000 +y_0=6600000 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs\"\n\n// Map parameters to play with it\nviewof ind = Inputs.radio([\"climbing_length\", \"climbing_routes\"], {label: \"Wall height / Number of routes\", value: \"climbing_length\"})\nviewof k = Inputs.range([10, 300], { label: \"Spikes height\", step: 1, value: 90 })\nviewof w = Inputs.range([2, 30], { label: \"Spikes / dots width\", step: 1, value: 15 })\n\n// Spike map \nmap = bertin.draw({\n  params: {\n    width: 750,\n    projection: lambert93,\n    extent: com\n  },\n\n  layers: [\n    {\n      type: \"spikes\",\n      geojson: poi,\n      values: ind,\n      fillOpacity: 0.2,\n      k: k,\n      w: w,\n      fill: {\n        type: \"typo\",\n        values: \"federation\",\n        colors: [\"#9990f0\", \"#fcb456\", \"#ba0b25\"],\n        leg_title: `Wall's managers`,\n        leg_x: 600,\n        leg_y: 550\n      },\n      stroke: {\n        type: \"typo\",\n        values: \"federation\",\n        colors: [\"#9990f0\", \"#fcb456\", \"#ba0b25\"]\n      },\n      leg_x: 15,\n      leg_y: 15,\n      leg_round: 0,\n      leg_title: `Height (meters) or routes number`,\n      tooltip: {\n        fields: [\n          \"$name\",\n          \"$climbing_length\",\n          \"(height in meters)\",\n          \"$climbing_routes\",\n          \"(nb. routes)\",\n          \"$federation\",\n          \"(manager)\"\n        ],\n        fill: [\"black\", \"black\", \"black\", \"black\", \"black\", \"black\", \"black\"],\n        fontWeight: [\n          \"bold\",\n          \"normal\",\n          \"normal\",\n          \"normal\",\n          \"normal\",\n          \"normal\",\n          \"normal\"\n        ],\n        fontSize: [14, 12, 10, 12, 10, 12, 10],\n        col: \"white\"\n      }\n    },\n\n    {\n      geojson: poi,\n      symbol_size: 10 * w,\n      symbol: \"circle\",\n      fill: {\n        type: \"typo\",\n        values: \"climbing_type\",\n        colors: [\"white\", \"lightgrey\", \"grey\"],\n        leg_title: `Climbing type`,\n        leg_x: 600,\n        leg_y: 430\n      },\n      stroke: {\n        type: \"typo\",\n        values: \"federation\",\n        colors: [\"#9990f0\", \"#fcb456\", \"#ba0b25\"]\n      },\n      strokeWidth: 2,\n      tooltip: {\n        fields: [\"$name\", \"$climbing_type\"],\n        fill: [\"black\", \"black\"],\n        fontWeight: [\"bold\", \"normal\"],\n        fontSize: [12, 10],\n        col: \"white\"\n      }\n    },\n\n    {\n      type: \"text\",\n      position: \"topright\",\n      text: \"Climbing hot spots\",\n      frame_opacity: 0.7,\n      baseline: \"hanging\",\n      fill: \"black\",\n      fontSize: 25,\n      margin: 4,\n      fontWeight: \"bold\",\n      fontFamily: \"Ubuntu\"\n    },\n\n    {\n      type: \"layer\",\n      geojson: com,\n      stroke: \"white\",\n      fill: \"peachpuff\",\n      tooltip: [\"$NOM_COM\"]\n    },\n\n    {\n      type: \"scalebar\",\n      units: \"miles\"\n    },\n\n    {\n      type: \"footer\",\n      text:\n        \"Sources: (c)OpenStreetMap and contributors, INSEE, IGN, 2022\\nRealisation: Ronan Ysebaert, 2022\"\n    }\n  ]\n})\n"},{"methodName":"interpretQuiet","source":"shinyInput('geojson')"},{"methodName":"interpretQuiet","source":"shinyInput('style')"},{"methodName":"interpretQuiet","source":"shinyInput('ind')"},{"methodName":"interpretQuiet","source":"shinyInput('k')"},{"methodName":"interpretQuiet","source":"shinyInput('w')"}]}
</script>
<script type="module">
window._ojs.paths.runtimeToDoc = "..\..\..";
window._ojs.paths.runtimeToRoot = "..\..\..";
window._ojs.paths.docToRoot = "";
window._ojs.selfContained = false;
window._ojs.runtime.interpretFromScriptTags();
</script>
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb19" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "OSRM Travel-time calculation with R and data visualization with Observable"</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="an">subtitle:</span><span class="co"> "Application to artifical climbing walls in Paris and its neighbourhood"</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="co">  - name: Ronan Ysebaert </span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="co">    url: https://rysebaert.github.io/climbing_paris/</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="co">    affiliation: UAR RIATE, Université Paris Cité, CNRS</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="co">    affiliation-url: https://riate.cnrs.fr/</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="an">citation:</span><span class="co"> true</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> "June 2022"</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a><span class="an">bibliography:</span><span class="co"> bib.bib</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a><span class="co">    theme: sandstone</span></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a><span class="co">    fontsize: 0.9em</span></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: true</span></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-depth: 2</span></span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a><span class="co">    css: "styles.css"</span></span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a>**Work in progress**</span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a>The aim of this document consists in showing how to build, visualize and reproduce accessibility indicators by combining points of interest (POI) coming from the OpenStreetMap database, socio-economic indicators included in small territorial division (IRIS) and routing engines (OSRM).</span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a>The graphical outputs displayed in this notebook are also available in an <span class="co">[</span><span class="ot">Observable collection</span><span class="co">](https://observablehq.com/collection/@rysebaert/climbing_paris "Go to Observable Notebook")</span>.</span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a>To introduce the reader to the issues raised by indoor sport-climbing in Paris, have a look to <span class="co">[</span><span class="ot">this notebook</span><span class="co">](https://observablehq.com/d/d2be39c4dd55a32d?collection=@rysebaert/climbing_paris "Go to Observable Notebook")</span>.</span>
<span id="cb19-30"><a href="#cb19-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-31"><a href="#cb19-31" aria-hidden="true" tabindex="-1"></a>This Quarto document combines 2 computer languages : R for data processing, and D3.js for data visualizations.</span>
<span id="cb19-32"><a href="#cb19-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-33"><a href="#cb19-33" aria-hidden="true" tabindex="-1"></a><span class="fu"># Data processing with R</span></span>
<span id="cb19-34"><a href="#cb19-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-35"><a href="#cb19-35" aria-hidden="true" tabindex="-1"></a><span class="fu">## Data sources</span></span>
<span id="cb19-36"><a href="#cb19-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-37"><a href="#cb19-37" aria-hidden="true" tabindex="-1"></a>Three data providers are used to build the consolidated data of this document.</span>
<span id="cb19-38"><a href="#cb19-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-39"><a href="#cb19-39" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**IGN** : <span class="co">[</span><span class="ot">The Contour...IRIS® édition 2020</span><span class="co">]</span>(https://geoservices.ign.fr/contoursiris "Access to input geometries (France)"), which corresponds to the lowest territorial division in France (below the commune level).</span>
<span id="cb19-40"><a href="#cb19-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-41"><a href="#cb19-41" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**INSEE** : IRIS <span class="co">[</span><span class="ot">Median income</span><span class="co">](https://www.insee.fr/fr/statistiques/6049648 "Go to input data")</span> and <span class="co">[</span><span class="ot">population</span><span class="co">](https://www.insee.fr/fr/statistiques/5650720?sommaire=4658626 "Go to input data")</span> in 2019.</span>
<span id="cb19-42"><a href="#cb19-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-43"><a href="#cb19-43" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**OpenStreetMap** : download of Point Of Interest (POI) and travel time calculation by bike between IRIS centroids and POI, using the <span class="co">[</span><span class="ot">OSRM routing engine</span><span class="co">](http://project-osrm.org/ "Access to OSRM Website")</span>.</span>
<span id="cb19-44"><a href="#cb19-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-45"><a href="#cb19-45" aria-hidden="true" tabindex="-1"></a>Input data is not provided in the Github repository (too large files), but can be easily be downloaded.</span>
<span id="cb19-46"><a href="#cb19-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-47"><a href="#cb19-47" aria-hidden="true" tabindex="-1"></a><span class="fu">## Map layout</span></span>
<span id="cb19-48"><a href="#cb19-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-49"><a href="#cb19-49" aria-hidden="true" tabindex="-1"></a>A bounding box of 5 km around Paris, without Bois de Boulogne et Bois de Vincennes for a better centering of the map layout.</span>
<span id="cb19-50"><a href="#cb19-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-51"><a href="#cb19-51" aria-hidden="true" tabindex="-1"></a>A second bounding box (10 km around Paris) is created to catch OpenStreetMap POI in the neighbourhood of this study area.</span>
<span id="cb19-52"><a href="#cb19-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-53"><a href="#cb19-53" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = FALSE}</span></span>
<span id="cb19-54"><a href="#cb19-54" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Map layout preparation at IRIS scale (source IGN)----</span></span>
<span id="cb19-55"><a href="#cb19-55" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb19-56"><a href="#cb19-56" aria-hidden="true" tabindex="-1"></a>iris <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">"data-raw/CONTOURS-IRIS.shp"</span>, <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span>
<span id="cb19-57"><a href="#cb19-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-58"><a href="#cb19-58" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract Paris and delete </span></span>
<span id="cb19-59"><a href="#cb19-59" aria-hidden="true" tabindex="-1"></a><span class="co"># Bois-de-Vincennes / Boulogne Iris for map template</span></span>
<span id="cb19-60"><a href="#cb19-60" aria-hidden="true" tabindex="-1"></a>iris<span class="sc">$</span>dep <span class="ot">&lt;-</span> <span class="fu">substr</span>(iris<span class="sc">$</span>INSEE_COM, <span class="dv">1</span>, <span class="dv">2</span>)</span>
<span id="cb19-61"><a href="#cb19-61" aria-hidden="true" tabindex="-1"></a>paris <span class="ot">&lt;-</span> iris[iris<span class="sc">$</span>dep <span class="sc">==</span> <span class="st">"75"</span>,]</span>
<span id="cb19-62"><a href="#cb19-62" aria-hidden="true" tabindex="-1"></a>paris <span class="ot">&lt;-</span> paris[<span class="sc">!</span>paris<span class="sc">$</span>NOM_IRIS <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Bois de Vincennes 1"</span>,</span>
<span id="cb19-63"><a href="#cb19-63" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"Bois de Vincennes 2"</span>,</span>
<span id="cb19-64"><a href="#cb19-64" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"Bois de Boulogne 1"</span>,</span>
<span id="cb19-65"><a href="#cb19-65" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"Bois de Boulogne 2"</span>,</span>
<span id="cb19-66"><a href="#cb19-66" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"Bois de Boulogne 3"</span>),]</span>
<span id="cb19-67"><a href="#cb19-67" aria-hidden="true" tabindex="-1"></a>paris <span class="ot">&lt;-</span> <span class="fu">st_union</span>(paris)</span>
<span id="cb19-68"><a href="#cb19-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-69"><a href="#cb19-69" aria-hidden="true" tabindex="-1"></a><span class="co"># 5 km around Paris map layout</span></span>
<span id="cb19-70"><a href="#cb19-70" aria-hidden="true" tabindex="-1"></a>paris5k <span class="ot">&lt;-</span> <span class="fu">st_buffer</span>(paris, <span class="dv">5000</span>)</span>
<span id="cb19-71"><a href="#cb19-71" aria-hidden="true" tabindex="-1"></a>paris5k <span class="ot">&lt;-</span> <span class="fu">st_as_sfc</span>(<span class="fu">st_bbox</span>(paris5k, <span class="at">crs =</span> <span class="dv">2154</span>))</span>
<span id="cb19-72"><a href="#cb19-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-73"><a href="#cb19-73" aria-hidden="true" tabindex="-1"></a><span class="co"># 10 km around Paris (get OSM data) in long/lat</span></span>
<span id="cb19-74"><a href="#cb19-74" aria-hidden="true" tabindex="-1"></a>paris10k <span class="ot">&lt;-</span> <span class="fu">st_buffer</span>(paris, <span class="dv">10000</span>)</span>
<span id="cb19-75"><a href="#cb19-75" aria-hidden="true" tabindex="-1"></a>paris10k <span class="ot">&lt;-</span> <span class="fu">st_as_sfc</span>(<span class="fu">st_bbox</span>(paris10k, <span class="at">crs =</span> <span class="dv">2154</span>))</span>
<span id="cb19-76"><a href="#cb19-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-77"><a href="#cb19-77" aria-hidden="true" tabindex="-1"></a><span class="co"># Intersection with IRIS</span></span>
<span id="cb19-78"><a href="#cb19-78" aria-hidden="true" tabindex="-1"></a>iris10k <span class="ot">&lt;-</span> <span class="fu">st_intersection</span>(iris, paris10k)</span>
<span id="cb19-79"><a href="#cb19-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-80"><a href="#cb19-80" aria-hidden="true" tabindex="-1"></a><span class="co"># Bounding box for osm extraxt</span></span>
<span id="cb19-81"><a href="#cb19-81" aria-hidden="true" tabindex="-1"></a>paris10k <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(paris10k, <span class="dv">4326</span>)</span>
<span id="cb19-82"><a href="#cb19-82" aria-hidden="true" tabindex="-1"></a>paris10k <span class="ot">&lt;-</span> <span class="fu">st_bbox</span>(paris10k) </span>
<span id="cb19-83"><a href="#cb19-83" aria-hidden="true" tabindex="-1"></a>paris10k <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(paris10k)</span>
<span id="cb19-84"><a href="#cb19-84" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb19-85"><a href="#cb19-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-86"><a href="#cb19-86" aria-hidden="true" tabindex="-1"></a><span class="fu">## Feed IRIS with socio-economic data (INSEE)</span></span>
<span id="cb19-87"><a href="#cb19-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-88"><a href="#cb19-88" aria-hidden="true" tabindex="-1"></a>Data is enriched by socio-economic data (disposible median income 2019 and total population 2018) for further analysis. We keep only "Habitation" IRIS (dedicated to dwellings) for origins-destinations calculations.</span>
<span id="cb19-89"><a href="#cb19-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-90"><a href="#cb19-90" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = FALSE}</span></span>
<span id="cb19-91"><a href="#cb19-91" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb19-92"><a href="#cb19-92" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">read_xlsx</span>(<span class="st">"data-raw/base-ic-evol-struct-pop-2018.xlsx"</span>, <span class="at">skip =</span> <span class="dv">5</span>, <span class="at">sheet =</span> <span class="st">"IRIS"</span>)</span>
<span id="cb19-93"><a href="#cb19-93" aria-hidden="true" tabindex="-1"></a>iris10k <span class="ot">&lt;-</span> <span class="fu">merge</span>(iris10k[,<span class="fu">c</span>(<span class="st">"CODE_IRIS"</span>, <span class="st">"NOM_IRIS"</span>, <span class="st">"TYP_IRIS"</span>, <span class="st">"NOM_COM"</span>)], </span>
<span id="cb19-94"><a href="#cb19-94" aria-hidden="true" tabindex="-1"></a>              df[,<span class="fu">c</span>(<span class="st">"IRIS"</span>,<span class="st">"P18_POP"</span>)],</span>
<span id="cb19-95"><a href="#cb19-95" aria-hidden="true" tabindex="-1"></a>              <span class="at">by.x =</span> <span class="st">"CODE_IRIS"</span>, <span class="at">by.y =</span> <span class="st">"IRIS"</span>, <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span>
<span id="cb19-96"><a href="#cb19-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-97"><a href="#cb19-97" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">read_xlsx</span>(<span class="st">"data-raw/BASE_TD_FILO_DISP_IRIS_2019.xlsx"</span>, <span class="at">skip =</span> <span class="dv">5</span>, <span class="at">sheet =</span> <span class="st">"IRIS_DISP"</span>)</span>
<span id="cb19-98"><a href="#cb19-98" aria-hidden="true" tabindex="-1"></a>iris10k <span class="ot">&lt;-</span> <span class="fu">merge</span>(iris10k, df[,<span class="fu">c</span>(<span class="st">"IRIS"</span>,<span class="st">"DISP_MED19"</span>)],</span>
<span id="cb19-99"><a href="#cb19-99" aria-hidden="true" tabindex="-1"></a>              <span class="at">by.x =</span> <span class="st">"CODE_IRIS"</span>, <span class="at">by.y =</span> <span class="st">"IRIS"</span>, <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span>
<span id="cb19-100"><a href="#cb19-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-101"><a href="#cb19-101" aria-hidden="true" tabindex="-1"></a>iris <span class="ot">&lt;-</span> <span class="fu">st_intersection</span>(iris, paris5k)</span>
<span id="cb19-102"><a href="#cb19-102" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb19-103"><a href="#cb19-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-104"><a href="#cb19-104" aria-hidden="true" tabindex="-1"></a><span class="fu">## Prepare IRIS for travel-time calculation</span></span>
<span id="cb19-105"><a href="#cb19-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-106"><a href="#cb19-106" aria-hidden="true" tabindex="-1"></a>IRIS centroids are extracted. These points will be used for the origins of travel-time calculations. Only IRIS including dwellings are kept (TYP_IRIS == "H").</span>
<span id="cb19-107"><a href="#cb19-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-108"><a href="#cb19-108" aria-hidden="true" tabindex="-1"></a>These <span class="in">`sf`</span> objects are transformed in latitude/longitude (origin-destination calculations requirements and for final export in geojson format).</span>
<span id="cb19-109"><a href="#cb19-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-110"><a href="#cb19-110" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = FALSE}</span></span>
<span id="cb19-111"><a href="#cb19-111" aria-hidden="true" tabindex="-1"></a><span class="co"># Keep only habitation IRIS for origins calculation</span></span>
<span id="cb19-112"><a href="#cb19-112" aria-hidden="true" tabindex="-1"></a>ori <span class="ot">&lt;-</span> iris10k[iris10k<span class="sc">$</span>TYP_IRIS <span class="sc">==</span> <span class="st">"H"</span>,]</span>
<span id="cb19-113"><a href="#cb19-113" aria-hidden="true" tabindex="-1"></a>ori <span class="ot">&lt;-</span> <span class="fu">st_centroid</span>(ori)</span>
<span id="cb19-114"><a href="#cb19-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-115"><a href="#cb19-115" aria-hidden="true" tabindex="-1"></a>ori <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(ori, <span class="at">crs =</span> <span class="dv">4326</span>)</span>
<span id="cb19-116"><a href="#cb19-116" aria-hidden="true" tabindex="-1"></a>iris <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(iris, <span class="at">crs =</span> <span class="dv">4326</span>)</span>
<span id="cb19-117"><a href="#cb19-117" aria-hidden="true" tabindex="-1"></a>com <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(com, <span class="at">crs =</span> <span class="dv">4326</span>)</span>
<span id="cb19-118"><a href="#cb19-118" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb19-119"><a href="#cb19-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-120"><a href="#cb19-120" aria-hidden="true" tabindex="-1"></a><span class="fu">## Import OSM points of interest</span></span>
<span id="cb19-121"><a href="#cb19-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-122"><a href="#cb19-122" aria-hidden="true" tabindex="-1"></a>Indoor sport climbing points of interest are downloaded from OpenStreetMap thanks to the <span class="in">`osmdata`</span> R package (@osmdata).</span>
<span id="cb19-123"><a href="#cb19-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-124"><a href="#cb19-124" aria-hidden="true" tabindex="-1"></a>To access to these OSM features, the OSM key-value pair must be set. For climbing areas, it corresponds to the sport = climbing OSM tag. In the <span class="co">[</span><span class="ot">OpenStreetMap wiki</span><span class="co">](https://wiki.openstreetmap.org/wiki/Tag:sport%3Dclimbing "Tag:sport=climbing in OSM wiki")</span>, it is mentioned that "*sport=climbing should be preferably applied to noded for artificial climbing walls".* Thus, we only consider points responding to the query.</span>
<span id="cb19-125"><a href="#cb19-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-126"><a href="#cb19-126" aria-hidden="true" tabindex="-1"></a>The geographical coverage of the query covers a bounding box of 10 km around Paris (<span class="in">`paris10k`</span><span class="sc">\`</span>). At the end, only useful OSM attributes are kept. Associative and private structures are differentiated for thematic purpose.</span>
<span id="cb19-127"><a href="#cb19-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-128"><a href="#cb19-128" aria-hidden="true" tabindex="-1"></a>I argue that the accuracy and completeness of the data is quite good : I have edited missing points on OpenStreetMap with my personal knowledge and upstream investigation :-)</span>
<span id="cb19-129"><a href="#cb19-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-130"><a href="#cb19-130" aria-hidden="true" tabindex="-1"></a>For the presentation of the artificial climbing landscape in Paris and the difference between private - FSGT and FFME structures, have a look to <span class="co">[</span><span class="ot">this notebook</span><span class="co">](https://observablehq.com/@rysebaert/forewords)</span>.</span>
<span id="cb19-131"><a href="#cb19-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-132"><a href="#cb19-132" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = FALSE}</span></span>
<span id="cb19-133"><a href="#cb19-133" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Extract sport climbing areas from OSM ----</span></span>
<span id="cb19-134"><a href="#cb19-134" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(osmdata)</span>
<span id="cb19-135"><a href="#cb19-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-136"><a href="#cb19-136" aria-hidden="true" tabindex="-1"></a><span class="co"># define a bounding box</span></span>
<span id="cb19-137"><a href="#cb19-137" aria-hidden="true" tabindex="-1"></a>q0 <span class="ot">&lt;-</span> <span class="fu">opq</span>(<span class="at">bbox =</span> paris10k) </span>
<span id="cb19-138"><a href="#cb19-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-139"><a href="#cb19-139" aria-hidden="true" tabindex="-1"></a><span class="co"># extract climbing areas</span></span>
<span id="cb19-140"><a href="#cb19-140" aria-hidden="true" tabindex="-1"></a>q <span class="ot">&lt;-</span> <span class="fu">add_osm_feature</span>(<span class="at">opq =</span> q0, <span class="at">key =</span> <span class="st">'sport'</span>, <span class="at">value =</span> <span class="st">"climbing"</span>)</span>
<span id="cb19-141"><a href="#cb19-141" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">osmdata_sf</span>(q)</span>
<span id="cb19-142"><a href="#cb19-142" aria-hidden="true" tabindex="-1"></a>dest <span class="ot">&lt;-</span> res<span class="sc">$</span>osm_points</span>
<span id="cb19-143"><a href="#cb19-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-144"><a href="#cb19-144" aria-hidden="true" tabindex="-1"></a><span class="co"># Manage private and associative areas</span></span>
<span id="cb19-145"><a href="#cb19-145" aria-hidden="true" tabindex="-1"></a>private <span class="ot">&lt;-</span> dest[<span class="sc">!</span><span class="fu">is.na</span>(dest<span class="sc">$</span>brand),]</span>
<span id="cb19-146"><a href="#cb19-146" aria-hidden="true" tabindex="-1"></a>asso <span class="ot">&lt;-</span> dest[<span class="sc">!</span><span class="fu">is.na</span>(dest<span class="sc">$</span>federation),]</span>
<span id="cb19-147"><a href="#cb19-147" aria-hidden="true" tabindex="-1"></a>asso<span class="sc">$</span>type <span class="ot">&lt;-</span> <span class="st">"Associative structure"</span></span>
<span id="cb19-148"><a href="#cb19-148" aria-hidden="true" tabindex="-1"></a>private<span class="sc">$</span>type <span class="ot">&lt;-</span> <span class="st">"Speculative structure"</span></span>
<span id="cb19-149"><a href="#cb19-149" aria-hidden="true" tabindex="-1"></a>dest <span class="ot">&lt;-</span> <span class="fu">rbind</span>(asso, private)</span>
<span id="cb19-150"><a href="#cb19-150" aria-hidden="true" tabindex="-1"></a>dest <span class="ot">&lt;-</span> dest[,cols]</span>
<span id="cb19-151"><a href="#cb19-151" aria-hidden="true" tabindex="-1"></a>dest<span class="sc">$</span>federation[<span class="fu">is.na</span>(dest<span class="sc">$</span>federation)] <span class="ot">&lt;-</span> <span class="st">"Private"</span></span>
<span id="cb19-152"><a href="#cb19-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-153"><a href="#cb19-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-154"><a href="#cb19-154" aria-hidden="true" tabindex="-1"></a><span class="co"># Manage artificial area type</span></span>
<span id="cb19-155"><a href="#cb19-155" aria-hidden="true" tabindex="-1"></a>dest[<span class="fu">c</span>(<span class="st">"climbing.toprope"</span>, <span class="st">"climbing.boulder"</span>)][<span class="fu">is.na</span>(dest[<span class="fu">c</span>(<span class="st">"climbing.toprope"</span>, <span class="st">"climbing.boulder"</span>)])] <span class="ot">&lt;-</span> <span class="st">"no"</span></span>
<span id="cb19-156"><a href="#cb19-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-157"><a href="#cb19-157" aria-hidden="true" tabindex="-1"></a>dest<span class="sc">$</span>climbing_type <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(dest<span class="sc">$</span>climbing.toprope <span class="sc">==</span> <span class="st">'yes'</span>  <span class="sc">&amp;</span> </span>
<span id="cb19-158"><a href="#cb19-158" aria-hidden="true" tabindex="-1"></a>                               dest<span class="sc">$</span>climbing.boulder <span class="sc">==</span> <span class="st">"yes"</span>,<span class="st">'Wall and bouldering'</span>,</span>
<span id="cb19-159"><a href="#cb19-159" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">ifelse</span>(dest<span class="sc">$</span>climbing.toprope <span class="sc">==</span> <span class="st">'yes'</span> <span class="sc">&amp;</span> </span>
<span id="cb19-160"><a href="#cb19-160" aria-hidden="true" tabindex="-1"></a>                                      dest<span class="sc">$</span>climbing.boulder <span class="sc">==</span> <span class="st">"no"</span> , <span class="st">'Wall'</span>,</span>
<span id="cb19-161"><a href="#cb19-161" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">ifelse</span>(dest<span class="sc">$</span>climbing.toprope <span class="sc">==</span> <span class="st">'no'</span> <span class="sc">&amp;</span></span>
<span id="cb19-162"><a href="#cb19-162" aria-hidden="true" tabindex="-1"></a>                                             dest<span class="sc">$</span>climbing.boulder <span class="sc">==</span> <span class="st">"yes"</span> , <span class="st">'Bouldering'</span>,</span>
<span id="cb19-163"><a href="#cb19-163" aria-hidden="true" tabindex="-1"></a>                                           <span class="cn">NA</span>)))</span>
<span id="cb19-164"><a href="#cb19-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-165"><a href="#cb19-165" aria-hidden="true" tabindex="-1"></a>cols <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"osm_id"</span>, <span class="st">"name"</span>, <span class="st">"climbing_type"</span>, <span class="st">"climbing.length"</span>,</span>
<span id="cb19-166"><a href="#cb19-166" aria-hidden="true" tabindex="-1"></a>          <span class="st">"climbing.routes"</span>, <span class="st">"type"</span>, <span class="st">"federation"</span>, <span class="st">"brand"</span>, <span class="st">"SUM_POP18"</span>, <span class="st">"MIN_REV19"</span>, <span class="st">"MOY_REV19"</span>, <span class="st">"MAX_REV19"</span>)</span>
<span id="cb19-167"><a href="#cb19-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-168"><a href="#cb19-168" aria-hidden="true" tabindex="-1"></a>dest <span class="ot">&lt;-</span> dest[,cols]</span>
<span id="cb19-169"><a href="#cb19-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-170"><a href="#cb19-170" aria-hidden="true" tabindex="-1"></a><span class="co"># Intersection with bouding box </span></span>
<span id="cb19-171"><a href="#cb19-171" aria-hidden="true" tabindex="-1"></a>poi <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(dest, <span class="dv">2154</span>)</span>
<span id="cb19-172"><a href="#cb19-172" aria-hidden="true" tabindex="-1"></a>poi <span class="ot">&lt;-</span> <span class="fu">st_intersection</span>(poi, paris5k)</span>
<span id="cb19-173"><a href="#cb19-173" aria-hidden="true" tabindex="-1"></a>poi <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(poi, <span class="dv">4326</span>)</span>
<span id="cb19-174"><a href="#cb19-174" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb19-175"><a href="#cb19-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-176"><a href="#cb19-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-177"><a href="#cb19-177" aria-hidden="true" tabindex="-1"></a>The data preparation allows to prepare origins-destinations layers for travel-time calculation. Origins correspond to the IRIS layer (only type H : 2141 points). Destinations to artificial climbing areas (45 points).</span>
<span id="cb19-178"><a href="#cb19-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-179"><a href="#cb19-179" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = TRUE, echo = FALSE, warning=FALSE}</span></span>
<span id="cb19-180"><a href="#cb19-180" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb19-181"><a href="#cb19-181" aria-hidden="true" tabindex="-1"></a>poi <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">"data-conso/poi.geojson"</span>, <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span>
<span id="cb19-182"><a href="#cb19-182" aria-hidden="true" tabindex="-1"></a>iris <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">"data-conso/iris.geojson"</span>, <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span>
<span id="cb19-183"><a href="#cb19-183" aria-hidden="true" tabindex="-1"></a>com <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">"data-conso/com.geojson"</span>, <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span>
<span id="cb19-184"><a href="#cb19-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-185"><a href="#cb19-185" aria-hidden="true" tabindex="-1"></a>poi <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(poi, <span class="dv">2154</span>)</span>
<span id="cb19-186"><a href="#cb19-186" aria-hidden="true" tabindex="-1"></a>iris <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(iris, <span class="dv">2154</span>)</span>
<span id="cb19-187"><a href="#cb19-187" aria-hidden="true" tabindex="-1"></a>com <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(com, <span class="dv">2154</span>)</span>
<span id="cb19-188"><a href="#cb19-188" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb19-189"><a href="#cb19-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-190"><a href="#cb19-190" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = TRUE, out.width= "100%", warning=FALSE}</span></span>
<span id="cb19-191"><a href="#cb19-191" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mapsf)</span>
<span id="cb19-192"><a href="#cb19-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-193"><a href="#cb19-193" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract centroids from IRIS dedicated to dwellings</span></span>
<span id="cb19-194"><a href="#cb19-194" aria-hidden="true" tabindex="-1"></a>ori <span class="ot">&lt;-</span> <span class="fu">st_centroid</span>(iris)</span>
<span id="cb19-195"><a href="#cb19-195" aria-hidden="true" tabindex="-1"></a>ori <span class="ot">&lt;-</span> ori[ori<span class="sc">$</span>TYP_IRIS <span class="sc">==</span> <span class="st">"H"</span>,]</span>
<span id="cb19-196"><a href="#cb19-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-197"><a href="#cb19-197" aria-hidden="true" tabindex="-1"></a><span class="co"># Map creation</span></span>
<span id="cb19-198"><a href="#cb19-198" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>))</span>
<span id="cb19-199"><a href="#cb19-199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-200"><a href="#cb19-200" aria-hidden="true" tabindex="-1"></a><span class="co"># Set a map theme (library mapsf)</span></span>
<span id="cb19-201"><a href="#cb19-201" aria-hidden="true" tabindex="-1"></a>my_theme <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">bg =</span> <span class="cn">NA</span>, <span class="at">fg =</span> <span class="cn">NA</span>, <span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>), <span class="at">tab =</span> <span class="cn">TRUE</span>, <span class="at">pos =</span> <span class="st">"left"</span>, </span>
<span id="cb19-202"><a href="#cb19-202" aria-hidden="true" tabindex="-1"></a>                  <span class="at">inner =</span> <span class="cn">TRUE</span>, <span class="at">line =</span> <span class="fl">1.3</span>, <span class="at">cex =</span> <span class="dv">1</span>, <span class="at">font =</span> <span class="dv">2</span>)</span>
<span id="cb19-203"><a href="#cb19-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-204"><a href="#cb19-204" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the map</span></span>
<span id="cb19-205"><a href="#cb19-205" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_init</span>(com, <span class="at">expandBB =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.4</span>,<span class="dv">0</span>,<span class="dv">0</span>), <span class="at">theme =</span> my_theme)</span>
<span id="cb19-206"><a href="#cb19-206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-207"><a href="#cb19-207" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_typo</span>(</span>
<span id="cb19-208"><a href="#cb19-208" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> iris, <span class="at">var =</span> <span class="st">"TYP_IRIS"</span>, </span>
<span id="cb19-209"><a href="#cb19-209" aria-hidden="true" tabindex="-1"></a>  <span class="at">pal =</span> <span class="fu">c</span>(<span class="st">"peachpuff"</span>, <span class="st">"#feb8ff"</span>, <span class="st">"#f0e6f0"</span>, <span class="st">"#f1f7ab"</span>), <span class="at">lwd =</span> <span class="fl">0.25</span>,</span>
<span id="cb19-210"><a href="#cb19-210" aria-hidden="true" tabindex="-1"></a>  <span class="at">val_order =</span> <span class="fu">c</span>(<span class="st">"H"</span>, <span class="st">"A"</span>, <span class="st">"D"</span>, <span class="st">"Z"</span>), <span class="at">border =</span> <span class="st">"white"</span>, <span class="at">leg_pos =</span> <span class="fu">c</span>(<span class="dv">631000</span>, <span class="dv">6872000</span>),</span>
<span id="cb19-211"><a href="#cb19-211" aria-hidden="true" tabindex="-1"></a>  <span class="at">leg_title =</span> <span class="st">"IRIS types (H = dwellings)"</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb19-212"><a href="#cb19-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-213"><a href="#cb19-213" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_map</span>(ori, <span class="at">pch =</span> <span class="dv">20</span>, <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">cex =</span> .<span class="dv">2</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb19-214"><a href="#cb19-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-215"><a href="#cb19-215" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_legend</span>(</span>
<span id="cb19-216"><a href="#cb19-216" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">"symb"</span>, <span class="at">pos =</span>  <span class="fu">c</span>(<span class="dv">631000</span>, <span class="dv">6864000</span>), <span class="at">val =</span> <span class="fu">c</span>(<span class="st">"H"</span>, <span class="st">"H"</span>),</span>
<span id="cb19-217"><a href="#cb19-217" aria-hidden="true" tabindex="-1"></a>  <span class="at">pt_pch =</span> <span class="fu">c</span>(<span class="dv">20</span>,<span class="dv">20</span>), <span class="at">pt_cex =</span>.<span class="dv">2</span>, <span class="at">title =</span> <span class="st">"Origins : IRIS centroids type H"</span>,</span>
<span id="cb19-218"><a href="#cb19-218" aria-hidden="true" tabindex="-1"></a>  <span class="at">pal =</span> <span class="fu">c</span>(<span class="st">"red"</span>, <span class="st">"red"</span>))</span>
<span id="cb19-219"><a href="#cb19-219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-220"><a href="#cb19-220" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_typo</span>(<span class="at">x =</span> poi, <span class="at">var =</span> <span class="st">"federation"</span>, <span class="at">pch =</span> <span class="dv">21</span>, <span class="at">cex =</span> .<span class="dv">7</span>,</span>
<span id="cb19-221"><a href="#cb19-221" aria-hidden="true" tabindex="-1"></a>        <span class="at">val_order =</span> <span class="fu">c</span>(<span class="st">"Private"</span>, <span class="st">"FSGT"</span>, <span class="st">"FFME"</span>),</span>
<span id="cb19-222"><a href="#cb19-222" aria-hidden="true" tabindex="-1"></a>        <span class="at">pal =</span> <span class="fu">c</span>(<span class="st">"#377eb8"</span>, <span class="st">"#e41a1c"</span>, <span class="st">"#ff7f00"</span>),</span>
<span id="cb19-223"><a href="#cb19-223" aria-hidden="true" tabindex="-1"></a>        <span class="at">leg_title =</span> <span class="st">"Destinations:</span><span class="sc">\n</span><span class="st">Artificial climbing areas"</span>,</span>
<span id="cb19-224"><a href="#cb19-224" aria-hidden="true" tabindex="-1"></a>        <span class="at">leg_pos =</span> <span class="fu">c</span>(<span class="dv">631000</span>, <span class="dv">6860000</span>),</span>
<span id="cb19-225"><a href="#cb19-225" aria-hidden="true" tabindex="-1"></a>        <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb19-226"><a href="#cb19-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-227"><a href="#cb19-227" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_map</span>(com, <span class="at">col =</span> <span class="cn">NA</span>, <span class="at">border =</span> <span class="st">"black"</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb19-228"><a href="#cb19-228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-229"><a href="#cb19-229" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_title</span>(<span class="st">"Layers presentation for origins-destinations calculation"</span>)</span>
<span id="cb19-230"><a href="#cb19-230" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_scale</span>(<span class="at">size =</span> <span class="dv">5</span>, <span class="at">col =</span> <span class="st">"black"</span>, <span class="at">pos =</span> <span class="st">"bottomright"</span>)</span>
<span id="cb19-231"><a href="#cb19-231" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_credits</span>(<span class="fu">paste0</span>(<span class="st">"Sources : © OpenStreetMap and Contributors, IGN, INSEE, 2022</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb19-232"><a href="#cb19-232" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Realisation : Ronan Ysebaert, 2022"</span>))</span>
<span id="cb19-233"><a href="#cb19-233" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb19-234"><a href="#cb19-234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-235"><a href="#cb19-235" aria-hidden="true" tabindex="-1"></a><span class="fu">## Travel-time calculation with OSRM</span></span>
<span id="cb19-236"><a href="#cb19-236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-237"><a href="#cb19-237" aria-hidden="true" tabindex="-1"></a>We have now required origins and destinations required to compute travel-time calculations. The computation is realized using the <span class="in">`osrm`</span> R package (@osrm). This package allows to compute routes, trips, isochrones and travel distances matrices (travel time and kilometric distance).</span>
<span id="cb19-238"><a href="#cb19-238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-239"><a href="#cb19-239" aria-hidden="true" tabindex="-1"></a>Considering that the input data are quite important (more than 2000 origin points and 48 destination points) and to avoid to overload the OSRM demo server, I have run my own instance of OSRM based on docker container. To do so the procedure is explained in the <span class="co">[</span><span class="ot">following documentation</span><span class="co">](https://github.com/Project-OSRM/osrm-backend#using-docker "Run OSRM with docker")</span>, or more specifically for Windows <span class="co">[</span><span class="ot">here</span><span class="co">](https://gist.github.com/AlexandraKapp/e0eee2beacc93e765113aff43ec77789 "How to set up your own OSRM backend with Docker on Windows")</span>.</span>
<span id="cb19-240"><a href="#cb19-240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-241"><a href="#cb19-241" aria-hidden="true" tabindex="-1"></a>Once it is done, the connection to the rounting engine is operational with the url <span class="in">`http://localhost:5000/`</span><span class="sc">\`</span>.</span>
<span id="cb19-242"><a href="#cb19-242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-243"><a href="#cb19-243" aria-hidden="true" tabindex="-1"></a>With OSRM, it is possible to choose several profiles depending on what kind of routing we want to use (car, bike, walking). In our case, we choose by bike considering the fact this is a widespread practice for climbers to reach climbing areas with this transport mean. Moreover, it allows also to avoid to use the car profile, which underestimates the travel-time in metropolitan areas (trafic congestion not taken into account).</span>
<span id="cb19-244"><a href="#cb19-244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-245"><a href="#cb19-245" aria-hidden="true" tabindex="-1"></a>The bicycle profile is described in the <span class="co">[</span><span class="ot">github OSRM repository</span><span class="co">](https://github.com/Project-OSRM/osrm-backend/blob/master/profiles/bicycle.lua "OSRM bicycle profile")</span>. Basically, the default speed is 15 km/h. It avoids the access to highways, reduce the driving speed by 30 % for unsafe roads. It is important to keep in mind that landforms (elevation) are not considered in the default profile. Some thoughts and solutions exist on the subject, using elevation rasters (<span class="co">[</span><span class="ot">Liedman, 2022</span><span class="co">](https://www.liedman.net/2015/04/13/add-elevation-data-to-osrm/ "Adding elevation data to OSRM")</span> ; <span class="co">[</span><span class="ot">Mapbox, 2015</span><span class="co">](https://blog.mapbox.com/elevation-aware-routing-profiles-in-mapbox-directions-21e182a85165 "Elevation-aware routing profiles in Mapbox Directions")</span>).</span>
<span id="cb19-246"><a href="#cb19-246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-247"><a href="#cb19-247" aria-hidden="true" tabindex="-1"></a>The code below compute travel-time calculation between the geometric center of IRIS (<span class="in">`ori`</span>) and artificial climbing areas (<span class="in">`poi`</span>). It is done for all climbing structures and reproduced according to the type of climbing structure : private or associative structures. For associative structures, we distinguish the FSGT and FFME federations, who do not exactly the same goals in term of practice.</span>
<span id="cb19-248"><a href="#cb19-248" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-249"><a href="#cb19-249" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = FALSE}</span></span>
<span id="cb19-250"><a href="#cb19-250" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(osrm)</span>
<span id="cb19-251"><a href="#cb19-251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-252"><a href="#cb19-252" aria-hidden="true" tabindex="-1"></a><span class="co"># Manage ids</span></span>
<span id="cb19-253"><a href="#cb19-253" aria-hidden="true" tabindex="-1"></a><span class="fu">row.names</span>(ori) <span class="ot">&lt;-</span> ori<span class="sc">$</span>CODE_IRIS</span>
<span id="cb19-254"><a href="#cb19-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-255"><a href="#cb19-255" aria-hidden="true" tabindex="-1"></a><span class="co"># Connexion to osrm local server</span></span>
<span id="cb19-256"><a href="#cb19-256" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">osrm.server =</span> <span class="st">"http://localhost:5000/"</span>, <span class="at">osrm.profile =</span> <span class="st">"bike"</span>)</span>
<span id="cb19-257"><a href="#cb19-257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-258"><a href="#cb19-258" aria-hidden="true" tabindex="-1"></a><span class="co"># Origin-destination calculation</span></span>
<span id="cb19-259"><a href="#cb19-259" aria-hidden="true" tabindex="-1"></a><span class="co"># All structures</span></span>
<span id="cb19-260"><a href="#cb19-260" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">osrmTable</span>(<span class="at">src =</span> ori, <span class="at">dst =</span> dest, <span class="at">measure =</span> <span class="st">"duration"</span>)</span>
<span id="cb19-261"><a href="#cb19-261" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(df<span class="sc">$</span>duration)</span>
<span id="cb19-262"><a href="#cb19-262" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(df) <span class="ot">&lt;-</span> <span class="fu">as.character</span>(dest<span class="sc">$</span>osm_id)</span>
<span id="cb19-263"><a href="#cb19-263" aria-hidden="true" tabindex="-1"></a><span class="fu">row.names</span>(df) <span class="ot">&lt;-</span> <span class="fu">as.character</span>(ori<span class="sc">$</span>CODE_IRIS)</span>
<span id="cb19-264"><a href="#cb19-264" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(df, <span class="st">"data-conso/bike-duration.csv"</span>)</span>
<span id="cb19-265"><a href="#cb19-265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-266"><a href="#cb19-266" aria-hidden="true" tabindex="-1"></a><span class="co"># Private structures</span></span>
<span id="cb19-267"><a href="#cb19-267" aria-hidden="true" tabindex="-1"></a>dest_priv <span class="ot">&lt;-</span> dest[dest<span class="sc">$</span>type <span class="sc">==</span> <span class="st">"Speculative structure"</span>,] </span>
<span id="cb19-268"><a href="#cb19-268" aria-hidden="true" tabindex="-1"></a>df2 <span class="ot">&lt;-</span> <span class="fu">osrmTable</span>(<span class="at">src =</span> ori, <span class="at">dst =</span> dest_priv, <span class="at">measure =</span> <span class="st">"duration"</span>)</span>
<span id="cb19-269"><a href="#cb19-269" aria-hidden="true" tabindex="-1"></a>df2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(df2<span class="sc">$</span>duration)</span>
<span id="cb19-270"><a href="#cb19-270" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(df2) <span class="ot">&lt;-</span> <span class="fu">as.character</span>(dest_priv<span class="sc">$</span>osm_id)</span>
<span id="cb19-271"><a href="#cb19-271" aria-hidden="true" tabindex="-1"></a><span class="fu">row.names</span>(df2) <span class="ot">&lt;-</span> <span class="fu">as.character</span>(ori<span class="sc">$</span>CODE_IRIS)</span>
<span id="cb19-272"><a href="#cb19-272" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(df2, <span class="st">"data-conso/bike-duration-priv.csv"</span>)</span>
<span id="cb19-273"><a href="#cb19-273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-274"><a href="#cb19-274" aria-hidden="true" tabindex="-1"></a><span class="co"># FFME</span></span>
<span id="cb19-275"><a href="#cb19-275" aria-hidden="true" tabindex="-1"></a>dest_asso <span class="ot">&lt;-</span>dest[dest<span class="sc">$</span>type <span class="sc">==</span> <span class="st">"Associative structure"</span>,] </span>
<span id="cb19-276"><a href="#cb19-276" aria-hidden="true" tabindex="-1"></a>dest_ffme <span class="ot">&lt;-</span> dest_asso[dest_asso<span class="sc">$</span>federation <span class="sc">==</span> <span class="st">"FFME"</span>,]</span>
<span id="cb19-277"><a href="#cb19-277" aria-hidden="true" tabindex="-1"></a>df3 <span class="ot">&lt;-</span> <span class="fu">osrmTable</span>(<span class="at">src =</span> ori, <span class="at">dst =</span> dest_ffme, <span class="at">measure =</span> <span class="st">"duration"</span>)</span>
<span id="cb19-278"><a href="#cb19-278" aria-hidden="true" tabindex="-1"></a>df3 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(df3<span class="sc">$</span>duration)</span>
<span id="cb19-279"><a href="#cb19-279" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(df3) <span class="ot">&lt;-</span> <span class="fu">as.character</span>(dest_ffme<span class="sc">$</span>osm_id)</span>
<span id="cb19-280"><a href="#cb19-280" aria-hidden="true" tabindex="-1"></a><span class="fu">row.names</span>(df3) <span class="ot">&lt;-</span> <span class="fu">as.character</span>(ori<span class="sc">$</span>CODE_IRIS)</span>
<span id="cb19-281"><a href="#cb19-281" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(df3, <span class="st">"data-conso/bike-duration-ffme.csv"</span>)</span>
<span id="cb19-282"><a href="#cb19-282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-283"><a href="#cb19-283" aria-hidden="true" tabindex="-1"></a><span class="co"># FSGT</span></span>
<span id="cb19-284"><a href="#cb19-284" aria-hidden="true" tabindex="-1"></a>dest_fsgt <span class="ot">&lt;-</span> dest_asso[poi_asso<span class="sc">$</span>federation <span class="sc">==</span> <span class="st">"FSGT"</span>,]</span>
<span id="cb19-285"><a href="#cb19-285" aria-hidden="true" tabindex="-1"></a>df4 <span class="ot">&lt;-</span> <span class="fu">osrmTable</span>(<span class="at">src =</span> ori, <span class="at">dst =</span> dest_fsgt, <span class="at">measure =</span> <span class="st">"duration"</span>)</span>
<span id="cb19-286"><a href="#cb19-286" aria-hidden="true" tabindex="-1"></a>df4 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(df4<span class="sc">$</span>duration)</span>
<span id="cb19-287"><a href="#cb19-287" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(df4) <span class="ot">&lt;-</span> <span class="fu">as.character</span>(poi_fsgt<span class="sc">$</span>osm_id)</span>
<span id="cb19-288"><a href="#cb19-288" aria-hidden="true" tabindex="-1"></a><span class="fu">row.names</span>(df4) <span class="ot">&lt;-</span> <span class="fu">as.character</span>(ori<span class="sc">$</span>CODE_IRIS)</span>
<span id="cb19-289"><a href="#cb19-289" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(df4, <span class="st">"data-conso/bike-duration-fsgt.csv"</span>)</span>
<span id="cb19-290"><a href="#cb19-290" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb19-291"><a href="#cb19-291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-292"><a href="#cb19-292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-293"><a href="#cb19-293" aria-hidden="true" tabindex="-1"></a><span class="fu">## Indicators creation</span></span>
<span id="cb19-294"><a href="#cb19-294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-295"><a href="#cb19-295" aria-hidden="true" tabindex="-1"></a><span class="fu">### At IRIS level</span></span>
<span id="cb19-296"><a href="#cb19-296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-297"><a href="#cb19-297" aria-hidden="true" tabindex="-1"></a>This heavy matrix is then manipulated to extract for each IRIS the following information :</span>
<span id="cb19-298"><a href="#cb19-298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-299"><a href="#cb19-299" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Name of the nearest climbing structure by bike</span>
<span id="cb19-300"><a href="#cb19-300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-301"><a href="#cb19-301" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Type of structure (associative or speculative)</span>
<span id="cb19-302"><a href="#cb19-302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-303"><a href="#cb19-303" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Time to reach it (in minutes)</span>
<span id="cb19-304"><a href="#cb19-304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-305"><a href="#cb19-305" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Number of artificial climbing areas at less than 15 minutes by bike (N)</span>
<span id="cb19-306"><a href="#cb19-306" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-307"><a href="#cb19-307" aria-hidden="true" tabindex="-1"></a>This calculation is done for all climbing structures (ALL), private ones (PRIV), the FFME federation (FFME) and the FSGT one (FSGT). It is done with R base code.</span>
<span id="cb19-308"><a href="#cb19-308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-309"><a href="#cb19-309" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = FALSE}</span></span>
<span id="cb19-310"><a href="#cb19-310" aria-hidden="true" tabindex="-1"></a><span class="co"># Name of the nearest structure</span></span>
<span id="cb19-311"><a href="#cb19-311" aria-hidden="true" tabindex="-1"></a>osm_id <span class="ot">&lt;-</span> <span class="fu">colnames</span>(df)[<span class="fu">apply</span>(df, <span class="dv">1</span>, which.min)] <span class="co"># Name</span></span>
<span id="cb19-312"><a href="#cb19-312" aria-hidden="true" tabindex="-1"></a>osm_id <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(osm_id, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb19-313"><a href="#cb19-313" aria-hidden="true" tabindex="-1"></a>osm_id<span class="sc">$</span>iris <span class="ot">&lt;-</span> <span class="fu">row.names</span>(df)</span>
<span id="cb19-314"><a href="#cb19-314" aria-hidden="true" tabindex="-1"></a>osm_id <span class="ot">&lt;-</span> <span class="fu">merge</span>(osm_id, poi[,<span class="fu">c</span>(<span class="st">"osm_id"</span>, <span class="st">"name"</span>, <span class="st">"type"</span>)], </span>
<span id="cb19-315"><a href="#cb19-315" aria-hidden="true" tabindex="-1"></a>                <span class="at">by =</span> <span class="st">"osm_id"</span>, <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span>
<span id="cb19-316"><a href="#cb19-316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-317"><a href="#cb19-317" aria-hidden="true" tabindex="-1"></a><span class="co"># Time to the nearest climbing area</span></span>
<span id="cb19-318"><a href="#cb19-318" aria-hidden="true" tabindex="-1"></a>time <span class="ot">&lt;-</span> <span class="fu">apply</span>(df, <span class="dv">1</span>, min) <span class="co"># Time</span></span>
<span id="cb19-319"><a href="#cb19-319" aria-hidden="true" tabindex="-1"></a>time <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(time, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb19-320"><a href="#cb19-320" aria-hidden="true" tabindex="-1"></a>time<span class="sc">$</span>iris <span class="ot">&lt;-</span> <span class="fu">row.names</span>(time)</span>
<span id="cb19-321"><a href="#cb19-321" aria-hidden="true" tabindex="-1"></a>osm_id <span class="ot">&lt;-</span> <span class="fu">merge</span>(osm_id, time, <span class="at">by =</span> <span class="st">"iris"</span>, <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span>
<span id="cb19-322"><a href="#cb19-322" aria-hidden="true" tabindex="-1"></a>osm_id<span class="sc">$</span>geometry <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb19-323"><a href="#cb19-323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-324"><a href="#cb19-324" aria-hidden="true" tabindex="-1"></a><span class="co"># Number of climbing area at less than 15 minutes by bike</span></span>
<span id="cb19-325"><a href="#cb19-325" aria-hidden="true" tabindex="-1"></a>n15mn <span class="ot">&lt;-</span> df</span>
<span id="cb19-326"><a href="#cb19-326" aria-hidden="true" tabindex="-1"></a>n15mn <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(df, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb19-327"><a href="#cb19-327" aria-hidden="true" tabindex="-1"></a>n15mn[n15mn <span class="sc">&lt;</span> <span class="dv">15</span>] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb19-328"><a href="#cb19-328" aria-hidden="true" tabindex="-1"></a>n15mn[n15mn <span class="sc">&gt;</span> <span class="dv">15</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb19-329"><a href="#cb19-329" aria-hidden="true" tabindex="-1"></a>n15mn<span class="sc">$</span>N <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(n15mn)</span>
<span id="cb19-330"><a href="#cb19-330" aria-hidden="true" tabindex="-1"></a>n15mn<span class="sc">$</span>iris <span class="ot">&lt;-</span> <span class="fu">row.names</span>(n15mn)</span>
<span id="cb19-331"><a href="#cb19-331" aria-hidden="true" tabindex="-1"></a>osm_id <span class="ot">&lt;-</span> <span class="fu">merge</span>(osm_id, n15mn[,<span class="fu">c</span>(<span class="st">"iris"</span>, <span class="st">"N"</span>)], <span class="at">by =</span> <span class="st">"iris"</span>,</span>
<span id="cb19-332"><a href="#cb19-332" aria-hidden="true" tabindex="-1"></a>                <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span>
<span id="cb19-333"><a href="#cb19-333" aria-hidden="true" tabindex="-1"></a>osm_id <span class="ot">&lt;-</span> osm_id[,<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span><span class="sc">:</span><span class="dv">6</span>)]</span>
<span id="cb19-334"><a href="#cb19-334" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(osm_id) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"CODE_IRIS"</span>, <span class="st">"ALL_NAME"</span>, <span class="st">"TYPE_STRUCT"</span>, <span class="st">"ALL_TIME"</span>,</span>
<span id="cb19-335"><a href="#cb19-335" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"N_15MN"</span>)</span>
<span id="cb19-336"><a href="#cb19-336" aria-hidden="true" tabindex="-1"></a>iris <span class="ot">&lt;-</span> <span class="fu">merge</span>(iris, osm_id, <span class="at">by =</span> <span class="st">"CODE_IRIS"</span>, <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span>
<span id="cb19-337"><a href="#cb19-337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-338"><a href="#cb19-338" aria-hidden="true" tabindex="-1"></a><span class="co"># Prive climbing club (fees $$$)</span></span>
<span id="cb19-339"><a href="#cb19-339" aria-hidden="true" tabindex="-1"></a><span class="co"># Name of the nearest structure</span></span>
<span id="cb19-340"><a href="#cb19-340" aria-hidden="true" tabindex="-1"></a>osm_id <span class="ot">&lt;-</span> <span class="fu">colnames</span>(df2)[<span class="fu">apply</span>(df2, <span class="dv">1</span>, which.min)] <span class="co"># Name</span></span>
<span id="cb19-341"><a href="#cb19-341" aria-hidden="true" tabindex="-1"></a>osm_id <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(osm_id, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb19-342"><a href="#cb19-342" aria-hidden="true" tabindex="-1"></a>osm_id<span class="sc">$</span>iris <span class="ot">&lt;-</span> <span class="fu">row.names</span>(df2)</span>
<span id="cb19-343"><a href="#cb19-343" aria-hidden="true" tabindex="-1"></a>osm_id <span class="ot">&lt;-</span> <span class="fu">merge</span>(osm_id, poi[,<span class="fu">c</span>(<span class="st">"osm_id"</span>, <span class="st">"name"</span>, <span class="st">"type"</span>)], </span>
<span id="cb19-344"><a href="#cb19-344" aria-hidden="true" tabindex="-1"></a>                <span class="at">by =</span> <span class="st">"osm_id"</span>, <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span>
<span id="cb19-345"><a href="#cb19-345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-346"><a href="#cb19-346" aria-hidden="true" tabindex="-1"></a><span class="co"># Time to the nearest climbing area</span></span>
<span id="cb19-347"><a href="#cb19-347" aria-hidden="true" tabindex="-1"></a>time <span class="ot">&lt;-</span> <span class="fu">apply</span>(df2, <span class="dv">1</span>, min) <span class="co"># Time</span></span>
<span id="cb19-348"><a href="#cb19-348" aria-hidden="true" tabindex="-1"></a>time <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(time, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb19-349"><a href="#cb19-349" aria-hidden="true" tabindex="-1"></a>time<span class="sc">$</span>iris <span class="ot">&lt;-</span> <span class="fu">row.names</span>(time)</span>
<span id="cb19-350"><a href="#cb19-350" aria-hidden="true" tabindex="-1"></a>osm_id <span class="ot">&lt;-</span> <span class="fu">merge</span>(osm_id, time, <span class="at">by =</span> <span class="st">"iris"</span>, <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span>
<span id="cb19-351"><a href="#cb19-351" aria-hidden="true" tabindex="-1"></a>osm_id<span class="sc">$</span>geometry <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb19-352"><a href="#cb19-352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-353"><a href="#cb19-353" aria-hidden="true" tabindex="-1"></a><span class="co"># Number of climbing area at less than 15 minutes by bike</span></span>
<span id="cb19-354"><a href="#cb19-354" aria-hidden="true" tabindex="-1"></a>n15mn <span class="ot">&lt;-</span> df2</span>
<span id="cb19-355"><a href="#cb19-355" aria-hidden="true" tabindex="-1"></a>n15mn <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(df2, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb19-356"><a href="#cb19-356" aria-hidden="true" tabindex="-1"></a>n15mn[n15mn <span class="sc">&lt;</span> <span class="dv">15</span>] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb19-357"><a href="#cb19-357" aria-hidden="true" tabindex="-1"></a>n15mn[n15mn <span class="sc">&gt;</span> <span class="dv">15</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb19-358"><a href="#cb19-358" aria-hidden="true" tabindex="-1"></a>n15mn<span class="sc">$</span>N <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(n15mn)</span>
<span id="cb19-359"><a href="#cb19-359" aria-hidden="true" tabindex="-1"></a>n15mn<span class="sc">$</span>iris <span class="ot">&lt;-</span> <span class="fu">row.names</span>(n15mn)</span>
<span id="cb19-360"><a href="#cb19-360" aria-hidden="true" tabindex="-1"></a>osm_id <span class="ot">&lt;-</span> <span class="fu">merge</span>(osm_id, n15mn[,<span class="fu">c</span>(<span class="st">"iris"</span>, <span class="st">"N"</span>)], <span class="at">by =</span> <span class="st">"iris"</span>,</span>
<span id="cb19-361"><a href="#cb19-361" aria-hidden="true" tabindex="-1"></a>                <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span>
<span id="cb19-362"><a href="#cb19-362" aria-hidden="true" tabindex="-1"></a>osm_id <span class="ot">&lt;-</span> osm_id[,<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">5</span><span class="sc">:</span><span class="dv">6</span>)]</span>
<span id="cb19-363"><a href="#cb19-363" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(osm_id) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"CODE_IRIS"</span>, <span class="st">"PRIV_NAME"</span>, <span class="st">"PRIV_TIME"</span>,</span>
<span id="cb19-364"><a href="#cb19-364" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"N_PRIV_15MN"</span>)</span>
<span id="cb19-365"><a href="#cb19-365" aria-hidden="true" tabindex="-1"></a>iris <span class="ot">&lt;-</span> <span class="fu">merge</span>(iris, osm_id, <span class="at">by =</span> <span class="st">"CODE_IRIS"</span>, <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span>
<span id="cb19-366"><a href="#cb19-366" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-367"><a href="#cb19-367" aria-hidden="true" tabindex="-1"></a><span class="co"># FFME associative structure</span></span>
<span id="cb19-368"><a href="#cb19-368" aria-hidden="true" tabindex="-1"></a><span class="co"># Name of the nearest structure</span></span>
<span id="cb19-369"><a href="#cb19-369" aria-hidden="true" tabindex="-1"></a>osm_id <span class="ot">&lt;-</span> <span class="fu">colnames</span>(df3)[<span class="fu">apply</span>(df3, <span class="dv">1</span>, which.min)] <span class="co"># Name</span></span>
<span id="cb19-370"><a href="#cb19-370" aria-hidden="true" tabindex="-1"></a>osm_id <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(osm_id, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb19-371"><a href="#cb19-371" aria-hidden="true" tabindex="-1"></a>osm_id<span class="sc">$</span>iris <span class="ot">&lt;-</span> <span class="fu">row.names</span>(df3)</span>
<span id="cb19-372"><a href="#cb19-372" aria-hidden="true" tabindex="-1"></a>osm_id <span class="ot">&lt;-</span> <span class="fu">merge</span>(osm_id, poi[,<span class="fu">c</span>(<span class="st">"osm_id"</span>, <span class="st">"name"</span>, <span class="st">"type"</span>)], </span>
<span id="cb19-373"><a href="#cb19-373" aria-hidden="true" tabindex="-1"></a>                <span class="at">by =</span> <span class="st">"osm_id"</span>, <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span>
<span id="cb19-374"><a href="#cb19-374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-375"><a href="#cb19-375" aria-hidden="true" tabindex="-1"></a><span class="co"># Time to the nearest climbing area</span></span>
<span id="cb19-376"><a href="#cb19-376" aria-hidden="true" tabindex="-1"></a>time <span class="ot">&lt;-</span> <span class="fu">apply</span>(df3, <span class="dv">1</span>, min) <span class="co"># Time</span></span>
<span id="cb19-377"><a href="#cb19-377" aria-hidden="true" tabindex="-1"></a>time <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(time, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb19-378"><a href="#cb19-378" aria-hidden="true" tabindex="-1"></a>time<span class="sc">$</span>iris <span class="ot">&lt;-</span> <span class="fu">row.names</span>(time)</span>
<span id="cb19-379"><a href="#cb19-379" aria-hidden="true" tabindex="-1"></a>osm_id <span class="ot">&lt;-</span> <span class="fu">merge</span>(osm_id, time, <span class="at">by =</span> <span class="st">"iris"</span>, <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span>
<span id="cb19-380"><a href="#cb19-380" aria-hidden="true" tabindex="-1"></a>osm_id<span class="sc">$</span>geometry <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb19-381"><a href="#cb19-381" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-382"><a href="#cb19-382" aria-hidden="true" tabindex="-1"></a><span class="co"># Number of climbing area at less than 15 minutes by bike</span></span>
<span id="cb19-383"><a href="#cb19-383" aria-hidden="true" tabindex="-1"></a>n15mn <span class="ot">&lt;-</span> df3</span>
<span id="cb19-384"><a href="#cb19-384" aria-hidden="true" tabindex="-1"></a>n15mn <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(df3, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb19-385"><a href="#cb19-385" aria-hidden="true" tabindex="-1"></a>n15mn[n15mn <span class="sc">&lt;</span> <span class="dv">15</span>] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb19-386"><a href="#cb19-386" aria-hidden="true" tabindex="-1"></a>n15mn[n15mn <span class="sc">&gt;</span> <span class="dv">15</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb19-387"><a href="#cb19-387" aria-hidden="true" tabindex="-1"></a>n15mn<span class="sc">$</span>N <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(n15mn)</span>
<span id="cb19-388"><a href="#cb19-388" aria-hidden="true" tabindex="-1"></a>n15mn<span class="sc">$</span>iris <span class="ot">&lt;-</span> <span class="fu">row.names</span>(n15mn)</span>
<span id="cb19-389"><a href="#cb19-389" aria-hidden="true" tabindex="-1"></a>osm_id <span class="ot">&lt;-</span> <span class="fu">merge</span>(osm_id, n15mn[,<span class="fu">c</span>(<span class="st">"iris"</span>, <span class="st">"N"</span>)], <span class="at">by =</span> <span class="st">"iris"</span>,</span>
<span id="cb19-390"><a href="#cb19-390" aria-hidden="true" tabindex="-1"></a>                <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span>
<span id="cb19-391"><a href="#cb19-391" aria-hidden="true" tabindex="-1"></a>osm_id <span class="ot">&lt;-</span> osm_id[,<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">5</span><span class="sc">:</span><span class="dv">6</span>)]</span>
<span id="cb19-392"><a href="#cb19-392" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(osm_id) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"CODE_IRIS"</span>, <span class="st">"FFME_NAME"</span>, <span class="st">"FFME_TIME"</span>,</span>
<span id="cb19-393"><a href="#cb19-393" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"N_FFME_15MN"</span>)</span>
<span id="cb19-394"><a href="#cb19-394" aria-hidden="true" tabindex="-1"></a>iris <span class="ot">&lt;-</span> <span class="fu">merge</span>(iris, osm_id, <span class="at">by =</span> <span class="st">"CODE_IRIS"</span>, <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span>
<span id="cb19-395"><a href="#cb19-395" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-396"><a href="#cb19-396" aria-hidden="true" tabindex="-1"></a><span class="co"># FSGT associative structure</span></span>
<span id="cb19-397"><a href="#cb19-397" aria-hidden="true" tabindex="-1"></a><span class="co"># Name of the nearest structure</span></span>
<span id="cb19-398"><a href="#cb19-398" aria-hidden="true" tabindex="-1"></a>osm_id <span class="ot">&lt;-</span> <span class="fu">colnames</span>(df4)[<span class="fu">apply</span>(df4, <span class="dv">1</span>, which.min)] <span class="co"># Name</span></span>
<span id="cb19-399"><a href="#cb19-399" aria-hidden="true" tabindex="-1"></a>osm_id <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(osm_id, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb19-400"><a href="#cb19-400" aria-hidden="true" tabindex="-1"></a>osm_id<span class="sc">$</span>iris <span class="ot">&lt;-</span> <span class="fu">row.names</span>(df4)</span>
<span id="cb19-401"><a href="#cb19-401" aria-hidden="true" tabindex="-1"></a>osm_id <span class="ot">&lt;-</span> <span class="fu">merge</span>(osm_id, poi[,<span class="fu">c</span>(<span class="st">"osm_id"</span>, <span class="st">"name"</span>, <span class="st">"type"</span>)], </span>
<span id="cb19-402"><a href="#cb19-402" aria-hidden="true" tabindex="-1"></a>                <span class="at">by =</span> <span class="st">"osm_id"</span>, <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span>
<span id="cb19-403"><a href="#cb19-403" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-404"><a href="#cb19-404" aria-hidden="true" tabindex="-1"></a><span class="co"># Time to the nearest climbing area</span></span>
<span id="cb19-405"><a href="#cb19-405" aria-hidden="true" tabindex="-1"></a>time <span class="ot">&lt;-</span> <span class="fu">apply</span>(df4, <span class="dv">1</span>, min) <span class="co"># Time</span></span>
<span id="cb19-406"><a href="#cb19-406" aria-hidden="true" tabindex="-1"></a>time <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(time, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb19-407"><a href="#cb19-407" aria-hidden="true" tabindex="-1"></a>time<span class="sc">$</span>iris <span class="ot">&lt;-</span> <span class="fu">row.names</span>(time)</span>
<span id="cb19-408"><a href="#cb19-408" aria-hidden="true" tabindex="-1"></a>osm_id <span class="ot">&lt;-</span> <span class="fu">merge</span>(osm_id, time, <span class="at">by =</span> <span class="st">"iris"</span>, <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span>
<span id="cb19-409"><a href="#cb19-409" aria-hidden="true" tabindex="-1"></a>osm_id<span class="sc">$</span>geometry <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb19-410"><a href="#cb19-410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-411"><a href="#cb19-411" aria-hidden="true" tabindex="-1"></a><span class="co"># Number of climbing area at less than 15 minutes by bike</span></span>
<span id="cb19-412"><a href="#cb19-412" aria-hidden="true" tabindex="-1"></a>n15mn <span class="ot">&lt;-</span> df4</span>
<span id="cb19-413"><a href="#cb19-413" aria-hidden="true" tabindex="-1"></a>n15mn <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(df4, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb19-414"><a href="#cb19-414" aria-hidden="true" tabindex="-1"></a>n15mn[n15mn <span class="sc">&lt;</span> <span class="dv">15</span>] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb19-415"><a href="#cb19-415" aria-hidden="true" tabindex="-1"></a>n15mn[n15mn <span class="sc">&gt;</span> <span class="dv">15</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb19-416"><a href="#cb19-416" aria-hidden="true" tabindex="-1"></a>n15mn<span class="sc">$</span>N <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(n15mn)</span>
<span id="cb19-417"><a href="#cb19-417" aria-hidden="true" tabindex="-1"></a>n15mn<span class="sc">$</span>iris <span class="ot">&lt;-</span> <span class="fu">row.names</span>(n15mn)</span>
<span id="cb19-418"><a href="#cb19-418" aria-hidden="true" tabindex="-1"></a>osm_id <span class="ot">&lt;-</span> <span class="fu">merge</span>(osm_id, n15mn[,<span class="fu">c</span>(<span class="st">"iris"</span>, <span class="st">"N"</span>)], <span class="at">by =</span> <span class="st">"iris"</span>,</span>
<span id="cb19-419"><a href="#cb19-419" aria-hidden="true" tabindex="-1"></a>                <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span>
<span id="cb19-420"><a href="#cb19-420" aria-hidden="true" tabindex="-1"></a>osm_id <span class="ot">&lt;-</span> osm_id[,<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">5</span><span class="sc">:</span><span class="dv">6</span>)]</span>
<span id="cb19-421"><a href="#cb19-421" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(osm_id) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"CODE_IRIS"</span>, <span class="st">"FSGT_NAME"</span>, <span class="st">"FSGT_TIME"</span>,</span>
<span id="cb19-422"><a href="#cb19-422" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"N_FSGT_15MN"</span>)</span>
<span id="cb19-423"><a href="#cb19-423" aria-hidden="true" tabindex="-1"></a>iris <span class="ot">&lt;-</span> <span class="fu">merge</span>(iris, osm_id, <span class="at">by =</span> <span class="st">"CODE_IRIS"</span>, <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span>
<span id="cb19-424"><a href="#cb19-424" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb19-425"><a href="#cb19-425" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-426"><a href="#cb19-426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-427"><a href="#cb19-427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-428"><a href="#cb19-428" aria-hidden="true" tabindex="-1"></a><span class="fu">### Characterizing the POI neighbourhood</span></span>
<span id="cb19-429"><a href="#cb19-429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-430"><a href="#cb19-430" aria-hidden="true" tabindex="-1"></a>For each climbing areas, we are interested in defining the socio-economic characteristics of their neighbourhood.</span>
<span id="cb19-431"><a href="#cb19-431" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-432"><a href="#cb19-432" aria-hidden="true" tabindex="-1"></a>The previous matrix is transposed (lines <span class="sc">\&lt;\&gt;</span> columns). For each climbing structure, we extract the IRIS located at less than 15 minutes by bike and to produce the following indicators :</span>
<span id="cb19-433"><a href="#cb19-433" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-434"><a href="#cb19-434" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Total population at less than 15 minutes by bike. This can be considered as an amount of "social demand".</span>
<span id="cb19-435"><a href="#cb19-435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-436"><a href="#cb19-436" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Minimum, mean and maximum of median income of IRIS at less than 15 minutes by bike.</span>
<span id="cb19-437"><a href="#cb19-437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-438"><a href="#cb19-438" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = FALSE}</span></span>
<span id="cb19-439"><a href="#cb19-439" aria-hidden="true" tabindex="-1"></a><span class="co"># Transpose dataframe</span></span>
<span id="cb19-440"><a href="#cb19-440" aria-hidden="true" tabindex="-1"></a>t.df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">t</span>(df))</span>
<span id="cb19-441"><a href="#cb19-441" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(t.df) <span class="ot">&lt;-</span> iris10k[iris10k<span class="sc">$</span>TYP_IRIS <span class="sc">==</span> <span class="st">"H"</span>,]<span class="sc">$</span>CODE_IRIS</span>
<span id="cb19-442"><a href="#cb19-442" aria-hidden="true" tabindex="-1"></a>t.df<span class="sc">$</span>osm_id <span class="ot">&lt;-</span> dest<span class="sc">$</span>osm_id</span>
<span id="cb19-443"><a href="#cb19-443" aria-hidden="true" tabindex="-1"></a>t.df <span class="ot">&lt;-</span> t.df[t.df<span class="sc">$</span>osm_id <span class="sc">%in%</span> poi<span class="sc">$</span>osm_id,]</span>
<span id="cb19-444"><a href="#cb19-444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-445"><a href="#cb19-445" aria-hidden="true" tabindex="-1"></a><span class="co"># For each climbing area, get indicators of interest</span></span>
<span id="cb19-446"><a href="#cb19-446" aria-hidden="true" tabindex="-1"></a>poi_socio <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">matrix</span>(<span class="at">nrow =</span> <span class="dv">0</span>, <span class="at">ncol =</span> <span class="dv">5</span>))</span>
<span id="cb19-447"><a href="#cb19-447" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(poi_socio) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"osm_id"</span>, <span class="st">"SUM_POP18"</span>, <span class="st">"MIN_REV19"</span>, <span class="st">"MOY_REV19"</span>, <span class="st">"MAX_REV19"</span>)</span>
<span id="cb19-448"><a href="#cb19-448" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-449"><a href="#cb19-449" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(t.df)){</span>
<span id="cb19-450"><a href="#cb19-450" aria-hidden="true" tabindex="-1"></a>  tmp1 <span class="ot">&lt;-</span> t.df[, t.df[i, ] <span class="sc">&lt;</span> <span class="dv">15</span>]</span>
<span id="cb19-451"><a href="#cb19-451" aria-hidden="true" tabindex="-1"></a>  tmp2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">CODE_IRIS =</span> <span class="fu">colnames</span>(tmp1))</span>
<span id="cb19-452"><a href="#cb19-452" aria-hidden="true" tabindex="-1"></a>  tmp2 <span class="ot">&lt;-</span> <span class="fu">merge</span>(tmp2, iris10k[,<span class="fu">c</span>(<span class="st">"CODE_IRIS"</span>, <span class="st">"P18_POP"</span>, <span class="st">"DISP_MED19"</span>)],</span>
<span id="cb19-453"><a href="#cb19-453" aria-hidden="true" tabindex="-1"></a>             <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span>
<span id="cb19-454"><a href="#cb19-454" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-455"><a href="#cb19-455" aria-hidden="true" tabindex="-1"></a>  poi_socio[i,<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">row.names</span>(tmp1)[i]</span>
<span id="cb19-456"><a href="#cb19-456" aria-hidden="true" tabindex="-1"></a>  poi_socio[i,<span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="fu">sum</span>(tmp2<span class="sc">$</span>P18_POP, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb19-457"><a href="#cb19-457" aria-hidden="true" tabindex="-1"></a>  poi_socio[i,<span class="dv">3</span>] <span class="ot">&lt;-</span> <span class="fu">min</span>(tmp2<span class="sc">$</span>DISP_MED19, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb19-458"><a href="#cb19-458" aria-hidden="true" tabindex="-1"></a>  poi_socio[i,<span class="dv">4</span>] <span class="ot">&lt;-</span> <span class="fu">mean</span>(tmp2<span class="sc">$</span>DISP_MED19, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb19-459"><a href="#cb19-459" aria-hidden="true" tabindex="-1"></a>  poi_socio[i,<span class="dv">5</span>] <span class="ot">&lt;-</span> <span class="fu">max</span>(tmp2<span class="sc">$</span>DISP_MED19, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb19-460"><a href="#cb19-460" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb19-461"><a href="#cb19-461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-462"><a href="#cb19-462" aria-hidden="true" tabindex="-1"></a>poi <span class="ot">&lt;-</span> <span class="fu">merge</span>(poi, poi_socio, <span class="at">by =</span> <span class="st">"osm_id"</span>, <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span>
<span id="cb19-463"><a href="#cb19-463" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb19-464"><a href="#cb19-464" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-465"><a href="#cb19-465" aria-hidden="true" tabindex="-1"></a><span class="fu">## Simplify geometries</span></span>
<span id="cb19-466"><a href="#cb19-466" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-467"><a href="#cb19-467" aria-hidden="true" tabindex="-1"></a>Geometries are quite detailed. The library <span class="in">`rmapshaper`</span> (@rmapshaper) is used to simplify the layer. 9 % of the points constituting the polygons are kept. Then, the IRIS layer is aggregated in communes for the map layout.</span>
<span id="cb19-468"><a href="#cb19-468" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-469"><a href="#cb19-469" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = FALSE}</span></span>
<span id="cb19-470"><a href="#cb19-470" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rmapshaper)</span>
<span id="cb19-471"><a href="#cb19-471" aria-hidden="true" tabindex="-1"></a>iris <span class="ot">&lt;-</span> <span class="fu">ms_simplify</span>(iris, <span class="at">keep =</span> <span class="fl">0.09</span>)</span>
<span id="cb19-472"><a href="#cb19-472" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-473"><a href="#cb19-473" aria-hidden="true" tabindex="-1"></a><span class="co"># Communes aggregation (layout)</span></span>
<span id="cb19-474"><a href="#cb19-474" aria-hidden="true" tabindex="-1"></a>com <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(iris[,<span class="fu">c</span>(<span class="st">"INSEE_COM"</span>, <span class="st">"NOM_COM"</span>)],</span>
<span id="cb19-475"><a href="#cb19-475" aria-hidden="true" tabindex="-1"></a>                 <span class="at">by =</span> <span class="fu">list</span>(iris<span class="sc">$</span>INSEE_COM),</span>
<span id="cb19-476"><a href="#cb19-476" aria-hidden="true" tabindex="-1"></a>                 <span class="at">FUN =</span> head, <span class="dv">1</span>)</span>
<span id="cb19-477"><a href="#cb19-477" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb19-478"><a href="#cb19-478" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-479"><a href="#cb19-479" aria-hidden="true" tabindex="-1"></a><span class="fu">## Export results</span></span>
<span id="cb19-480"><a href="#cb19-480" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-481"><a href="#cb19-481" aria-hidden="true" tabindex="-1"></a>Data preparation is over, we can go the data visualization section. Resulting geojson (poi, iris ad communes) are exported in three separated geojson. These files are available in the <span class="co">[</span><span class="ot">Github repository</span><span class="co">](https://github.com/rysebaert/climbing_paris/tree/main/data-conso)</span>.</span>
<span id="cb19-482"><a href="#cb19-482" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-483"><a href="#cb19-483" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = FALSE}</span></span>
<span id="cb19-484"><a href="#cb19-484" aria-hidden="true" tabindex="-1"></a><span class="fu">st_write</span>(com, <span class="st">"data-conso/com.geojson"</span>)</span>
<span id="cb19-485"><a href="#cb19-485" aria-hidden="true" tabindex="-1"></a><span class="fu">st_write</span>(iris, <span class="st">"data-conso/iris.geojson"</span>)</span>
<span id="cb19-486"><a href="#cb19-486" aria-hidden="true" tabindex="-1"></a><span class="fu">st_write</span>(poi, <span class="st">"data-conso/poi.geojson"</span>)</span>
<span id="cb19-487"><a href="#cb19-487" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb19-488"><a href="#cb19-488" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-489"><a href="#cb19-489" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-490"><a href="#cb19-490" aria-hidden="true" tabindex="-1"></a><span class="fu">## Session info (R)</span></span>
<span id="cb19-491"><a href="#cb19-491" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo=FALSE, message=FALSE}</span></span>
<span id="cb19-492"><a href="#cb19-492" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(osmdata)</span>
<span id="cb19-493"><a href="#cb19-493" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(osrm)</span>
<span id="cb19-494"><a href="#cb19-494" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb19-495"><a href="#cb19-495" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mapsf)</span>
<span id="cb19-496"><a href="#cb19-496" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rmapshaper)</span>
<span id="cb19-497"><a href="#cb19-497" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb19-498"><a href="#cb19-498" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-499"><a href="#cb19-499" aria-hidden="true" tabindex="-1"></a><span class="fu">sessionInfo</span>()</span>
<span id="cb19-500"><a href="#cb19-500" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb19-501"><a href="#cb19-501" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-502"><a href="#cb19-502" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-503"><a href="#cb19-503" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-504"><a href="#cb19-504" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-505"><a href="#cb19-505" aria-hidden="true" tabindex="-1"></a><span class="fu"># Data visualization with Observable JavaScript (ojs)</span></span>
<span id="cb19-506"><a href="#cb19-506" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-507"><a href="#cb19-507" aria-hidden="true" tabindex="-1"></a>Observable is a startup founded by Mike Bostock and Melody Mechfessel, who initiated an on-line plateform to collaboratively explore, analyze, visualize and communicate with data on the Web.</span>
<span id="cb19-508"><a href="#cb19-508" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-509"><a href="#cb19-509" aria-hidden="true" tabindex="-1"></a>The computing language is <span class="co">[</span><span class="ot">Observable JavaScript (ojs)</span><span class="co">](https://observablehq.com/\@observablehq/observables-not-javascript)</span>. It is possible to include this programming language in Quarto chunks.</span>
<span id="cb19-510"><a href="#cb19-510" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-511"><a href="#cb19-511" aria-hidden="true" tabindex="-1"></a>This section imports some visualizations realized in an <span class="co">[</span><span class="ot">Observable collection</span><span class="co">](https://observablehq.com/collection/\@rysebaert/climbing_paris)</span>. We invite the reader to consult the Observable collection to have a look to all the data visualizations produced within this project. </span>
<span id="cb19-512"><a href="#cb19-512" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-513"><a href="#cb19-513" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-514"><a href="#cb19-514" aria-hidden="true" tabindex="-1"></a><span class="fu">## Import consolidated data </span></span>
<span id="cb19-515"><a href="#cb19-515" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-516"><a href="#cb19-516" aria-hidden="true" tabindex="-1"></a>Geojson files coming from the data preparation precessing realized in a R programming language and described above are imported.</span>
<span id="cb19-517"><a href="#cb19-517" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-520"><a href="#cb19-520" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb19-521"><a href="#cb19-521" aria-hidden="true" tabindex="-1"></a>iris <span class="op">=</span> <span class="fu">FileAttachment</span>(<span class="st">"data-conso/iris.geojson"</span>)<span class="op">.</span><span class="fu">json</span>()</span>
<span id="cb19-522"><a href="#cb19-522" aria-hidden="true" tabindex="-1"></a>poi <span class="op">=</span> <span class="fu">FileAttachment</span>(<span class="st">"data-conso/poi.geojson"</span>)<span class="op">.</span><span class="fu">json</span>()</span>
<span id="cb19-523"><a href="#cb19-523" aria-hidden="true" tabindex="-1"></a>com <span class="op">=</span> <span class="fu">FileAttachment</span>(<span class="st">"data-conso/com.geojson"</span>)<span class="op">.</span><span class="fu">json</span>()</span>
<span id="cb19-524"><a href="#cb19-524" aria-hidden="true" tabindex="-1"></a><span class="vs">```</span></span>
<span id="cb19-525"><a href="#cb19-525" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-526"><a href="#cb19-526" aria-hidden="true" tabindex="-1"></a><span class="vs">Bertin.js (@bertin) and geoverview.js (@geoverview) libraries are imported. These libraries will be used for creating the maps. </span></span>
<span id="cb19-527"><a href="#cb19-527" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-530"><a href="#cb19-530" aria-hidden="true" tabindex="-1"></a><span class="vs">```</span>ojs</span>
<span id="cb19-531"><a href="#cb19-531" aria-hidden="true" tabindex="-1"></a>bertin <span class="op">=</span> <span class="pp">require</span>(<span class="st">'bertin@0.9.16'</span>)</span>
<span id="cb19-532"><a href="#cb19-532" aria-hidden="true" tabindex="-1"></a>view <span class="op">=</span> <span class="pp">require</span>(<span class="st">"geoverview@1.2"</span>)<span class="op">.</span><span class="fu">then</span>((f) <span class="kw">=&gt;</span> f<span class="op">.</span><span class="at">view</span>)</span>
<span id="cb19-533"><a href="#cb19-533" aria-hidden="true" tabindex="-1"></a><span class="vs">```</span></span>
<span id="cb19-534"><a href="#cb19-534" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-535"><a href="#cb19-535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-536"><a href="#cb19-536" aria-hidden="true" tabindex="-1"></a><span class="vs">## Layers attributes and metadata</span></span>
<span id="cb19-537"><a href="#cb19-537" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-538"><a href="#cb19-538" aria-hidden="true" tabindex="-1"></a><span class="vs">Three geographical layers will be used :</span></span>
<span id="cb19-539"><a href="#cb19-539" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-540"><a href="#cb19-540" aria-hidden="true" tabindex="-1"></a><span class="vs">- **iris** : IRIS intersecting the study area (polygons layer).</span></span>
<span id="cb19-541"><a href="#cb19-541" aria-hidden="true" tabindex="-1"></a><span class="vs">- **poi** : climbing structures included the study area (points layer).</span></span>
<span id="cb19-542"><a href="#cb19-542" aria-hidden="true" tabindex="-1"></a><span class="vs">- **com** : Muncipilaties interesecting thhe study area (polygons layer). This layer will only be used for the map layout and better understand the location of the poi and iris layers : IRIS, the lowest territorial division in France, is not really known by the population. </span></span>
<span id="cb19-543"><a href="#cb19-543" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-544"><a href="#cb19-544" aria-hidden="true" tabindex="-1"></a><span class="vs">The first two geographical layers include attributes coming from the data preparation process, that will be mapped and ploted in the next section of the document. In this part, we present the layers in several ways to understand the information we have in hand for producing the data visualization. </span></span>
<span id="cb19-545"><a href="#cb19-545" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-546"><a href="#cb19-546" aria-hidden="true" tabindex="-1"></a><span class="vs">### Interactive map</span></span>
<span id="cb19-547"><a href="#cb19-547" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-548"><a href="#cb19-548" aria-hidden="true" tabindex="-1"></a><span class="vs">Made with geoverview library. Click on the points / polygons to have an overview of their respective attributes and values.</span></span>
<span id="cb19-549"><a href="#cb19-549" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-552"><a href="#cb19-552" aria-hidden="true" tabindex="-1"></a><span class="vs">```</span>ojs</span>
<span id="cb19-553"><a href="#cb19-553" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> <span class="kw">new</span> <span class="bu">Map</span>([</span>
<span id="cb19-554"><a href="#cb19-554" aria-hidden="true" tabindex="-1"></a>  [<span class="st">"Climbing areas (dots)"</span><span class="op">,</span> poi]<span class="op">,</span></span>
<span id="cb19-555"><a href="#cb19-555" aria-hidden="true" tabindex="-1"></a>  [<span class="st">"IRIS (polygons)"</span><span class="op">,</span> iris]<span class="op">,</span></span>
<span id="cb19-556"><a href="#cb19-556" aria-hidden="true" tabindex="-1"></a>  [<span class="st">"Layout municipalities (polygons)"</span><span class="op">,</span> com]</span>
<span id="cb19-557"><a href="#cb19-557" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb19-558"><a href="#cb19-558" aria-hidden="true" tabindex="-1"></a>viewof geojson <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">select</span>(data<span class="op">,</span> { <span class="dt">label</span><span class="op">:</span> <span class="st">"Select a geojson"</span> })</span>
<span id="cb19-559"><a href="#cb19-559" aria-hidden="true" tabindex="-1"></a>viewof style <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">select</span>([<span class="st">"voyager"</span><span class="op">,</span> <span class="st">"night"</span><span class="op">,</span> <span class="st">"fulldark"</span><span class="op">,</span><span class="st">"positron"</span><span class="op">,</span><span class="st">"icgc"</span><span class="op">,</span><span class="st">"osmbright"</span><span class="op">,</span><span class="st">"hibrid"</span>]<span class="op">,</span> { <span class="dt">label</span><span class="op">:</span> <span class="st">"Select a style"</span> })</span>
<span id="cb19-560"><a href="#cb19-560" aria-hidden="true" tabindex="-1"></a>map2 <span class="op">=</span> <span class="fu">view</span>(geojson<span class="op">,</span> {</span>
<span id="cb19-561"><a href="#cb19-561" aria-hidden="true" tabindex="-1"></a>  <span class="dt">style</span><span class="op">:</span> style</span>
<span id="cb19-562"><a href="#cb19-562" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb19-563"><a href="#cb19-563" aria-hidden="true" tabindex="-1"></a><span class="vs">```</span></span>
<span id="cb19-564"><a href="#cb19-564" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-565"><a href="#cb19-565" aria-hidden="true" tabindex="-1"></a><span class="vs">### Attributes and metadata</span></span>
<span id="cb19-566"><a href="#cb19-566" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-567"><a href="#cb19-567" aria-hidden="true" tabindex="-1"></a><span class="vs">**Attribute table (iris layer)** </span></span>
<span id="cb19-568"><a href="#cb19-568" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-571"><a href="#cb19-571" aria-hidden="true" tabindex="-1"></a><span class="vs">```</span>ojs</span>
<span id="cb19-572"><a href="#cb19-572" aria-hidden="true" tabindex="-1"></a>Inputs<span class="op">.</span><span class="fu">table</span>(iris<span class="op">.</span><span class="at">features</span><span class="op">.</span><span class="fu">map</span>((d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">properties</span>))</span>
<span id="cb19-573"><a href="#cb19-573" aria-hidden="true" tabindex="-1"></a><span class="vs">```</span></span>
<span id="cb19-574"><a href="#cb19-574" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-575"><a href="#cb19-575" aria-hidden="true" tabindex="-1"></a><span class="vs">**Indicators definition (iris layer)**</span></span>
<span id="cb19-576"><a href="#cb19-576" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-577"><a href="#cb19-577" aria-hidden="true" tabindex="-1"></a><span class="vs">| id          | Description                                                                                                                 | Data source                                       |</span></span>
<span id="cb19-578"><a href="#cb19-578" aria-hidden="true" tabindex="-1"></a><span class="vs">|-------------|-----------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------|</span></span>
<span id="cb19-579"><a href="#cb19-579" aria-hidden="true" tabindex="-1"></a><span class="vs">| CODE_IRIS   | IRIS code                                                                                                                   | INSEE, IGN                                        |</span></span>
<span id="cb19-580"><a href="#cb19-580" aria-hidden="true" tabindex="-1"></a><span class="vs">| NOM_IRIS    | IRIS Name                                                                                                                   | INSEE, IGN                                        |</span></span>
<span id="cb19-581"><a href="#cb19-581" aria-hidden="true" tabindex="-1"></a><span class="vs">| TYP_IRIS    | IRIS type (H for dwellings)                                                                                                 | INSEE, IGN                                        |</span></span>
<span id="cb19-582"><a href="#cb19-582" aria-hidden="true" tabindex="-1"></a><span class="vs">| P18_POP     | Population in 2018                                                                                                          | INSEE                                             |</span></span>
<span id="cb19-583"><a href="#cb19-583" aria-hidden="true" tabindex="-1"></a><span class="vs">| DISP_MED19  | Disposable median income in 2019                                                                                            | INSEE                                             |</span></span>
<span id="cb19-584"><a href="#cb19-584" aria-hidden="true" tabindex="-1"></a><span class="vs">| ALL_NAME    | Name of the nearest artificial climbing area reachable by bike (all structures)                                             | (c)OpenStreetMap and contributors, Ronan Ysebaert |</span></span>
<span id="cb19-585"><a href="#cb19-585" aria-hidden="true" tabindex="-1"></a><span class="vs">| TYPE_STRUCT | Manager of the nearest artificial climbing area reachable by bike (private, FSGT or FFME)                                   | (c)OpenStreetMap and contributors, Ronan Ysebaert |</span></span>
<span id="cb19-586"><a href="#cb19-586" aria-hidden="true" tabindex="-1"></a><span class="vs">| ALL_TIME    | Time by bike to reach the nearest artificial climbing area.                                                                 | (c)OpenStreetMap and contributors, Ronan Ysebaert |</span></span>
<span id="cb19-587"><a href="#cb19-587" aria-hidden="true" tabindex="-1"></a><span class="vs">| N_15MN      | Number of climbing areas accessible in 15 minutes by bike from the IRIS centroid (all structures)                           | (c)OpenStreetMap and contributors, Ronan Ysebaert |</span></span>
<span id="cb19-588"><a href="#cb19-588" aria-hidden="true" tabindex="-1"></a><span class="vs">| PRIV_NAME   | Name of the nearest artificial climbing area by bike (Private structure)                                                    | (c)OpenStreetMap and contributors, Ronan Ysebaert |</span></span>
<span id="cb19-589"><a href="#cb19-589" aria-hidden="true" tabindex="-1"></a><span class="vs">| PRIV_TIME   | Time by bike to reach the nearest artificial climbing area (Private structure)                                              | (c)OpenStreetMap and contributors, Ronan Ysebaert |</span></span>
<span id="cb19-590"><a href="#cb19-590" aria-hidden="true" tabindex="-1"></a><span class="vs">| N_PRIV_15MN | Number of climbing areas accessible in 15 minutes by bike from the IRIS centroid (private structures)                       | (c)OpenStreetMap and contributors, Ronan Ysebaert |</span></span>
<span id="cb19-591"><a href="#cb19-591" aria-hidden="true" tabindex="-1"></a><span class="vs">| FFME_NAME   | Name of the nearest artificial climbing area by bike (Associative structure, federation : FFME)                             | (c)OpenStreetMap and contributors, Ronan Ysebaert |</span></span>
<span id="cb19-592"><a href="#cb19-592" aria-hidden="true" tabindex="-1"></a><span class="vs">| FFME_TIME   | Time by bike to reach the nearest artificial climbing area (Associative structure, federation : FFME)                       | (c)OpenStreetMap and contributors, Ronan Ysebaert |</span></span>
<span id="cb19-593"><a href="#cb19-593" aria-hidden="true" tabindex="-1"></a><span class="vs">| N_FFME_15MN | Number of climbing areas accessible in 15 minutes by bike from the IRIS centroid (Associative structure, federation : FFME) | (c)OpenStreetMap and contributors, Ronan Ysebaert |</span></span>
<span id="cb19-594"><a href="#cb19-594" aria-hidden="true" tabindex="-1"></a><span class="vs">| FSGT_NAME   | Name of the nearest artificial climbing area by bike (Associative structure, federation : FSGT)                             | (c)OpenStreetMap and contributors, Ronan Ysebaert |</span></span>
<span id="cb19-595"><a href="#cb19-595" aria-hidden="true" tabindex="-1"></a><span class="vs">| FSGT_TIME   | Time by bike to reach the nearest artificial climbing area (Associative structure, federation : FSGT)                       | (c)OpenStreetMap and contributors, Ronan Ysebaert |</span></span>
<span id="cb19-596"><a href="#cb19-596" aria-hidden="true" tabindex="-1"></a><span class="vs">| N_FSGT_15MN | Number of climbing areas accessible in 15 minutes by bike from the IRIS centroid (Associative structure, federation : FSGT) | (c)OpenStreetMap and contributors, Ronan Ysebaert |</span></span>
<span id="cb19-597"><a href="#cb19-597" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-598"><a href="#cb19-598" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-599"><a href="#cb19-599" aria-hidden="true" tabindex="-1"></a><span class="vs">**Attribute table (poi layer)** </span></span>
<span id="cb19-600"><a href="#cb19-600" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-603"><a href="#cb19-603" aria-hidden="true" tabindex="-1"></a><span class="vs">```</span>ojs</span>
<span id="cb19-604"><a href="#cb19-604" aria-hidden="true" tabindex="-1"></a>Inputs<span class="op">.</span><span class="fu">table</span>(poi<span class="op">.</span><span class="at">features</span><span class="op">.</span><span class="fu">map</span>((d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">properties</span>))</span>
<span id="cb19-605"><a href="#cb19-605" aria-hidden="true" tabindex="-1"></a><span class="vs">```</span></span>
<span id="cb19-606"><a href="#cb19-606" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-607"><a href="#cb19-607" aria-hidden="true" tabindex="-1"></a><span class="vs">**Indicators definition (poi layer)**</span></span>
<span id="cb19-608"><a href="#cb19-608" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-609"><a href="#cb19-609" aria-hidden="true" tabindex="-1"></a><span class="vs">| id              | Description                                                                                                                                                                                       | Data source                                              |</span></span>
<span id="cb19-610"><a href="#cb19-610" aria-hidden="true" tabindex="-1"></a><span class="vs">|-----------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------|</span></span>
<span id="cb19-611"><a href="#cb19-611" aria-hidden="true" tabindex="-1"></a><span class="vs">| osm_id          | OpenStreetMap identifier (responding to the query sport=climbing in the bounding box of the study area)                                                                                           | (c)OpenStreetMap and contributors                        |</span></span>
<span id="cb19-612"><a href="#cb19-612" aria-hidden="true" tabindex="-1"></a><span class="vs">| name            | Name of the artificial climbing area                                                                                                                                                              | (c)OpenStreetMap and contributors                        |</span></span>
<span id="cb19-613"><a href="#cb19-613" aria-hidden="true" tabindex="-1"></a><span class="vs">| climbing_type   | If the articial climbing area is a wall (need a rope to climb), dedicated to bouldering, or both                                                                                                  | (c)OpenStreetMap and contributors, Ronan Ysebaert        |</span></span>
<span id="cb19-614"><a href="#cb19-614" aria-hidden="true" tabindex="-1"></a><span class="vs">| climbing_length | Max. height of the wall (if adapted, for walls and not for bouldering)                                                                                                                            | (c)OpenStreetMap and contributors                        |</span></span>
<span id="cb19-615"><a href="#cb19-615" aria-hidden="true" tabindex="-1"></a><span class="vs">| climbing_routes | Number of climbing routes, materialized by belay station (if adapted, for walls and not for bouldering). Note that in artificial climbing, a same belay station can serve several climbing routes | (c)OpenStreetMap and contributors                        |</span></span>
<span id="cb19-616"><a href="#cb19-616" aria-hidden="true" tabindex="-1"></a><span class="vs">| type            | If the climbing area is speculative (manage by a private brand) or associative                                                                                                                    | (c)OpenStreetMap and contributors, Ronan Ysebaert        |</span></span>
<span id="cb19-617"><a href="#cb19-617" aria-hidden="true" tabindex="-1"></a><span class="vs">| federation      | Name of the manager (FFME, FSGT or private)                                                                                                                                                       | (c)OpenStreetMap and contributors, Ronan Ysebaert        |</span></span>
<span id="cb19-618"><a href="#cb19-618" aria-hidden="true" tabindex="-1"></a><span class="vs">| brand           | Name of the brand managing the private structure                                                                                                                                                  | (c)OpenStreetMap and contributors                        |</span></span>
<span id="cb19-619"><a href="#cb19-619" aria-hidden="true" tabindex="-1"></a><span class="vs">| SUM_POP18       | Population at less than 15 minutes by bike of the artificial climbing area (IRIS centroids).                                                                                                      | INSEE, (c)OpenStreetMap and contributors, Ronan Ysebaert |</span></span>
<span id="cb19-620"><a href="#cb19-620" aria-hidden="true" tabindex="-1"></a><span class="vs">| MIN_REV19       | Mininum of the median income for the IRIS located at less than 15 minutes by bike                                                                                                                 | INSEE, (c)OpenStreetMap and contributors, Ronan Ysebaert |</span></span>
<span id="cb19-621"><a href="#cb19-621" aria-hidden="true" tabindex="-1"></a><span class="vs">| MOY_REV19       | Mean of the Median income for the IRIS located at less than 15 minutes by bike                                                                                                                    | INSEE, (c)OpenStreetMap and contributors, Ronan Ysebaert |</span></span>
<span id="cb19-622"><a href="#cb19-622" aria-hidden="true" tabindex="-1"></a><span class="vs">| MAX_REV19       | Maximum of the Median income for the IRIS located at less than 15 minutes by bike                                                                                                                 | INSEE, (c)OpenStreetMap and contributors, Ronan Ysebaert |</span></span>
<span id="cb19-623"><a href="#cb19-623" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-624"><a href="#cb19-624" aria-hidden="true" tabindex="-1"></a><span class="vs">## Wall's characteristics</span></span>
<span id="cb19-625"><a href="#cb19-625" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-628"><a href="#cb19-628" aria-hidden="true" tabindex="-1"></a><span class="vs">```</span>ojs</span>
<span id="cb19-629"><a href="#cb19-629" aria-hidden="true" tabindex="-1"></a><span class="co">//Manage map projection</span></span>
<span id="cb19-630"><a href="#cb19-630" aria-hidden="true" tabindex="-1"></a>lambert93 <span class="op">=</span> <span class="st">"+proj=lcc +lat_1=49 +lat_2=44 +lat_0=46.5 +lon_0=3 +x_0=700000 +y_0=6600000 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs"</span></span>
<span id="cb19-631"><a href="#cb19-631" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-632"><a href="#cb19-632" aria-hidden="true" tabindex="-1"></a><span class="co">// Map parameters to play with it</span></span>
<span id="cb19-633"><a href="#cb19-633" aria-hidden="true" tabindex="-1"></a>viewof ind <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">radio</span>([<span class="st">"climbing_length"</span><span class="op">,</span> <span class="st">"climbing_routes"</span>]<span class="op">,</span> {<span class="dt">label</span><span class="op">:</span> <span class="st">"Wall height / Number of routes"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="st">"climbing_length"</span>})</span>
<span id="cb19-634"><a href="#cb19-634" aria-hidden="true" tabindex="-1"></a>viewof k <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">10</span><span class="op">,</span> <span class="dv">300</span>]<span class="op">,</span> { <span class="dt">label</span><span class="op">:</span> <span class="st">"Spikes height"</span><span class="op">,</span> <span class="dt">step</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="dv">90</span> })</span>
<span id="cb19-635"><a href="#cb19-635" aria-hidden="true" tabindex="-1"></a>viewof w <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">2</span><span class="op">,</span> <span class="dv">30</span>]<span class="op">,</span> { <span class="dt">label</span><span class="op">:</span> <span class="st">"Spikes / dots width"</span><span class="op">,</span> <span class="dt">step</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="dv">15</span> })</span>
<span id="cb19-636"><a href="#cb19-636" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-637"><a href="#cb19-637" aria-hidden="true" tabindex="-1"></a><span class="co">// Spike map </span></span>
<span id="cb19-638"><a href="#cb19-638" aria-hidden="true" tabindex="-1"></a>map <span class="op">=</span> bertin<span class="op">.</span><span class="fu">draw</span>({</span>
<span id="cb19-639"><a href="#cb19-639" aria-hidden="true" tabindex="-1"></a>  <span class="dt">params</span><span class="op">:</span> {</span>
<span id="cb19-640"><a href="#cb19-640" aria-hidden="true" tabindex="-1"></a>    <span class="dt">width</span><span class="op">:</span> <span class="dv">750</span><span class="op">,</span></span>
<span id="cb19-641"><a href="#cb19-641" aria-hidden="true" tabindex="-1"></a>    <span class="dt">projection</span><span class="op">:</span> lambert93<span class="op">,</span></span>
<span id="cb19-642"><a href="#cb19-642" aria-hidden="true" tabindex="-1"></a>    <span class="dt">extent</span><span class="op">:</span> com</span>
<span id="cb19-643"><a href="#cb19-643" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb19-644"><a href="#cb19-644" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-645"><a href="#cb19-645" aria-hidden="true" tabindex="-1"></a>  <span class="dt">layers</span><span class="op">:</span> [</span>
<span id="cb19-646"><a href="#cb19-646" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb19-647"><a href="#cb19-647" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"spikes"</span><span class="op">,</span></span>
<span id="cb19-648"><a href="#cb19-648" aria-hidden="true" tabindex="-1"></a>      <span class="dt">geojson</span><span class="op">:</span> poi<span class="op">,</span></span>
<span id="cb19-649"><a href="#cb19-649" aria-hidden="true" tabindex="-1"></a>      <span class="dt">values</span><span class="op">:</span> ind<span class="op">,</span></span>
<span id="cb19-650"><a href="#cb19-650" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fillOpacity</span><span class="op">:</span> <span class="fl">0.2</span><span class="op">,</span></span>
<span id="cb19-651"><a href="#cb19-651" aria-hidden="true" tabindex="-1"></a>      <span class="dt">k</span><span class="op">:</span> k<span class="op">,</span></span>
<span id="cb19-652"><a href="#cb19-652" aria-hidden="true" tabindex="-1"></a>      <span class="dt">w</span><span class="op">:</span> w<span class="op">,</span></span>
<span id="cb19-653"><a href="#cb19-653" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> {</span>
<span id="cb19-654"><a href="#cb19-654" aria-hidden="true" tabindex="-1"></a>        <span class="dt">type</span><span class="op">:</span> <span class="st">"typo"</span><span class="op">,</span></span>
<span id="cb19-655"><a href="#cb19-655" aria-hidden="true" tabindex="-1"></a>        <span class="dt">values</span><span class="op">:</span> <span class="st">"federation"</span><span class="op">,</span></span>
<span id="cb19-656"><a href="#cb19-656" aria-hidden="true" tabindex="-1"></a>        <span class="dt">colors</span><span class="op">:</span> [<span class="st">"#9990f0"</span><span class="op">,</span> <span class="st">"#fcb456"</span><span class="op">,</span> <span class="st">"#ba0b25"</span>]<span class="op">,</span></span>
<span id="cb19-657"><a href="#cb19-657" aria-hidden="true" tabindex="-1"></a>        <span class="dt">leg_title</span><span class="op">:</span> <span class="vs">`Wall's managers`</span><span class="op">,</span></span>
<span id="cb19-658"><a href="#cb19-658" aria-hidden="true" tabindex="-1"></a>        <span class="dt">leg_x</span><span class="op">:</span> <span class="dv">600</span><span class="op">,</span></span>
<span id="cb19-659"><a href="#cb19-659" aria-hidden="true" tabindex="-1"></a>        <span class="dt">leg_y</span><span class="op">:</span> <span class="dv">550</span></span>
<span id="cb19-660"><a href="#cb19-660" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb19-661"><a href="#cb19-661" aria-hidden="true" tabindex="-1"></a>      <span class="dt">stroke</span><span class="op">:</span> {</span>
<span id="cb19-662"><a href="#cb19-662" aria-hidden="true" tabindex="-1"></a>        <span class="dt">type</span><span class="op">:</span> <span class="st">"typo"</span><span class="op">,</span></span>
<span id="cb19-663"><a href="#cb19-663" aria-hidden="true" tabindex="-1"></a>        <span class="dt">values</span><span class="op">:</span> <span class="st">"federation"</span><span class="op">,</span></span>
<span id="cb19-664"><a href="#cb19-664" aria-hidden="true" tabindex="-1"></a>        <span class="dt">colors</span><span class="op">:</span> [<span class="st">"#9990f0"</span><span class="op">,</span> <span class="st">"#fcb456"</span><span class="op">,</span> <span class="st">"#ba0b25"</span>]</span>
<span id="cb19-665"><a href="#cb19-665" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb19-666"><a href="#cb19-666" aria-hidden="true" tabindex="-1"></a>      <span class="dt">leg_x</span><span class="op">:</span> <span class="dv">15</span><span class="op">,</span></span>
<span id="cb19-667"><a href="#cb19-667" aria-hidden="true" tabindex="-1"></a>      <span class="dt">leg_y</span><span class="op">:</span> <span class="dv">15</span><span class="op">,</span></span>
<span id="cb19-668"><a href="#cb19-668" aria-hidden="true" tabindex="-1"></a>      <span class="dt">leg_round</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb19-669"><a href="#cb19-669" aria-hidden="true" tabindex="-1"></a>      <span class="dt">leg_title</span><span class="op">:</span> <span class="vs">`Height (meters) or routes number`</span><span class="op">,</span></span>
<span id="cb19-670"><a href="#cb19-670" aria-hidden="true" tabindex="-1"></a>      <span class="dt">tooltip</span><span class="op">:</span> {</span>
<span id="cb19-671"><a href="#cb19-671" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fields</span><span class="op">:</span> [</span>
<span id="cb19-672"><a href="#cb19-672" aria-hidden="true" tabindex="-1"></a>          <span class="st">"$name"</span><span class="op">,</span></span>
<span id="cb19-673"><a href="#cb19-673" aria-hidden="true" tabindex="-1"></a>          <span class="st">"$climbing_length"</span><span class="op">,</span></span>
<span id="cb19-674"><a href="#cb19-674" aria-hidden="true" tabindex="-1"></a>          <span class="st">"(height in meters)"</span><span class="op">,</span></span>
<span id="cb19-675"><a href="#cb19-675" aria-hidden="true" tabindex="-1"></a>          <span class="st">"$climbing_routes"</span><span class="op">,</span></span>
<span id="cb19-676"><a href="#cb19-676" aria-hidden="true" tabindex="-1"></a>          <span class="st">"(nb. routes)"</span><span class="op">,</span></span>
<span id="cb19-677"><a href="#cb19-677" aria-hidden="true" tabindex="-1"></a>          <span class="st">"$federation"</span><span class="op">,</span></span>
<span id="cb19-678"><a href="#cb19-678" aria-hidden="true" tabindex="-1"></a>          <span class="st">"(manager)"</span></span>
<span id="cb19-679"><a href="#cb19-679" aria-hidden="true" tabindex="-1"></a>        ]<span class="op">,</span></span>
<span id="cb19-680"><a href="#cb19-680" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fill</span><span class="op">:</span> [<span class="st">"black"</span><span class="op">,</span> <span class="st">"black"</span><span class="op">,</span> <span class="st">"black"</span><span class="op">,</span> <span class="st">"black"</span><span class="op">,</span> <span class="st">"black"</span><span class="op">,</span> <span class="st">"black"</span><span class="op">,</span> <span class="st">"black"</span>]<span class="op">,</span></span>
<span id="cb19-681"><a href="#cb19-681" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fontWeight</span><span class="op">:</span> [</span>
<span id="cb19-682"><a href="#cb19-682" aria-hidden="true" tabindex="-1"></a>          <span class="st">"bold"</span><span class="op">,</span></span>
<span id="cb19-683"><a href="#cb19-683" aria-hidden="true" tabindex="-1"></a>          <span class="st">"normal"</span><span class="op">,</span></span>
<span id="cb19-684"><a href="#cb19-684" aria-hidden="true" tabindex="-1"></a>          <span class="st">"normal"</span><span class="op">,</span></span>
<span id="cb19-685"><a href="#cb19-685" aria-hidden="true" tabindex="-1"></a>          <span class="st">"normal"</span><span class="op">,</span></span>
<span id="cb19-686"><a href="#cb19-686" aria-hidden="true" tabindex="-1"></a>          <span class="st">"normal"</span><span class="op">,</span></span>
<span id="cb19-687"><a href="#cb19-687" aria-hidden="true" tabindex="-1"></a>          <span class="st">"normal"</span><span class="op">,</span></span>
<span id="cb19-688"><a href="#cb19-688" aria-hidden="true" tabindex="-1"></a>          <span class="st">"normal"</span></span>
<span id="cb19-689"><a href="#cb19-689" aria-hidden="true" tabindex="-1"></a>        ]<span class="op">,</span></span>
<span id="cb19-690"><a href="#cb19-690" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fontSize</span><span class="op">:</span> [<span class="dv">14</span><span class="op">,</span> <span class="dv">12</span><span class="op">,</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">12</span><span class="op">,</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">12</span><span class="op">,</span> <span class="dv">10</span>]<span class="op">,</span></span>
<span id="cb19-691"><a href="#cb19-691" aria-hidden="true" tabindex="-1"></a>        <span class="dt">col</span><span class="op">:</span> <span class="st">"white"</span></span>
<span id="cb19-692"><a href="#cb19-692" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb19-693"><a href="#cb19-693" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb19-694"><a href="#cb19-694" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-695"><a href="#cb19-695" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb19-696"><a href="#cb19-696" aria-hidden="true" tabindex="-1"></a>      <span class="dt">geojson</span><span class="op">:</span> poi<span class="op">,</span></span>
<span id="cb19-697"><a href="#cb19-697" aria-hidden="true" tabindex="-1"></a>      <span class="dt">symbol_size</span><span class="op">:</span> <span class="dv">10</span> <span class="op">*</span> w<span class="op">,</span></span>
<span id="cb19-698"><a href="#cb19-698" aria-hidden="true" tabindex="-1"></a>      <span class="dt">symbol</span><span class="op">:</span> <span class="st">"circle"</span><span class="op">,</span></span>
<span id="cb19-699"><a href="#cb19-699" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> {</span>
<span id="cb19-700"><a href="#cb19-700" aria-hidden="true" tabindex="-1"></a>        <span class="dt">type</span><span class="op">:</span> <span class="st">"typo"</span><span class="op">,</span></span>
<span id="cb19-701"><a href="#cb19-701" aria-hidden="true" tabindex="-1"></a>        <span class="dt">values</span><span class="op">:</span> <span class="st">"climbing_type"</span><span class="op">,</span></span>
<span id="cb19-702"><a href="#cb19-702" aria-hidden="true" tabindex="-1"></a>        <span class="dt">colors</span><span class="op">:</span> [<span class="st">"white"</span><span class="op">,</span> <span class="st">"lightgrey"</span><span class="op">,</span> <span class="st">"grey"</span>]<span class="op">,</span></span>
<span id="cb19-703"><a href="#cb19-703" aria-hidden="true" tabindex="-1"></a>        <span class="dt">leg_title</span><span class="op">:</span> <span class="vs">`Climbing type`</span><span class="op">,</span></span>
<span id="cb19-704"><a href="#cb19-704" aria-hidden="true" tabindex="-1"></a>        <span class="dt">leg_x</span><span class="op">:</span> <span class="dv">600</span><span class="op">,</span></span>
<span id="cb19-705"><a href="#cb19-705" aria-hidden="true" tabindex="-1"></a>        <span class="dt">leg_y</span><span class="op">:</span> <span class="dv">430</span></span>
<span id="cb19-706"><a href="#cb19-706" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb19-707"><a href="#cb19-707" aria-hidden="true" tabindex="-1"></a>      <span class="dt">stroke</span><span class="op">:</span> {</span>
<span id="cb19-708"><a href="#cb19-708" aria-hidden="true" tabindex="-1"></a>        <span class="dt">type</span><span class="op">:</span> <span class="st">"typo"</span><span class="op">,</span></span>
<span id="cb19-709"><a href="#cb19-709" aria-hidden="true" tabindex="-1"></a>        <span class="dt">values</span><span class="op">:</span> <span class="st">"federation"</span><span class="op">,</span></span>
<span id="cb19-710"><a href="#cb19-710" aria-hidden="true" tabindex="-1"></a>        <span class="dt">colors</span><span class="op">:</span> [<span class="st">"#9990f0"</span><span class="op">,</span> <span class="st">"#fcb456"</span><span class="op">,</span> <span class="st">"#ba0b25"</span>]</span>
<span id="cb19-711"><a href="#cb19-711" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb19-712"><a href="#cb19-712" aria-hidden="true" tabindex="-1"></a>      <span class="dt">strokeWidth</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span></span>
<span id="cb19-713"><a href="#cb19-713" aria-hidden="true" tabindex="-1"></a>      <span class="dt">tooltip</span><span class="op">:</span> {</span>
<span id="cb19-714"><a href="#cb19-714" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fields</span><span class="op">:</span> [<span class="st">"$name"</span><span class="op">,</span> <span class="st">"$climbing_type"</span>]<span class="op">,</span></span>
<span id="cb19-715"><a href="#cb19-715" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fill</span><span class="op">:</span> [<span class="st">"black"</span><span class="op">,</span> <span class="st">"black"</span>]<span class="op">,</span></span>
<span id="cb19-716"><a href="#cb19-716" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fontWeight</span><span class="op">:</span> [<span class="st">"bold"</span><span class="op">,</span> <span class="st">"normal"</span>]<span class="op">,</span></span>
<span id="cb19-717"><a href="#cb19-717" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fontSize</span><span class="op">:</span> [<span class="dv">12</span><span class="op">,</span> <span class="dv">10</span>]<span class="op">,</span></span>
<span id="cb19-718"><a href="#cb19-718" aria-hidden="true" tabindex="-1"></a>        <span class="dt">col</span><span class="op">:</span> <span class="st">"white"</span></span>
<span id="cb19-719"><a href="#cb19-719" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb19-720"><a href="#cb19-720" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb19-721"><a href="#cb19-721" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-722"><a href="#cb19-722" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb19-723"><a href="#cb19-723" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"text"</span><span class="op">,</span></span>
<span id="cb19-724"><a href="#cb19-724" aria-hidden="true" tabindex="-1"></a>      <span class="dt">position</span><span class="op">:</span> <span class="st">"topright"</span><span class="op">,</span></span>
<span id="cb19-725"><a href="#cb19-725" aria-hidden="true" tabindex="-1"></a>      <span class="dt">text</span><span class="op">:</span> <span class="st">"Climbing hot spots"</span><span class="op">,</span></span>
<span id="cb19-726"><a href="#cb19-726" aria-hidden="true" tabindex="-1"></a>      <span class="dt">frame_opacity</span><span class="op">:</span> <span class="fl">0.7</span><span class="op">,</span></span>
<span id="cb19-727"><a href="#cb19-727" aria-hidden="true" tabindex="-1"></a>      <span class="dt">baseline</span><span class="op">:</span> <span class="st">"hanging"</span><span class="op">,</span></span>
<span id="cb19-728"><a href="#cb19-728" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> <span class="st">"black"</span><span class="op">,</span></span>
<span id="cb19-729"><a href="#cb19-729" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fontSize</span><span class="op">:</span> <span class="dv">25</span><span class="op">,</span></span>
<span id="cb19-730"><a href="#cb19-730" aria-hidden="true" tabindex="-1"></a>      <span class="dt">margin</span><span class="op">:</span> <span class="dv">4</span><span class="op">,</span></span>
<span id="cb19-731"><a href="#cb19-731" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fontWeight</span><span class="op">:</span> <span class="st">"bold"</span><span class="op">,</span></span>
<span id="cb19-732"><a href="#cb19-732" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fontFamily</span><span class="op">:</span> <span class="st">"Ubuntu"</span></span>
<span id="cb19-733"><a href="#cb19-733" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb19-734"><a href="#cb19-734" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-735"><a href="#cb19-735" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb19-736"><a href="#cb19-736" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"layer"</span><span class="op">,</span></span>
<span id="cb19-737"><a href="#cb19-737" aria-hidden="true" tabindex="-1"></a>      <span class="dt">geojson</span><span class="op">:</span> com<span class="op">,</span></span>
<span id="cb19-738"><a href="#cb19-738" aria-hidden="true" tabindex="-1"></a>      <span class="dt">stroke</span><span class="op">:</span> <span class="st">"white"</span><span class="op">,</span></span>
<span id="cb19-739"><a href="#cb19-739" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> <span class="st">"peachpuff"</span><span class="op">,</span></span>
<span id="cb19-740"><a href="#cb19-740" aria-hidden="true" tabindex="-1"></a>      <span class="dt">tooltip</span><span class="op">:</span> [<span class="st">"$NOM_COM"</span>]</span>
<span id="cb19-741"><a href="#cb19-741" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb19-742"><a href="#cb19-742" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-743"><a href="#cb19-743" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb19-744"><a href="#cb19-744" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"scalebar"</span><span class="op">,</span></span>
<span id="cb19-745"><a href="#cb19-745" aria-hidden="true" tabindex="-1"></a>      <span class="dt">units</span><span class="op">:</span> <span class="st">"miles"</span></span>
<span id="cb19-746"><a href="#cb19-746" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb19-747"><a href="#cb19-747" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-748"><a href="#cb19-748" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb19-749"><a href="#cb19-749" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"footer"</span><span class="op">,</span></span>
<span id="cb19-750"><a href="#cb19-750" aria-hidden="true" tabindex="-1"></a>      <span class="dt">text</span><span class="op">:</span></span>
<span id="cb19-751"><a href="#cb19-751" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Sources: (c)OpenStreetMap and contributors, INSEE, IGN, 2022</span><span class="sc">\n</span><span class="st">Realisation: Ronan Ysebaert, 2022"</span></span>
<span id="cb19-752"><a href="#cb19-752" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb19-753"><a href="#cb19-753" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb19-754"><a href="#cb19-754" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb19-755"><a href="#cb19-755" aria-hidden="true" tabindex="-1"></a><span class="vs">```</span></span>
<span id="cb19-756"><a href="#cb19-756" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-757"><a href="#cb19-757" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-758"><a href="#cb19-758" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-759"><a href="#cb19-759" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-760"><a href="#cb19-760" aria-hidden="true" tabindex="-1"></a><span class="vs"># Concluding methodological remarks</span></span>
<span id="cb19-761"><a href="#cb19-761" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-762"><a href="#cb19-762" aria-hidden="true" tabindex="-1"></a><span class="vs">## Extend the analysis</span></span>
<span id="cb19-763"><a href="#cb19-763" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-764"><a href="#cb19-764" aria-hidden="true" tabindex="-1"></a><span class="vs">This methodological example showed a general methodology to combine institutional and crowd-sourced data to develop some simple indicators of accessibility to services of interest using open-source routing engines, and disseminate this with data visualizations frameworks. It is one possible implementation, among others. Other implementations could easily be envisaged. </span></span>
<span id="cb19-765"><a href="#cb19-765" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-766"><a href="#cb19-766" aria-hidden="true" tabindex="-1"></a><span class="vs">- **Geographical coverage**: The data preparation process presented above requires the definition of a geographical bounding box to extract OpenStreetMap points of interest (destinations of travel-time calculations) and an existing territorial division (the centroids being the origins of the travel-time calculations). This could be easily extented to other areas of interest, by modifying the Xmin, Xmax, Ymin and Ymax of the bounding box, or using other territorial divisions (a regular grid, for instance). The important things to consider is  </span></span>
<span id="cb19-767"><a href="#cb19-767" aria-hidden="true" tabindex="-1"></a><span class="vs">- **Use other points of interest**:  This example used the OpenStreetMap tag defined by the key-value `</span>sport<span class="op">=</span><span class="fu">climbing</span><span class="vs">`. Other [map features](https://wiki.openstreetmap.org/wiki/Map_features) could be investigated, such as [amenities](https://wiki.openstreetmap.org/wiki/Key:amenity), [tourism facilities](https://wiki.openstreetmap.org/wiki/Map_features#Tourism) or [shops](https://wiki.openstreetmap.org/wiki/Map_features#Shop). The only element to consider is the geometric reference of the object in the OpenStreetMap database ; it could be nodes, ways or relations. In the case of sport=climbing tag, the [OpenStreetMap Wiki](https://wiki.openstreetmap.org/wiki/Tag%3Asport%3Dclimbing) reminds that *sport=climbing should preferably applied to nodes for artificial climbing walls*, our case. If the tag combines nodes and areas, it requires also to extract polygons responding to the tag and transform it into points, checking if the information is not included twice in the OpenStreetMap database.   </span></span>
<span id="cb19-768"><a href="#cb19-768" aria-hidden="true" tabindex="-1"></a><span class="vs">- **Apply other profiles**: In this example, the standard bike profile has been applied. The pedestrian and the car profile are also available and may be also used depending on the objective of the analysis. Whatever the profile used, it reminds important to the parameters of the profiles ([car here](https://github.com/Project-OSRM/osrm-backend/blob/master/profiles/car.lua), [bike here](https://github.com/Project-OSRM/osrm-backend/blob/master/profiles/bicycle.lua) and [pedestrian here](https://github.com/Project-OSRM/osrm-backend/blob/master/profiles/foot.lua)) to understand the calculations realized with routing engines, and their limitations. It is also possible to implement its [own profile](https://github.com/Project-OSRM/osrm-backend/blob/master/docs/profiles.md). </span></span>
<span id="cb19-769"><a href="#cb19-769" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-770"><a href="#cb19-770" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-771"><a href="#cb19-771" aria-hidden="true" tabindex="-1"></a><span class="vs">## Usage precautions</span></span>
<span id="cb19-772"><a href="#cb19-772" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-773"><a href="#cb19-773" aria-hidden="true" tabindex="-1"></a><span class="vs">One persisting criticism made to OpenStreetMap is its lack of quality, mainly due to its general and contributive organisations implying a high heterogeneity of contribution practices. Known problems are due to [geometric accuracy](https://wiki.openstreetmap.org/wiki/Accuracy) (geographical positioning of OSM objects), completeness</span></span>
<span id="cb19-774"><a href="#cb19-774" aria-hidden="true" tabindex="-1"></a><span class="vs">[accuracy](https://wiki.openstreetmap.org/wiki/Accuracy) and [completeness](https://wiki.openstreetmap.org/wiki/Completeness) (missing information, not up-to-date) or problems due to the [tags](https://wiki.openstreetmap.org/wiki/Category:Tagging_Mistakes) describing OSM objects (missing important tags, bad practices). </span></span>
<span id="cb19-775"><a href="#cb19-775" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-776"><a href="#cb19-776" aria-hidden="true" tabindex="-1"></a><span class="vs">In that case, I made a personal survey to complete missing information (around 30 % of the information was missing) in OpenStreetMap database. It meant add some missing points in some cases, and in others to describe it with [relevant climbing tags](https://wiki.openstreetmap.org/wiki/Climbing) identified in the OpenStreetMap Wiki. At the end, it is sure that the input information is not perfect and would require double-checks by the community, but we can argue that it was not worst than in the begginning. </span></span>
<span id="cb19-777"><a href="#cb19-777" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-778"><a href="#cb19-778" aria-hidden="true" tabindex="-1"></a><span class="vs">**Whatever the use of OpenStreetMap you may made, taking a step back to these questions is very important to control** ***a minima*** **the input information used for the travel-time calculations**.  </span></span>
<span id="cb19-779"><a href="#cb19-779" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-780"><a href="#cb19-780" aria-hidden="true" tabindex="-1"></a><span class="vs">Another point to have in mind is the default parameters of osrm profiles: bike profile does not take into account the slope of the road ; the car profile does not take into account the trafic congestion. It may have significant impact on the travel-time calculations. </span></span>
<span id="cb19-781"><a href="#cb19-781" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-782"><a href="#cb19-782" aria-hidden="true" tabindex="-1"></a><span class="vs">Nevertheless, we argue that OpenStreetMap is a wonderful initiative and as we try to demonstrate in this notebook, it is not too difficult to produce innovative indicators and data visualizations using open-source database and libraries. </span></span>
<span id="cb19-783"><a href="#cb19-783" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-784"><a href="#cb19-784" aria-hidden="true" tabindex="-1"></a><span class="vs">Enjoy ! </span></span>
<span id="cb19-785"><a href="#cb19-785" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-786"><a href="#cb19-786" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-787"><a href="#cb19-787" aria-hidden="true" tabindex="-1"></a><span class="vs"># References</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>