<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-0.9.550">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Ronan Ysebaert">
<meta name="dcterms.date" content="2022-06-01">

<title>OSRM Travel-time calculation with R and data visualization with Observable</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>


<script src="index_files/libs/clipboard/clipboard.min.js"></script>
<script src="index_files/libs/quarto-html/quarto.js"></script>
<script src="index_files/libs/quarto-html/popper.min.js"></script>
<script src="index_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="index_files/libs/quarto-html/anchor.min.js"></script>
<link href="index_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="index_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="index_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="index_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="index_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet">
<script type="module" src="index_files/libs/quarto-ojs/quarto-ojs-runtime.js"></script>
<link href="index_files/libs/quarto-ojs/quarto-ojs.css" rel="stylesheet">


<link rel="stylesheet" href="styles.css">
</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#data-processing-with-r" id="toc-data-processing-with-r" class="nav-link active" data-scroll-target="#data-processing-with-r">Data processing with R</a>
  <ul class="collapse">
  <li><a href="#data-sources" id="toc-data-sources" class="nav-link" data-scroll-target="#data-sources">Data sources</a></li>
  <li><a href="#map-layout" id="toc-map-layout" class="nav-link" data-scroll-target="#map-layout">Map layout</a></li>
  <li><a href="#feed-iris-with-socio-economic-data-insee" id="toc-feed-iris-with-socio-economic-data-insee" class="nav-link" data-scroll-target="#feed-iris-with-socio-economic-data-insee">Feed IRIS with socio-economic data (INSEE)</a></li>
  <li><a href="#prepare-iris-for-travel-time-calculation" id="toc-prepare-iris-for-travel-time-calculation" class="nav-link" data-scroll-target="#prepare-iris-for-travel-time-calculation">Prepare IRIS for travel-time calculation</a></li>
  <li><a href="#import-osm-points-of-interest" id="toc-import-osm-points-of-interest" class="nav-link" data-scroll-target="#import-osm-points-of-interest">Import OSM points of interest</a></li>
  <li><a href="#travel-time-calculations-with-osrm" id="toc-travel-time-calculations-with-osrm" class="nav-link" data-scroll-target="#travel-time-calculations-with-osrm">Travel-time calculations with OSRM</a></li>
  <li><a href="#travel-time-isochrone-map" id="toc-travel-time-isochrone-map" class="nav-link" data-scroll-target="#travel-time-isochrone-map">Travel time isochrone Map</a></li>
  <li><a href="#osrm-climbing-trip" id="toc-osrm-climbing-trip" class="nav-link" data-scroll-target="#osrm-climbing-trip">OSRM climbing trip</a></li>
  <li><a href="#simplify-geometries" id="toc-simplify-geometries" class="nav-link" data-scroll-target="#simplify-geometries">Simplify geometries</a></li>
  <li><a href="#export-results" id="toc-export-results" class="nav-link" data-scroll-target="#export-results">Export results</a></li>
  <li><a href="#session-info-r" id="toc-session-info-r" class="nav-link" data-scroll-target="#session-info-r">Session info (R)</a></li>
  </ul></li>
  <li><a href="#data-visualization-with-observable-javascript-ojs" id="toc-data-visualization-with-observable-javascript-ojs" class="nav-link" data-scroll-target="#data-visualization-with-observable-javascript-ojs">Data visualization with Observable JavaScript (ojs)</a>
  <ul class="collapse">
  <li><a href="#import-consolidated-data" id="toc-import-consolidated-data" class="nav-link" data-scroll-target="#import-consolidated-data">Import consolidated data</a></li>
  <li><a href="#layers-attributes-and-metadata" id="toc-layers-attributes-and-metadata" class="nav-link" data-scroll-target="#layers-attributes-and-metadata">Layers attributes and metadata</a></li>
  <li><a href="#walls-characteristics" id="toc-walls-characteristics" class="nav-link" data-scroll-target="#walls-characteristics">Wall’s characteristics</a></li>
  <li><a href="#nearest-wall" id="toc-nearest-wall" class="nav-link" data-scroll-target="#nearest-wall">Nearest wall</a></li>
  <li><a href="#time-to-climb" id="toc-time-to-climb" class="nav-link" data-scroll-target="#time-to-climb">Time to climb</a></li>
  <li><a href="#climbing-in-15-minutes" id="toc-climbing-in-15-minutes" class="nav-link" data-scroll-target="#climbing-in-15-minutes">Climbing in 15 minutes?</a></li>
  <li><a href="#demographic-neighbourhood" id="toc-demographic-neighbourhood" class="nav-link" data-scroll-target="#demographic-neighbourhood">Demographic neighbourhood</a></li>
  <li><a href="#income-neighbourhood" id="toc-income-neighbourhood" class="nav-link" data-scroll-target="#income-neighbourhood">Income neighbourhood</a></li>
  </ul></li>
  <li><a href="#concluding-methodological-remarks" id="toc-concluding-methodological-remarks" class="nav-link" data-scroll-target="#concluding-methodological-remarks">Concluding methodological remarks</a>
  <ul class="collapse">
  <li><a href="#extend-the-analysis" id="toc-extend-the-analysis" class="nav-link" data-scroll-target="#extend-the-analysis">Extend the analysis</a></li>
  <li><a href="#usage-precautions" id="toc-usage-precautions" class="nav-link" data-scroll-target="#usage-precautions">Usage precautions</a></li>
  </ul></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">OSRM Travel-time calculation with R and data visualization with Observable</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
<p class="subtitle lead">Application to artifical climbing walls in Paris and its neighbourhood</p>
</div>


<div class="quarto-title-meta-author">
  <div class="quarto-title-meta-heading">Author</div>
  <div class="quarto-title-meta-heading">Affiliation</div>
  
    <div class="quarto-title-meta-contents">
    <a href="https://rysebaert.github.io/climbing_paris/">Ronan Ysebaert</a> 
  </div>
    <div class="quarto-title-meta-contents">
        <p class="affiliation">
            <a href="https://riate.cnrs.fr/">
            UAR RIATE, Université Paris Cité, CNRS
            </a>
          </p>
      </div>
    </div>

<div class="quarto-title-meta">

      
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">June 1, 2022</p>
    </div>
  </div>
    
  </div>
  

</header>

<p><strong>This documentation is in progress and may evolve in a near future… Sorry for the tips it may include !</strong></p>
<p>The aim of this document consists in showing how to build, visualize and reproduce accessibility indicators by combining points of interest (POI) coming from the OpenStreetMap database, socio-economic indicators included in small territorial division (IRIS) and routing engines (OSRM).</p>
<p>The graphical outputs displayed in this notebook are also available in an <a href="https://observablehq.com/collection/@rysebaert/climbing_paris" title="Go to Observable Notebook">Observable collection</a>.</p>
<p>To introduce the reader to the issues raised by indoor sport-climbing in Paris, have a look to <a href="https://observablehq.com/d/d2be39c4dd55a32d?collection=@rysebaert/climbing_paris" title="Go to Observable Notebook">this notebook</a>.</p>
<p>This Quarto document combines 2 programming languages : R for data processing, and ObservableJS for data visualizations.</p>
<section id="data-processing-with-r" class="level1">
<h1>Data processing with R</h1>
<p>The entire R script can be found <a href="https://github.com/rysebaert/climbing_paris/blob/main/script.R">here</a>.</p>
<section id="data-sources" class="level2">
<h2 class="anchored" data-anchor-id="data-sources">Data sources</h2>
<p>Three data sources, coming from three data providers, will be used:</p>
<ul>
<li><p><strong>IGN</strong> : <a href="https://geoservices.ign.fr/contoursiris" title="Access to input geometries (France)">The Contour…IRIS® édition 2020</a>, which corresponds to the lowest territorial division in France (below the commune level).</p></li>
<li><p><strong>INSEE</strong> : IRIS <a href="https://www.insee.fr/fr/statistiques/6049648" title="Go to input data">Median income</a> and <a href="https://www.insee.fr/fr/statistiques/5650720?sommaire=4658626" title="Go to input data">population</a> in 2019.</p></li>
<li><p><strong>OpenStreetMap</strong> : download of Point Of Interest (POI) and travel time calculation by bike between IRIS centroids and POI, using the <a href="http://project-osrm.org/" title="Access to OSRM Website">OSRM routing engine</a>.</p></li>
</ul>
<p>Input data is not provided in the <a href="https://github.com/rysebaert/climbing_paris">GitHub repository</a> (too large files), but can easily be downloaded and used (no constraints of use).</p>
</section>
<section id="map-layout" class="level2">
<h2 class="anchored" data-anchor-id="map-layout">Map layout</h2>
<p>A bounding box of 5 km around Paris, without Bois de Boulogne et Bois de Vincennes for a better centering of the map layout.</p>
<p>A second bounding box (10 km around Paris) is created to catch OpenStreetMap POI and IRIS in the neighbourhood of this study area and avoid “border effects” for the further calculation of travel-time indicators.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Map layout preparation at IRIS scale (source IGN)----</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>iris <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">"data-raw/CONTOURS-IRIS.shp"</span>, <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract Paris and delete </span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Bois-de-Vincennes / Boulogne Iris for map template</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>iris<span class="sc">$</span>dep <span class="ot">&lt;-</span> <span class="fu">substr</span>(iris<span class="sc">$</span>INSEE_COM, <span class="dv">1</span>, <span class="dv">2</span>)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>paris <span class="ot">&lt;-</span> iris[iris<span class="sc">$</span>dep <span class="sc">==</span> <span class="st">"75"</span>,]</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>paris <span class="ot">&lt;-</span> paris[<span class="sc">!</span>paris<span class="sc">$</span>NOM_IRIS <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Bois de Vincennes 1"</span>,</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"Bois de Vincennes 2"</span>,</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"Bois de Boulogne 1"</span>,</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"Bois de Boulogne 2"</span>,</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"Bois de Boulogne 3"</span>),]</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>paris <span class="ot">&lt;-</span> <span class="fu">st_union</span>(paris)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="co"># 5 km around Paris map layout</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>paris5k <span class="ot">&lt;-</span> <span class="fu">st_buffer</span>(paris, <span class="dv">5000</span>)</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>paris5k <span class="ot">&lt;-</span> <span class="fu">st_as_sfc</span>(<span class="fu">st_bbox</span>(paris5k, <span class="at">crs =</span> <span class="dv">2154</span>))</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>paris <span class="ot">&lt;-</span> paris5k</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="co"># 10 km around Paris (get OSM data) in long/lat</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>paris10k <span class="ot">&lt;-</span> <span class="fu">st_buffer</span>(paris, <span class="dv">10000</span>)</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>paris10k <span class="ot">&lt;-</span> <span class="fu">st_as_sfc</span>(<span class="fu">st_bbox</span>(paris10k, <span class="at">crs =</span> <span class="dv">2154</span>))</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Intersection with IRIS</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>iris10k <span class="ot">&lt;-</span> <span class="fu">st_intersection</span>(iris, paris10k)</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Bounding box for osm extraxt</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>paris10k <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(paris10k, <span class="dv">4326</span>)</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>paris10k <span class="ot">&lt;-</span> <span class="fu">st_bbox</span>(paris10k) </span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>paris10k <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(paris10k)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="feed-iris-with-socio-economic-data-insee" class="level2">
<h2 class="anchored" data-anchor-id="feed-iris-with-socio-economic-data-insee">Feed IRIS with socio-economic data (INSEE)</h2>
<p>Data is enriched by socio-economic data (disposible median income 2019 and total population 2018) for further analysis. We keep only “Habitation” IRIS (dedicated to dwellings) for origins-destinations calculations.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Feed IRIS layer by socio-economic data (INSEE) ----</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Population 2018 (IRIS)</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">read_xlsx</span>(<span class="st">"data-raw/base-ic-evol-struct-pop-2018.xlsx"</span>, <span class="at">skip =</span> <span class="dv">5</span>, <span class="at">sheet =</span> <span class="st">"IRIS"</span>)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>iris10k <span class="ot">&lt;-</span> <span class="fu">merge</span>(iris10k[,<span class="fu">c</span>(<span class="st">"CODE_IRIS"</span>, <span class="st">"NOM_IRIS"</span>, <span class="st">"TYP_IRIS"</span>, <span class="st">"NOM_COM"</span>)], </span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>                 df[,<span class="fu">c</span>(<span class="st">"IRIS"</span>,<span class="st">"P18_POP"</span>)],</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>                 <span class="at">by.x =</span> <span class="st">"CODE_IRIS"</span>, <span class="at">by.y =</span> <span class="st">"IRIS"</span>, <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Median Income (2018)</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">read_xlsx</span>(<span class="st">"data-raw/BASE_TD_FILO_DISP_IRIS_2019.xlsx"</span>, <span class="at">skip =</span> <span class="dv">5</span>, <span class="at">sheet =</span> <span class="st">"IRIS_DISP"</span>)</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>iris10k <span class="ot">&lt;-</span> <span class="fu">merge</span>(iris10k, df[,<span class="fu">c</span>(<span class="st">"IRIS"</span>,<span class="st">"DISP_MED19"</span>)],</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>                 <span class="at">by.x =</span> <span class="st">"CODE_IRIS"</span>, <span class="at">by.y =</span> <span class="st">"IRIS"</span>, <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Intersection with study area</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>iris <span class="ot">&lt;-</span> <span class="fu">st_intersection</span>(iris10k, paris5k)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="prepare-iris-for-travel-time-calculation" class="level2">
<h2 class="anchored" data-anchor-id="prepare-iris-for-travel-time-calculation">Prepare IRIS for travel-time calculation</h2>
<p>IRIS centroids are extracted. These points will be used for the origins of travel-time calculations. Only IRIS including dwellings are kept (TYP_IRIS == “H”).</p>
<p>These <code>sf</code> objects are transformed in latitude/longitude (origin-destination calculations requirements and for final export in geojson format).</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Keep only habitation IRIS for origins calculation</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>ori <span class="ot">&lt;-</span> iris10k[iris10k<span class="sc">$</span>TYP_IRIS <span class="sc">==</span> <span class="st">"H"</span>,]</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>ori <span class="ot">&lt;-</span> <span class="fu">st_centroid</span>(ori)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Transofrm in long/lat</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>ori <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(ori, <span class="at">crs =</span> <span class="dv">4326</span>)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>iris <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(iris, <span class="at">crs =</span> <span class="dv">4326</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="import-osm-points-of-interest" class="level2">
<h2 class="anchored" data-anchor-id="import-osm-points-of-interest">Import OSM points of interest</h2>
<p>Indoor sport climbing points of interest are downloaded from OpenStreetMap thanks to the <code>osmdata</code> R package (<span class="citation" data-cites="osmdata">Mark Padgham (<a href="#ref-osmdata" role="doc-biblioref">2022</a>)</span>).</p>
<p>To access to these OSM features, the OSM key-value pair (or OSM tag) must be set. For climbing areas, the most appropriate is <code>sport=climbing</code>. In the <a href="https://wiki.openstreetmap.org/wiki/Tag:sport%3Dclimbing" title="Tag:sport=climbing in OSM wiki">OpenStreetMap wiki</a>, it is mentioned that “<em>sport=climbing should be preferably applied to noded for artificial climbing walls”.</em> Thus, we only consider points responding to the query.</p>
<p>The geographical coverage of the query covers a bounding box of 10 km around Paris (<code>paris10k</code>`).</p>
<p>The OSM attributes are transformed afterwards for further analytical purposes in order to differentiate private and associative structures, and bouldering areas and climbing walls (to different climbing practices).</p>
<p>I argue that the accuracy and completeness of the data is quite good : I have edited missing points on OpenStreetMap with my personal knowledge and upstream investigation :-)</p>
<p>For the presentation of the artificial climbing landscape in Paris and the difference between private - FSGT and FFME structures, have a look to <a href="https://observablehq.com/@rysebaert/forewords">this notebook</a>.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Extract OSM objects (climbing and map layout)----</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(osmdata)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co"># define a bounding box</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>q0 <span class="ot">&lt;-</span> <span class="fu">opq</span>(<span class="at">bbox =</span> paris10k) </span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="co"># extract climbing areas</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>q <span class="ot">&lt;-</span> <span class="fu">add_osm_feature</span>(<span class="at">opq =</span> q0, <span class="at">key =</span> <span class="st">'sport'</span>, <span class="at">value =</span> <span class="st">"climbing"</span>)</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">osmdata_sf</span>(q)</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>dest <span class="ot">&lt;-</span> res<span class="sc">$</span>osm_points</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>dest[,<span class="st">"name"</span>] <span class="ot">&lt;-</span> <span class="fu">iconv</span>(dest<span class="sc">$</span>name, <span class="at">from =</span> <span class="st">"UTF-8"</span>, <span class="at">to =</span> <span class="st">"UTF-8"</span>)</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Cleaning</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>private <span class="ot">&lt;-</span> dest[<span class="sc">!</span><span class="fu">is.na</span>(dest<span class="sc">$</span>brand),] <span class="co"># Manage private and associative areas</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>asso <span class="ot">&lt;-</span> dest[<span class="sc">!</span><span class="fu">is.na</span>(dest<span class="sc">$</span>federation),]</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>asso<span class="sc">$</span>type <span class="ot">&lt;-</span> <span class="st">"Associative structure"</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>private<span class="sc">$</span>type <span class="ot">&lt;-</span> <span class="st">"Speculative structure"</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>dest <span class="ot">&lt;-</span> <span class="fu">rbind</span>(asso, private)</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>dest<span class="sc">$</span>federation[<span class="fu">is.na</span>(dest<span class="sc">$</span>federation)] <span class="ot">&lt;-</span> <span class="st">"Private"</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Find walls and boulders</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>dest[<span class="fu">c</span>(<span class="st">"climbing.toprope"</span>, <span class="st">"climbing.boulder"</span>)][<span class="fu">is.na</span>(dest[<span class="fu">c</span>(<span class="st">"climbing.toprope"</span>, <span class="st">"climbing.boulder"</span>)])] <span class="ot">&lt;-</span> <span class="st">"no"</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>dest<span class="sc">$</span>climbing_type <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(dest<span class="sc">$</span>climbing.toprope <span class="sc">==</span> <span class="st">'yes'</span> <span class="sc">&amp;</span> </span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>                               dest<span class="sc">$</span>climbing.boulder <span class="sc">==</span> <span class="st">"yes"</span>, <span class="st">'Wall and bouldering'</span>,</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">ifelse</span>(dest<span class="sc">$</span>climbing.toprope <span class="sc">==</span> <span class="st">'yes'</span> <span class="sc">&amp;</span> </span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>                                      dest<span class="sc">$</span>climbing.boulder <span class="sc">==</span> <span class="st">"no"</span> , <span class="st">'Wall'</span>,</span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">ifelse</span>(dest<span class="sc">$</span>climbing.toprope <span class="sc">==</span> <span class="st">'no'</span> <span class="sc">&amp;</span> </span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>                                             dest<span class="sc">$</span>climbing.boulder <span class="sc">==</span> <span class="st">"yes"</span> ,</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>                                           <span class="st">'Bouldering'</span>, <span class="cn">NA</span>)))</span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Keep only attributes of interest and rename it</span></span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>cols <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"osm_id"</span>, <span class="st">"name"</span>, <span class="st">"climbing_type"</span>, <span class="st">"climbing.length"</span>,</span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>          <span class="st">"climbing.routes"</span>, <span class="st">"type"</span>, <span class="st">"federation"</span>, <span class="st">"brand"</span>)</span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>dest <span class="ot">&lt;-</span> dest[,cols]</span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(dest)[<span class="dv">4</span><span class="sc">:</span><span class="dv">5</span>] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"climbing_length"</span>, <span class="st">"climbing_routes"</span>)</span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Intersection with bouding box </span></span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>poi <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(dest, <span class="dv">2154</span>)</span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>poi <span class="ot">&lt;-</span> <span class="fu">st_intersection</span>(poi, paris5k)</span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>poi <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(poi, <span class="dv">4326</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The data preparation allows to prepare origins-destinations layers for travel-time calculation. Origins correspond to the IRIS layer (only type H : 2141 points). Destinations to artificial climbing areas (45 points).</p>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>Linking to GEOS 3.9.1, GDAL 3.3.2, PROJ 7.2.1; sf_use_s2() is TRUE</code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mapsf)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract centroids from IRIS dedicated to dwellings</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>ori <span class="ot">&lt;-</span> <span class="fu">st_centroid</span>(iris)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>ori <span class="ot">&lt;-</span> ori[ori<span class="sc">$</span>TYP_IRIS <span class="sc">==</span> <span class="st">"H"</span>,]</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Map creation</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>))</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Set a map theme (library mapsf)</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>my_theme <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">bg =</span> <span class="cn">NA</span>, <span class="at">fg =</span> <span class="cn">NA</span>, <span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>), <span class="at">tab =</span> <span class="cn">TRUE</span>, <span class="at">pos =</span> <span class="st">"left"</span>, </span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>                  <span class="at">inner =</span> <span class="cn">TRUE</span>, <span class="at">line =</span> <span class="fl">1.3</span>, <span class="at">cex =</span> <span class="dv">1</span>, <span class="at">font =</span> <span class="dv">2</span>)</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the map</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_init</span>(com, <span class="at">expandBB =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.4</span>,<span class="dv">0</span>,<span class="dv">0</span>), <span class="at">theme =</span> my_theme)</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_typo</span>(</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> iris, <span class="at">var =</span> <span class="st">"TYP_IRIS"</span>, </span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">pal =</span> <span class="fu">c</span>(<span class="st">"peachpuff"</span>, <span class="st">"#feb8ff"</span>, <span class="st">"#f0e6f0"</span>, <span class="st">"#f1f7ab"</span>), <span class="at">lwd =</span> <span class="fl">0.25</span>,</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">val_order =</span> <span class="fu">c</span>(<span class="st">"H"</span>, <span class="st">"A"</span>, <span class="st">"D"</span>, <span class="st">"Z"</span>), <span class="at">border =</span> <span class="st">"white"</span>, <span class="at">leg_pos =</span> <span class="fu">c</span>(<span class="dv">631000</span>, <span class="dv">6872000</span>),</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">leg_title =</span> <span class="st">"IRIS types (H = dwellings)"</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_map</span>(ori, <span class="at">pch =</span> <span class="dv">20</span>, <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">cex =</span> .<span class="dv">2</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_legend</span>(</span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">"symb"</span>, <span class="at">pos =</span>  <span class="fu">c</span>(<span class="dv">631000</span>, <span class="dv">6864000</span>), <span class="at">val =</span> <span class="fu">c</span>(<span class="st">"H"</span>, <span class="st">"H"</span>),</span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">pt_pch =</span> <span class="fu">c</span>(<span class="dv">20</span>,<span class="dv">20</span>), <span class="at">pt_cex =</span>.<span class="dv">2</span>, <span class="at">title =</span> <span class="st">"Origins : IRIS centroids type H"</span>,</span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">pal =</span> <span class="fu">c</span>(<span class="st">"red"</span>, <span class="st">"red"</span>))</span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_typo</span>(<span class="at">x =</span> poi, <span class="at">var =</span> <span class="st">"federation"</span>, <span class="at">pch =</span> <span class="dv">21</span>, <span class="at">cex =</span> .<span class="dv">7</span>,</span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>        <span class="at">val_order =</span> <span class="fu">c</span>(<span class="st">"Private"</span>, <span class="st">"FSGT"</span>, <span class="st">"FFME"</span>),</span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>        <span class="at">pal =</span> <span class="fu">c</span>(<span class="st">"#377eb8"</span>, <span class="st">"#e41a1c"</span>, <span class="st">"#ff7f00"</span>),</span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>        <span class="at">leg_title =</span> <span class="st">"Destinations:</span><span class="sc">\n</span><span class="st">Artificial climbing areas"</span>,</span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>        <span class="at">leg_pos =</span> <span class="fu">c</span>(<span class="dv">631000</span>, <span class="dv">6860000</span>),</span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>        <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_map</span>(com, <span class="at">col =</span> <span class="cn">NA</span>, <span class="at">border =</span> <span class="st">"black"</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_title</span>(<span class="st">"Layers presentation for origins-destinations calculation"</span>)</span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_scale</span>(<span class="at">size =</span> <span class="dv">5</span>, <span class="at">col =</span> <span class="st">"black"</span>, <span class="at">pos =</span> <span class="st">"bottomright"</span>)</span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_credits</span>(<span class="fu">paste0</span>(<span class="st">"Sources : © OpenStreetMap and Contributors, IGN, INSEE, 2022</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Realisation : Ronan Ysebaert, 2022"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" style="width:100.0%"></p>
</div>
</div>
</section>
<section id="travel-time-calculations-with-osrm" class="level2">
<h2 class="anchored" data-anchor-id="travel-time-calculations-with-osrm">Travel-time calculations with OSRM</h2>
<p>We have now required origins and destinations required to compute travel-time calculations. The computation is realized using the <code>osrm</code> R package (<span class="citation" data-cites="osrm">Giraud (<a href="#ref-osrm" role="doc-biblioref">2022</a>)</span>). This package allows to compute routes, trips, isochrones and travel distances matrices (travel time and kilometric distance).</p>
<p>Considering that the input data are quite important (more than 2000 origin points and 48 destination points) and to avoid to overload the OSRM demo server, I have run my own instance of OSRM based on docker container. The procedure to implement this solution is explained in the <a href="https://github.com/Project-OSRM/osrm-backend#using-docker" title="Run OSRM with docker">following documentation</a>, or more specifically for Windows <a href="https://gist.github.com/AlexandraKapp/e0eee2beacc93e765113aff43ec77789" title="How to set up your own OSRM backend with Docker on Windows">here</a>.</p>
<p>Once it is done, the connection to the rounting engine is operational locally (with the URL <code>http://localhost:5000/</code>` for me).</p>
<p>With OSRM, it is possible to choose several profiles depending on the routing we want to use (car, bike, walking). In our case, we choose the bike profile: Cycling is a widespread practice (with public transport) for climbers to reach their activities. Moreover, it allows also to avoid to use the car profile, which underestimates the travel-time in metropolitan areas (trafic congestion not taken into account).</p>
<p>The bicycle profile is described in the <a href="https://github.com/Project-OSRM/osrm-backend/blob/master/profiles/bicycle.lua" title="OSRM bicycle profile">github OSRM repository</a>. Basically, the default speed is 15 km/h. It avoids the access to highways, reduce the driving speed by 30 % for unsafe roads. It is important to keep in mind that landforms (elevation) are not considered in the default profile. Some thoughts and solutions exist on the subject, using elevation rasters (<a href="https://www.liedman.net/2015/04/13/add-elevation-data-to-osrm/" title="Adding elevation data to OSRM">Liedman, 2022</a> ; <a href="https://blog.mapbox.com/elevation-aware-routing-profiles-in-mapbox-directions-21e182a85165" title="Elevation-aware routing profiles in Mapbox Directions">Mapbox, 2015</a>).</p>
<section id="iris-to-climbing-areas" class="level3">
<h3 class="anchored" data-anchor-id="iris-to-climbing-areas">IRIS to climbing areas</h3>
<p>The code below compute travel-time calculation between the geometric center of IRIS (<code>ori</code>) and artificial climbing areas (<code>dest</code>). It is done for all climbing structures and reproduced according to the type of climbing structure : private or associative structures. For associative structures, we distinguish the FSGT and FFME federations, who do not exactly the same goals in term of practice.</p>
<p>Resulting travel-time matrixes are exported in the <a href="https://github.com/rysebaert/climbing_paris/tree/main/data-conso">data-conso</a> folder for other possible uses (and to avoid runing these calculations systematically).</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. Origin - Destination calculation with OSRM ----</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(osrm)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Manage ids</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="fu">row.names</span>(ori) <span class="ot">&lt;-</span> ori<span class="sc">$</span>CODE_IRIS</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Connexion to osrm local server (the osrm container must running under docker)</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">osrm.server =</span> <span class="st">"http://localhost:5000/"</span>, <span class="at">osrm.profile =</span> <span class="st">"bike"</span>)</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Origin-destination calculation</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="co"># All structures</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">osrmTable</span>(<span class="at">src =</span> ori, <span class="at">dst =</span> dest, <span class="at">measure =</span> <span class="st">"duration"</span>)</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(df<span class="sc">$</span>duration)</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(df) <span class="ot">&lt;-</span> <span class="fu">as.character</span>(dest<span class="sc">$</span>osm_id)</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a><span class="fu">row.names</span>(df) <span class="ot">&lt;-</span> <span class="fu">as.character</span>(ori<span class="sc">$</span>CODE_IRIS)</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(df, <span class="st">"data-conso/bike-duration.csv"</span>)</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Private structures</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>dest_priv <span class="ot">&lt;-</span> dest[dest<span class="sc">$</span>type <span class="sc">==</span> <span class="st">"Speculative structure"</span>,] </span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>df2 <span class="ot">&lt;-</span> <span class="fu">osrmTable</span>(<span class="at">src =</span> ori, <span class="at">dst =</span> dest_priv, <span class="at">measure =</span> <span class="st">"duration"</span>)</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>df2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(df2<span class="sc">$</span>duration)</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(df2) <span class="ot">&lt;-</span> <span class="fu">as.character</span>(dest_priv<span class="sc">$</span>osm_id)</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a><span class="fu">row.names</span>(df2) <span class="ot">&lt;-</span> <span class="fu">as.character</span>(ori<span class="sc">$</span>CODE_IRIS)</span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(df2, <span class="st">"data-conso/bike-duration-priv.csv"</span>)</span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a><span class="co"># FFME</span></span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>dest_asso <span class="ot">&lt;-</span>dest[dest<span class="sc">$</span>type <span class="sc">==</span> <span class="st">"Associative structure"</span>,] </span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>dest_ffme <span class="ot">&lt;-</span> dest_asso[dest_asso<span class="sc">$</span>federation <span class="sc">==</span> <span class="st">"FFME"</span>,]</span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>df3 <span class="ot">&lt;-</span> <span class="fu">osrmTable</span>(<span class="at">src =</span> ori, <span class="at">dst =</span> dest_ffme, <span class="at">measure =</span> <span class="st">"duration"</span>)</span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>df3 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(df3<span class="sc">$</span>duration)</span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(df3) <span class="ot">&lt;-</span> <span class="fu">as.character</span>(dest_ffme<span class="sc">$</span>osm_id)</span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a><span class="fu">row.names</span>(df3) <span class="ot">&lt;-</span> <span class="fu">as.character</span>(ori<span class="sc">$</span>CODE_IRIS)</span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(df3, <span class="st">"data-conso/bike-duration-ffme.csv"</span>)</span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a><span class="co"># FSGT</span></span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a>dest_fsgt <span class="ot">&lt;-</span> dest_asso[dest_asso<span class="sc">$</span>federation <span class="sc">==</span> <span class="st">"FSGT"</span>,]</span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a>df4 <span class="ot">&lt;-</span> <span class="fu">osrmTable</span>(<span class="at">src =</span> ori, <span class="at">dst =</span> dest_fsgt, <span class="at">measure =</span> <span class="st">"duration"</span>)</span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a>df4 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(df4<span class="sc">$</span>duration)</span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(df4) <span class="ot">&lt;-</span> <span class="fu">as.character</span>(dest_fsgt<span class="sc">$</span>osm_id)</span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a><span class="fu">row.names</span>(df4) <span class="ot">&lt;-</span> <span class="fu">as.character</span>(ori<span class="sc">$</span>CODE_IRIS)</span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(df4, <span class="st">"data-conso/bike-duration-fsgt.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>This heavy matrix is then manipulated to extract for each IRIS the following information at IRIS level :</p>
<ul>
<li><p>Name of the nearest climbing structure by bike</p></li>
<li><p>Type of structure (associative or speculative)</p></li>
<li><p>Time to reach it (in minutes)</p></li>
<li><p>Number of artificial climbing areas at less than 15 minutes by bike (N)</p></li>
</ul>
<p>This calculation is done for all climbing structures (ALL), private ones (PRIV), the FFME federation (FFME) and the FSGT one (FSGT). It is done with R base code. A function would reduce considerably the code length… Never mind, it is not the aim of this proof ;)</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 5. Accessibility indicator creation (IRIS) ----</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Name of the nearest structure</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data-conso/bike-duration.csv"</span>, <span class="at">row.names =</span> <span class="st">"X"</span>)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(df) <span class="ot">&lt;-</span> <span class="fu">as.character</span>(dest<span class="sc">$</span>osm_id)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>osm_id <span class="ot">&lt;-</span> <span class="fu">colnames</span>(df)[<span class="fu">apply</span>(df, <span class="dv">1</span>, which.min)] <span class="co"># Name</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>osm_id <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(osm_id, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>osm_id<span class="sc">$</span>iris <span class="ot">&lt;-</span> <span class="fu">row.names</span>(df)</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>osm_id <span class="ot">&lt;-</span> <span class="fu">merge</span>(osm_id, poi[,<span class="fu">c</span>(<span class="st">"osm_id"</span>, <span class="st">"name"</span>, <span class="st">"federation"</span>)], </span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>                <span class="at">by =</span> <span class="st">"osm_id"</span>, <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Time to the nearest climbing area</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>time <span class="ot">&lt;-</span> <span class="fu">apply</span>(df, <span class="dv">1</span>, min) <span class="co"># Time</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>time <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(time, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>time<span class="sc">$</span>iris <span class="ot">&lt;-</span> <span class="fu">row.names</span>(time)</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>osm_id <span class="ot">&lt;-</span> <span class="fu">merge</span>(osm_id, time, <span class="at">by =</span> <span class="st">"iris"</span>, <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>osm_id<span class="sc">$</span>geometry <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Number of climbing area at less than 15 minutes by bike</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>n15mn <span class="ot">&lt;-</span> df</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>n15mn <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(df, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>n15mn[n15mn <span class="sc">&lt;=</span> <span class="dv">15</span>] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>n15mn[n15mn <span class="sc">&gt;</span> <span class="dv">15</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>n15mn<span class="sc">$</span>N <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(n15mn)</span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>n15mn<span class="sc">$</span>iris <span class="ot">&lt;-</span> <span class="fu">row.names</span>(n15mn)</span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>osm_id <span class="ot">&lt;-</span> <span class="fu">merge</span>(osm_id, n15mn[,<span class="fu">c</span>(<span class="st">"iris"</span>, <span class="st">"N"</span>)], <span class="at">by =</span> <span class="st">"iris"</span>,</span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>                <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>osm_id <span class="ot">&lt;-</span> osm_id[,<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span><span class="sc">:</span><span class="dv">6</span>)]</span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(osm_id) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"CODE_IRIS"</span>, <span class="st">"ALL_NAME"</span>, <span class="st">"TYPE_STRUCT"</span>, <span class="st">"ALL_TIME"</span>,</span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"N_15MN"</span>)</span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>iris <span class="ot">&lt;-</span> <span class="fu">merge</span>(iris, osm_id, <span class="at">by =</span> <span class="st">"CODE_IRIS"</span>, <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Prive climbing club (fees $$$)</span></span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Name of the nearest structure</span></span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a>df2 <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data-conso/bike-duration-priv.csv"</span>, <span class="at">row.names =</span> <span class="st">"X"</span>)</span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(df2) <span class="ot">&lt;-</span> <span class="fu">as.character</span>(dest_priv<span class="sc">$</span>osm_id)</span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a>osm_id <span class="ot">&lt;-</span> <span class="fu">colnames</span>(df2)[<span class="fu">apply</span>(df2, <span class="dv">1</span>, which.min)] <span class="co"># Name</span></span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a>osm_id <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(osm_id, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a>osm_id<span class="sc">$</span>iris <span class="ot">&lt;-</span> <span class="fu">row.names</span>(df2)</span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a>osm_id <span class="ot">&lt;-</span> <span class="fu">merge</span>(osm_id, poi[,<span class="fu">c</span>(<span class="st">"osm_id"</span>, <span class="st">"name"</span>, <span class="st">"type"</span>)], </span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a>                <span class="at">by =</span> <span class="st">"osm_id"</span>, <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a><span class="co"># Time to the nearest climbing area</span></span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a>time <span class="ot">&lt;-</span> <span class="fu">apply</span>(df2, <span class="dv">1</span>, min) <span class="co"># Time</span></span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a>time <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(time, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a>time<span class="sc">$</span>iris <span class="ot">&lt;-</span> <span class="fu">row.names</span>(time)</span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a>osm_id <span class="ot">&lt;-</span> <span class="fu">merge</span>(osm_id, time, <span class="at">by =</span> <span class="st">"iris"</span>, <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span>
<span id="cb8-47"><a href="#cb8-47" aria-hidden="true" tabindex="-1"></a>osm_id<span class="sc">$</span>geometry <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb8-48"><a href="#cb8-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-49"><a href="#cb8-49" aria-hidden="true" tabindex="-1"></a><span class="co"># Number of climbing area at less than 15 minutes by bike</span></span>
<span id="cb8-50"><a href="#cb8-50" aria-hidden="true" tabindex="-1"></a>n15mn <span class="ot">&lt;-</span> df2</span>
<span id="cb8-51"><a href="#cb8-51" aria-hidden="true" tabindex="-1"></a>n15mn <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(df2, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb8-52"><a href="#cb8-52" aria-hidden="true" tabindex="-1"></a>n15mn[n15mn <span class="sc">&lt;=</span> <span class="dv">15</span>] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb8-53"><a href="#cb8-53" aria-hidden="true" tabindex="-1"></a>n15mn[n15mn <span class="sc">&gt;</span> <span class="dv">15</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb8-54"><a href="#cb8-54" aria-hidden="true" tabindex="-1"></a>n15mn<span class="sc">$</span>N <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(n15mn)</span>
<span id="cb8-55"><a href="#cb8-55" aria-hidden="true" tabindex="-1"></a>n15mn<span class="sc">$</span>iris <span class="ot">&lt;-</span> <span class="fu">row.names</span>(n15mn)</span>
<span id="cb8-56"><a href="#cb8-56" aria-hidden="true" tabindex="-1"></a>osm_id <span class="ot">&lt;-</span> <span class="fu">merge</span>(osm_id, n15mn[,<span class="fu">c</span>(<span class="st">"iris"</span>, <span class="st">"N"</span>)], <span class="at">by =</span> <span class="st">"iris"</span>,</span>
<span id="cb8-57"><a href="#cb8-57" aria-hidden="true" tabindex="-1"></a>                <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span>
<span id="cb8-58"><a href="#cb8-58" aria-hidden="true" tabindex="-1"></a>osm_id <span class="ot">&lt;-</span> osm_id[,<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">5</span><span class="sc">:</span><span class="dv">6</span>)]</span>
<span id="cb8-59"><a href="#cb8-59" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(osm_id) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"CODE_IRIS"</span>, <span class="st">"PRIV_NAME"</span>, <span class="st">"PRIV_TIME"</span>,</span>
<span id="cb8-60"><a href="#cb8-60" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"N_PRIV_15MN"</span>)</span>
<span id="cb8-61"><a href="#cb8-61" aria-hidden="true" tabindex="-1"></a>iris <span class="ot">&lt;-</span> <span class="fu">merge</span>(iris, osm_id, <span class="at">by =</span> <span class="st">"CODE_IRIS"</span>, <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span>
<span id="cb8-62"><a href="#cb8-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-63"><a href="#cb8-63" aria-hidden="true" tabindex="-1"></a><span class="co"># FFME associative structure</span></span>
<span id="cb8-64"><a href="#cb8-64" aria-hidden="true" tabindex="-1"></a><span class="co"># Name of the nearest structure</span></span>
<span id="cb8-65"><a href="#cb8-65" aria-hidden="true" tabindex="-1"></a>df3 <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data-conso/bike-duration-ffme.csv"</span>, <span class="at">row.names =</span> <span class="st">"X"</span>)</span>
<span id="cb8-66"><a href="#cb8-66" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(df3) <span class="ot">&lt;-</span> <span class="fu">as.character</span>(dest_ffme<span class="sc">$</span>osm_id)</span>
<span id="cb8-67"><a href="#cb8-67" aria-hidden="true" tabindex="-1"></a>osm_id <span class="ot">&lt;-</span> <span class="fu">colnames</span>(df3)[<span class="fu">apply</span>(df3, <span class="dv">1</span>, which.min)] <span class="co"># Name</span></span>
<span id="cb8-68"><a href="#cb8-68" aria-hidden="true" tabindex="-1"></a>osm_id <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(osm_id, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb8-69"><a href="#cb8-69" aria-hidden="true" tabindex="-1"></a>osm_id<span class="sc">$</span>iris <span class="ot">&lt;-</span> <span class="fu">row.names</span>(df3)</span>
<span id="cb8-70"><a href="#cb8-70" aria-hidden="true" tabindex="-1"></a>osm_id <span class="ot">&lt;-</span> <span class="fu">merge</span>(osm_id, poi[,<span class="fu">c</span>(<span class="st">"osm_id"</span>, <span class="st">"name"</span>, <span class="st">"type"</span>)], </span>
<span id="cb8-71"><a href="#cb8-71" aria-hidden="true" tabindex="-1"></a>                <span class="at">by =</span> <span class="st">"osm_id"</span>, <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span>
<span id="cb8-72"><a href="#cb8-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-73"><a href="#cb8-73" aria-hidden="true" tabindex="-1"></a><span class="co"># Time to the nearest climbing area</span></span>
<span id="cb8-74"><a href="#cb8-74" aria-hidden="true" tabindex="-1"></a>time <span class="ot">&lt;-</span> <span class="fu">apply</span>(df3, <span class="dv">1</span>, min) <span class="co"># Time</span></span>
<span id="cb8-75"><a href="#cb8-75" aria-hidden="true" tabindex="-1"></a>time <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(time, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb8-76"><a href="#cb8-76" aria-hidden="true" tabindex="-1"></a>time<span class="sc">$</span>iris <span class="ot">&lt;-</span> <span class="fu">row.names</span>(time)</span>
<span id="cb8-77"><a href="#cb8-77" aria-hidden="true" tabindex="-1"></a>osm_id <span class="ot">&lt;-</span> <span class="fu">merge</span>(osm_id, time, <span class="at">by =</span> <span class="st">"iris"</span>, <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span>
<span id="cb8-78"><a href="#cb8-78" aria-hidden="true" tabindex="-1"></a>osm_id<span class="sc">$</span>geometry <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb8-79"><a href="#cb8-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-80"><a href="#cb8-80" aria-hidden="true" tabindex="-1"></a><span class="co"># Number of climbing area at less than 15 minutes by bike</span></span>
<span id="cb8-81"><a href="#cb8-81" aria-hidden="true" tabindex="-1"></a>n15mn <span class="ot">&lt;-</span> df3</span>
<span id="cb8-82"><a href="#cb8-82" aria-hidden="true" tabindex="-1"></a>n15mn <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(df3, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb8-83"><a href="#cb8-83" aria-hidden="true" tabindex="-1"></a>n15mn[n15mn <span class="sc">&lt;=</span> <span class="dv">15</span>] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb8-84"><a href="#cb8-84" aria-hidden="true" tabindex="-1"></a>n15mn[n15mn <span class="sc">&gt;</span> <span class="dv">15</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb8-85"><a href="#cb8-85" aria-hidden="true" tabindex="-1"></a>n15mn<span class="sc">$</span>N <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(n15mn)</span>
<span id="cb8-86"><a href="#cb8-86" aria-hidden="true" tabindex="-1"></a>n15mn<span class="sc">$</span>iris <span class="ot">&lt;-</span> <span class="fu">row.names</span>(n15mn)</span>
<span id="cb8-87"><a href="#cb8-87" aria-hidden="true" tabindex="-1"></a>osm_id <span class="ot">&lt;-</span> <span class="fu">merge</span>(osm_id, n15mn[,<span class="fu">c</span>(<span class="st">"iris"</span>, <span class="st">"N"</span>)], <span class="at">by =</span> <span class="st">"iris"</span>,</span>
<span id="cb8-88"><a href="#cb8-88" aria-hidden="true" tabindex="-1"></a>                <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span>
<span id="cb8-89"><a href="#cb8-89" aria-hidden="true" tabindex="-1"></a>osm_id <span class="ot">&lt;-</span> osm_id[,<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">5</span><span class="sc">:</span><span class="dv">6</span>)]</span>
<span id="cb8-90"><a href="#cb8-90" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(osm_id) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"CODE_IRIS"</span>, <span class="st">"FFME_NAME"</span>, <span class="st">"FFME_TIME"</span>,</span>
<span id="cb8-91"><a href="#cb8-91" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"N_FFME_15MN"</span>)</span>
<span id="cb8-92"><a href="#cb8-92" aria-hidden="true" tabindex="-1"></a>iris <span class="ot">&lt;-</span> <span class="fu">merge</span>(iris, osm_id, <span class="at">by =</span> <span class="st">"CODE_IRIS"</span>, <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span>
<span id="cb8-93"><a href="#cb8-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-94"><a href="#cb8-94" aria-hidden="true" tabindex="-1"></a><span class="co"># FSGT associative structure</span></span>
<span id="cb8-95"><a href="#cb8-95" aria-hidden="true" tabindex="-1"></a><span class="co"># Name of the nearest structure</span></span>
<span id="cb8-96"><a href="#cb8-96" aria-hidden="true" tabindex="-1"></a>df4 <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data-conso/bike-duration-fsgt.csv"</span>, <span class="at">row.names =</span> <span class="st">"X"</span>)</span>
<span id="cb8-97"><a href="#cb8-97" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(df4) <span class="ot">&lt;-</span> <span class="fu">as.character</span>(dest_fsgt<span class="sc">$</span>osm_id)</span>
<span id="cb8-98"><a href="#cb8-98" aria-hidden="true" tabindex="-1"></a>osm_id <span class="ot">&lt;-</span> <span class="fu">colnames</span>(df4)[<span class="fu">apply</span>(df4, <span class="dv">1</span>, which.min)] <span class="co"># Name</span></span>
<span id="cb8-99"><a href="#cb8-99" aria-hidden="true" tabindex="-1"></a>osm_id <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(osm_id, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb8-100"><a href="#cb8-100" aria-hidden="true" tabindex="-1"></a>osm_id<span class="sc">$</span>iris <span class="ot">&lt;-</span> <span class="fu">row.names</span>(df4)</span>
<span id="cb8-101"><a href="#cb8-101" aria-hidden="true" tabindex="-1"></a>osm_id <span class="ot">&lt;-</span> <span class="fu">merge</span>(osm_id, poi[,<span class="fu">c</span>(<span class="st">"osm_id"</span>, <span class="st">"name"</span>, <span class="st">"type"</span>)], </span>
<span id="cb8-102"><a href="#cb8-102" aria-hidden="true" tabindex="-1"></a>                <span class="at">by =</span> <span class="st">"osm_id"</span>, <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span>
<span id="cb8-103"><a href="#cb8-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-104"><a href="#cb8-104" aria-hidden="true" tabindex="-1"></a><span class="co"># Time to the nearest climbing area</span></span>
<span id="cb8-105"><a href="#cb8-105" aria-hidden="true" tabindex="-1"></a>time <span class="ot">&lt;-</span> <span class="fu">apply</span>(df4, <span class="dv">1</span>, min) <span class="co"># Time</span></span>
<span id="cb8-106"><a href="#cb8-106" aria-hidden="true" tabindex="-1"></a>time <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(time, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb8-107"><a href="#cb8-107" aria-hidden="true" tabindex="-1"></a>time<span class="sc">$</span>iris <span class="ot">&lt;-</span> <span class="fu">row.names</span>(time)</span>
<span id="cb8-108"><a href="#cb8-108" aria-hidden="true" tabindex="-1"></a>osm_id <span class="ot">&lt;-</span> <span class="fu">merge</span>(osm_id, time, <span class="at">by =</span> <span class="st">"iris"</span>, <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span>
<span id="cb8-109"><a href="#cb8-109" aria-hidden="true" tabindex="-1"></a>osm_id<span class="sc">$</span>geometry <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb8-110"><a href="#cb8-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-111"><a href="#cb8-111" aria-hidden="true" tabindex="-1"></a><span class="co"># Number of climbing area at less than 15 minutes by bike</span></span>
<span id="cb8-112"><a href="#cb8-112" aria-hidden="true" tabindex="-1"></a>n15mn <span class="ot">&lt;-</span> df4</span>
<span id="cb8-113"><a href="#cb8-113" aria-hidden="true" tabindex="-1"></a>n15mn <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(df4, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb8-114"><a href="#cb8-114" aria-hidden="true" tabindex="-1"></a>n15mn[n15mn <span class="sc">&lt;=</span> <span class="dv">15</span>] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb8-115"><a href="#cb8-115" aria-hidden="true" tabindex="-1"></a>n15mn[n15mn <span class="sc">&gt;</span> <span class="dv">15</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb8-116"><a href="#cb8-116" aria-hidden="true" tabindex="-1"></a>n15mn<span class="sc">$</span>N <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(n15mn)</span>
<span id="cb8-117"><a href="#cb8-117" aria-hidden="true" tabindex="-1"></a>n15mn<span class="sc">$</span>iris <span class="ot">&lt;-</span> <span class="fu">row.names</span>(n15mn)</span>
<span id="cb8-118"><a href="#cb8-118" aria-hidden="true" tabindex="-1"></a>osm_id <span class="ot">&lt;-</span> <span class="fu">merge</span>(osm_id, n15mn[,<span class="fu">c</span>(<span class="st">"iris"</span>, <span class="st">"N"</span>)], <span class="at">by =</span> <span class="st">"iris"</span>,</span>
<span id="cb8-119"><a href="#cb8-119" aria-hidden="true" tabindex="-1"></a>                <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span>
<span id="cb8-120"><a href="#cb8-120" aria-hidden="true" tabindex="-1"></a>osm_id <span class="ot">&lt;-</span> osm_id[,<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">5</span><span class="sc">:</span><span class="dv">6</span>)]</span>
<span id="cb8-121"><a href="#cb8-121" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(osm_id) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"CODE_IRIS"</span>, <span class="st">"FSGT_NAME"</span>, <span class="st">"FSGT_TIME"</span>,</span>
<span id="cb8-122"><a href="#cb8-122" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"N_FSGT_15MN"</span>)</span>
<span id="cb8-123"><a href="#cb8-123" aria-hidden="true" tabindex="-1"></a>iris <span class="ot">&lt;-</span> <span class="fu">merge</span>(iris, osm_id, <span class="at">by =</span> <span class="st">"CODE_IRIS"</span>, <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="characterizing-the-poi-neighbourhood" class="level3">
<h3 class="anchored" data-anchor-id="characterizing-the-poi-neighbourhood">Characterizing the POI neighbourhood</h3>
<p>Then, for each climbing areas, we are interested in defining the socio-economic characteristics of their neighbourhood.</p>
<p>The previous matrix is transposed (lines &lt;&gt; columns). For each climbing structure, we extract the IRIS located at less than 15 minutes by bike and to produce the following indicators :</p>
<ul>
<li><p>Total population at less than 15 minutes by bike. This can be considered as an amount of “social demand”.</p></li>
<li><p>Minimum, mean and maximum of median income of IRIS at less than 15 minutes by bike.</p></li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 6. Characterise the POI neighbourhood ----</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>t.df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">t</span>(df))</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(t.df) <span class="ot">&lt;-</span> iris10k[iris10k<span class="sc">$</span>TYP_IRIS <span class="sc">==</span> <span class="st">"H"</span>,]<span class="sc">$</span>CODE_IRIS</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>t.df<span class="sc">$</span>osm_id <span class="ot">&lt;-</span> dest<span class="sc">$</span>osm_id</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>t.df <span class="ot">&lt;-</span> t.df[t.df<span class="sc">$</span>osm_id <span class="sc">%in%</span> poi<span class="sc">$</span>osm_id,]</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>poi_socio <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">matrix</span>(<span class="at">nrow =</span> <span class="dv">0</span>, <span class="at">ncol =</span> <span class="dv">5</span>))</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(poi_socio) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"osm_id"</span>, <span class="st">"SUM_POP18"</span>, <span class="st">"MIN_REV19"</span>, <span class="st">"MOY_REV19"</span>, <span class="st">"MAX_REV19"</span>)</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(t.df)){</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>  tmp1 <span class="ot">&lt;-</span> t.df[, t.df[i, ] <span class="sc">&lt;</span> <span class="dv">15</span>]</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>  tmp2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">CODE_IRIS =</span> <span class="fu">colnames</span>(tmp1))</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>  tmp2 <span class="ot">&lt;-</span> <span class="fu">merge</span>(tmp2, iris10k[,<span class="fu">c</span>(<span class="st">"CODE_IRIS"</span>, <span class="st">"P18_POP"</span>, <span class="st">"DISP_MED19"</span>)],</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>             <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>  poi_socio[i,<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">row.names</span>(tmp1)[i]</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>  poi_socio[i,<span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="fu">sum</span>(tmp2<span class="sc">$</span>P18_POP, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>  poi_socio[i,<span class="dv">3</span>] <span class="ot">&lt;-</span> <span class="fu">min</span>(tmp2<span class="sc">$</span>DISP_MED19, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>  poi_socio[i,<span class="dv">4</span>] <span class="ot">&lt;-</span> <span class="fu">mean</span>(tmp2<span class="sc">$</span>DISP_MED19, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>  poi_socio[i,<span class="dv">5</span>] <span class="ot">&lt;-</span> <span class="fu">max</span>(tmp2<span class="sc">$</span>DISP_MED19, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>poi <span class="ot">&lt;-</span> <span class="fu">merge</span>(poi, poi_socio, <span class="at">by =</span> <span class="st">"osm_id"</span>, <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="output" class="level3">
<h3 class="anchored" data-anchor-id="output">Output</h3>
<p>Here is one example of data produced at IRIS level.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mapsf)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the map</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_init</span>(com, <span class="at">expandBB =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.4</span>,<span class="dv">0</span>,<span class="dv">0</span>), <span class="at">theme =</span> my_theme)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>cols <span class="ot">&lt;-</span> <span class="fu">mf_get_pal</span>(<span class="at">n =</span> <span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">5</span>), <span class="at">pal =</span> <span class="fu">c</span>(<span class="st">"Reds 2"</span>, <span class="st">"Greens"</span>))</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>thr <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">2.5</span>, <span class="dv">5</span>, <span class="fl">7.5</span>, <span class="dv">10</span>, <span class="fl">12.5</span>, <span class="dv">15</span>, <span class="dv">20</span>, <span class="dv">25</span>, <span class="dv">30</span>, <span class="fu">max</span>(iris<span class="sc">$</span>ALL_TIME, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_choro</span>(</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> iris, <span class="at">var =</span> <span class="st">"ALL_TIME"</span>, </span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">pal =</span> cols, <span class="at">lwd =</span> <span class="fl">0.25</span>, <span class="at">breaks =</span> thr, <span class="at">border =</span> <span class="st">"white"</span>,</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">leg_pos =</span> <span class="fu">c</span>(<span class="dv">631000</span>, <span class="dv">6872000</span>),</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">leg_title =</span> <span class="st">"Nearest climbing area</span><span class="sc">\n</span><span class="st">(all structures, minutes)"</span>, </span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">col_na =</span> <span class="st">"lightgrey"</span>, <span class="at">leg_no_data =</span> <span class="st">"No dedicated to housing"</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_map</span>(<span class="at">x =</span> poi, <span class="at">pch =</span> <span class="dv">21</span>, <span class="at">cex =</span> .<span class="dv">9</span>, <span class="at">bg =</span> <span class="st">"black"</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_map</span>(com, <span class="at">col =</span> <span class="cn">NA</span>, <span class="at">border =</span> <span class="st">"black"</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_title</span>(<span class="st">"Time to reach the nearest climbing area"</span>)</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_scale</span>(<span class="at">size =</span> <span class="dv">5</span>, <span class="at">col =</span> <span class="st">"black"</span>, <span class="at">pos =</span> <span class="st">"bottomright"</span>)</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_credits</span>(<span class="fu">paste0</span>(<span class="st">"Sources : © OpenStreetMap and Contributors, IGN, INSEE, 2022</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Realisation : Ronan Ysebaert, 2022"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" style="width:100.0%"></p>
</div>
</div>
</section>
</section>
<section id="travel-time-isochrone-map" class="level2">
<h2 class="anchored" data-anchor-id="travel-time-isochrone-map">Travel time isochrone Map</h2>
<p>Then, we are interested in building iscochrons of time-distance coming from climbing areas. This is done with the <code>potential</code> R package (<span class="citation" data-cites="potential">(<a href="#ref-potential" role="doc-biblioref"><strong>potential?</strong></a>)</span>) and its function <code>equipotential</code>. Below are reminded the required steps to create polygons of equipotential from a regular grid of points :</p>
<ul>
<li>Create a regular grid (150 resolution in our case) and extract the centroids.</li>
<li>Compute travel time indicators with the <code>osrmtable</code> function of the <code>osrm</code> R package, from grid centroids to climbing areas.</li>
<li>Get the minimum value of the resulting matrix and join the result to the regular grid layer</li>
<li>Create polygons of equipotential, by defining the desired thresholds and the indicator we are interested in (which climbing area travel-time)</li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="do">## 4.3 Isochrones from a regular grid to climbing areas ----</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute travel time from grid to climbing areas</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create grid and extract centroids (cell size = 150 m)</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>mygrid <span class="ot">&lt;-</span> <span class="fu">st_make_grid</span>(paris5k, <span class="at">cellsize =</span> <span class="dv">150</span>)</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>mygrid <span class="ot">&lt;-</span> <span class="fu">st_centroid</span>(mygrid)</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>mygrid <span class="ot">&lt;-</span> <span class="fu">st_sf</span>(<span class="at">ID =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(mygrid), <span class="at">geometry =</span> mygrid)</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>dest <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(dest, <span class="dv">2154</span>)</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>dest_priv <span class="ot">&lt;-</span> dest[dest<span class="sc">$</span>type <span class="sc">==</span> <span class="st">"Speculative structure"</span>,] </span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>dest_fsgt <span class="ot">&lt;-</span> dest[dest<span class="sc">$</span>federation <span class="sc">==</span> <span class="st">"FSGT"</span>,]</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute travel time from grid centroids to all climbing areas</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>df5 <span class="ot">&lt;-</span> <span class="fu">osrmTable</span>(<span class="at">src =</span> mygrid, <span class="at">dst =</span> dest, <span class="at">measure =</span> <span class="st">"duration"</span>)</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>df5 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(df5<span class="sc">$</span>duration)</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(df5, <span class="st">"data-conso/grid-bike-duration.csv"</span>, <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>df5 <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data-conso/grid-bike-duration.csv"</span>)</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(df5) <span class="ot">&lt;-</span> <span class="fu">as.character</span>(dest<span class="sc">$</span>osm_id)</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>time <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(mygrid<span class="sc">$</span>ID, <span class="fu">apply</span>(df5, <span class="dv">1</span>, min)) <span class="co"># find minimum value</span></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(time) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"ID"</span>, <span class="st">"TIME_ALL"</span>)</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>mygrid <span class="ot">&lt;-</span> <span class="fu">merge</span>(mygrid, time, <span class="at">by =</span> <span class="st">"ID"</span>, <span class="at">all.x =</span> <span class="cn">TRUE</span>) <span class="co"># merge time to grid</span></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute travel time from grid centroids to private climbing areas</span></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>df6 <span class="ot">&lt;-</span> <span class="fu">osrmTable</span>(<span class="at">src =</span> mygrid, <span class="at">dst =</span> dest_priv, <span class="at">measure =</span> <span class="st">"duration"</span>)</span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>df6 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(df6<span class="sc">$</span>duration)</span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(df6, <span class="st">"data-conso/grid-bike-duration_priv.csv"</span>, <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>df6 <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data-conso/grid-bike-duration_priv.csv"</span>)</span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(df6) <span class="ot">&lt;-</span> <span class="fu">as.character</span>(dest_priv<span class="sc">$</span>osm_id)</span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>time <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(mygrid<span class="sc">$</span>ID, <span class="fu">apply</span>(df6, <span class="dv">1</span>, min)) <span class="co"># find minimum value</span></span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(time) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"ID"</span>, <span class="st">"TIME_PRIV"</span>)</span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>mygrid <span class="ot">&lt;-</span> <span class="fu">merge</span>(mygrid, time, <span class="at">by =</span> <span class="st">"ID"</span>, <span class="at">all.x =</span> <span class="cn">TRUE</span>) <span class="co"># merge time to grid</span></span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute travel time from grid centroids to FSGT climbing areas</span></span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a>df7 <span class="ot">&lt;-</span> <span class="fu">osrmTable</span>(<span class="at">src =</span> mygrid, <span class="at">dst =</span> dest_fsgt, <span class="at">measure =</span> <span class="st">"duration"</span>)</span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a>df7 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(df7<span class="sc">$</span>duration)</span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(df7, <span class="st">"data-conso/grid-bike-duration_fsgt.csv"</span>, <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a>df7 <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data-conso/grid-bike-duration_fsgt.csv"</span>)</span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(df7) <span class="ot">&lt;-</span> <span class="fu">as.character</span>(dest_fsgt<span class="sc">$</span>osm_id)</span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a>time <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(mygrid<span class="sc">$</span>ID, <span class="fu">apply</span>(df7, <span class="dv">1</span>, min)) <span class="co"># find minimum value</span></span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(time) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"ID"</span>, <span class="st">"TIME_FSGT"</span>)</span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a>mygrid <span class="ot">&lt;-</span> <span class="fu">merge</span>(mygrid, time, <span class="at">by =</span> <span class="st">"ID"</span>, <span class="at">all.x =</span> <span class="cn">TRUE</span>) <span class="co"># merge time to grid</span></span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-42"><a href="#cb11-42" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute isochrones</span></span>
<span id="cb11-43"><a href="#cb11-43" aria-hidden="true" tabindex="-1"></a><span class="co"># define breaks (based on quantie analysis)</span></span>
<span id="cb11-44"><a href="#cb11-44" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(potential)</span>
<span id="cb11-45"><a href="#cb11-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-46"><a href="#cb11-46" aria-hidden="true" tabindex="-1"></a>thr <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">2.5</span>, <span class="dv">5</span>, <span class="fl">7.5</span>, <span class="dv">10</span>, <span class="fl">12.5</span>, <span class="dv">15</span>, <span class="dv">20</span>, <span class="dv">25</span>, <span class="dv">30</span>, <span class="fu">max</span>(mygrid<span class="sc">$</span>TIME_FSGT))</span>
<span id="cb11-47"><a href="#cb11-47" aria-hidden="true" tabindex="-1"></a>iso_all <span class="ot">&lt;-</span> <span class="fu">equipotential</span>(<span class="at">x =</span> mygrid, <span class="at">var =</span> <span class="st">"TIME_ALL"</span>, <span class="at">breaks =</span> thr,  <span class="at">mask =</span> paris5k)</span>
<span id="cb11-48"><a href="#cb11-48" aria-hidden="true" tabindex="-1"></a>iso_fsgt <span class="ot">&lt;-</span> <span class="fu">equipotential</span>(<span class="at">x =</span> mygrid, <span class="at">var =</span> <span class="st">"TIME_FSGT"</span>, <span class="at">breaks =</span> thr,  <span class="at">mask =</span> paris5k)</span>
<span id="cb11-49"><a href="#cb11-49" aria-hidden="true" tabindex="-1"></a>iso_priv <span class="ot">&lt;-</span> <span class="fu">equipotential</span>(<span class="at">x =</span> mygrid, <span class="at">var =</span> <span class="st">"TIME_PRIV"</span>, <span class="at">breaks =</span> thr,  <span class="at">mask =</span> paris5k)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="output-1" class="level3">
<h3 class="anchored" data-anchor-id="output-1">Output</h3>
<div class="cell">

</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># thresholds, colors and backaground colors</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>thr <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">2.5</span>, <span class="dv">5</span>, <span class="fl">7.5</span>, <span class="dv">10</span>, <span class="fl">12.5</span>, <span class="dv">15</span>, <span class="dv">20</span>, <span class="dv">25</span>, <span class="dv">30</span>, <span class="fu">max</span>(mygrid<span class="sc">$</span>TIME_FSGT))</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>cols <span class="ot">&lt;-</span> <span class="fu">mf_get_pal</span>(<span class="at">n =</span> <span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">5</span>), <span class="at">pal =</span> <span class="fu">c</span>(<span class="st">"Reds 2"</span>, <span class="st">"Greens"</span>))</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>colsbg <span class="ot">&lt;-</span> <span class="fu">paste0</span>(cols, <span class="st">"80"</span>)</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Show impact</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_init</span>(com, <span class="at">expandBB =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.4</span>,<span class="dv">0</span>,<span class="dv">0</span>), <span class="at">theme =</span> my_theme)</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_map</span>(iso_all, <span class="at">var =</span> <span class="st">"center"</span>, <span class="at">type =</span> <span class="st">"choro"</span>, <span class="at">breaks =</span> thr, <span class="at">pal =</span> colsbg, </span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">border =</span> <span class="cn">NA</span>, <span class="at">leg_pos =</span> <span class="fu">c</span>(<span class="dv">631000</span>, <span class="dv">6872000</span>), </span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">leg_title =</span> <span class="st">"Time to reach</span><span class="sc">\n</span><span class="st">the nearest climbing area</span><span class="sc">\n</span><span class="st">from a 150m regular grid centroids"</span>,</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_map</span>(mygrid, <span class="at">var =</span> <span class="st">"TIME_ALL"</span>, <span class="at">pch =</span> <span class="dv">21</span>, <span class="at">cex =</span> .<span class="dv">2</span>, <span class="at">border =</span> <span class="cn">NA</span>,</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">type =</span> <span class="st">"choro"</span>, <span class="at">breaks =</span> thr, <span class="at">pal =</span> cols, <span class="at">leg_pos =</span> <span class="st">"n"</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_map</span>(poi, <span class="at">pch =</span> <span class="dv">21</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_map</span>(com, <span class="at">col =</span> <span class="cn">NA</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_title</span>(<span class="st">"Isochrones output from a travel-time calculation grid centroids - climbing areas"</span>)</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_scale</span>(<span class="at">size =</span> <span class="dv">5</span>, <span class="at">col =</span> <span class="st">"black"</span>, <span class="at">pos =</span> <span class="st">"bottomright"</span>)</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_credits</span>(<span class="fu">paste0</span>(<span class="st">"Sources : © OpenStreetMap and Contributors, IGN, INSEE, 2022</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Realisation : Ronan Ysebaert, 2022"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" style="width:100.0%"></p>
</div>
</div>
</section>
</section>
<section id="osrm-climbing-trip" class="level2">
<h2 class="anchored" data-anchor-id="osrm-climbing-trip">OSRM climbing trip</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>dest_fsgt <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(dest_fsgt, <span class="dv">2154</span>)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>dest_fsgt <span class="ot">&lt;-</span> <span class="fu">st_intersection</span>(dest_fsgt, paris_5k)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>dest_fsgt <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(dest_fsgt, <span class="dv">4326</span>)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>trip <span class="ot">&lt;-</span> <span class="fu">osrmTrip</span>(<span class="at">loc =</span> dest_fsgt)</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>trip <span class="ot">&lt;-</span> trip[[<span class="dv">1</span>]]<span class="sc">$</span>trip</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">

</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(trip<span class="sc">$</span>distance)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 88.3846</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(trip<span class="sc">$</span>duration)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 420.93</code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(maptiles)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>osm <span class="ot">&lt;-</span> <span class="fu">get_tiles</span>(<span class="at">x =</span> trip, <span class="at">crop =</span> <span class="cn">TRUE</span>, <span class="at">zoom =</span> <span class="dv">13</span>)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>theme <span class="ot">&lt;-</span> <span class="fu">mf_theme</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="fl">1.2</span>,<span class="dv">0</span>), <span class="at">inner =</span> <span class="cn">FALSE</span>, <span class="at">line =</span> <span class="fl">1.2</span>, <span class="at">cex =</span> .<span class="dv">9</span>, </span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">pos =</span> <span class="st">"center"</span>, <span class="at">tab =</span> <span class="cn">FALSE</span>)</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_raster</span>(osm)</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_map</span>(trip, <span class="at">lwd =</span> <span class="dv">4</span>, <span class="at">add =</span> <span class="cn">TRUE</span>, <span class="at">col =</span> <span class="st">"blue"</span>)</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_map</span>(trip, <span class="at">lwd =</span> <span class="dv">1</span>, <span class="at">col =</span> <span class="st">"white"</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_map</span>(dest_fsgt, <span class="at">pch =</span> <span class="dv">20</span>, <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_title</span>(<span class="st">"osrmRoute()"</span>)</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_credits</span>(<span class="fu">get_credit</span>(<span class="st">"OpenStreetMap"</span>), <span class="at">pos =</span> <span class="st">"bottomright"</span>, <span class="at">cex =</span> .<span class="dv">8</span>, </span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>           <span class="at">bg =</span> <span class="st">"#ffffff80"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<section id="manual-corrections-out-of-osm" class="level3">
<h3 class="anchored" data-anchor-id="manual-corrections-out-of-osm">Manual corrections (out of OSM)</h3>
<p>I noticed that in the OpenStreetMap database some attributes could be specified more precisely. However, my use does not correspond to the one recommended by OSM : climbing_length is not climbin_max. Moreover, this attribute has been set directly in OSM by the private brand.</p>
<p>Consequently, I prefer not to change these attributes in the OSM database, but directly in my R programme.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Correct MurMur and Rename ESC15</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>poi[<span class="dv">17</span>,<span class="st">"climbing_length"</span>] <span class="ot">&lt;-</span> <span class="dv">17</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>poi[<span class="dv">16</span>,<span class="st">"name"</span>] <span class="ot">&lt;-</span> <span class="st">"ESC 15 - La Plaine"</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>poi[<span class="dv">31</span>,<span class="st">"name"</span>] <span class="ot">&lt;-</span> <span class="st">"ESC 15 - Croix Nivert"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="simplify-geometries" class="level2">
<h2 class="anchored" data-anchor-id="simplify-geometries">Simplify geometries</h2>
<p>Geometries are quite detailed. The library <code>rmapshaper</code> (<span class="citation" data-cites="rmapshaper">Andy Teucher (<a href="#ref-rmapshaper" role="doc-biblioref">2022</a>)</span>) is used to simplify the layer. 9 % of the points constituting the polygons are kept. Then, the IRIS layer is aggregated in communes for the map layout.</p>
<p>We also extract the IRIS located at less than 15 minutes from a artificial climbing area for some upcoming maps.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rmapshaper)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>iris <span class="ot">&lt;-</span> <span class="fu">ms_simplify</span>(iris, <span class="at">keep =</span> <span class="fl">0.09</span>)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Communes aggregation (layout)</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>com <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(iris[,<span class="fu">c</span>(<span class="st">"INSEE_COM"</span>, <span class="st">"NOM_COM"</span>)],</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>                 <span class="at">by =</span> <span class="fu">list</span>(iris<span class="sc">$</span>INSEE_COM),</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>                 <span class="at">FUN =</span> head, <span class="dv">1</span>)</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract IRIS at less than 15 minutes by bike</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>iris15 <span class="ot">&lt;-</span> iris[iris<span class="sc">$</span>ALL_TIME <span class="sc">&lt;</span> <span class="dv">15</span>,]</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>iris15 <span class="ot">&lt;-</span> iris15[<span class="sc">!</span><span class="fu">is.na</span>(iris15<span class="sc">$</span>ALL_TIME),]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="export-results" class="level2">
<h2 class="anchored" data-anchor-id="export-results">Export results</h2>
<p>Data preparation is over, we can go the data visualization section. Resulting geojson (poi, iris ad communes) are exported in three separated geojson. These files are available in the <a href="https://github.com/rysebaert/climbing_paris/tree/main/data-conso">Github repository</a>.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Export IRIS, POI, com layers</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">st_write</span>(com, <span class="st">"data-conso/com.geojson"</span>)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="fu">st_write</span>(iris, <span class="st">"data-conso/iris.geojson"</span>)</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="fu">st_write</span>(poi, <span class="st">"data-conso/poi.geojson"</span>)</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="fu">st_write</span>(iris15, <span class="st">"data-conso/iris15.geojson"</span>)</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Export material related to isochrons</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>mygrid <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(mygrid, <span class="dv">4326</span>)</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>iso_all <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(iso_all, <span class="dv">4326</span>)</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>iso_fsgt <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(iso_fsgt, <span class="dv">4326</span>)</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>iso_priv <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(iso_priv, <span class="dv">4326</span>)</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a><span class="fu">st_write</span>(mygrid, <span class="st">"data-conso/mygrid.geojson"</span>)</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a><span class="fu">st_write</span>(iso_all, <span class="st">"data-conso/iso_all.geojson"</span>)</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a><span class="fu">st_write</span>(iso_fsgt, <span class="st">"data-conso/iso_fsgt.geojson"</span>)</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a><span class="fu">st_write</span>(iso_priv, <span class="st">"data-conso/iso_priv.geojson"</span>)</span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Export material related to travel-trip</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="session-info-r" class="level2">
<h2 class="anchored" data-anchor-id="session-info-r">Session info (R)</h2>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>R version 4.2.0 (2022-04-22 ucrt)
Platform: x86_64-w64-mingw32/x64 (64-bit)
Running under: Windows 10 x64 (build 19043)

Matrix products: default

locale:
[1] LC_COLLATE=French_France.utf8  LC_CTYPE=French_France.utf8   
[3] LC_MONETARY=French_France.utf8 LC_NUMERIC=C                  
[5] LC_TIME=French_France.utf8    

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

other attached packages:
[1] readxl_1.4.0     rmapshaper_0.4.6 osrm_3.5.1       osmdata_0.1.10  
[5] maptiles_0.3.0   mapsf_0.5.0      sf_1.0-7        

loaded via a namespace (and not attached):
 [1] Rcpp_1.0.8.3       cellranger_1.1.0   compiler_4.2.0     class_7.3-20      
 [5] tools_4.2.0        digest_0.6.29      jsonlite_1.8.0     evaluate_0.15     
 [9] lattice_0.20-45    png_0.1-7          rlang_1.0.2        DBI_1.1.2         
[13] cli_3.3.0          curl_4.3.2         crul_1.2.0         yaml_2.3.5        
[17] xfun_0.31          fastmap_1.1.0      e1071_1.7-11       terra_1.5-34      
[21] stringr_1.4.0      knitr_1.39         classInt_0.4-7     geojsonlint_0.4.0 
[25] grid_4.2.0         jsonvalidate_1.3.2 httpcode_0.3.0     R6_2.5.1          
[29] rmarkdown_2.14     sp_1.5-0           purrr_0.3.4        magrittr_2.0.3    
[33] codetools_0.2-18   htmltools_0.5.2    units_0.8-0        V8_4.2.0          
[37] KernSmooth_2.23-20 slippymath_0.3.1   stringi_1.7.6      proxy_0.4-27      </code></pre>
</div>
</div>
</section>
</section>
<section id="data-visualization-with-observable-javascript-ojs" class="level1">
<h1>Data visualization with Observable JavaScript (ojs)</h1>
<p>Observable is a startup founded by Mike Bostock and Melody Mechfessel, who initiated an on-line plateform to collaboratively explore, analyze, visualize and communicate with data on the Web.</p>
<p>The computing language is <a href="https://observablehq.com/@observablehq/observables-not-javascript">Observable JavaScript (ojs)</a>. It is possible to include this programming language in Quarto chunks.</p>
<p>This section imports some visualizations realized in an <a href="https://observablehq.com/collection/@rysebaert/climbing_paris">Observable collection</a>. Have a look to this resource to see the overall project !</p>
<p>All the maps produced below use the bertin.js library. Have a look to the excellent documentation in its <a href="https://www.npmjs.com/package/bertin">npm repository</a> or in this <a href="https://observablehq.com/collection/@neocartocnrs/bertin">Observable Collection</a> to see the possibilities offered by this library to the map creator !</p>
<section id="import-consolidated-data" class="level2">
<h2 class="anchored" data-anchor-id="import-consolidated-data">Import consolidated data</h2>
<p>Geojson files coming from the data preparation precessing realized in a R programming language and described above are imported.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23" data-startfrom="740" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 739;"><span id="cb23-740"><a href="#cb23-740" aria-hidden="true" tabindex="-1"></a>iris <span class="op">=</span> <span class="fu">FileAttachment</span>(<span class="st">"data-conso/iris.geojson"</span>)<span class="op">.</span><span class="fu">json</span>()</span>
<span id="cb23-741"><a href="#cb23-741" aria-hidden="true" tabindex="-1"></a>poi <span class="op">=</span> <span class="fu">FileAttachment</span>(<span class="st">"data-conso/poi.geojson"</span>)<span class="op">.</span><span class="fu">json</span>()</span>
<span id="cb23-742"><a href="#cb23-742" aria-hidden="true" tabindex="-1"></a>com <span class="op">=</span> <span class="fu">FileAttachment</span>(<span class="st">"data-conso/com.geojson"</span>)<span class="op">.</span><span class="fu">json</span>()</span>
<span id="cb23-743"><a href="#cb23-743" aria-hidden="true" tabindex="-1"></a>iris15 <span class="op">=</span> <span class="fu">FileAttachment</span>(<span class="st">"data-conso/iris15.geojson"</span>)<span class="op">.</span><span class="fu">json</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-4" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<p>Bertin.js (<span class="citation" data-cites="bertin">Lambert (<a href="#ref-bertin" role="doc-biblioref">2022a</a>)</span>) and geoverview.js (<span class="citation" data-cites="geoverview">Lambert (<a href="#ref-geoverview" role="doc-biblioref">2022b</a>)</span>) libraries are imported. These libraries will be used for creating the maps.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24" data-startfrom="749" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 748;"><span id="cb24-749"><a href="#cb24-749" aria-hidden="true" tabindex="-1"></a>bertin <span class="op">=</span> <span class="pp">require</span>(<span class="st">'bertin@0.9.16'</span>)</span>
<span id="cb24-750"><a href="#cb24-750" aria-hidden="true" tabindex="-1"></a>view <span class="op">=</span> <span class="pp">require</span>(<span class="st">"geoverview@1.2"</span>)<span class="op">.</span><span class="fu">then</span>((f) <span class="kw">=&gt;</span> f<span class="op">.</span><span class="at">view</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-2-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-2-2" data-nodetype="declaration">

</div>
</div>
</div>
</div>
</section>
<section id="layers-attributes-and-metadata" class="level2">
<h2 class="anchored" data-anchor-id="layers-attributes-and-metadata">Layers attributes and metadata</h2>
<p>Three geographical layers will be used :</p>
<ul>
<li><strong>iris</strong> : IRIS intersecting the study area (polygons layer).</li>
<li><strong>poi</strong> : climbing structures included the study area (points layer).</li>
<li><strong>com</strong> : Muncipilaties interesecting thhe study area (polygons layer). This layer will only be used for the map layout and better understand the location of the poi and iris layers : IRIS, the lowest territorial division in France, is not really known by the population.</li>
</ul>
<p>The first two geographical layers include attributes coming from the data preparation process, that will be mapped and ploted in the next section of the document. In this part, we present the layers in several ways to understand the information we have in hand for producing the data visualization.</p>
<section id="interactive-map" class="level3">
<h3 class="anchored" data-anchor-id="interactive-map">Interactive map</h3>
<p>Made with geoverview library. Click on the points / polygons to have an overview of their respective attributes and values.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25" data-startfrom="769" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 768;"><span id="cb25-769"><a href="#cb25-769" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> <span class="kw">new</span> <span class="bu">Map</span>([</span>
<span id="cb25-770"><a href="#cb25-770" aria-hidden="true" tabindex="-1"></a>  [<span class="st">"Climbing areas (dots)"</span><span class="op">,</span> poi]<span class="op">,</span></span>
<span id="cb25-771"><a href="#cb25-771" aria-hidden="true" tabindex="-1"></a>  [<span class="st">"IRIS (polygons)"</span><span class="op">,</span> iris]<span class="op">,</span></span>
<span id="cb25-772"><a href="#cb25-772" aria-hidden="true" tabindex="-1"></a>  [<span class="st">"Layout municipalities (polygons)"</span><span class="op">,</span> com]</span>
<span id="cb25-773"><a href="#cb25-773" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb25-774"><a href="#cb25-774" aria-hidden="true" tabindex="-1"></a>viewof geojson <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">select</span>(data<span class="op">,</span> { <span class="dt">label</span><span class="op">:</span> <span class="st">"Select a geojson"</span> })</span>
<span id="cb25-775"><a href="#cb25-775" aria-hidden="true" tabindex="-1"></a>viewof style <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">select</span>([<span class="st">"voyager"</span><span class="op">,</span> <span class="st">"night"</span><span class="op">,</span> <span class="st">"fulldark"</span><span class="op">,</span><span class="st">"positron"</span><span class="op">,</span><span class="st">"icgc"</span><span class="op">,</span><span class="st">"osmbright"</span><span class="op">,</span><span class="st">"hibrid"</span>]<span class="op">,</span> { <span class="dt">label</span><span class="op">:</span> <span class="st">"Select a style"</span> })</span>
<span id="cb25-776"><a href="#cb25-776" aria-hidden="true" tabindex="-1"></a>map <span class="op">=</span> <span class="fu">view</span>(geojson<span class="op">,</span> {</span>
<span id="cb25-777"><a href="#cb25-777" aria-hidden="true" tabindex="-1"></a>  <span class="dt">style</span><span class="op">:</span> style</span>
<span id="cb25-778"><a href="#cb25-778" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-3-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-3-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-3-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-3-4" data-nodetype="declaration">

</div>
</div>
</div>
</div>
</section>
<section id="attributes-and-metadata" class="level3">
<h3 class="anchored" data-anchor-id="attributes-and-metadata">Attributes and metadata</h3>
<p><strong>Attribute table (iris layer)</strong></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26" data-startfrom="785" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 784;"><span id="cb26-785"><a href="#cb26-785" aria-hidden="true" tabindex="-1"></a>Inputs<span class="op">.</span><span class="fu">table</span>(iris<span class="op">.</span><span class="at">features</span><span class="op">.</span><span class="fu">map</span>((d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">properties</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="ojs-cell-4" data-nodetype="expression">

</div>
</div>
</div>
<p><strong>Indicators definition (iris layer)</strong></p>
<table class="table">
<colgroup>
<col style="width: 6%">
<col style="width: 66%">
<col style="width: 26%">
</colgroup>
<thead>
<tr class="header">
<th>id</th>
<th>Description</th>
<th>Data source</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>CODE_IRIS</td>
<td>IRIS code</td>
<td>INSEE, IGN</td>
</tr>
<tr class="even">
<td>NOM_IRIS</td>
<td>IRIS Name</td>
<td>INSEE, IGN</td>
</tr>
<tr class="odd">
<td>TYP_IRIS</td>
<td>IRIS type (H for dwellings)</td>
<td>INSEE, IGN</td>
</tr>
<tr class="even">
<td>P18_POP</td>
<td>Population in 2018</td>
<td>INSEE</td>
</tr>
<tr class="odd">
<td>DISP_MED19</td>
<td>Disposable median income in 2019</td>
<td>INSEE</td>
</tr>
<tr class="even">
<td>ALL_NAME</td>
<td>Name of the nearest artificial climbing area reachable by bike (all structures)</td>
<td>(c)OpenStreetMap and contributors, Ronan Ysebaert</td>
</tr>
<tr class="odd">
<td>TYPE_STRUCT</td>
<td>Manager of the nearest artificial climbing area reachable by bike (private, FSGT or FFME)</td>
<td>(c)OpenStreetMap and contributors, Ronan Ysebaert</td>
</tr>
<tr class="even">
<td>ALL_TIME</td>
<td>Time by bike to reach the nearest artificial climbing area.</td>
<td>(c)OpenStreetMap and contributors, Ronan Ysebaert</td>
</tr>
<tr class="odd">
<td>N_15MN</td>
<td>Number of climbing areas accessible in 15 minutes by bike from the IRIS centroid (all structures)</td>
<td>(c)OpenStreetMap and contributors, Ronan Ysebaert</td>
</tr>
<tr class="even">
<td>PRIV_NAME</td>
<td>Name of the nearest artificial climbing area by bike (Private structure)</td>
<td>(c)OpenStreetMap and contributors, Ronan Ysebaert</td>
</tr>
<tr class="odd">
<td>PRIV_TIME</td>
<td>Time by bike to reach the nearest artificial climbing area (Private structure)</td>
<td>(c)OpenStreetMap and contributors, Ronan Ysebaert</td>
</tr>
<tr class="even">
<td>N_PRIV_15MN</td>
<td>Number of climbing areas accessible in 15 minutes by bike from the IRIS centroid (private structures)</td>
<td>(c)OpenStreetMap and contributors, Ronan Ysebaert</td>
</tr>
<tr class="odd">
<td>FFME_NAME</td>
<td>Name of the nearest artificial climbing area by bike (Associative structure, federation : FFME)</td>
<td>(c)OpenStreetMap and contributors, Ronan Ysebaert</td>
</tr>
<tr class="even">
<td>FFME_TIME</td>
<td>Time by bike to reach the nearest artificial climbing area (Associative structure, federation : FFME)</td>
<td>(c)OpenStreetMap and contributors, Ronan Ysebaert</td>
</tr>
<tr class="odd">
<td>N_FFME_15MN</td>
<td>Number of climbing areas accessible in 15 minutes by bike from the IRIS centroid (Associative structure, federation : FFME)</td>
<td>(c)OpenStreetMap and contributors, Ronan Ysebaert</td>
</tr>
<tr class="even">
<td>FSGT_NAME</td>
<td>Name of the nearest artificial climbing area by bike (Associative structure, federation : FSGT)</td>
<td>(c)OpenStreetMap and contributors, Ronan Ysebaert</td>
</tr>
<tr class="odd">
<td>FSGT_TIME</td>
<td>Time by bike to reach the nearest artificial climbing area (Associative structure, federation : FSGT)</td>
<td>(c)OpenStreetMap and contributors, Ronan Ysebaert</td>
</tr>
<tr class="even">
<td>N_FSGT_15MN</td>
<td>Number of climbing areas accessible in 15 minutes by bike from the IRIS centroid (Associative structure, federation : FSGT)</td>
<td>(c)OpenStreetMap and contributors, Ronan Ysebaert</td>
</tr>
</tbody>
</table>
<p><strong>Attribute table (poi layer)</strong></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27" data-startfrom="815" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 814;"><span id="cb27-815"><a href="#cb27-815" aria-hidden="true" tabindex="-1"></a>Inputs<span class="op">.</span><span class="fu">table</span>(poi<span class="op">.</span><span class="at">features</span><span class="op">.</span><span class="fu">map</span>((d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">properties</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="ojs-cell-5" data-nodetype="expression">

</div>
</div>
</div>
<p><strong>Indicators definition (poi layer)</strong></p>
<table class="table">
<colgroup>
<col style="width: 6%">
<col style="width: 72%">
<col style="width: 21%">
</colgroup>
<thead>
<tr class="header">
<th>id</th>
<th>Description</th>
<th>Data source</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>osm_id</td>
<td>OpenStreetMap identifier (responding to the query sport=climbing in the bounding box of the study area)</td>
<td>(c)OpenStreetMap and contributors</td>
</tr>
<tr class="even">
<td>name</td>
<td>Name of the artificial climbing area</td>
<td>(c)OpenStreetMap and contributors</td>
</tr>
<tr class="odd">
<td>climbing_type</td>
<td>If the articial climbing area is a wall (need a rope to climb), dedicated to bouldering, or both</td>
<td>(c)OpenStreetMap and contributors, Ronan Ysebaert</td>
</tr>
<tr class="even">
<td>climbing_length</td>
<td>Max. height of the wall (if adapted, for walls and not for bouldering)</td>
<td>(c)OpenStreetMap and contributors</td>
</tr>
<tr class="odd">
<td>climbing_routes</td>
<td>Number of climbing routes, materialized by belay station (if adapted, for walls and not for bouldering). Note that in artificial climbing, a same belay station can serve several climbing routes</td>
<td>(c)OpenStreetMap and contributors</td>
</tr>
<tr class="even">
<td>type</td>
<td>If the climbing area is speculative (manage by a private brand) or associative</td>
<td>(c)OpenStreetMap and contributors, Ronan Ysebaert</td>
</tr>
<tr class="odd">
<td>federation</td>
<td>Name of the manager (FFME, FSGT or private)</td>
<td>(c)OpenStreetMap and contributors, Ronan Ysebaert</td>
</tr>
<tr class="even">
<td>brand</td>
<td>Name of the brand managing the private structure</td>
<td>(c)OpenStreetMap and contributors</td>
</tr>
<tr class="odd">
<td>SUM_POP18</td>
<td>Population at less than 15 minutes by bike of the artificial climbing area (IRIS centroids).</td>
<td>INSEE, (c)OpenStreetMap and contributors, Ronan Ysebaert</td>
</tr>
<tr class="even">
<td>MIN_REV19</td>
<td>Mininum of the median income for the IRIS located at less than 15 minutes by bike</td>
<td>INSEE, (c)OpenStreetMap and contributors, Ronan Ysebaert</td>
</tr>
<tr class="odd">
<td>MOY_REV19</td>
<td>Mean of the Median income for the IRIS located at less than 15 minutes by bike</td>
<td>INSEE, (c)OpenStreetMap and contributors, Ronan Ysebaert</td>
</tr>
<tr class="even">
<td>MAX_REV19</td>
<td>Maximum of the Median income for the IRIS located at less than 15 minutes by bike</td>
<td>INSEE, (c)OpenStreetMap and contributors, Ronan Ysebaert</td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="walls-characteristics" class="level2">
<h2 class="anchored" data-anchor-id="walls-characteristics">Wall’s characteristics</h2>
<p>This interactive map displays the artificial climbing offer in Paris and its surroundings, according artificial climbing specificities: top rope climbing (walls) / bouldering, climbing height, number of routes, manager of the articial climbing area.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28" data-startfrom="842" data-source-offset="-24"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 841;"><span id="cb28-842"><a href="#cb28-842" aria-hidden="true" tabindex="-1"></a>lambert93 <span class="op">=</span> <span class="st">"+proj=lcc +lat_1=49 +lat_2=44 +lat_0=46.5 +lon_0=3 +x_0=700000 +y_0=6600000 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs"</span></span>
<span id="cb28-843"><a href="#cb28-843" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-844"><a href="#cb28-844" aria-hidden="true" tabindex="-1"></a><span class="co">// Map parameters to play with it</span></span>
<span id="cb28-845"><a href="#cb28-845" aria-hidden="true" tabindex="-1"></a>viewof ind <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">radio</span>([<span class="st">"climbing_length"</span><span class="op">,</span> <span class="st">"climbing_routes"</span>]<span class="op">,</span> {<span class="dt">label</span><span class="op">:</span> <span class="st">"Wall height / Number of routes"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="st">"climbing_length"</span>})</span>
<span id="cb28-846"><a href="#cb28-846" aria-hidden="true" tabindex="-1"></a>viewof k <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">10</span><span class="op">,</span> <span class="dv">300</span>]<span class="op">,</span> { <span class="dt">label</span><span class="op">:</span> <span class="st">"Spikes height"</span><span class="op">,</span> <span class="dt">step</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="dv">90</span> })</span>
<span id="cb28-847"><a href="#cb28-847" aria-hidden="true" tabindex="-1"></a>viewof w <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">2</span><span class="op">,</span> <span class="dv">30</span>]<span class="op">,</span> { <span class="dt">label</span><span class="op">:</span> <span class="st">"Spikes / dots width"</span><span class="op">,</span> <span class="dt">step</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="dv">15</span> })</span>
<span id="cb28-848"><a href="#cb28-848" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-849"><a href="#cb28-849" aria-hidden="true" tabindex="-1"></a><span class="co">// Spike map with tooltips</span></span>
<span id="cb28-850"><a href="#cb28-850" aria-hidden="true" tabindex="-1"></a>map1 <span class="op">=</span> bertin<span class="op">.</span><span class="fu">draw</span>({</span>
<span id="cb28-851"><a href="#cb28-851" aria-hidden="true" tabindex="-1"></a>  <span class="dt">params</span><span class="op">:</span> {</span>
<span id="cb28-852"><a href="#cb28-852" aria-hidden="true" tabindex="-1"></a>    <span class="dt">width</span><span class="op">:</span> <span class="dv">750</span><span class="op">,</span></span>
<span id="cb28-853"><a href="#cb28-853" aria-hidden="true" tabindex="-1"></a>    <span class="dt">projection</span><span class="op">:</span> lambert93<span class="op">,</span></span>
<span id="cb28-854"><a href="#cb28-854" aria-hidden="true" tabindex="-1"></a>    <span class="dt">extent</span><span class="op">:</span> com</span>
<span id="cb28-855"><a href="#cb28-855" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb28-856"><a href="#cb28-856" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-857"><a href="#cb28-857" aria-hidden="true" tabindex="-1"></a>  <span class="dt">layers</span><span class="op">:</span> [</span>
<span id="cb28-858"><a href="#cb28-858" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb28-859"><a href="#cb28-859" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"spikes"</span><span class="op">,</span></span>
<span id="cb28-860"><a href="#cb28-860" aria-hidden="true" tabindex="-1"></a>      <span class="dt">geojson</span><span class="op">:</span> poi<span class="op">,</span></span>
<span id="cb28-861"><a href="#cb28-861" aria-hidden="true" tabindex="-1"></a>      <span class="dt">values</span><span class="op">:</span> ind<span class="op">,</span></span>
<span id="cb28-862"><a href="#cb28-862" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fillOpacity</span><span class="op">:</span> <span class="fl">0.2</span><span class="op">,</span></span>
<span id="cb28-863"><a href="#cb28-863" aria-hidden="true" tabindex="-1"></a>      <span class="dt">k</span><span class="op">:</span> k<span class="op">,</span></span>
<span id="cb28-864"><a href="#cb28-864" aria-hidden="true" tabindex="-1"></a>      <span class="dt">w</span><span class="op">:</span> w<span class="op">,</span></span>
<span id="cb28-865"><a href="#cb28-865" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> {</span>
<span id="cb28-866"><a href="#cb28-866" aria-hidden="true" tabindex="-1"></a>        <span class="dt">type</span><span class="op">:</span> <span class="st">"typo"</span><span class="op">,</span></span>
<span id="cb28-867"><a href="#cb28-867" aria-hidden="true" tabindex="-1"></a>        <span class="dt">values</span><span class="op">:</span> <span class="st">"federation"</span><span class="op">,</span></span>
<span id="cb28-868"><a href="#cb28-868" aria-hidden="true" tabindex="-1"></a>        <span class="dt">colors</span><span class="op">:</span> [<span class="st">"#9990f0"</span><span class="op">,</span> <span class="st">"#fcb456"</span><span class="op">,</span> <span class="st">"#ba0b25"</span>]<span class="op">,</span></span>
<span id="cb28-869"><a href="#cb28-869" aria-hidden="true" tabindex="-1"></a>        <span class="dt">leg_title</span><span class="op">:</span> <span class="vs">`Wall's managers`</span><span class="op">,</span></span>
<span id="cb28-870"><a href="#cb28-870" aria-hidden="true" tabindex="-1"></a>        <span class="dt">leg_x</span><span class="op">:</span> <span class="dv">600</span><span class="op">,</span></span>
<span id="cb28-871"><a href="#cb28-871" aria-hidden="true" tabindex="-1"></a>        <span class="dt">leg_y</span><span class="op">:</span> <span class="dv">550</span></span>
<span id="cb28-872"><a href="#cb28-872" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb28-873"><a href="#cb28-873" aria-hidden="true" tabindex="-1"></a>      <span class="dt">stroke</span><span class="op">:</span> {</span>
<span id="cb28-874"><a href="#cb28-874" aria-hidden="true" tabindex="-1"></a>        <span class="dt">type</span><span class="op">:</span> <span class="st">"typo"</span><span class="op">,</span></span>
<span id="cb28-875"><a href="#cb28-875" aria-hidden="true" tabindex="-1"></a>        <span class="dt">values</span><span class="op">:</span> <span class="st">"federation"</span><span class="op">,</span></span>
<span id="cb28-876"><a href="#cb28-876" aria-hidden="true" tabindex="-1"></a>        <span class="dt">colors</span><span class="op">:</span> [<span class="st">"#9990f0"</span><span class="op">,</span> <span class="st">"#fcb456"</span><span class="op">,</span> <span class="st">"#ba0b25"</span>]</span>
<span id="cb28-877"><a href="#cb28-877" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb28-878"><a href="#cb28-878" aria-hidden="true" tabindex="-1"></a>      <span class="dt">leg_x</span><span class="op">:</span> <span class="dv">15</span><span class="op">,</span></span>
<span id="cb28-879"><a href="#cb28-879" aria-hidden="true" tabindex="-1"></a>      <span class="dt">leg_y</span><span class="op">:</span> <span class="dv">15</span><span class="op">,</span></span>
<span id="cb28-880"><a href="#cb28-880" aria-hidden="true" tabindex="-1"></a>      <span class="dt">leg_round</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb28-881"><a href="#cb28-881" aria-hidden="true" tabindex="-1"></a>      <span class="dt">leg_title</span><span class="op">:</span> <span class="vs">`Height (meters) or routes number`</span><span class="op">,</span></span>
<span id="cb28-882"><a href="#cb28-882" aria-hidden="true" tabindex="-1"></a>      <span class="dt">tooltip</span><span class="op">:</span> {</span>
<span id="cb28-883"><a href="#cb28-883" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fields</span><span class="op">:</span> [</span>
<span id="cb28-884"><a href="#cb28-884" aria-hidden="true" tabindex="-1"></a>          <span class="st">"$name"</span><span class="op">,</span></span>
<span id="cb28-885"><a href="#cb28-885" aria-hidden="true" tabindex="-1"></a>          <span class="st">"$climbing_length"</span><span class="op">,</span></span>
<span id="cb28-886"><a href="#cb28-886" aria-hidden="true" tabindex="-1"></a>          <span class="st">"(height in meters)"</span><span class="op">,</span></span>
<span id="cb28-887"><a href="#cb28-887" aria-hidden="true" tabindex="-1"></a>          <span class="st">"$climbing_routes"</span><span class="op">,</span></span>
<span id="cb28-888"><a href="#cb28-888" aria-hidden="true" tabindex="-1"></a>          <span class="st">"(nb. routes)"</span><span class="op">,</span></span>
<span id="cb28-889"><a href="#cb28-889" aria-hidden="true" tabindex="-1"></a>          <span class="st">"$federation"</span><span class="op">,</span></span>
<span id="cb28-890"><a href="#cb28-890" aria-hidden="true" tabindex="-1"></a>          <span class="st">"(manager)"</span></span>
<span id="cb28-891"><a href="#cb28-891" aria-hidden="true" tabindex="-1"></a>        ]<span class="op">,</span></span>
<span id="cb28-892"><a href="#cb28-892" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fill</span><span class="op">:</span> [<span class="st">"black"</span><span class="op">,</span> <span class="st">"black"</span><span class="op">,</span> <span class="st">"black"</span><span class="op">,</span> <span class="st">"black"</span><span class="op">,</span> <span class="st">"black"</span><span class="op">,</span> <span class="st">"black"</span><span class="op">,</span> <span class="st">"black"</span>]<span class="op">,</span></span>
<span id="cb28-893"><a href="#cb28-893" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fontWeight</span><span class="op">:</span> [</span>
<span id="cb28-894"><a href="#cb28-894" aria-hidden="true" tabindex="-1"></a>          <span class="st">"bold"</span><span class="op">,</span></span>
<span id="cb28-895"><a href="#cb28-895" aria-hidden="true" tabindex="-1"></a>          <span class="st">"normal"</span><span class="op">,</span></span>
<span id="cb28-896"><a href="#cb28-896" aria-hidden="true" tabindex="-1"></a>          <span class="st">"normal"</span><span class="op">,</span></span>
<span id="cb28-897"><a href="#cb28-897" aria-hidden="true" tabindex="-1"></a>          <span class="st">"normal"</span><span class="op">,</span></span>
<span id="cb28-898"><a href="#cb28-898" aria-hidden="true" tabindex="-1"></a>          <span class="st">"normal"</span><span class="op">,</span></span>
<span id="cb28-899"><a href="#cb28-899" aria-hidden="true" tabindex="-1"></a>          <span class="st">"normal"</span><span class="op">,</span></span>
<span id="cb28-900"><a href="#cb28-900" aria-hidden="true" tabindex="-1"></a>          <span class="st">"normal"</span></span>
<span id="cb28-901"><a href="#cb28-901" aria-hidden="true" tabindex="-1"></a>        ]<span class="op">,</span></span>
<span id="cb28-902"><a href="#cb28-902" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fontSize</span><span class="op">:</span> [<span class="dv">14</span><span class="op">,</span> <span class="dv">12</span><span class="op">,</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">12</span><span class="op">,</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">12</span><span class="op">,</span> <span class="dv">10</span>]<span class="op">,</span></span>
<span id="cb28-903"><a href="#cb28-903" aria-hidden="true" tabindex="-1"></a>        <span class="dt">col</span><span class="op">:</span> <span class="st">"white"</span></span>
<span id="cb28-904"><a href="#cb28-904" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb28-905"><a href="#cb28-905" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb28-906"><a href="#cb28-906" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-907"><a href="#cb28-907" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb28-908"><a href="#cb28-908" aria-hidden="true" tabindex="-1"></a>      <span class="dt">geojson</span><span class="op">:</span> poi<span class="op">,</span></span>
<span id="cb28-909"><a href="#cb28-909" aria-hidden="true" tabindex="-1"></a>      <span class="dt">symbol_size</span><span class="op">:</span> <span class="dv">10</span> <span class="op">*</span> w<span class="op">,</span></span>
<span id="cb28-910"><a href="#cb28-910" aria-hidden="true" tabindex="-1"></a>      <span class="dt">symbol</span><span class="op">:</span> <span class="st">"circle"</span><span class="op">,</span></span>
<span id="cb28-911"><a href="#cb28-911" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> {</span>
<span id="cb28-912"><a href="#cb28-912" aria-hidden="true" tabindex="-1"></a>        <span class="dt">type</span><span class="op">:</span> <span class="st">"typo"</span><span class="op">,</span></span>
<span id="cb28-913"><a href="#cb28-913" aria-hidden="true" tabindex="-1"></a>        <span class="dt">values</span><span class="op">:</span> <span class="st">"climbing_type"</span><span class="op">,</span></span>
<span id="cb28-914"><a href="#cb28-914" aria-hidden="true" tabindex="-1"></a>        <span class="dt">colors</span><span class="op">:</span> [<span class="st">"white"</span><span class="op">,</span> <span class="st">"lightgrey"</span><span class="op">,</span> <span class="st">"grey"</span>]<span class="op">,</span></span>
<span id="cb28-915"><a href="#cb28-915" aria-hidden="true" tabindex="-1"></a>        <span class="dt">leg_title</span><span class="op">:</span> <span class="vs">`Climbing type`</span><span class="op">,</span></span>
<span id="cb28-916"><a href="#cb28-916" aria-hidden="true" tabindex="-1"></a>        <span class="dt">leg_x</span><span class="op">:</span> <span class="dv">600</span><span class="op">,</span></span>
<span id="cb28-917"><a href="#cb28-917" aria-hidden="true" tabindex="-1"></a>        <span class="dt">leg_y</span><span class="op">:</span> <span class="dv">430</span></span>
<span id="cb28-918"><a href="#cb28-918" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb28-919"><a href="#cb28-919" aria-hidden="true" tabindex="-1"></a>      <span class="dt">stroke</span><span class="op">:</span> {</span>
<span id="cb28-920"><a href="#cb28-920" aria-hidden="true" tabindex="-1"></a>        <span class="dt">type</span><span class="op">:</span> <span class="st">"typo"</span><span class="op">,</span></span>
<span id="cb28-921"><a href="#cb28-921" aria-hidden="true" tabindex="-1"></a>        <span class="dt">values</span><span class="op">:</span> <span class="st">"federation"</span><span class="op">,</span></span>
<span id="cb28-922"><a href="#cb28-922" aria-hidden="true" tabindex="-1"></a>        <span class="dt">colors</span><span class="op">:</span> [<span class="st">"#9990f0"</span><span class="op">,</span> <span class="st">"#fcb456"</span><span class="op">,</span> <span class="st">"#ba0b25"</span>]</span>
<span id="cb28-923"><a href="#cb28-923" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb28-924"><a href="#cb28-924" aria-hidden="true" tabindex="-1"></a>      <span class="dt">strokeWidth</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span></span>
<span id="cb28-925"><a href="#cb28-925" aria-hidden="true" tabindex="-1"></a>      <span class="dt">tooltip</span><span class="op">:</span> {</span>
<span id="cb28-926"><a href="#cb28-926" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fields</span><span class="op">:</span> [<span class="st">"$name"</span><span class="op">,</span> <span class="st">"$climbing_type"</span>]<span class="op">,</span></span>
<span id="cb28-927"><a href="#cb28-927" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fill</span><span class="op">:</span> [<span class="st">"black"</span><span class="op">,</span> <span class="st">"black"</span>]<span class="op">,</span></span>
<span id="cb28-928"><a href="#cb28-928" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fontWeight</span><span class="op">:</span> [<span class="st">"bold"</span><span class="op">,</span> <span class="st">"normal"</span>]<span class="op">,</span></span>
<span id="cb28-929"><a href="#cb28-929" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fontSize</span><span class="op">:</span> [<span class="dv">12</span><span class="op">,</span> <span class="dv">10</span>]<span class="op">,</span></span>
<span id="cb28-930"><a href="#cb28-930" aria-hidden="true" tabindex="-1"></a>        <span class="dt">col</span><span class="op">:</span> <span class="st">"white"</span></span>
<span id="cb28-931"><a href="#cb28-931" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb28-932"><a href="#cb28-932" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb28-933"><a href="#cb28-933" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-934"><a href="#cb28-934" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb28-935"><a href="#cb28-935" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"text"</span><span class="op">,</span></span>
<span id="cb28-936"><a href="#cb28-936" aria-hidden="true" tabindex="-1"></a>      <span class="dt">position</span><span class="op">:</span> <span class="st">"topright"</span><span class="op">,</span></span>
<span id="cb28-937"><a href="#cb28-937" aria-hidden="true" tabindex="-1"></a>      <span class="dt">text</span><span class="op">:</span> <span class="st">"Climbing hot spots"</span><span class="op">,</span></span>
<span id="cb28-938"><a href="#cb28-938" aria-hidden="true" tabindex="-1"></a>      <span class="dt">frame_opacity</span><span class="op">:</span> <span class="fl">0.7</span><span class="op">,</span></span>
<span id="cb28-939"><a href="#cb28-939" aria-hidden="true" tabindex="-1"></a>      <span class="dt">baseline</span><span class="op">:</span> <span class="st">"hanging"</span><span class="op">,</span></span>
<span id="cb28-940"><a href="#cb28-940" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> <span class="st">"black"</span><span class="op">,</span></span>
<span id="cb28-941"><a href="#cb28-941" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fontSize</span><span class="op">:</span> <span class="dv">25</span><span class="op">,</span></span>
<span id="cb28-942"><a href="#cb28-942" aria-hidden="true" tabindex="-1"></a>      <span class="dt">margin</span><span class="op">:</span> <span class="dv">4</span><span class="op">,</span></span>
<span id="cb28-943"><a href="#cb28-943" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fontWeight</span><span class="op">:</span> <span class="st">"bold"</span><span class="op">,</span></span>
<span id="cb28-944"><a href="#cb28-944" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fontFamily</span><span class="op">:</span> <span class="st">"Ubuntu"</span></span>
<span id="cb28-945"><a href="#cb28-945" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb28-946"><a href="#cb28-946" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-947"><a href="#cb28-947" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb28-948"><a href="#cb28-948" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"layer"</span><span class="op">,</span></span>
<span id="cb28-949"><a href="#cb28-949" aria-hidden="true" tabindex="-1"></a>      <span class="dt">geojson</span><span class="op">:</span> com<span class="op">,</span></span>
<span id="cb28-950"><a href="#cb28-950" aria-hidden="true" tabindex="-1"></a>      <span class="dt">stroke</span><span class="op">:</span> <span class="st">"white"</span><span class="op">,</span></span>
<span id="cb28-951"><a href="#cb28-951" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> <span class="st">"peachpuff"</span><span class="op">,</span></span>
<span id="cb28-952"><a href="#cb28-952" aria-hidden="true" tabindex="-1"></a>      <span class="dt">tooltip</span><span class="op">:</span> [<span class="st">"$NOM_COM"</span>]</span>
<span id="cb28-953"><a href="#cb28-953" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb28-954"><a href="#cb28-954" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-955"><a href="#cb28-955" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb28-956"><a href="#cb28-956" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"scalebar"</span><span class="op">,</span></span>
<span id="cb28-957"><a href="#cb28-957" aria-hidden="true" tabindex="-1"></a>      <span class="dt">units</span><span class="op">:</span> <span class="st">"miles"</span></span>
<span id="cb28-958"><a href="#cb28-958" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb28-959"><a href="#cb28-959" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-960"><a href="#cb28-960" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb28-961"><a href="#cb28-961" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"footer"</span><span class="op">,</span></span>
<span id="cb28-962"><a href="#cb28-962" aria-hidden="true" tabindex="-1"></a>      <span class="dt">text</span><span class="op">:</span></span>
<span id="cb28-963"><a href="#cb28-963" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Sources: (c)OpenStreetMap and contributors, INSEE, IGN, 2022</span><span class="sc">\n</span><span class="st">Realisation: Ronan Ysebaert, 2022"</span></span>
<span id="cb28-964"><a href="#cb28-964" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb28-965"><a href="#cb28-965" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb28-966"><a href="#cb28-966" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-6-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-6-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-6-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-6-4" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-6-5" data-nodetype="declaration">

</div>
</div>
</div>
</div>
</section>
<section id="nearest-wall" class="level2">
<h2 class="anchored" data-anchor-id="nearest-wall">Nearest wall</h2>
<p>The nearest climbing area by bike from each populated IRIS by wall manager: private or associative (FSGT or FFME).</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29" data-startfrom="974" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 973;"><span id="cb29-974"><a href="#cb29-974" aria-hidden="true" tabindex="-1"></a><span class="co">// Categorical map with tooltips</span></span>
<span id="cb29-975"><a href="#cb29-975" aria-hidden="true" tabindex="-1"></a>map2 <span class="op">=</span> bertin<span class="op">.</span><span class="fu">draw</span>({</span>
<span id="cb29-976"><a href="#cb29-976" aria-hidden="true" tabindex="-1"></a>  <span class="dt">params</span><span class="op">:</span> {</span>
<span id="cb29-977"><a href="#cb29-977" aria-hidden="true" tabindex="-1"></a>    <span class="dt">width</span><span class="op">:</span> <span class="dv">750</span><span class="op">,</span></span>
<span id="cb29-978"><a href="#cb29-978" aria-hidden="true" tabindex="-1"></a>    <span class="dt">projection</span><span class="op">:</span> lambert93<span class="op">,</span></span>
<span id="cb29-979"><a href="#cb29-979" aria-hidden="true" tabindex="-1"></a>    <span class="dt">extent</span><span class="op">:</span> com</span>
<span id="cb29-980"><a href="#cb29-980" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb29-981"><a href="#cb29-981" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-982"><a href="#cb29-982" aria-hidden="true" tabindex="-1"></a>  <span class="dt">layers</span><span class="op">:</span> [</span>
<span id="cb29-983"><a href="#cb29-983" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb29-984"><a href="#cb29-984" aria-hidden="true" tabindex="-1"></a>      <span class="dt">geojson</span><span class="op">:</span> poi<span class="op">,</span></span>
<span id="cb29-985"><a href="#cb29-985" aria-hidden="true" tabindex="-1"></a>      <span class="dt">symbol_size</span><span class="op">:</span> <span class="dv">100</span><span class="op">,</span></span>
<span id="cb29-986"><a href="#cb29-986" aria-hidden="true" tabindex="-1"></a>      <span class="dt">symbol</span><span class="op">:</span> <span class="st">"circle"</span><span class="op">,</span></span>
<span id="cb29-987"><a href="#cb29-987" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> <span class="st">"white"</span><span class="op">,</span></span>
<span id="cb29-988"><a href="#cb29-988" aria-hidden="true" tabindex="-1"></a>      <span class="dt">strokeWidth</span><span class="op">:</span> <span class="fl">2.5</span><span class="op">,</span></span>
<span id="cb29-989"><a href="#cb29-989" aria-hidden="true" tabindex="-1"></a>      <span class="dt">stroke</span><span class="op">:</span> {</span>
<span id="cb29-990"><a href="#cb29-990" aria-hidden="true" tabindex="-1"></a>        <span class="dt">type</span><span class="op">:</span> <span class="st">"typo"</span><span class="op">,</span></span>
<span id="cb29-991"><a href="#cb29-991" aria-hidden="true" tabindex="-1"></a>        <span class="dt">values</span><span class="op">:</span> <span class="st">"federation"</span><span class="op">,</span></span>
<span id="cb29-992"><a href="#cb29-992" aria-hidden="true" tabindex="-1"></a>        <span class="dt">colors</span><span class="op">:</span> [<span class="st">"#9990f0"</span><span class="op">,</span> <span class="st">"#fcb456"</span><span class="op">,</span> <span class="st">"#ba0b25"</span>]</span>
<span id="cb29-993"><a href="#cb29-993" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb29-994"><a href="#cb29-994" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb29-995"><a href="#cb29-995" aria-hidden="true" tabindex="-1"></a>      <span class="dt">tooltip</span><span class="op">:</span> {</span>
<span id="cb29-996"><a href="#cb29-996" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fields</span><span class="op">:</span> [<span class="st">"$name"</span><span class="op">,</span> <span class="st">"$federation"</span>]<span class="op">,</span></span>
<span id="cb29-997"><a href="#cb29-997" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fill</span><span class="op">:</span> [<span class="st">"black"</span><span class="op">,</span> <span class="st">"black"</span>]<span class="op">,</span></span>
<span id="cb29-998"><a href="#cb29-998" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fontWeight</span><span class="op">:</span> [<span class="st">"bold"</span><span class="op">,</span> <span class="st">"normal"</span>]<span class="op">,</span></span>
<span id="cb29-999"><a href="#cb29-999" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fontSize</span><span class="op">:</span> [<span class="dv">12</span><span class="op">,</span> <span class="dv">10</span>]<span class="op">,</span></span>
<span id="cb29-1000"><a href="#cb29-1000" aria-hidden="true" tabindex="-1"></a>        <span class="dt">col</span><span class="op">:</span> <span class="st">"white"</span></span>
<span id="cb29-1001"><a href="#cb29-1001" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb29-1002"><a href="#cb29-1002" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb29-1003"><a href="#cb29-1003" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb29-1004"><a href="#cb29-1004" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb29-1005"><a href="#cb29-1005" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"text"</span><span class="op">,</span></span>
<span id="cb29-1006"><a href="#cb29-1006" aria-hidden="true" tabindex="-1"></a>      <span class="dt">position</span><span class="op">:</span> <span class="st">"topright"</span><span class="op">,</span></span>
<span id="cb29-1007"><a href="#cb29-1007" aria-hidden="true" tabindex="-1"></a>      <span class="dt">text</span><span class="op">:</span> <span class="st">"Nearest climbing area</span><span class="sc">\n</span><span class="st">manager"</span><span class="op">,</span></span>
<span id="cb29-1008"><a href="#cb29-1008" aria-hidden="true" tabindex="-1"></a>      <span class="dt">frame_opacity</span><span class="op">:</span> <span class="fl">0.7</span><span class="op">,</span></span>
<span id="cb29-1009"><a href="#cb29-1009" aria-hidden="true" tabindex="-1"></a>      <span class="dt">baseline</span><span class="op">:</span> <span class="st">"hanging"</span><span class="op">,</span></span>
<span id="cb29-1010"><a href="#cb29-1010" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> <span class="st">"black"</span><span class="op">,</span></span>
<span id="cb29-1011"><a href="#cb29-1011" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fontSize</span><span class="op">:</span> <span class="dv">25</span><span class="op">,</span></span>
<span id="cb29-1012"><a href="#cb29-1012" aria-hidden="true" tabindex="-1"></a>      <span class="dt">margin</span><span class="op">:</span> <span class="dv">4</span><span class="op">,</span></span>
<span id="cb29-1013"><a href="#cb29-1013" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fontWeight</span><span class="op">:</span> <span class="st">"bold"</span><span class="op">,</span></span>
<span id="cb29-1014"><a href="#cb29-1014" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fontFamily</span><span class="op">:</span> <span class="st">"Ubuntu"</span></span>
<span id="cb29-1015"><a href="#cb29-1015" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb29-1016"><a href="#cb29-1016" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1017"><a href="#cb29-1017" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb29-1018"><a href="#cb29-1018" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"layer"</span><span class="op">,</span></span>
<span id="cb29-1019"><a href="#cb29-1019" aria-hidden="true" tabindex="-1"></a>      <span class="dt">geojson</span><span class="op">:</span> com<span class="op">,</span></span>
<span id="cb29-1020"><a href="#cb29-1020" aria-hidden="true" tabindex="-1"></a>      <span class="dt">stroke</span><span class="op">:</span> <span class="st">"black"</span><span class="op">,</span></span>
<span id="cb29-1021"><a href="#cb29-1021" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> <span class="st">"none"</span></span>
<span id="cb29-1022"><a href="#cb29-1022" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb29-1023"><a href="#cb29-1023" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1024"><a href="#cb29-1024" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb29-1025"><a href="#cb29-1025" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"layer"</span><span class="op">,</span></span>
<span id="cb29-1026"><a href="#cb29-1026" aria-hidden="true" tabindex="-1"></a>      <span class="dt">geojson</span><span class="op">:</span> iris<span class="op">,</span></span>
<span id="cb29-1027"><a href="#cb29-1027" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> {</span>
<span id="cb29-1028"><a href="#cb29-1028" aria-hidden="true" tabindex="-1"></a>        <span class="dt">type</span><span class="op">:</span> <span class="st">"typo"</span><span class="op">,</span></span>
<span id="cb29-1029"><a href="#cb29-1029" aria-hidden="true" tabindex="-1"></a>        <span class="dt">values</span><span class="op">:</span> <span class="st">"TYPE_STRUCT"</span><span class="op">,</span></span>
<span id="cb29-1030"><a href="#cb29-1030" aria-hidden="true" tabindex="-1"></a>        <span class="dt">strokeWidth</span><span class="op">:</span> <span class="fl">0.3</span><span class="op">,</span></span>
<span id="cb29-1031"><a href="#cb29-1031" aria-hidden="true" tabindex="-1"></a>        <span class="dt">colors</span><span class="op">:</span> [<span class="st">"#fcb45680"</span><span class="op">,</span> <span class="st">"#ba0b2580"</span><span class="op">,</span> <span class="st">"#9990f080"</span>]<span class="op">,</span></span>
<span id="cb29-1032"><a href="#cb29-1032" aria-hidden="true" tabindex="-1"></a>        <span class="dt">leg_title</span><span class="op">:</span> <span class="vs">`Manager name`</span><span class="op">,</span></span>
<span id="cb29-1033"><a href="#cb29-1033" aria-hidden="true" tabindex="-1"></a>        <span class="dt">leg_x</span><span class="op">:</span> <span class="dv">15</span><span class="op">,</span></span>
<span id="cb29-1034"><a href="#cb29-1034" aria-hidden="true" tabindex="-1"></a>        <span class="dt">leg_y</span><span class="op">:</span> <span class="dv">15</span><span class="op">,</span></span>
<span id="cb29-1035"><a href="#cb29-1035" aria-hidden="true" tabindex="-1"></a>        <span class="dt">col_missing</span><span class="op">:</span> <span class="st">"lightgrey"</span><span class="op">,</span></span>
<span id="cb29-1036"><a href="#cb29-1036" aria-hidden="true" tabindex="-1"></a>        <span class="dt">txt_missing</span><span class="op">:</span> <span class="st">"Non dedicated to housing"</span></span>
<span id="cb29-1037"><a href="#cb29-1037" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb29-1038"><a href="#cb29-1038" aria-hidden="true" tabindex="-1"></a>      <span class="dt">tooltip</span><span class="op">:</span> {</span>
<span id="cb29-1039"><a href="#cb29-1039" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fields</span><span class="op">:</span> [</span>
<span id="cb29-1040"><a href="#cb29-1040" aria-hidden="true" tabindex="-1"></a>          <span class="st">"$NOM_IRIS"</span><span class="op">,</span></span>
<span id="cb29-1041"><a href="#cb29-1041" aria-hidden="true" tabindex="-1"></a>          <span class="st">"$ALL_NAME"</span><span class="op">,</span></span>
<span id="cb29-1042"><a href="#cb29-1042" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Name of the nearest artificial climbing structure"</span></span>
<span id="cb29-1043"><a href="#cb29-1043" aria-hidden="true" tabindex="-1"></a>        ]<span class="op">,</span></span>
<span id="cb29-1044"><a href="#cb29-1044" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fill</span><span class="op">:</span> <span class="st">"white"</span><span class="op">,</span></span>
<span id="cb29-1045"><a href="#cb29-1045" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fontWeight</span><span class="op">:</span> [<span class="st">"bold"</span><span class="op">,</span> <span class="st">"normal"</span><span class="op">,</span> <span class="st">"normal"</span>]<span class="op">,</span></span>
<span id="cb29-1046"><a href="#cb29-1046" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fontSize</span><span class="op">:</span> [<span class="dv">11</span><span class="op">,</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">8</span>]<span class="op">,</span></span>
<span id="cb29-1047"><a href="#cb29-1047" aria-hidden="true" tabindex="-1"></a>        <span class="dt">col</span><span class="op">:</span> [<span class="st">"black"</span><span class="op">,</span> <span class="st">"black"</span><span class="op">,</span> <span class="st">"black"</span>]</span>
<span id="cb29-1048"><a href="#cb29-1048" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb29-1049"><a href="#cb29-1049" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb29-1050"><a href="#cb29-1050" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1051"><a href="#cb29-1051" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb29-1052"><a href="#cb29-1052" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"scalebar"</span><span class="op">,</span></span>
<span id="cb29-1053"><a href="#cb29-1053" aria-hidden="true" tabindex="-1"></a>      <span class="dt">units</span><span class="op">:</span> <span class="st">"miles"</span><span class="op">,</span></span>
<span id="cb29-1054"><a href="#cb29-1054" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb29-1055"><a href="#cb29-1055" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-1056"><a href="#cb29-1056" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb29-1057"><a href="#cb29-1057" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"footer"</span><span class="op">,</span></span>
<span id="cb29-1058"><a href="#cb29-1058" aria-hidden="true" tabindex="-1"></a>      <span class="dt">text</span><span class="op">:</span></span>
<span id="cb29-1059"><a href="#cb29-1059" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Sources: (c)OpenStreetMap and contributors, INSEE, IGN, 2022</span><span class="sc">\n</span><span class="st">Realisation: Ronan Ysebaert, 2022"</span></span>
<span id="cb29-1060"><a href="#cb29-1060" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb29-1061"><a href="#cb29-1061" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb29-1062"><a href="#cb29-1062" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="ojs-cell-7" data-nodetype="declaration">

</div>
</div>
</div>
</section>
<section id="time-to-climb" class="level2">
<h2 class="anchored" data-anchor-id="time-to-climb">Time to climb</h2>
<p>It displays the time by bike required to reach the nearest climbing area, for all structures or by manager type.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30" data-startfrom="1073" data-source-offset="-54"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1072;"><span id="cb30-1073"><a href="#cb30-1073" aria-hidden="true" tabindex="-1"></a>viewof ind2 <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">radio</span>([<span class="st">"ALL_TIME"</span><span class="op">,</span> <span class="st">"PRIV_TIME"</span><span class="op">,</span> <span class="st">"FSGT_TIME"</span><span class="op">,</span> <span class="st">"FFME_TIME"</span>]<span class="op">,</span></span>
<span id="cb30-1074"><a href="#cb30-1074" aria-hidden="true" tabindex="-1"></a>{<span class="dt">value</span><span class="op">:</span> <span class="st">"ALL_TIME"</span>})</span>
<span id="cb30-1075"><a href="#cb30-1075" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1076"><a href="#cb30-1076" aria-hidden="true" tabindex="-1"></a><span class="co">// Discretization method</span></span>
<span id="cb30-1077"><a href="#cb30-1077" aria-hidden="true" tabindex="-1"></a>viewof method2 <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">select</span>([<span class="st">"jenks"</span><span class="op">,</span> <span class="st">"q6"</span><span class="op">,</span> <span class="st">"quantile"</span><span class="op">,</span> <span class="st">"equal"</span><span class="op">,</span> <span class="st">"msd"</span>]<span class="op">,</span> {</span>
<span id="cb30-1078"><a href="#cb30-1078" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="st">"method"</span><span class="op">,</span></span>
<span id="cb30-1079"><a href="#cb30-1079" aria-hidden="true" tabindex="-1"></a>  <span class="dt">value</span><span class="op">:</span> <span class="st">"quantile"</span></span>
<span id="cb30-1080"><a href="#cb30-1080" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb30-1081"><a href="#cb30-1081" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1082"><a href="#cb30-1082" aria-hidden="true" tabindex="-1"></a><span class="co">// nbreaks</span></span>
<span id="cb30-1083"><a href="#cb30-1083" aria-hidden="true" tabindex="-1"></a>viewof nbreaks2 <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">3</span><span class="op">,</span> <span class="dv">9</span>]<span class="op">,</span> { <span class="dt">label</span><span class="op">:</span> <span class="st">"nbreaks"</span><span class="op">,</span> <span class="dt">step</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="dv">8</span> })</span>
<span id="cb30-1084"><a href="#cb30-1084" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1085"><a href="#cb30-1085" aria-hidden="true" tabindex="-1"></a><span class="co">// color palettes</span></span>
<span id="cb30-1086"><a href="#cb30-1086" aria-hidden="true" tabindex="-1"></a>viewof pal2 <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">select</span>(</span>
<span id="cb30-1087"><a href="#cb30-1087" aria-hidden="true" tabindex="-1"></a>  [<span class="st">"Blues"</span><span class="op">,</span>  <span class="st">"Greens"</span><span class="op">,</span>  <span class="st">"Greys"</span><span class="op">,</span> <span class="st">"Oranges"</span><span class="op">,</span> <span class="st">"Purples"</span><span class="op">,</span> <span class="st">"BuGn"</span><span class="op">,</span> <span class="st">"BuPu"</span><span class="op">,</span> <span class="st">"GnBu"</span><span class="op">,</span></span>
<span id="cb30-1088"><a href="#cb30-1088" aria-hidden="true" tabindex="-1"></a>  <span class="st">"OrRd"</span><span class="op">,</span> <span class="st">"PuBuGn"</span><span class="op">,</span> <span class="st">"PuBu"</span><span class="op">,</span> <span class="st">"PuRd"</span><span class="op">,</span> <span class="st">"RdPu"</span><span class="op">,</span> <span class="st">"YlGnBu"</span><span class="op">,</span> <span class="st">"YlGn"</span><span class="op">,</span> <span class="st">"YlOrBr"</span><span class="op">,</span> <span class="st">"YlOrRd"</span><span class="op">,</span></span>
<span id="cb30-1089"><a href="#cb30-1089" aria-hidden="true" tabindex="-1"></a>  <span class="st">"BrBG"</span><span class="op">,</span> <span class="st">"PRGn"</span><span class="op">,</span> <span class="st">"PiYG"</span><span class="op">,</span> <span class="st">"PuOr"</span><span class="op">,</span> <span class="st">"RdBu"</span><span class="op">,</span> <span class="st">"RdGy"</span><span class="op">,</span> <span class="st">"RdYlBu"</span><span class="op">,</span> <span class="st">"RdYlGn"</span><span class="op">,</span> <span class="st">"Spectral"</span> ]<span class="op">,</span></span>
<span id="cb30-1090"><a href="#cb30-1090" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb30-1091"><a href="#cb30-1091" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="st">"colors"</span><span class="op">,</span></span>
<span id="cb30-1092"><a href="#cb30-1092" aria-hidden="true" tabindex="-1"></a>    <span class="dt">value</span><span class="op">:</span> <span class="st">"RdYlBu"</span></span>
<span id="cb30-1093"><a href="#cb30-1093" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb30-1094"><a href="#cb30-1094" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb30-1095"><a href="#cb30-1095" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1096"><a href="#cb30-1096" aria-hidden="true" tabindex="-1"></a><span class="co">// Choropleth map with tooltips</span></span>
<span id="cb30-1097"><a href="#cb30-1097" aria-hidden="true" tabindex="-1"></a>map3 <span class="op">=</span> bertin<span class="op">.</span><span class="fu">draw</span>({</span>
<span id="cb30-1098"><a href="#cb30-1098" aria-hidden="true" tabindex="-1"></a>  <span class="dt">params</span><span class="op">:</span> {</span>
<span id="cb30-1099"><a href="#cb30-1099" aria-hidden="true" tabindex="-1"></a>    <span class="dt">width</span><span class="op">:</span> <span class="dv">750</span><span class="op">,</span></span>
<span id="cb30-1100"><a href="#cb30-1100" aria-hidden="true" tabindex="-1"></a>    <span class="dt">projection</span><span class="op">:</span> lambert93<span class="op">,</span></span>
<span id="cb30-1101"><a href="#cb30-1101" aria-hidden="true" tabindex="-1"></a>    <span class="dt">extent</span><span class="op">:</span> com</span>
<span id="cb30-1102"><a href="#cb30-1102" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb30-1103"><a href="#cb30-1103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1104"><a href="#cb30-1104" aria-hidden="true" tabindex="-1"></a>  <span class="dt">layers</span><span class="op">:</span> [</span>
<span id="cb30-1105"><a href="#cb30-1105" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb30-1106"><a href="#cb30-1106" aria-hidden="true" tabindex="-1"></a>      <span class="dt">geojson</span><span class="op">:</span> poi<span class="op">,</span></span>
<span id="cb30-1107"><a href="#cb30-1107" aria-hidden="true" tabindex="-1"></a>      <span class="dt">symbol_size</span><span class="op">:</span> <span class="dv">100</span><span class="op">,</span></span>
<span id="cb30-1108"><a href="#cb30-1108" aria-hidden="true" tabindex="-1"></a>      <span class="dt">symbol</span><span class="op">:</span> <span class="st">"circle"</span><span class="op">,</span></span>
<span id="cb30-1109"><a href="#cb30-1109" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> <span class="st">"white"</span><span class="op">,</span></span>
<span id="cb30-1110"><a href="#cb30-1110" aria-hidden="true" tabindex="-1"></a>      <span class="dt">strokeWidth</span><span class="op">:</span> <span class="fl">2.5</span><span class="op">,</span></span>
<span id="cb30-1111"><a href="#cb30-1111" aria-hidden="true" tabindex="-1"></a>      <span class="dt">stroke</span><span class="op">:</span> {</span>
<span id="cb30-1112"><a href="#cb30-1112" aria-hidden="true" tabindex="-1"></a>        <span class="dt">type</span><span class="op">:</span> <span class="st">"typo"</span><span class="op">,</span></span>
<span id="cb30-1113"><a href="#cb30-1113" aria-hidden="true" tabindex="-1"></a>        <span class="dt">values</span><span class="op">:</span> <span class="st">"federation"</span><span class="op">,</span></span>
<span id="cb30-1114"><a href="#cb30-1114" aria-hidden="true" tabindex="-1"></a>        <span class="dt">colors</span><span class="op">:</span> [<span class="st">"#9990f0"</span><span class="op">,</span> <span class="st">"#fcb456"</span><span class="op">,</span> <span class="st">"#ba0b25"</span>]</span>
<span id="cb30-1115"><a href="#cb30-1115" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb30-1116"><a href="#cb30-1116" aria-hidden="true" tabindex="-1"></a>      <span class="dt">tooltip</span><span class="op">:</span> {</span>
<span id="cb30-1117"><a href="#cb30-1117" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fields</span><span class="op">:</span> [<span class="st">"$name"</span><span class="op">,</span> <span class="st">"$federation"</span>]<span class="op">,</span></span>
<span id="cb30-1118"><a href="#cb30-1118" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fill</span><span class="op">:</span> [<span class="st">"black"</span><span class="op">,</span> <span class="st">"black"</span>]<span class="op">,</span></span>
<span id="cb30-1119"><a href="#cb30-1119" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fontWeight</span><span class="op">:</span> [<span class="st">"bold"</span><span class="op">,</span> <span class="st">"normal"</span>]<span class="op">,</span></span>
<span id="cb30-1120"><a href="#cb30-1120" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fontSize</span><span class="op">:</span> [<span class="dv">12</span><span class="op">,</span> <span class="dv">10</span>]<span class="op">,</span></span>
<span id="cb30-1121"><a href="#cb30-1121" aria-hidden="true" tabindex="-1"></a>        <span class="dt">col</span><span class="op">:</span> <span class="st">"white"</span></span>
<span id="cb30-1122"><a href="#cb30-1122" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb30-1123"><a href="#cb30-1123" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb30-1124"><a href="#cb30-1124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1125"><a href="#cb30-1125" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb30-1126"><a href="#cb30-1126" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"text"</span><span class="op">,</span></span>
<span id="cb30-1127"><a href="#cb30-1127" aria-hidden="true" tabindex="-1"></a>      <span class="dt">position</span><span class="op">:</span> <span class="st">"topright"</span><span class="op">,</span></span>
<span id="cb30-1128"><a href="#cb30-1128" aria-hidden="true" tabindex="-1"></a>      <span class="dt">text</span><span class="op">:</span> <span class="st">"Time to reach the nearest</span><span class="sc">\n</span><span class="st">artificial climbing area"</span><span class="op">,</span></span>
<span id="cb30-1129"><a href="#cb30-1129" aria-hidden="true" tabindex="-1"></a>      <span class="dt">frame_opacity</span><span class="op">:</span> <span class="fl">0.7</span><span class="op">,</span></span>
<span id="cb30-1130"><a href="#cb30-1130" aria-hidden="true" tabindex="-1"></a>      <span class="dt">baseline</span><span class="op">:</span> <span class="st">"hanging"</span><span class="op">,</span></span>
<span id="cb30-1131"><a href="#cb30-1131" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> <span class="st">"black"</span><span class="op">,</span></span>
<span id="cb30-1132"><a href="#cb30-1132" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fontSize</span><span class="op">:</span> <span class="dv">25</span><span class="op">,</span></span>
<span id="cb30-1133"><a href="#cb30-1133" aria-hidden="true" tabindex="-1"></a>      <span class="dt">margin</span><span class="op">:</span> <span class="dv">4</span><span class="op">,</span></span>
<span id="cb30-1134"><a href="#cb30-1134" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fontWeight</span><span class="op">:</span> <span class="st">"bold"</span><span class="op">,</span></span>
<span id="cb30-1135"><a href="#cb30-1135" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fontFamily</span><span class="op">:</span> <span class="st">"Ubuntu"</span></span>
<span id="cb30-1136"><a href="#cb30-1136" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb30-1137"><a href="#cb30-1137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1138"><a href="#cb30-1138" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb30-1139"><a href="#cb30-1139" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"layer"</span><span class="op">,</span></span>
<span id="cb30-1140"><a href="#cb30-1140" aria-hidden="true" tabindex="-1"></a>      <span class="dt">geojson</span><span class="op">:</span> com<span class="op">,</span></span>
<span id="cb30-1141"><a href="#cb30-1141" aria-hidden="true" tabindex="-1"></a>      <span class="dt">stroke</span><span class="op">:</span> <span class="st">"black"</span><span class="op">,</span></span>
<span id="cb30-1142"><a href="#cb30-1142" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> <span class="st">"none"</span></span>
<span id="cb30-1143"><a href="#cb30-1143" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb30-1144"><a href="#cb30-1144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1145"><a href="#cb30-1145" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb30-1146"><a href="#cb30-1146" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"layer"</span><span class="op">,</span></span>
<span id="cb30-1147"><a href="#cb30-1147" aria-hidden="true" tabindex="-1"></a>      <span class="dt">geojson</span><span class="op">:</span> iris<span class="op">,</span></span>
<span id="cb30-1148"><a href="#cb30-1148" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> {</span>
<span id="cb30-1149"><a href="#cb30-1149" aria-hidden="true" tabindex="-1"></a>        <span class="dt">type</span><span class="op">:</span> <span class="st">"choro"</span><span class="op">,</span></span>
<span id="cb30-1150"><a href="#cb30-1150" aria-hidden="true" tabindex="-1"></a>        <span class="dt">values</span><span class="op">:</span> ind2<span class="op">,</span></span>
<span id="cb30-1151"><a href="#cb30-1151" aria-hidden="true" tabindex="-1"></a>        <span class="dt">nbreaks</span><span class="op">:</span> <span class="dv">8</span><span class="op">,</span></span>
<span id="cb30-1152"><a href="#cb30-1152" aria-hidden="true" tabindex="-1"></a>        <span class="dt">method</span><span class="op">:</span> method2<span class="op">,</span></span>
<span id="cb30-1153"><a href="#cb30-1153" aria-hidden="true" tabindex="-1"></a>        <span class="dt">colors</span><span class="op">:</span> pal2<span class="op">,</span></span>
<span id="cb30-1154"><a href="#cb30-1154" aria-hidden="true" tabindex="-1"></a>        <span class="dt">leg_round</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span></span>
<span id="cb30-1155"><a href="#cb30-1155" aria-hidden="true" tabindex="-1"></a>        <span class="dt">leg_title</span><span class="op">:</span> <span class="vs">`By bike (minutes)`</span><span class="op">,</span></span>
<span id="cb30-1156"><a href="#cb30-1156" aria-hidden="true" tabindex="-1"></a>        <span class="dt">leg_x</span><span class="op">:</span> <span class="dv">15</span><span class="op">,</span></span>
<span id="cb30-1157"><a href="#cb30-1157" aria-hidden="true" tabindex="-1"></a>        <span class="dt">leg_y</span><span class="op">:</span> <span class="dv">15</span><span class="op">,</span></span>
<span id="cb30-1158"><a href="#cb30-1158" aria-hidden="true" tabindex="-1"></a>        <span class="dt">col_missing</span><span class="op">:</span> <span class="st">"lightgrey"</span><span class="op">,</span></span>
<span id="cb30-1159"><a href="#cb30-1159" aria-hidden="true" tabindex="-1"></a>        <span class="dt">txt_missing</span><span class="op">:</span> <span class="st">"Non dedicated to housing"</span></span>
<span id="cb30-1160"><a href="#cb30-1160" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb30-1161"><a href="#cb30-1161" aria-hidden="true" tabindex="-1"></a>      <span class="dt">tooltip</span><span class="op">:</span> {</span>
<span id="cb30-1162"><a href="#cb30-1162" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fields</span><span class="op">:</span> [</span>
<span id="cb30-1163"><a href="#cb30-1163" aria-hidden="true" tabindex="-1"></a>          <span class="st">"$NOM_IRIS"</span><span class="op">,</span></span>
<span id="cb30-1164"><a href="#cb30-1164" aria-hidden="true" tabindex="-1"></a>          <span class="st">"$NOM_COM"</span><span class="op">,</span></span>
<span id="cb30-1165"><a href="#cb30-1165" aria-hidden="true" tabindex="-1"></a>          <span class="st">"$ALL_TIME"</span><span class="op">,</span></span>
<span id="cb30-1166"><a href="#cb30-1166" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Bike time to the nearest Indoor climbing area"</span></span>
<span id="cb30-1167"><a href="#cb30-1167" aria-hidden="true" tabindex="-1"></a>        ]<span class="op">,</span></span>
<span id="cb30-1168"><a href="#cb30-1168" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fill</span><span class="op">:</span> <span class="st">"white"</span><span class="op">,</span></span>
<span id="cb30-1169"><a href="#cb30-1169" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fontWeight</span><span class="op">:</span> [<span class="st">"bold"</span><span class="op">,</span> <span class="st">"normal"</span><span class="op">,</span> <span class="st">"normal"</span><span class="op">,</span> <span class="st">"normal"</span>]<span class="op">,</span></span>
<span id="cb30-1170"><a href="#cb30-1170" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fontSize</span><span class="op">:</span> [<span class="dv">11</span><span class="op">,</span> <span class="dv">11</span><span class="op">,</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">8</span>]<span class="op">,</span></span>
<span id="cb30-1171"><a href="#cb30-1171" aria-hidden="true" tabindex="-1"></a>        <span class="dt">col</span><span class="op">:</span> [<span class="st">"black"</span><span class="op">,</span> <span class="st">"black"</span><span class="op">,</span> <span class="st">"black"</span><span class="op">,</span> <span class="st">"black"</span>]</span>
<span id="cb30-1172"><a href="#cb30-1172" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb30-1173"><a href="#cb30-1173" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb30-1174"><a href="#cb30-1174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1175"><a href="#cb30-1175" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb30-1176"><a href="#cb30-1176" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"scalebar"</span><span class="op">,</span></span>
<span id="cb30-1177"><a href="#cb30-1177" aria-hidden="true" tabindex="-1"></a>      <span class="dt">units</span><span class="op">:</span> <span class="st">"kilometers"</span><span class="op">,</span></span>
<span id="cb30-1178"><a href="#cb30-1178" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb30-1179"><a href="#cb30-1179" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-1180"><a href="#cb30-1180" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb30-1181"><a href="#cb30-1181" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"footer"</span><span class="op">,</span></span>
<span id="cb30-1182"><a href="#cb30-1182" aria-hidden="true" tabindex="-1"></a>      <span class="dt">text</span><span class="op">:</span></span>
<span id="cb30-1183"><a href="#cb30-1183" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Sources: (c)OpenStreetMap and contributors, INSEE, IGN, 2022</span><span class="sc">\n</span><span class="st">Realisation: Ronan Ysebaert, 2022"</span></span>
<span id="cb30-1184"><a href="#cb30-1184" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb30-1185"><a href="#cb30-1185" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb30-1186"><a href="#cb30-1186" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-8-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-8-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-8-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-8-4" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-8-5" data-nodetype="declaration">

</div>
</div>
</div>
</div>
</section>
<section id="climbing-in-15-minutes" class="level2">
<h2 class="anchored" data-anchor-id="climbing-in-15-minutes">Climbing in 15 minutes?</h2>
<p>The number of climbing areas reachable in 15 minutes by bike from the geometric centroid of each IRIS of the study area.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31" data-startfrom="1196" data-source-offset="-54"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1195;"><span id="cb31-1196"><a href="#cb31-1196" aria-hidden="true" tabindex="-1"></a>viewof ind4 <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">radio</span>([<span class="st">"N_15MN"</span><span class="op">,</span> <span class="st">"N_PRIV_15MN"</span><span class="op">,</span> <span class="st">"N_FSGT_15MN"</span><span class="op">,</span> <span class="st">"N_FFME_15MN"</span>]<span class="op">,</span></span>
<span id="cb31-1197"><a href="#cb31-1197" aria-hidden="true" tabindex="-1"></a>{<span class="dt">label</span><span class="op">:</span> <span class="st">"Number - all / private / FSGT / FFME - indoor climbing areas at less than 15 minutes"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="st">"N_15MN"</span>})</span>
<span id="cb31-1198"><a href="#cb31-1198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1199"><a href="#cb31-1199" aria-hidden="true" tabindex="-1"></a><span class="co">// color palettes</span></span>
<span id="cb31-1200"><a href="#cb31-1200" aria-hidden="true" tabindex="-1"></a>viewof pal4 <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">select</span>(</span>
<span id="cb31-1201"><a href="#cb31-1201" aria-hidden="true" tabindex="-1"></a>  [<span class="st">"Blues"</span><span class="op">,</span> <span class="st">"Greens"</span><span class="op">,</span> <span class="st">"Greys"</span><span class="op">,</span> <span class="st">"Oranges"</span><span class="op">,</span> <span class="st">"Purples"</span><span class="op">,</span> <span class="st">"BuGn"</span><span class="op">,</span> <span class="st">"BuPu"</span><span class="op">,</span> <span class="st">"GnBu"</span><span class="op">,</span> </span>
<span id="cb31-1202"><a href="#cb31-1202" aria-hidden="true" tabindex="-1"></a>  <span class="st">"OrRd"</span><span class="op">,</span> <span class="st">"PuBuGn"</span><span class="op">,</span> <span class="st">"PuBu"</span><span class="op">,</span> <span class="st">"PuRd"</span><span class="op">,</span> <span class="st">"RdPu"</span><span class="op">,</span></span>
<span id="cb31-1203"><a href="#cb31-1203" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">,</span></span>
<span id="cb31-1204"><a href="#cb31-1204" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb31-1205"><a href="#cb31-1205" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="st">"colors"</span><span class="op">,</span></span>
<span id="cb31-1206"><a href="#cb31-1206" aria-hidden="true" tabindex="-1"></a>    <span class="dt">value</span><span class="op">:</span> <span class="st">"Greens"</span></span>
<span id="cb31-1207"><a href="#cb31-1207" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb31-1208"><a href="#cb31-1208" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb31-1209"><a href="#cb31-1209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1210"><a href="#cb31-1210" aria-hidden="true" tabindex="-1"></a><span class="co">// choropleth map with tooltips</span></span>
<span id="cb31-1211"><a href="#cb31-1211" aria-hidden="true" tabindex="-1"></a>map4 <span class="op">=</span> bertin<span class="op">.</span><span class="fu">draw</span>({</span>
<span id="cb31-1212"><a href="#cb31-1212" aria-hidden="true" tabindex="-1"></a>  <span class="dt">params</span><span class="op">:</span> {</span>
<span id="cb31-1213"><a href="#cb31-1213" aria-hidden="true" tabindex="-1"></a>    <span class="dt">width</span><span class="op">:</span> <span class="dv">750</span><span class="op">,</span></span>
<span id="cb31-1214"><a href="#cb31-1214" aria-hidden="true" tabindex="-1"></a>    <span class="dt">projection</span><span class="op">:</span> lambert93<span class="op">,</span></span>
<span id="cb31-1215"><a href="#cb31-1215" aria-hidden="true" tabindex="-1"></a>    <span class="dt">extent</span><span class="op">:</span> com</span>
<span id="cb31-1216"><a href="#cb31-1216" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb31-1217"><a href="#cb31-1217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1218"><a href="#cb31-1218" aria-hidden="true" tabindex="-1"></a>  <span class="dt">layers</span><span class="op">:</span> [</span>
<span id="cb31-1219"><a href="#cb31-1219" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb31-1220"><a href="#cb31-1220" aria-hidden="true" tabindex="-1"></a>      <span class="dt">geojson</span><span class="op">:</span> poi<span class="op">,</span></span>
<span id="cb31-1221"><a href="#cb31-1221" aria-hidden="true" tabindex="-1"></a>      <span class="dt">symbol_size</span><span class="op">:</span> <span class="dv">100</span><span class="op">,</span></span>
<span id="cb31-1222"><a href="#cb31-1222" aria-hidden="true" tabindex="-1"></a>      <span class="dt">symbol</span><span class="op">:</span> <span class="st">"circle"</span><span class="op">,</span></span>
<span id="cb31-1223"><a href="#cb31-1223" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> <span class="st">"white"</span><span class="op">,</span></span>
<span id="cb31-1224"><a href="#cb31-1224" aria-hidden="true" tabindex="-1"></a>      <span class="dt">strokeWidth</span><span class="op">:</span> <span class="fl">2.5</span><span class="op">,</span></span>
<span id="cb31-1225"><a href="#cb31-1225" aria-hidden="true" tabindex="-1"></a>      <span class="dt">stroke</span><span class="op">:</span> {</span>
<span id="cb31-1226"><a href="#cb31-1226" aria-hidden="true" tabindex="-1"></a>        <span class="dt">type</span><span class="op">:</span> <span class="st">"typo"</span><span class="op">,</span></span>
<span id="cb31-1227"><a href="#cb31-1227" aria-hidden="true" tabindex="-1"></a>        <span class="dt">values</span><span class="op">:</span> <span class="st">"federation"</span><span class="op">,</span></span>
<span id="cb31-1228"><a href="#cb31-1228" aria-hidden="true" tabindex="-1"></a>        <span class="dt">colors</span><span class="op">:</span> [<span class="st">"#9990f0"</span><span class="op">,</span> <span class="st">"#fcb456"</span><span class="op">,</span> <span class="st">"#ba0b25"</span>]</span>
<span id="cb31-1229"><a href="#cb31-1229" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb31-1230"><a href="#cb31-1230" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb31-1231"><a href="#cb31-1231" aria-hidden="true" tabindex="-1"></a>      <span class="dt">tooltip</span><span class="op">:</span> {</span>
<span id="cb31-1232"><a href="#cb31-1232" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fields</span><span class="op">:</span> [<span class="st">"$name"</span><span class="op">,</span> <span class="st">"$federation"</span>]<span class="op">,</span></span>
<span id="cb31-1233"><a href="#cb31-1233" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fill</span><span class="op">:</span> [<span class="st">"black"</span><span class="op">,</span> <span class="st">"black"</span>]<span class="op">,</span></span>
<span id="cb31-1234"><a href="#cb31-1234" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fontWeight</span><span class="op">:</span> [<span class="st">"bold"</span><span class="op">,</span> <span class="st">"normal"</span>]<span class="op">,</span></span>
<span id="cb31-1235"><a href="#cb31-1235" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fontSize</span><span class="op">:</span> [<span class="dv">12</span><span class="op">,</span> <span class="dv">10</span>]<span class="op">,</span></span>
<span id="cb31-1236"><a href="#cb31-1236" aria-hidden="true" tabindex="-1"></a>        <span class="dt">col</span><span class="op">:</span> <span class="st">"white"</span></span>
<span id="cb31-1237"><a href="#cb31-1237" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb31-1238"><a href="#cb31-1238" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb31-1239"><a href="#cb31-1239" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb31-1240"><a href="#cb31-1240" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb31-1241"><a href="#cb31-1241" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"text"</span><span class="op">,</span></span>
<span id="cb31-1242"><a href="#cb31-1242" aria-hidden="true" tabindex="-1"></a>      <span class="dt">position</span><span class="op">:</span> <span class="st">"topright"</span><span class="op">,</span></span>
<span id="cb31-1243"><a href="#cb31-1243" aria-hidden="true" tabindex="-1"></a>      <span class="dt">text</span><span class="op">:</span> <span class="st">"Number of climbing areas reachable</span><span class="sc">\n</span><span class="st">in less than 15 minutes"</span><span class="op">,</span></span>
<span id="cb31-1244"><a href="#cb31-1244" aria-hidden="true" tabindex="-1"></a>      <span class="dt">frame_opacity</span><span class="op">:</span> <span class="fl">0.7</span><span class="op">,</span></span>
<span id="cb31-1245"><a href="#cb31-1245" aria-hidden="true" tabindex="-1"></a>      <span class="dt">baseline</span><span class="op">:</span> <span class="st">"hanging"</span><span class="op">,</span></span>
<span id="cb31-1246"><a href="#cb31-1246" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> <span class="st">"black"</span><span class="op">,</span></span>
<span id="cb31-1247"><a href="#cb31-1247" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fontSize</span><span class="op">:</span> <span class="dv">25</span><span class="op">,</span></span>
<span id="cb31-1248"><a href="#cb31-1248" aria-hidden="true" tabindex="-1"></a>      <span class="dt">margin</span><span class="op">:</span> <span class="dv">4</span><span class="op">,</span></span>
<span id="cb31-1249"><a href="#cb31-1249" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fontWeight</span><span class="op">:</span> <span class="st">"bold"</span><span class="op">,</span></span>
<span id="cb31-1250"><a href="#cb31-1250" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fontFamily</span><span class="op">:</span> <span class="st">"Ubuntu"</span></span>
<span id="cb31-1251"><a href="#cb31-1251" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb31-1252"><a href="#cb31-1252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1253"><a href="#cb31-1253" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb31-1254"><a href="#cb31-1254" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"layer"</span><span class="op">,</span></span>
<span id="cb31-1255"><a href="#cb31-1255" aria-hidden="true" tabindex="-1"></a>      <span class="dt">geojson</span><span class="op">:</span> com<span class="op">,</span></span>
<span id="cb31-1256"><a href="#cb31-1256" aria-hidden="true" tabindex="-1"></a>      <span class="dt">stroke</span><span class="op">:</span> <span class="st">"black"</span><span class="op">,</span></span>
<span id="cb31-1257"><a href="#cb31-1257" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> <span class="st">"none"</span></span>
<span id="cb31-1258"><a href="#cb31-1258" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb31-1259"><a href="#cb31-1259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1260"><a href="#cb31-1260" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb31-1261"><a href="#cb31-1261" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"layer"</span><span class="op">,</span></span>
<span id="cb31-1262"><a href="#cb31-1262" aria-hidden="true" tabindex="-1"></a>      <span class="dt">geojson</span><span class="op">:</span> iris<span class="op">,</span></span>
<span id="cb31-1263"><a href="#cb31-1263" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> {</span>
<span id="cb31-1264"><a href="#cb31-1264" aria-hidden="true" tabindex="-1"></a>        <span class="dt">type</span><span class="op">:</span> <span class="st">"choro"</span><span class="op">,</span></span>
<span id="cb31-1265"><a href="#cb31-1265" aria-hidden="true" tabindex="-1"></a>        <span class="dt">values</span><span class="op">:</span> ind4<span class="op">,</span></span>
<span id="cb31-1266"><a href="#cb31-1266" aria-hidden="true" tabindex="-1"></a>        <span class="dt">breaks</span><span class="op">:</span> [<span class="dv">1</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="dv">3</span><span class="op">,</span> <span class="dv">4</span><span class="op">,</span> <span class="dv">5</span><span class="op">,</span> <span class="dv">6</span><span class="op">,</span> <span class="dv">7</span><span class="op">,</span> <span class="dv">8</span><span class="op">,</span> <span class="dv">9</span>]<span class="op">,</span></span>
<span id="cb31-1267"><a href="#cb31-1267" aria-hidden="true" tabindex="-1"></a>        <span class="dt">colors</span><span class="op">:</span> pal4<span class="op">,</span></span>
<span id="cb31-1268"><a href="#cb31-1268" aria-hidden="true" tabindex="-1"></a>        <span class="dt">leg_round</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span></span>
<span id="cb31-1269"><a href="#cb31-1269" aria-hidden="true" tabindex="-1"></a>        <span class="dt">leg_title</span><span class="op">:</span> <span class="vs">`Structures numbers`</span><span class="op">,</span></span>
<span id="cb31-1270"><a href="#cb31-1270" aria-hidden="true" tabindex="-1"></a>        <span class="dt">leg_x</span><span class="op">:</span> <span class="dv">15</span><span class="op">,</span></span>
<span id="cb31-1271"><a href="#cb31-1271" aria-hidden="true" tabindex="-1"></a>        <span class="dt">leg_y</span><span class="op">:</span> <span class="dv">15</span><span class="op">,</span></span>
<span id="cb31-1272"><a href="#cb31-1272" aria-hidden="true" tabindex="-1"></a>        <span class="dt">col_missing</span><span class="op">:</span> <span class="st">"lightgrey"</span><span class="op">,</span></span>
<span id="cb31-1273"><a href="#cb31-1273" aria-hidden="true" tabindex="-1"></a>        <span class="dt">txt_missing</span><span class="op">:</span> <span class="st">"Non dedicated to housing"</span></span>
<span id="cb31-1274"><a href="#cb31-1274" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb31-1275"><a href="#cb31-1275" aria-hidden="true" tabindex="-1"></a>      <span class="dt">tooltip</span><span class="op">:</span> {</span>
<span id="cb31-1276"><a href="#cb31-1276" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fields</span><span class="op">:</span> [</span>
<span id="cb31-1277"><a href="#cb31-1277" aria-hidden="true" tabindex="-1"></a>          <span class="st">"$NOM_IRIS"</span><span class="op">,</span></span>
<span id="cb31-1278"><a href="#cb31-1278" aria-hidden="true" tabindex="-1"></a>          <span class="st">"$N_15MN"</span><span class="op">,</span></span>
<span id="cb31-1279"><a href="#cb31-1279" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Climbing areas at less than 15 minutes by bike"</span></span>
<span id="cb31-1280"><a href="#cb31-1280" aria-hidden="true" tabindex="-1"></a>        ]<span class="op">,</span></span>
<span id="cb31-1281"><a href="#cb31-1281" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fill</span><span class="op">:</span> <span class="st">"white"</span><span class="op">,</span></span>
<span id="cb31-1282"><a href="#cb31-1282" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fontWeight</span><span class="op">:</span> [<span class="st">"bold"</span><span class="op">,</span> <span class="st">"normal"</span><span class="op">,</span> <span class="st">"normal"</span>]<span class="op">,</span></span>
<span id="cb31-1283"><a href="#cb31-1283" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fontSize</span><span class="op">:</span> [<span class="dv">11</span><span class="op">,</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">8</span>]<span class="op">,</span></span>
<span id="cb31-1284"><a href="#cb31-1284" aria-hidden="true" tabindex="-1"></a>        <span class="dt">col</span><span class="op">:</span> [<span class="st">"black"</span><span class="op">,</span> <span class="st">"black"</span><span class="op">,</span> <span class="st">"black"</span>]</span>
<span id="cb31-1285"><a href="#cb31-1285" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb31-1286"><a href="#cb31-1286" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb31-1287"><a href="#cb31-1287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1288"><a href="#cb31-1288" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb31-1289"><a href="#cb31-1289" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"scalebar"</span><span class="op">,</span></span>
<span id="cb31-1290"><a href="#cb31-1290" aria-hidden="true" tabindex="-1"></a>      <span class="dt">units</span><span class="op">:</span> <span class="st">"miles"</span><span class="op">,</span></span>
<span id="cb31-1291"><a href="#cb31-1291" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb31-1292"><a href="#cb31-1292" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb31-1293"><a href="#cb31-1293" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb31-1294"><a href="#cb31-1294" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"footer"</span><span class="op">,</span></span>
<span id="cb31-1295"><a href="#cb31-1295" aria-hidden="true" tabindex="-1"></a>      <span class="dt">text</span><span class="op">:</span></span>
<span id="cb31-1296"><a href="#cb31-1296" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Sources: (c)OpenStreetMap and contributors, INSEE, IGN, 2022</span><span class="sc">\n</span><span class="st">Realisation: Ronan Ysebaert, 2022"</span></span>
<span id="cb31-1297"><a href="#cb31-1297" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb31-1298"><a href="#cb31-1298" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb31-1299"><a href="#cb31-1299" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-9-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-9-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-9-3" data-nodetype="declaration">

</div>
</div>
</div>
</div>
</section>
<section id="demographic-neighbourhood" class="level2">
<h2 class="anchored" data-anchor-id="demographic-neighbourhood">Demographic neighbourhood</h2>
<p>Visualize the demographic neighbourhood of each climbing area : IRIS population at less than 15 minutes by bike from each climbing area.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32" data-startfrom="1310" data-source-offset="-51"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1309;"><span id="cb32-1310"><a href="#cb32-1310" aria-hidden="true" tabindex="-1"></a>viewof k5 <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">1</span><span class="op">,</span> <span class="dv">100</span>]<span class="op">,</span> { <span class="dt">label</span><span class="op">:</span> <span class="st">"radius max"</span><span class="op">,</span> <span class="dt">step</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="dv">18</span> })</span>
<span id="cb32-1311"><a href="#cb32-1311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-1312"><a href="#cb32-1312" aria-hidden="true" tabindex="-1"></a><span class="co">// Proportional map and tooltips</span></span>
<span id="cb32-1313"><a href="#cb32-1313" aria-hidden="true" tabindex="-1"></a>map5 <span class="op">=</span> bertin<span class="op">.</span><span class="fu">draw</span>({</span>
<span id="cb32-1314"><a href="#cb32-1314" aria-hidden="true" tabindex="-1"></a>  <span class="dt">params</span><span class="op">:</span> {</span>
<span id="cb32-1315"><a href="#cb32-1315" aria-hidden="true" tabindex="-1"></a>    <span class="dt">width</span><span class="op">:</span> <span class="dv">750</span><span class="op">,</span></span>
<span id="cb32-1316"><a href="#cb32-1316" aria-hidden="true" tabindex="-1"></a>    <span class="dt">projection</span><span class="op">:</span> lambert93<span class="op">,</span></span>
<span id="cb32-1317"><a href="#cb32-1317" aria-hidden="true" tabindex="-1"></a>    <span class="dt">extent</span><span class="op">:</span> com</span>
<span id="cb32-1318"><a href="#cb32-1318" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb32-1319"><a href="#cb32-1319" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-1320"><a href="#cb32-1320" aria-hidden="true" tabindex="-1"></a>  <span class="dt">layers</span><span class="op">:</span> [</span>
<span id="cb32-1321"><a href="#cb32-1321" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb32-1322"><a href="#cb32-1322" aria-hidden="true" tabindex="-1"></a>      <span class="dt">geojson</span><span class="op">:</span> poi<span class="op">,</span></span>
<span id="cb32-1323"><a href="#cb32-1323" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"bubble"</span><span class="op">,</span></span>
<span id="cb32-1324"><a href="#cb32-1324" aria-hidden="true" tabindex="-1"></a>      <span class="dt">k</span><span class="op">:</span> k5<span class="op">,</span></span>
<span id="cb32-1325"><a href="#cb32-1325" aria-hidden="true" tabindex="-1"></a>      <span class="dt">values</span><span class="op">:</span> <span class="st">"SUM_POP18"</span><span class="op">,</span></span>
<span id="cb32-1326"><a href="#cb32-1326" aria-hidden="true" tabindex="-1"></a>      <span class="dt">leg_title</span><span class="op">:</span> <span class="vs">`Population in 15mn by bike neighbourhood`</span><span class="op">,</span> </span>
<span id="cb32-1327"><a href="#cb32-1327" aria-hidden="true" tabindex="-1"></a>      <span class="dt">leg_x</span><span class="op">:</span> <span class="dv">15</span><span class="op">,</span></span>
<span id="cb32-1328"><a href="#cb32-1328" aria-hidden="true" tabindex="-1"></a>      <span class="dt">leg_y</span><span class="op">:</span> <span class="dv">15</span><span class="op">,</span></span>
<span id="cb32-1329"><a href="#cb32-1329" aria-hidden="true" tabindex="-1"></a>      <span class="dt">leg_round</span><span class="op">:</span> <span class="op">-</span><span class="dv">2</span><span class="op">,</span></span>
<span id="cb32-1330"><a href="#cb32-1330" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> {</span>
<span id="cb32-1331"><a href="#cb32-1331" aria-hidden="true" tabindex="-1"></a>        <span class="dt">type</span><span class="op">:</span> <span class="st">"typo"</span><span class="op">,</span></span>
<span id="cb32-1332"><a href="#cb32-1332" aria-hidden="true" tabindex="-1"></a>        <span class="dt">values</span><span class="op">:</span> <span class="st">"federation"</span><span class="op">,</span></span>
<span id="cb32-1333"><a href="#cb32-1333" aria-hidden="true" tabindex="-1"></a>        <span class="dt">colors</span><span class="op">:</span> [<span class="st">"#9990f0"</span><span class="op">,</span> <span class="st">"#fcb456"</span><span class="op">,</span> <span class="st">"#ba0b25"</span>]<span class="op">,</span></span>
<span id="cb32-1334"><a href="#cb32-1334" aria-hidden="true" tabindex="-1"></a>        <span class="dt">leg_title</span><span class="op">:</span> <span class="vs">`Wall's managers`</span><span class="op">,</span></span>
<span id="cb32-1335"><a href="#cb32-1335" aria-hidden="true" tabindex="-1"></a>        <span class="dt">leg_x</span><span class="op">:</span> <span class="dv">600</span><span class="op">,</span></span>
<span id="cb32-1336"><a href="#cb32-1336" aria-hidden="true" tabindex="-1"></a>        <span class="dt">leg_y</span><span class="op">:</span> <span class="dv">550</span></span>
<span id="cb32-1337"><a href="#cb32-1337" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb32-1338"><a href="#cb32-1338" aria-hidden="true" tabindex="-1"></a>      <span class="dt">strokeWidth</span><span class="op">:</span> <span class="fl">2.5</span><span class="op">,</span></span>
<span id="cb32-1339"><a href="#cb32-1339" aria-hidden="true" tabindex="-1"></a>      <span class="dt">stroke</span><span class="op">:</span> <span class="st">"white"</span><span class="op">,</span></span>
<span id="cb32-1340"><a href="#cb32-1340" aria-hidden="true" tabindex="-1"></a>      <span class="dt">tooltip</span><span class="op">:</span> {</span>
<span id="cb32-1341"><a href="#cb32-1341" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fields</span><span class="op">:</span> [<span class="st">"$name"</span><span class="op">,</span> <span class="st">"$federation"</span><span class="op">,</span> <span class="st">"$SUM_POP18"</span><span class="op">,</span> <span class="st">"(Inhabitants in 15mn by bike neighbourhood)"</span>]<span class="op">,</span></span>
<span id="cb32-1342"><a href="#cb32-1342" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fill</span><span class="op">:</span> [<span class="st">"black"</span><span class="op">,</span> <span class="st">"black"</span><span class="op">,</span> <span class="st">"black"</span><span class="op">,</span> <span class="st">"black"</span>]<span class="op">,</span></span>
<span id="cb32-1343"><a href="#cb32-1343" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fontWeight</span><span class="op">:</span> [<span class="st">"bold"</span><span class="op">,</span> <span class="st">"normal"</span><span class="op">,</span> <span class="st">"normal"</span><span class="op">,</span> <span class="st">"normal"</span>]<span class="op">,</span></span>
<span id="cb32-1344"><a href="#cb32-1344" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fontSize</span><span class="op">:</span> [<span class="dv">14</span><span class="op">,</span> <span class="dv">12</span><span class="op">,</span> <span class="dv">12</span><span class="op">,</span> <span class="dv">10</span>]<span class="op">,</span></span>
<span id="cb32-1345"><a href="#cb32-1345" aria-hidden="true" tabindex="-1"></a>        <span class="dt">col</span><span class="op">:</span> <span class="st">"white"</span></span>
<span id="cb32-1346"><a href="#cb32-1346" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb32-1347"><a href="#cb32-1347" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb32-1348"><a href="#cb32-1348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-1349"><a href="#cb32-1349" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb32-1350"><a href="#cb32-1350" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"text"</span><span class="op">,</span></span>
<span id="cb32-1351"><a href="#cb32-1351" aria-hidden="true" tabindex="-1"></a>      <span class="dt">position</span><span class="op">:</span> <span class="st">"topright"</span><span class="op">,</span></span>
<span id="cb32-1352"><a href="#cb32-1352" aria-hidden="true" tabindex="-1"></a>      <span class="dt">text</span><span class="op">:</span> <span class="st">"Population</span><span class="sc">\n</span><span class="st">in climbing area's neighbourhood"</span><span class="op">,</span></span>
<span id="cb32-1353"><a href="#cb32-1353" aria-hidden="true" tabindex="-1"></a>      <span class="dt">frame_opacity</span><span class="op">:</span> <span class="fl">0.7</span><span class="op">,</span></span>
<span id="cb32-1354"><a href="#cb32-1354" aria-hidden="true" tabindex="-1"></a>      <span class="dt">baseline</span><span class="op">:</span> <span class="st">"hanging"</span><span class="op">,</span></span>
<span id="cb32-1355"><a href="#cb32-1355" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> <span class="st">"black"</span><span class="op">,</span></span>
<span id="cb32-1356"><a href="#cb32-1356" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fontSize</span><span class="op">:</span> <span class="dv">25</span><span class="op">,</span></span>
<span id="cb32-1357"><a href="#cb32-1357" aria-hidden="true" tabindex="-1"></a>      <span class="dt">margin</span><span class="op">:</span> <span class="dv">4</span><span class="op">,</span></span>
<span id="cb32-1358"><a href="#cb32-1358" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fontWeight</span><span class="op">:</span> <span class="st">"bold"</span><span class="op">,</span></span>
<span id="cb32-1359"><a href="#cb32-1359" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fontFamily</span><span class="op">:</span> <span class="st">"Ubuntu"</span></span>
<span id="cb32-1360"><a href="#cb32-1360" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb32-1361"><a href="#cb32-1361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-1362"><a href="#cb32-1362" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb32-1363"><a href="#cb32-1363" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"layer"</span><span class="op">,</span></span>
<span id="cb32-1364"><a href="#cb32-1364" aria-hidden="true" tabindex="-1"></a>      <span class="dt">geojson</span><span class="op">:</span> com<span class="op">,</span></span>
<span id="cb32-1365"><a href="#cb32-1365" aria-hidden="true" tabindex="-1"></a>      <span class="dt">stroke</span><span class="op">:</span> <span class="st">"black"</span><span class="op">,</span></span>
<span id="cb32-1366"><a href="#cb32-1366" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> <span class="st">"none"</span></span>
<span id="cb32-1367"><a href="#cb32-1367" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb32-1368"><a href="#cb32-1368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-1369"><a href="#cb32-1369" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb32-1370"><a href="#cb32-1370" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"layer"</span><span class="op">,</span></span>
<span id="cb32-1371"><a href="#cb32-1371" aria-hidden="true" tabindex="-1"></a>      <span class="dt">geojson</span><span class="op">:</span> iris15<span class="op">,</span></span>
<span id="cb32-1372"><a href="#cb32-1372" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> <span class="st">"peachpuff"</span><span class="op">,</span></span>
<span id="cb32-1373"><a href="#cb32-1373" aria-hidden="true" tabindex="-1"></a>      <span class="dt">tooltip</span><span class="op">:</span> {</span>
<span id="cb32-1374"><a href="#cb32-1374" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fields</span><span class="op">:</span> [</span>
<span id="cb32-1375"><a href="#cb32-1375" aria-hidden="true" tabindex="-1"></a>          <span class="st">"$NOM_IRIS"</span><span class="op">,</span></span>
<span id="cb32-1376"><a href="#cb32-1376" aria-hidden="true" tabindex="-1"></a>          <span class="st">"$NOM_COM"</span><span class="op">,</span></span>
<span id="cb32-1377"><a href="#cb32-1377" aria-hidden="true" tabindex="-1"></a>          <span class="st">"$P18_POP"</span><span class="op">,</span></span>
<span id="cb32-1378"><a href="#cb32-1378" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Total population (2018)"</span></span>
<span id="cb32-1379"><a href="#cb32-1379" aria-hidden="true" tabindex="-1"></a>        ]<span class="op">,</span></span>
<span id="cb32-1380"><a href="#cb32-1380" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fill</span><span class="op">:</span> <span class="st">"white"</span><span class="op">,</span></span>
<span id="cb32-1381"><a href="#cb32-1381" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fontWeight</span><span class="op">:</span> [<span class="st">"bold"</span><span class="op">,</span> <span class="st">"normal"</span><span class="op">,</span> <span class="st">"normal"</span><span class="op">,</span> <span class="st">"normal"</span>]<span class="op">,</span></span>
<span id="cb32-1382"><a href="#cb32-1382" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fontSize</span><span class="op">:</span> [<span class="dv">11</span><span class="op">,</span> <span class="dv">11</span><span class="op">,</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">8</span>]<span class="op">,</span></span>
<span id="cb32-1383"><a href="#cb32-1383" aria-hidden="true" tabindex="-1"></a>        <span class="dt">col</span><span class="op">:</span> [<span class="st">"black"</span><span class="op">,</span> <span class="st">"black"</span><span class="op">,</span> <span class="st">"black"</span><span class="op">,</span> <span class="st">"black"</span>]</span>
<span id="cb32-1384"><a href="#cb32-1384" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb32-1385"><a href="#cb32-1385" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb32-1386"><a href="#cb32-1386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-1387"><a href="#cb32-1387" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb32-1388"><a href="#cb32-1388" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"scalebar"</span><span class="op">,</span></span>
<span id="cb32-1389"><a href="#cb32-1389" aria-hidden="true" tabindex="-1"></a>      <span class="dt">units</span><span class="op">:</span> <span class="st">"kilometers"</span><span class="op">,</span></span>
<span id="cb32-1390"><a href="#cb32-1390" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb32-1391"><a href="#cb32-1391" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb32-1392"><a href="#cb32-1392" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb32-1393"><a href="#cb32-1393" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"footer"</span><span class="op">,</span></span>
<span id="cb32-1394"><a href="#cb32-1394" aria-hidden="true" tabindex="-1"></a>      <span class="dt">text</span><span class="op">:</span></span>
<span id="cb32-1395"><a href="#cb32-1395" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Sources: (c)OpenStreetMap and contributors, INSEE, IGN, 2022</span><span class="sc">\n</span><span class="st">Realisation: Ronan Ysebaert, 2022"</span></span>
<span id="cb32-1396"><a href="#cb32-1396" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb32-1397"><a href="#cb32-1397" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb32-1398"><a href="#cb32-1398" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-10-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-10-2" data-nodetype="declaration">

</div>
</div>
</div>
</div>
</section>
<section id="income-neighbourhood" class="level2">
<h2 class="anchored" data-anchor-id="income-neighbourhood">Income neighbourhood</h2>
<p>Visualize the level of wealth of each climbing area neighbourhood : IRIS median income at less than 15 minutes by bike from a climbing area. User can choose the minimum income, average income or maximum income of the IRIS at less than 15 minutes.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33" data-startfrom="1409" data-source-offset="-54"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1408;"><span id="cb33-1409"><a href="#cb33-1409" aria-hidden="true" tabindex="-1"></a>viewof ind6 <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">radio</span>([<span class="st">"MIN_REV19"</span><span class="op">,</span> <span class="st">"MOY_REV19"</span><span class="op">,</span> <span class="st">"MAX_REV19"</span>]<span class="op">,</span> {<span class="dt">label</span><span class="op">:</span> <span class="st">"Min/average/max median income in a 15 minutes by bike neighbourhood"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="st">"MOY_REV19"</span>})</span>
<span id="cb33-1410"><a href="#cb33-1410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1411"><a href="#cb33-1411" aria-hidden="true" tabindex="-1"></a><span class="co">// Discretization method</span></span>
<span id="cb33-1412"><a href="#cb33-1412" aria-hidden="true" tabindex="-1"></a>viewof method6 <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">select</span>([<span class="st">"jenks"</span><span class="op">,</span> <span class="st">"q6"</span><span class="op">,</span> <span class="st">"quantile"</span><span class="op">,</span> <span class="st">"equal"</span><span class="op">,</span> <span class="st">"msd"</span>]<span class="op">,</span> {</span>
<span id="cb33-1413"><a href="#cb33-1413" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="st">"method"</span><span class="op">,</span></span>
<span id="cb33-1414"><a href="#cb33-1414" aria-hidden="true" tabindex="-1"></a>  <span class="dt">value</span><span class="op">:</span> <span class="st">"quantile"</span></span>
<span id="cb33-1415"><a href="#cb33-1415" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb33-1416"><a href="#cb33-1416" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1417"><a href="#cb33-1417" aria-hidden="true" tabindex="-1"></a><span class="co">// Nbreaks</span></span>
<span id="cb33-1418"><a href="#cb33-1418" aria-hidden="true" tabindex="-1"></a>viewof nbreaks6 <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">3</span><span class="op">,</span> <span class="dv">9</span>]<span class="op">,</span> { <span class="dt">label</span><span class="op">:</span> <span class="st">"nbreaks"</span><span class="op">,</span> <span class="dt">step</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="dv">6</span> })</span>
<span id="cb33-1419"><a href="#cb33-1419" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1420"><a href="#cb33-1420" aria-hidden="true" tabindex="-1"></a><span class="co">// Color palette</span></span>
<span id="cb33-1421"><a href="#cb33-1421" aria-hidden="true" tabindex="-1"></a>viewof pal6 <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">select</span>(</span>
<span id="cb33-1422"><a href="#cb33-1422" aria-hidden="true" tabindex="-1"></a>  [<span class="st">"Blues"</span><span class="op">,</span> <span class="st">"Greens"</span><span class="op">,</span> <span class="st">"Greys"</span><span class="op">,</span> <span class="st">"Oranges"</span><span class="op">,</span> <span class="st">"Purples"</span><span class="op">,</span> <span class="st">"BuGn"</span><span class="op">,</span> <span class="st">"BuPu"</span><span class="op">,</span> <span class="st">"GnBu"</span><span class="op">,</span></span>
<span id="cb33-1423"><a href="#cb33-1423" aria-hidden="true" tabindex="-1"></a>  <span class="st">"OrRd"</span><span class="op">,</span> <span class="st">"PuBuGn"</span><span class="op">,</span> <span class="st">"PuBu"</span><span class="op">,</span> <span class="st">"PuRd"</span><span class="op">,</span> <span class="st">"RdPu"</span><span class="op">,</span> <span class="st">"YlGnBu"</span><span class="op">,</span> <span class="st">"YlGn"</span><span class="op">,</span> <span class="st">"YlOrBr"</span><span class="op">,</span> </span>
<span id="cb33-1424"><a href="#cb33-1424" aria-hidden="true" tabindex="-1"></a>  <span class="st">"YlOrRd"</span><span class="op">,</span> <span class="st">"BrBG"</span><span class="op">,</span> <span class="st">"PRGn"</span><span class="op">,</span> <span class="st">"PiYG"</span><span class="op">,</span> <span class="st">"PuOr"</span><span class="op">,</span> <span class="st">"RdBu"</span><span class="op">,</span> <span class="st">"RdGy"</span><span class="op">,</span> <span class="st">"RdYlBu"</span><span class="op">,</span> <span class="st">"RdYlGn"</span><span class="op">,</span></span>
<span id="cb33-1425"><a href="#cb33-1425" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Spectral"</span></span>
<span id="cb33-1426"><a href="#cb33-1426" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">,</span></span>
<span id="cb33-1427"><a href="#cb33-1427" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb33-1428"><a href="#cb33-1428" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="st">"colors"</span><span class="op">,</span></span>
<span id="cb33-1429"><a href="#cb33-1429" aria-hidden="true" tabindex="-1"></a>    <span class="dt">value</span><span class="op">:</span> <span class="st">"PuOr"</span></span>
<span id="cb33-1430"><a href="#cb33-1430" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb33-1431"><a href="#cb33-1431" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb33-1432"><a href="#cb33-1432" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1433"><a href="#cb33-1433" aria-hidden="true" tabindex="-1"></a><span class="co">// IRIS layer opacity</span></span>
<span id="cb33-1434"><a href="#cb33-1434" aria-hidden="true" tabindex="-1"></a>viewof opacity6 <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span> {<span class="dt">label</span><span class="op">:</span> <span class="st">"IRIS income opacity"</span><span class="op">,</span> <span class="dt">step</span><span class="op">:</span> <span class="fl">0.1</span>})</span>
<span id="cb33-1435"><a href="#cb33-1435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1436"><a href="#cb33-1436" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1437"><a href="#cb33-1437" aria-hidden="true" tabindex="-1"></a><span class="co">// Resulting map with a lot of things :) </span></span>
<span id="cb33-1438"><a href="#cb33-1438" aria-hidden="true" tabindex="-1"></a>map6 <span class="op">=</span> bertin<span class="op">.</span><span class="fu">draw</span>({</span>
<span id="cb33-1439"><a href="#cb33-1439" aria-hidden="true" tabindex="-1"></a>  <span class="dt">params</span><span class="op">:</span> {</span>
<span id="cb33-1440"><a href="#cb33-1440" aria-hidden="true" tabindex="-1"></a>    <span class="dt">width</span><span class="op">:</span> <span class="dv">750</span><span class="op">,</span></span>
<span id="cb33-1441"><a href="#cb33-1441" aria-hidden="true" tabindex="-1"></a>    <span class="dt">projection</span><span class="op">:</span> lambert93<span class="op">,</span></span>
<span id="cb33-1442"><a href="#cb33-1442" aria-hidden="true" tabindex="-1"></a>    <span class="dt">extent</span><span class="op">:</span> com</span>
<span id="cb33-1443"><a href="#cb33-1443" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb33-1444"><a href="#cb33-1444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1445"><a href="#cb33-1445" aria-hidden="true" tabindex="-1"></a>  <span class="dt">layers</span><span class="op">:</span> [</span>
<span id="cb33-1446"><a href="#cb33-1446" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb33-1447"><a href="#cb33-1447" aria-hidden="true" tabindex="-1"></a>      <span class="dt">geojson</span><span class="op">:</span> poi<span class="op">,</span></span>
<span id="cb33-1448"><a href="#cb33-1448" aria-hidden="true" tabindex="-1"></a>      <span class="dt">symbol_size</span><span class="op">:</span> <span class="dv">300</span><span class="op">,</span></span>
<span id="cb33-1449"><a href="#cb33-1449" aria-hidden="true" tabindex="-1"></a>      <span class="dt">symbol</span><span class="op">:</span> <span class="st">"triangle"</span><span class="op">,</span></span>
<span id="cb33-1450"><a href="#cb33-1450" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> {</span>
<span id="cb33-1451"><a href="#cb33-1451" aria-hidden="true" tabindex="-1"></a>        <span class="dt">type</span><span class="op">:</span> <span class="st">"choro"</span><span class="op">,</span></span>
<span id="cb33-1452"><a href="#cb33-1452" aria-hidden="true" tabindex="-1"></a>        <span class="dt">values</span><span class="op">:</span> ind6<span class="op">,</span></span>
<span id="cb33-1453"><a href="#cb33-1453" aria-hidden="true" tabindex="-1"></a>        <span class="dt">nbreaks</span><span class="op">:</span> nbreaks6<span class="op">,</span></span>
<span id="cb33-1454"><a href="#cb33-1454" aria-hidden="true" tabindex="-1"></a>        <span class="dt">method</span><span class="op">:</span> method6<span class="op">,</span></span>
<span id="cb33-1455"><a href="#cb33-1455" aria-hidden="true" tabindex="-1"></a>        <span class="dt">colors</span><span class="op">:</span> pal6<span class="op">,</span></span>
<span id="cb33-1456"><a href="#cb33-1456" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb33-1457"><a href="#cb33-1457" aria-hidden="true" tabindex="-1"></a>      <span class="dt">strokeWidth</span><span class="op">:</span> <span class="fl">2.5</span><span class="op">,</span></span>
<span id="cb33-1458"><a href="#cb33-1458" aria-hidden="true" tabindex="-1"></a>      <span class="dt">stroke</span><span class="op">:</span> {</span>
<span id="cb33-1459"><a href="#cb33-1459" aria-hidden="true" tabindex="-1"></a>        <span class="dt">type</span><span class="op">:</span> <span class="st">"typo"</span><span class="op">,</span></span>
<span id="cb33-1460"><a href="#cb33-1460" aria-hidden="true" tabindex="-1"></a>        <span class="dt">values</span><span class="op">:</span> <span class="st">"federation"</span><span class="op">,</span></span>
<span id="cb33-1461"><a href="#cb33-1461" aria-hidden="true" tabindex="-1"></a>        <span class="dt">colors</span><span class="op">:</span> [<span class="st">"#9990f0"</span><span class="op">,</span> <span class="st">"#fcb456"</span><span class="op">,</span> <span class="st">"#ba0b25"</span>]<span class="op">,</span></span>
<span id="cb33-1462"><a href="#cb33-1462" aria-hidden="true" tabindex="-1"></a>        <span class="dt">leg_title</span><span class="op">:</span> <span class="vs">`Wall's managers`</span><span class="op">,</span></span>
<span id="cb33-1463"><a href="#cb33-1463" aria-hidden="true" tabindex="-1"></a>        <span class="dt">leg_x</span><span class="op">:</span> <span class="dv">600</span><span class="op">,</span></span>
<span id="cb33-1464"><a href="#cb33-1464" aria-hidden="true" tabindex="-1"></a>        <span class="dt">leg_y</span><span class="op">:</span> <span class="dv">550</span></span>
<span id="cb33-1465"><a href="#cb33-1465" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb33-1466"><a href="#cb33-1466" aria-hidden="true" tabindex="-1"></a>      <span class="dt">tooltip</span><span class="op">:</span> {</span>
<span id="cb33-1467"><a href="#cb33-1467" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fields</span><span class="op">:</span> [<span class="st">"$name"</span><span class="op">,</span> <span class="st">"$federation"</span><span class="op">,</span> <span class="st">"$MIN_REV19"</span><span class="op">,</span> <span class="st">"(Minimum income in 15mn by bike neighbourhood)"</span><span class="op">,</span> <span class="st">"$MOY_REV19"</span><span class="op">,</span> <span class="st">"(Average income in 15mn by bike neighbourhood)"</span><span class="op">,</span> <span class="st">"$MAX_REV19"</span><span class="op">,</span> <span class="st">"(Average income in 15mn by bike neighbourhood)"</span>]<span class="op">,</span></span>
<span id="cb33-1468"><a href="#cb33-1468" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fill</span><span class="op">:</span> [<span class="st">"black"</span><span class="op">,</span> <span class="st">"black"</span><span class="op">,</span> <span class="st">"black"</span><span class="op">,</span> <span class="st">"black"</span><span class="op">,</span> <span class="st">"black"</span><span class="op">,</span> <span class="st">"black"</span><span class="op">,</span> <span class="st">"black"</span><span class="op">,</span> <span class="st">"black"</span>]<span class="op">,</span></span>
<span id="cb33-1469"><a href="#cb33-1469" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fontWeight</span><span class="op">:</span> [<span class="st">"bold"</span><span class="op">,</span> <span class="st">"normal"</span><span class="op">,</span> <span class="st">"normal"</span><span class="op">,</span> <span class="st">"normal"</span><span class="op">,</span> <span class="st">"normal"</span><span class="op">,</span> <span class="st">"normal"</span><span class="op">,</span> <span class="st">"normal"</span><span class="op">,</span> <span class="st">"normal"</span>]<span class="op">,</span></span>
<span id="cb33-1470"><a href="#cb33-1470" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fontSize</span><span class="op">:</span> [<span class="dv">14</span><span class="op">,</span> <span class="dv">12</span><span class="op">,</span> <span class="dv">12</span><span class="op">,</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">12</span><span class="op">,</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">12</span><span class="op">,</span> <span class="dv">10</span>]<span class="op">,</span></span>
<span id="cb33-1471"><a href="#cb33-1471" aria-hidden="true" tabindex="-1"></a>        <span class="dt">col</span><span class="op">:</span> <span class="st">"white"</span></span>
<span id="cb33-1472"><a href="#cb33-1472" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb33-1473"><a href="#cb33-1473" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb33-1474"><a href="#cb33-1474" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1475"><a href="#cb33-1475" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb33-1476"><a href="#cb33-1476" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"text"</span><span class="op">,</span></span>
<span id="cb33-1477"><a href="#cb33-1477" aria-hidden="true" tabindex="-1"></a>      <span class="dt">position</span><span class="op">:</span> <span class="st">"topright"</span><span class="op">,</span></span>
<span id="cb33-1478"><a href="#cb33-1478" aria-hidden="true" tabindex="-1"></a>      <span class="dt">text</span><span class="op">:</span> <span class="st">"Income</span><span class="sc">\n</span><span class="st">in climbing area's neighbourhood"</span><span class="op">,</span></span>
<span id="cb33-1479"><a href="#cb33-1479" aria-hidden="true" tabindex="-1"></a>      <span class="dt">frame_opacity</span><span class="op">:</span> <span class="fl">0.7</span><span class="op">,</span></span>
<span id="cb33-1480"><a href="#cb33-1480" aria-hidden="true" tabindex="-1"></a>      <span class="dt">baseline</span><span class="op">:</span> <span class="st">"hanging"</span><span class="op">,</span></span>
<span id="cb33-1481"><a href="#cb33-1481" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> <span class="st">"black"</span><span class="op">,</span></span>
<span id="cb33-1482"><a href="#cb33-1482" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fontSize</span><span class="op">:</span> <span class="dv">25</span><span class="op">,</span></span>
<span id="cb33-1483"><a href="#cb33-1483" aria-hidden="true" tabindex="-1"></a>      <span class="dt">margin</span><span class="op">:</span> <span class="dv">4</span><span class="op">,</span></span>
<span id="cb33-1484"><a href="#cb33-1484" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fontWeight</span><span class="op">:</span> <span class="st">"bold"</span><span class="op">,</span></span>
<span id="cb33-1485"><a href="#cb33-1485" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fontFamily</span><span class="op">:</span> <span class="st">"Ubuntu"</span></span>
<span id="cb33-1486"><a href="#cb33-1486" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb33-1487"><a href="#cb33-1487" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1488"><a href="#cb33-1488" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb33-1489"><a href="#cb33-1489" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"layer"</span><span class="op">,</span></span>
<span id="cb33-1490"><a href="#cb33-1490" aria-hidden="true" tabindex="-1"></a>      <span class="dt">geojson</span><span class="op">:</span> com<span class="op">,</span></span>
<span id="cb33-1491"><a href="#cb33-1491" aria-hidden="true" tabindex="-1"></a>      <span class="dt">stroke</span><span class="op">:</span> <span class="st">"black"</span><span class="op">,</span></span>
<span id="cb33-1492"><a href="#cb33-1492" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> <span class="st">"none"</span></span>
<span id="cb33-1493"><a href="#cb33-1493" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb33-1494"><a href="#cb33-1494" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1495"><a href="#cb33-1495" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb33-1496"><a href="#cb33-1496" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"layer"</span><span class="op">,</span></span>
<span id="cb33-1497"><a href="#cb33-1497" aria-hidden="true" tabindex="-1"></a>      <span class="dt">geojson</span><span class="op">:</span> iris15<span class="op">,</span></span>
<span id="cb33-1498"><a href="#cb33-1498" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> {</span>
<span id="cb33-1499"><a href="#cb33-1499" aria-hidden="true" tabindex="-1"></a>        <span class="dt">type</span><span class="op">:</span> <span class="st">"choro"</span><span class="op">,</span></span>
<span id="cb33-1500"><a href="#cb33-1500" aria-hidden="true" tabindex="-1"></a>        <span class="dt">values</span><span class="op">:</span> <span class="st">"DISP_MED19"</span><span class="op">,</span></span>
<span id="cb33-1501"><a href="#cb33-1501" aria-hidden="true" tabindex="-1"></a>        <span class="dt">nbreaks</span><span class="op">:</span> nbreaks6<span class="op">,</span></span>
<span id="cb33-1502"><a href="#cb33-1502" aria-hidden="true" tabindex="-1"></a>        <span class="dt">method</span><span class="op">:</span> method6<span class="op">,</span></span>
<span id="cb33-1503"><a href="#cb33-1503" aria-hidden="true" tabindex="-1"></a>        <span class="dt">colors</span><span class="op">:</span> pal6<span class="op">,</span></span>
<span id="cb33-1504"><a href="#cb33-1504" aria-hidden="true" tabindex="-1"></a>        <span class="dt">leg_round</span><span class="op">:</span> <span class="op">-</span><span class="dv">2</span><span class="op">,</span></span>
<span id="cb33-1505"><a href="#cb33-1505" aria-hidden="true" tabindex="-1"></a>        <span class="dt">leg_title</span><span class="op">:</span> <span class="vs">`Median income (2019, euros)</span><span class="sc">\n</span><span class="vs">for IRIS at less than 15km by bike</span><span class="sc">\n</span><span class="vs">from a climbing area`</span><span class="op">,</span></span>
<span id="cb33-1506"><a href="#cb33-1506" aria-hidden="true" tabindex="-1"></a>        <span class="dt">leg_x</span><span class="op">:</span> <span class="dv">15</span><span class="op">,</span></span>
<span id="cb33-1507"><a href="#cb33-1507" aria-hidden="true" tabindex="-1"></a>        <span class="dt">leg_y</span><span class="op">:</span> <span class="dv">15</span><span class="op">,</span></span>
<span id="cb33-1508"><a href="#cb33-1508" aria-hidden="true" tabindex="-1"></a>        <span class="dt">col_missing</span><span class="op">:</span> <span class="st">"lightgrey"</span><span class="op">,</span></span>
<span id="cb33-1509"><a href="#cb33-1509" aria-hidden="true" tabindex="-1"></a>        <span class="dt">txt_missing</span><span class="op">:</span> <span class="st">"Non dedicated to housing"</span></span>
<span id="cb33-1510"><a href="#cb33-1510" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb33-1511"><a href="#cb33-1511" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fillOpacity</span><span class="op">:</span> opacity6<span class="op">,</span></span>
<span id="cb33-1512"><a href="#cb33-1512" aria-hidden="true" tabindex="-1"></a>      <span class="dt">tooltip</span><span class="op">:</span> {</span>
<span id="cb33-1513"><a href="#cb33-1513" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fields</span><span class="op">:</span> [</span>
<span id="cb33-1514"><a href="#cb33-1514" aria-hidden="true" tabindex="-1"></a>          <span class="st">"$NOM_IRIS"</span><span class="op">,</span></span>
<span id="cb33-1515"><a href="#cb33-1515" aria-hidden="true" tabindex="-1"></a>          <span class="st">"$NOM_COM"</span><span class="op">,</span></span>
<span id="cb33-1516"><a href="#cb33-1516" aria-hidden="true" tabindex="-1"></a>          <span class="st">"$DISP_MED19"</span><span class="op">,</span></span>
<span id="cb33-1517"><a href="#cb33-1517" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Median income (2019, euros)"</span></span>
<span id="cb33-1518"><a href="#cb33-1518" aria-hidden="true" tabindex="-1"></a>        ]<span class="op">,</span></span>
<span id="cb33-1519"><a href="#cb33-1519" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fill</span><span class="op">:</span> <span class="st">"white"</span><span class="op">,</span></span>
<span id="cb33-1520"><a href="#cb33-1520" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fontWeight</span><span class="op">:</span> [<span class="st">"bold"</span><span class="op">,</span> <span class="st">"normal"</span><span class="op">,</span> <span class="st">"normal"</span><span class="op">,</span> <span class="st">"normal"</span>]<span class="op">,</span></span>
<span id="cb33-1521"><a href="#cb33-1521" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fontSize</span><span class="op">:</span> [<span class="dv">11</span><span class="op">,</span> <span class="dv">11</span><span class="op">,</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">8</span>]<span class="op">,</span></span>
<span id="cb33-1522"><a href="#cb33-1522" aria-hidden="true" tabindex="-1"></a>        <span class="dt">col</span><span class="op">:</span> [<span class="st">"black"</span><span class="op">,</span> <span class="st">"black"</span><span class="op">,</span> <span class="st">"black"</span><span class="op">,</span> <span class="st">"black"</span>]</span>
<span id="cb33-1523"><a href="#cb33-1523" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb33-1524"><a href="#cb33-1524" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb33-1525"><a href="#cb33-1525" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1526"><a href="#cb33-1526" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb33-1527"><a href="#cb33-1527" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"scalebar"</span><span class="op">,</span></span>
<span id="cb33-1528"><a href="#cb33-1528" aria-hidden="true" tabindex="-1"></a>      <span class="dt">units</span><span class="op">:</span> <span class="st">"kilometers"</span><span class="op">,</span></span>
<span id="cb33-1529"><a href="#cb33-1529" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb33-1530"><a href="#cb33-1530" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb33-1531"><a href="#cb33-1531" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb33-1532"><a href="#cb33-1532" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"footer"</span><span class="op">,</span></span>
<span id="cb33-1533"><a href="#cb33-1533" aria-hidden="true" tabindex="-1"></a>      <span class="dt">text</span><span class="op">:</span></span>
<span id="cb33-1534"><a href="#cb33-1534" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Sources: (c)OpenStreetMap and contributors, INSEE, IGN, 2022</span><span class="sc">\n</span><span class="st">Realisation: Ronan Ysebaert, 2022"</span></span>
<span id="cb33-1535"><a href="#cb33-1535" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb33-1536"><a href="#cb33-1536" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb33-1537"><a href="#cb33-1537" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-11-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-11-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-11-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-11-4" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-11-5" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-11-6" data-nodetype="declaration">

</div>
</div>
</div>
</div>
</section>
</section>
<section id="concluding-methodological-remarks" class="level1">
<h1>Concluding methodological remarks</h1>
<section id="extend-the-analysis" class="level2">
<h2 class="anchored" data-anchor-id="extend-the-analysis">Extend the analysis</h2>
<p>This methodological example showed a general methodology to combine institutional and crowd-sourced data to develop some simple indicators of accessibility to services of interest using open-source routing engines, and disseminate this with data visualizations frameworks. It is one possible implementation, among others. Other implementations could easily be envisaged.</p>
<ul>
<li><strong>Geographical coverage</strong>: The data preparation process presented above requires the definition of a geographical bounding box to extract OpenStreetMap points of interest (destinations of travel-time calculations) and an existing territorial division (the centroids being the origins of the travel-time calculations). This could be easily extented to other areas of interest, by modifying the Xmin, Xmax, Ymin and Ymax of the bounding box, or using other territorial divisions (a regular grid, for instance). The important things to consider is<br>
</li>
<li><strong>Use other points of interest</strong>: This example used the OpenStreetMap tag defined by the key-value <code>sport=climbing</code>. Other <a href="https://wiki.openstreetmap.org/wiki/Map_features">map features</a> could be investigated, such as <a href="https://wiki.openstreetmap.org/wiki/Key:amenity">amenities</a>, <a href="https://wiki.openstreetmap.org/wiki/Map_features#Tourism">tourism facilities</a> or <a href="https://wiki.openstreetmap.org/wiki/Map_features#Shop">shops</a>. The only element to consider is the geometric reference of the object in the OpenStreetMap database ; it could be nodes, ways or relations. In the case of sport=climbing tag, the <a href="https://wiki.openstreetmap.org/wiki/Tag%3Asport%3Dclimbing">OpenStreetMap Wiki</a> reminds that <em>sport=climbing should preferably applied to nodes for artificial climbing walls</em>, our case. If the tag combines nodes and areas, it requires also to extract polygons responding to the tag and transform it into points, checking if the information is not included twice in the OpenStreetMap database.<br>
</li>
<li><strong>Apply other profiles</strong>: In this example, the standard bike profile has been applied. The pedestrian and the car profile are also available and may be also used depending on the objective of the analysis. Whatever the profile used, it reminds important to the parameters of the profiles (<a href="https://github.com/Project-OSRM/osrm-backend/blob/master/profiles/car.lua">car here</a>, <a href="https://github.com/Project-OSRM/osrm-backend/blob/master/profiles/bicycle.lua">bike here</a> and <a href="https://github.com/Project-OSRM/osrm-backend/blob/master/profiles/foot.lua">pedestrian here</a>) to understand the calculations realized with routing engines, and their limitations. It is also possible to implement its <a href="https://github.com/Project-OSRM/osrm-backend/blob/master/docs/profiles.md">own profile</a>.</li>
</ul>
</section>
<section id="usage-precautions" class="level2">
<h2 class="anchored" data-anchor-id="usage-precautions">Usage precautions</h2>
<p>One persisting criticism made to OpenStreetMap is its lack of quality, mainly due to its general and contributive organisations implying a high heterogeneity of contribution practices. Known problems are due to <a href="https://wiki.openstreetmap.org/wiki/Accuracy">geometric accuracy</a> (geographical positioning of OSM objects), completeness <a href="https://wiki.openstreetmap.org/wiki/Accuracy">accuracy</a> and <a href="https://wiki.openstreetmap.org/wiki/Completeness">completeness</a> (missing information, not up-to-date) or problems due to the <a href="https://wiki.openstreetmap.org/wiki/Category:Tagging_Mistakes">tags</a> describing OSM objects (missing important tags, bad practices).</p>
<p>In that case, I made a personal survey to complete missing information (around 30 % of the information was missing) in OpenStreetMap database. It meant add some missing points in some cases, and in others to describe it with <a href="https://wiki.openstreetmap.org/wiki/Climbing">relevant climbing tags</a> identified in the OpenStreetMap Wiki. At the end, it is sure that the input information is not perfect and would require double-checks by the community, but we can argue that it was not worst than in the begginning.</p>
<p><strong>Whatever the use of OpenStreetMap you may made, taking a step back to these questions is very important to control</strong> <strong><em>a minima</em></strong> <strong>the input information used for the travel-time calculations</strong>.</p>
<p>Another point to have in mind is the default parameters of osrm profiles: bike profile does not take into account the slope of the road ; the car profile does not take into account the trafic congestion. It may have significant impact on the travel-time calculations.</p>
<p>Nevertheless, we argue that OpenStreetMap is a wonderful initiative and as we try to demonstrate in this notebook, it is not too difficult to produce innovative indicators and data visualizations using open-source database and libraries.</p>
<p>Enjoy !</p>
</section>
</section>
<section id="references" class="level1">

<!-- -->


</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" role="doc-bibliography">
<div id="ref-rmapshaper" class="csl-entry" role="doc-biblioentry">
Andy Teucher, Kenton Russell. 2022. <em>Rmapshaper: Client for ’Mapshaper’ for ’Geospatial’ Operations</em>. <a href="https://www.npmjs.com/package/geoverview">https://www.npmjs.com/package/geoverview</a>.
</div>
<div id="ref-osrm" class="csl-entry" role="doc-biblioentry">
Giraud, Timothée. 2022. <em>Osrm: Interface Between r and the OpenStreetMap-Based Routing Service OSRM</em>. <a href="https://CRAN.R-project.org/package=osrm">https://CRAN.R-project.org/package=osrm</a>.
</div>
<div id="ref-bertin" class="csl-entry" role="doc-biblioentry">
Lambert, Nicolas. 2022a. <em>Bertin.js: A JavaScript Library for Visualizing Geospatial Data and Make Thematic Maps for the Web</em>. <a href="https://www.npmjs.com/package/bertin">https://www.npmjs.com/package/bertin</a>.
</div>
<div id="ref-geoverview" class="csl-entry" role="doc-biblioentry">
———. 2022b. <em>Geoverview.js: A Tool for Giving a Quick and Easy Geographic Overview of Any Geojson</em>. <a href="https://www.npmjs.com/package/geoverview">https://www.npmjs.com/package/geoverview</a>.
</div>
<div id="ref-osmdata" class="csl-entry" role="doc-biblioentry">
Mark Padgham, Robin Lovelace, Bob Rudis. 2022. <em>Osmdata: Import ‘OpenStreetMap‘ Data as Simple Features of Spatial Objects</em>. <a href="https://CRAN.R-project.org/package=osmdata">https://CRAN.R-project.org/package=osmdata</a>.
</div>
</div></section><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{ysebaert2022,
  author = {Ronan Ysebaert},
  title = {OSRM {Travel-time} Calculation with {R} and Data
    Visualization with {Observable}},
  date = {2022-06},
  langid = {en}
}
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-ysebaert2022" class="csl-entry quarto-appendix-citeas" role="doc-biblioentry">
Ronan Ysebaert. 2022. <span>“OSRM Travel-Time Calculation with R and
Data Visualization with Observable.”</span> June 2022.
</div></div></section></div></main>
<!-- /main column -->

<script type="ojs-module-contents">
{"contents":[{"methodName":"interpret","cellName":"ojs-cell-1","inline":false,"source":"iris = FileAttachment(\"data-conso/iris.geojson\").json()\npoi = FileAttachment(\"data-conso/poi.geojson\").json()\ncom = FileAttachment(\"data-conso/com.geojson\").json()\niris15 = FileAttachment(\"data-conso/iris15.geojson\").json()\n"},{"methodName":"interpret","cellName":"ojs-cell-2","inline":false,"source":"bertin = require('bertin@0.9.16')\nview = require(\"geoverview@1.2\").then((f) => f.view)\n"},{"methodName":"interpret","cellName":"ojs-cell-3","inline":false,"source":"data = new Map([\n  [\"Climbing areas (dots)\", poi],\n  [\"IRIS (polygons)\", iris],\n  [\"Layout municipalities (polygons)\", com]\n])\nviewof geojson = Inputs.select(data, { label: \"Select a geojson\" })\nviewof style = Inputs.select([\"voyager\", \"night\", \"fulldark\",\"positron\",\"icgc\",\"osmbright\",\"hibrid\"], { label: \"Select a style\" })\nmap = view(geojson, {\n  style: style\n})\n"},{"methodName":"interpret","cellName":"ojs-cell-4","inline":false,"source":"Inputs.table(iris.features.map((d) => d.properties))\n"},{"methodName":"interpret","cellName":"ojs-cell-5","inline":false,"source":"Inputs.table(poi.features.map((d) => d.properties))\n"},{"methodName":"interpret","cellName":"ojs-cell-6","inline":false,"source":"//Manage map projection\nlambert93 = \"+proj=lcc +lat_1=49 +lat_2=44 +lat_0=46.5 +lon_0=3 +x_0=700000 +y_0=6600000 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs\"\n\n// Map parameters to play with it\nviewof ind = Inputs.radio([\"climbing_length\", \"climbing_routes\"], {label: \"Wall height / Number of routes\", value: \"climbing_length\"})\nviewof k = Inputs.range([10, 300], { label: \"Spikes height\", step: 1, value: 90 })\nviewof w = Inputs.range([2, 30], { label: \"Spikes / dots width\", step: 1, value: 15 })\n\n// Spike map with tooltips\nmap1 = bertin.draw({\n  params: {\n    width: 750,\n    projection: lambert93,\n    extent: com\n  },\n\n  layers: [\n    {\n      type: \"spikes\",\n      geojson: poi,\n      values: ind,\n      fillOpacity: 0.2,\n      k: k,\n      w: w,\n      fill: {\n        type: \"typo\",\n        values: \"federation\",\n        colors: [\"#9990f0\", \"#fcb456\", \"#ba0b25\"],\n        leg_title: `Wall's managers`,\n        leg_x: 600,\n        leg_y: 550\n      },\n      stroke: {\n        type: \"typo\",\n        values: \"federation\",\n        colors: [\"#9990f0\", \"#fcb456\", \"#ba0b25\"]\n      },\n      leg_x: 15,\n      leg_y: 15,\n      leg_round: 0,\n      leg_title: `Height (meters) or routes number`,\n      tooltip: {\n        fields: [\n          \"$name\",\n          \"$climbing_length\",\n          \"(height in meters)\",\n          \"$climbing_routes\",\n          \"(nb. routes)\",\n          \"$federation\",\n          \"(manager)\"\n        ],\n        fill: [\"black\", \"black\", \"black\", \"black\", \"black\", \"black\", \"black\"],\n        fontWeight: [\n          \"bold\",\n          \"normal\",\n          \"normal\",\n          \"normal\",\n          \"normal\",\n          \"normal\",\n          \"normal\"\n        ],\n        fontSize: [14, 12, 10, 12, 10, 12, 10],\n        col: \"white\"\n      }\n    },\n\n    {\n      geojson: poi,\n      symbol_size: 10 * w,\n      symbol: \"circle\",\n      fill: {\n        type: \"typo\",\n        values: \"climbing_type\",\n        colors: [\"white\", \"lightgrey\", \"grey\"],\n        leg_title: `Climbing type`,\n        leg_x: 600,\n        leg_y: 430\n      },\n      stroke: {\n        type: \"typo\",\n        values: \"federation\",\n        colors: [\"#9990f0\", \"#fcb456\", \"#ba0b25\"]\n      },\n      strokeWidth: 2,\n      tooltip: {\n        fields: [\"$name\", \"$climbing_type\"],\n        fill: [\"black\", \"black\"],\n        fontWeight: [\"bold\", \"normal\"],\n        fontSize: [12, 10],\n        col: \"white\"\n      }\n    },\n\n    {\n      type: \"text\",\n      position: \"topright\",\n      text: \"Climbing hot spots\",\n      frame_opacity: 0.7,\n      baseline: \"hanging\",\n      fill: \"black\",\n      fontSize: 25,\n      margin: 4,\n      fontWeight: \"bold\",\n      fontFamily: \"Ubuntu\"\n    },\n\n    {\n      type: \"layer\",\n      geojson: com,\n      stroke: \"white\",\n      fill: \"peachpuff\",\n      tooltip: [\"$NOM_COM\"]\n    },\n\n    {\n      type: \"scalebar\",\n      units: \"miles\"\n    },\n\n    {\n      type: \"footer\",\n      text:\n        \"Sources: (c)OpenStreetMap and contributors, INSEE, IGN, 2022\\nRealisation: Ronan Ysebaert, 2022\"\n    }\n  ]\n})\n"},{"methodName":"interpret","cellName":"ojs-cell-7","inline":false,"source":"// Categorical map with tooltips\nmap2 = bertin.draw({\n  params: {\n    width: 750,\n    projection: lambert93,\n    extent: com\n  },\n\n  layers: [\n    {\n      geojson: poi,\n      symbol_size: 100,\n      symbol: \"circle\",\n      fill: \"white\",\n      strokeWidth: 2.5,\n      stroke: {\n        type: \"typo\",\n        values: \"federation\",\n        colors: [\"#9990f0\", \"#fcb456\", \"#ba0b25\"]\n      },\n      \n      tooltip: {\n        fields: [\"$name\", \"$federation\"],\n        fill: [\"black\", \"black\"],\n        fontWeight: [\"bold\", \"normal\"],\n        fontSize: [12, 10],\n        col: \"white\"\n      }\n    },\n      \n    {\n      type: \"text\",\n      position: \"topright\",\n      text: \"Nearest climbing area\\nmanager\",\n      frame_opacity: 0.7,\n      baseline: \"hanging\",\n      fill: \"black\",\n      fontSize: 25,\n      margin: 4,\n      fontWeight: \"bold\",\n      fontFamily: \"Ubuntu\"\n    },\n\n    {\n      type: \"layer\",\n      geojson: com,\n      stroke: \"black\",\n      fill: \"none\"\n    },\n\n    {\n      type: \"layer\",\n      geojson: iris,\n      fill: {\n        type: \"typo\",\n        values: \"TYPE_STRUCT\",\n        strokeWidth: 0.3,\n        colors: [\"#fcb45680\", \"#ba0b2580\", \"#9990f080\"],\n        leg_title: `Manager name`,\n        leg_x: 15,\n        leg_y: 15,\n        col_missing: \"lightgrey\",\n        txt_missing: \"Non dedicated to housing\"\n      },\n      tooltip: {\n        fields: [\n          \"$NOM_IRIS\",\n          \"$ALL_NAME\",\n          \"Name of the nearest artificial climbing structure\"\n        ],\n        fill: \"white\",\n        fontWeight: [\"bold\", \"normal\", \"normal\"],\n        fontSize: [11, 10, 8],\n        col: [\"black\", \"black\", \"black\"]\n      }\n    },\n\n    {\n      type: \"scalebar\",\n      units: \"miles\",\n    },\n    \n    {\n      type: \"footer\",\n      text:\n        \"Sources: (c)OpenStreetMap and contributors, INSEE, IGN, 2022\\nRealisation: Ronan Ysebaert, 2022\"\n    }\n  ]\n})\n"},{"methodName":"interpret","cellName":"ojs-cell-8","inline":false,"source":"// Map parameters to play with it\n// select indicator\nviewof ind2 = Inputs.radio([\"ALL_TIME\", \"PRIV_TIME\", \"FSGT_TIME\", \"FFME_TIME\"],\n{value: \"ALL_TIME\"})\n\n// Discretization method\nviewof method2 = Inputs.select([\"jenks\", \"q6\", \"quantile\", \"equal\", \"msd\"], {\n  label: \"method\",\n  value: \"quantile\"\n})\n\n// nbreaks\nviewof nbreaks2 = Inputs.range([3, 9], { label: \"nbreaks\", step: 1, value: 8 })\n\n// color palettes\nviewof pal2 = Inputs.select(\n  [\"Blues\",  \"Greens\",  \"Greys\", \"Oranges\", \"Purples\", \"BuGn\", \"BuPu\", \"GnBu\",\n  \"OrRd\", \"PuBuGn\", \"PuBu\", \"PuRd\", \"RdPu\", \"YlGnBu\", \"YlGn\", \"YlOrBr\", \"YlOrRd\",\n  \"BrBG\", \"PRGn\", \"PiYG\", \"PuOr\", \"RdBu\", \"RdGy\", \"RdYlBu\", \"RdYlGn\", \"Spectral\" ],\n  {\n    label: \"colors\",\n    value: \"RdYlBu\"\n  }\n)\n\n// Choropleth map with tooltips\nmap3 = bertin.draw({\n  params: {\n    width: 750,\n    projection: lambert93,\n    extent: com\n  },\n\n  layers: [\n    {\n      geojson: poi,\n      symbol_size: 100,\n      symbol: \"circle\",\n      fill: \"white\",\n      strokeWidth: 2.5,\n      stroke: {\n        type: \"typo\",\n        values: \"federation\",\n        colors: [\"#9990f0\", \"#fcb456\", \"#ba0b25\"]\n      },\n      tooltip: {\n        fields: [\"$name\", \"$federation\"],\n        fill: [\"black\", \"black\"],\n        fontWeight: [\"bold\", \"normal\"],\n        fontSize: [12, 10],\n        col: \"white\"\n      }\n    },\n\n    {\n      type: \"text\",\n      position: \"topright\",\n      text: \"Time to reach the nearest\\nartificial climbing area\",\n      frame_opacity: 0.7,\n      baseline: \"hanging\",\n      fill: \"black\",\n      fontSize: 25,\n      margin: 4,\n      fontWeight: \"bold\",\n      fontFamily: \"Ubuntu\"\n    },\n\n    {\n      type: \"layer\",\n      geojson: com,\n      stroke: \"black\",\n      fill: \"none\"\n    },\n\n    {\n      type: \"layer\",\n      geojson: iris,\n      fill: {\n        type: \"choro\",\n        values: ind2,\n        nbreaks: 8,\n        method: method2,\n        colors: pal2,\n        leg_round: 2,\n        leg_title: `By bike (minutes)`,\n        leg_x: 15,\n        leg_y: 15,\n        col_missing: \"lightgrey\",\n        txt_missing: \"Non dedicated to housing\"\n      },\n      tooltip: {\n        fields: [\n          \"$NOM_IRIS\",\n          \"$NOM_COM\",\n          \"$ALL_TIME\",\n          \"Bike time to the nearest Indoor climbing area\"\n        ],\n        fill: \"white\",\n        fontWeight: [\"bold\", \"normal\", \"normal\", \"normal\"],\n        fontSize: [11, 11, 10, 8],\n        col: [\"black\", \"black\", \"black\", \"black\"]\n      }\n    },\n\n    {\n      type: \"scalebar\",\n      units: \"kilometers\",\n    },\n    \n    {\n      type: \"footer\",\n      text:\n        \"Sources: (c)OpenStreetMap and contributors, INSEE, IGN, 2022\\nRealisation: Ronan Ysebaert, 2022\"\n    }\n  ]\n})\n"},{"methodName":"interpret","cellName":"ojs-cell-9","inline":false,"source":"// Map parameters to play with it\n// select indicator\nviewof ind4 = Inputs.radio([\"N_15MN\", \"N_PRIV_15MN\", \"N_FSGT_15MN\", \"N_FFME_15MN\"],\n{label: \"Number - all / private / FSGT / FFME - indoor climbing areas at less than 15 minutes\", value: \"N_15MN\"})\n\n// color palettes\nviewof pal4 = Inputs.select(\n  [\"Blues\", \"Greens\", \"Greys\", \"Oranges\", \"Purples\", \"BuGn\", \"BuPu\", \"GnBu\", \n  \"OrRd\", \"PuBuGn\", \"PuBu\", \"PuRd\", \"RdPu\",\n  ],\n  {\n    label: \"colors\",\n    value: \"Greens\"\n  }\n)\n\n// choropleth map with tooltips\nmap4 = bertin.draw({\n  params: {\n    width: 750,\n    projection: lambert93,\n    extent: com\n  },\n\n  layers: [\n    {\n      geojson: poi,\n      symbol_size: 100,\n      symbol: \"circle\",\n      fill: \"white\",\n      strokeWidth: 2.5,\n      stroke: {\n        type: \"typo\",\n        values: \"federation\",\n        colors: [\"#9990f0\", \"#fcb456\", \"#ba0b25\"]\n      },\n      \n      tooltip: {\n        fields: [\"$name\", \"$federation\"],\n        fill: [\"black\", \"black\"],\n        fontWeight: [\"bold\", \"normal\"],\n        fontSize: [12, 10],\n        col: \"white\"\n      }\n    },\n      \n    {\n      type: \"text\",\n      position: \"topright\",\n      text: \"Number of climbing areas reachable\\nin less than 15 minutes\",\n      frame_opacity: 0.7,\n      baseline: \"hanging\",\n      fill: \"black\",\n      fontSize: 25,\n      margin: 4,\n      fontWeight: \"bold\",\n      fontFamily: \"Ubuntu\"\n    },\n\n    {\n      type: \"layer\",\n      geojson: com,\n      stroke: \"black\",\n      fill: \"none\"\n    },\n\n    {\n      type: \"layer\",\n      geojson: iris,\n      fill: {\n        type: \"choro\",\n        values: ind4,\n        breaks: [1, 2, 3, 4, 5, 6, 7, 8, 9],\n        colors: pal4,\n        leg_round: 2,\n        leg_title: `Structures numbers`,\n        leg_x: 15,\n        leg_y: 15,\n        col_missing: \"lightgrey\",\n        txt_missing: \"Non dedicated to housing\"\n      },\n      tooltip: {\n        fields: [\n          \"$NOM_IRIS\",\n          \"$N_15MN\",\n          \"Climbing areas at less than 15 minutes by bike\"\n        ],\n        fill: \"white\",\n        fontWeight: [\"bold\", \"normal\", \"normal\"],\n        fontSize: [11, 10, 8],\n        col: [\"black\", \"black\", \"black\"]\n      }\n    },\n\n    {\n      type: \"scalebar\",\n      units: \"miles\",\n    },\n    \n    {\n      type: \"footer\",\n      text:\n        \"Sources: (c)OpenStreetMap and contributors, INSEE, IGN, 2022\\nRealisation: Ronan Ysebaert, 2022\"\n    }\n  ]\n})\n"},{"methodName":"interpret","cellName":"ojs-cell-10","inline":false,"source":"// Map parameters to play with it\n// Circle radius\nviewof k5 = Inputs.range([1, 100], { label: \"radius max\", step: 1, value: 18 })\n\n// Proportional map and tooltips\nmap5 = bertin.draw({\n  params: {\n    width: 750,\n    projection: lambert93,\n    extent: com\n  },\n\n  layers: [\n    {\n      geojson: poi,\n      type: \"bubble\",\n      k: k5,\n      values: \"SUM_POP18\",\n      leg_title: `Population in 15mn by bike neighbourhood`, \n      leg_x: 15,\n      leg_y: 15,\n      leg_round: -2,\n      fill: {\n        type: \"typo\",\n        values: \"federation\",\n        colors: [\"#9990f0\", \"#fcb456\", \"#ba0b25\"],\n        leg_title: `Wall's managers`,\n        leg_x: 600,\n        leg_y: 550\n      },\n      strokeWidth: 2.5,\n      stroke: \"white\",\n      tooltip: {\n        fields: [\"$name\", \"$federation\", \"$SUM_POP18\", \"(Inhabitants in 15mn by bike neighbourhood)\"],\n        fill: [\"black\", \"black\", \"black\", \"black\"],\n        fontWeight: [\"bold\", \"normal\", \"normal\", \"normal\"],\n        fontSize: [14, 12, 12, 10],\n        col: \"white\"\n      }\n    },\n\n    {\n      type: \"text\",\n      position: \"topright\",\n      text: \"Population\\nin climbing area's neighbourhood\",\n      frame_opacity: 0.7,\n      baseline: \"hanging\",\n      fill: \"black\",\n      fontSize: 25,\n      margin: 4,\n      fontWeight: \"bold\",\n      fontFamily: \"Ubuntu\"\n    },\n\n    {\n      type: \"layer\",\n      geojson: com,\n      stroke: \"black\",\n      fill: \"none\"\n    },\n\n    {\n      type: \"layer\",\n      geojson: iris15,\n      fill: \"peachpuff\",\n      tooltip: {\n        fields: [\n          \"$NOM_IRIS\",\n          \"$NOM_COM\",\n          \"$P18_POP\",\n          \"Total population (2018)\"\n        ],\n        fill: \"white\",\n        fontWeight: [\"bold\", \"normal\", \"normal\", \"normal\"],\n        fontSize: [11, 11, 10, 8],\n        col: [\"black\", \"black\", \"black\", \"black\"]\n      }\n    },\n\n    {\n      type: \"scalebar\",\n      units: \"kilometers\",\n    },\n    \n    {\n      type: \"footer\",\n      text:\n        \"Sources: (c)OpenStreetMap and contributors, INSEE, IGN, 2022\\nRealisation: Ronan Ysebaert, 2022\"\n    }\n  ]\n})\n\n"},{"methodName":"interpret","cellName":"ojs-cell-11","inline":false,"source":"// Map parameters to play with it\n// select indicator\nviewof ind6 = Inputs.radio([\"MIN_REV19\", \"MOY_REV19\", \"MAX_REV19\"], {label: \"Min/average/max median income in a 15 minutes by bike neighbourhood\", value: \"MOY_REV19\"})\n\n// Discretization method\nviewof method6 = Inputs.select([\"jenks\", \"q6\", \"quantile\", \"equal\", \"msd\"], {\n  label: \"method\",\n  value: \"quantile\"\n})\n\n// Nbreaks\nviewof nbreaks6 = Inputs.range([3, 9], { label: \"nbreaks\", step: 1, value: 6 })\n\n// Color palette\nviewof pal6 = Inputs.select(\n  [\"Blues\", \"Greens\", \"Greys\", \"Oranges\", \"Purples\", \"BuGn\", \"BuPu\", \"GnBu\",\n  \"OrRd\", \"PuBuGn\", \"PuBu\", \"PuRd\", \"RdPu\", \"YlGnBu\", \"YlGn\", \"YlOrBr\", \n  \"YlOrRd\", \"BrBG\", \"PRGn\", \"PiYG\", \"PuOr\", \"RdBu\", \"RdGy\", \"RdYlBu\", \"RdYlGn\",\n  \"Spectral\"\n  ],\n  {\n    label: \"colors\",\n    value: \"PuOr\"\n  }\n)\n\n// IRIS layer opacity\nviewof opacity6 = Inputs.range([0, 1], {label: \"IRIS income opacity\", step: 0.1})\n\n\n// Resulting map with a lot of things :) \nmap6 = bertin.draw({\n  params: {\n    width: 750,\n    projection: lambert93,\n    extent: com\n  },\n\n  layers: [\n    {\n      geojson: poi,\n      symbol_size: 300,\n      symbol: \"triangle\",\n      fill: {\n        type: \"choro\",\n        values: ind6,\n        nbreaks: nbreaks6,\n        method: method6,\n        colors: pal6,\n      },\n      strokeWidth: 2.5,\n      stroke: {\n        type: \"typo\",\n        values: \"federation\",\n        colors: [\"#9990f0\", \"#fcb456\", \"#ba0b25\"],\n        leg_title: `Wall's managers`,\n        leg_x: 600,\n        leg_y: 550\n      },\n      tooltip: {\n        fields: [\"$name\", \"$federation\", \"$MIN_REV19\", \"(Minimum income in 15mn by bike neighbourhood)\", \"$MOY_REV19\", \"(Average income in 15mn by bike neighbourhood)\", \"$MAX_REV19\", \"(Average income in 15mn by bike neighbourhood)\"],\n        fill: [\"black\", \"black\", \"black\", \"black\", \"black\", \"black\", \"black\", \"black\"],\n        fontWeight: [\"bold\", \"normal\", \"normal\", \"normal\", \"normal\", \"normal\", \"normal\", \"normal\"],\n        fontSize: [14, 12, 12, 10, 12, 10, 12, 10],\n        col: \"white\"\n      }\n    },\n\n    {\n      type: \"text\",\n      position: \"topright\",\n      text: \"Income\\nin climbing area's neighbourhood\",\n      frame_opacity: 0.7,\n      baseline: \"hanging\",\n      fill: \"black\",\n      fontSize: 25,\n      margin: 4,\n      fontWeight: \"bold\",\n      fontFamily: \"Ubuntu\"\n    },\n\n    {\n      type: \"layer\",\n      geojson: com,\n      stroke: \"black\",\n      fill: \"none\"\n    },\n\n    {\n      type: \"layer\",\n      geojson: iris15,\n      fill: {\n        type: \"choro\",\n        values: \"DISP_MED19\",\n        nbreaks: nbreaks6,\n        method: method6,\n        colors: pal6,\n        leg_round: -2,\n        leg_title: `Median income (2019, euros)\\nfor IRIS at less than 15km by bike\\nfrom a climbing area`,\n        leg_x: 15,\n        leg_y: 15,\n        col_missing: \"lightgrey\",\n        txt_missing: \"Non dedicated to housing\"\n      },\n      fillOpacity: opacity6,\n      tooltip: {\n        fields: [\n          \"$NOM_IRIS\",\n          \"$NOM_COM\",\n          \"$DISP_MED19\",\n          \"Median income (2019, euros)\"\n        ],\n        fill: \"white\",\n        fontWeight: [\"bold\", \"normal\", \"normal\", \"normal\"],\n        fontSize: [11, 11, 10, 8],\n        col: [\"black\", \"black\", \"black\", \"black\"]\n      }\n    },\n\n    {\n      type: \"scalebar\",\n      units: \"kilometers\",\n    },\n    \n    {\n      type: \"footer\",\n      text:\n        \"Sources: (c)OpenStreetMap and contributors, INSEE, IGN, 2022\\nRealisation: Ronan Ysebaert, 2022\"\n    }\n  ]\n})\n"},{"methodName":"interpretQuiet","source":"shinyInput('geojson')"},{"methodName":"interpretQuiet","source":"shinyInput('style')"},{"methodName":"interpretQuiet","source":"shinyInput('ind')"},{"methodName":"interpretQuiet","source":"shinyInput('k')"},{"methodName":"interpretQuiet","source":"shinyInput('w')"},{"methodName":"interpretQuiet","source":"shinyInput('ind2')"},{"methodName":"interpretQuiet","source":"shinyInput('method2')"},{"methodName":"interpretQuiet","source":"shinyInput('nbreaks2')"},{"methodName":"interpretQuiet","source":"shinyInput('pal2')"},{"methodName":"interpretQuiet","source":"shinyInput('ind4')"},{"methodName":"interpretQuiet","source":"shinyInput('pal4')"},{"methodName":"interpretQuiet","source":"shinyInput('k5')"},{"methodName":"interpretQuiet","source":"shinyInput('ind6')"},{"methodName":"interpretQuiet","source":"shinyInput('method6')"},{"methodName":"interpretQuiet","source":"shinyInput('nbreaks6')"},{"methodName":"interpretQuiet","source":"shinyInput('pal6')"},{"methodName":"interpretQuiet","source":"shinyInput('opacity6')"}]}
</script>
<script type="module">
window._ojs.paths.runtimeToDoc = "..\..\..";
window._ojs.paths.runtimeToRoot = "..\..\..";
window._ojs.paths.docToRoot = "";
window._ojs.selfContained = false;
window._ojs.runtime.interpretFromScriptTags();
</script>
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb34" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "OSRM Travel-time calculation with R and data visualization with Observable"</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="an">subtitle:</span><span class="co"> "Application to artifical climbing walls in Paris and its neighbourhood"</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="co">  - name: Ronan Ysebaert </span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a><span class="co">    url: https://rysebaert.github.io/climbing_paris/</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a><span class="co">    affiliation: UAR RIATE, Université Paris Cité, CNRS</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a><span class="co">    affiliation-url: https://riate.cnrs.fr/</span></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a><span class="an">citation:</span><span class="co"> true</span></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> "June 2022"</span></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a><span class="an">bibliography:</span><span class="co"> bib.bib</span></span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a><span class="co">    theme: sandstone</span></span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a><span class="co">    fontsize: 0.9em</span></span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: true</span></span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-depth: 2</span></span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a><span class="co">    css: "styles.css"</span></span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a>**This documentation is in progress and may evolve in a near future... Sorry for the tips it may include !**</span>
<span id="cb34-24"><a href="#cb34-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-25"><a href="#cb34-25" aria-hidden="true" tabindex="-1"></a>The aim of this document consists in showing how to build, visualize and reproduce accessibility indicators by combining points of interest (POI) coming from the OpenStreetMap database, socio-economic indicators included in small territorial division (IRIS) and routing engines (OSRM).</span>
<span id="cb34-26"><a href="#cb34-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-27"><a href="#cb34-27" aria-hidden="true" tabindex="-1"></a>The graphical outputs displayed in this notebook are also available in an <span class="co">[</span><span class="ot">Observable collection</span><span class="co">](https://observablehq.com/collection/@rysebaert/climbing_paris "Go to Observable Notebook")</span>.</span>
<span id="cb34-28"><a href="#cb34-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-29"><a href="#cb34-29" aria-hidden="true" tabindex="-1"></a>To introduce the reader to the issues raised by indoor sport-climbing in Paris, have a look to <span class="co">[</span><span class="ot">this notebook</span><span class="co">](https://observablehq.com/d/d2be39c4dd55a32d?collection=@rysebaert/climbing_paris "Go to Observable Notebook")</span>.</span>
<span id="cb34-30"><a href="#cb34-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-31"><a href="#cb34-31" aria-hidden="true" tabindex="-1"></a>This Quarto document combines 2 programming languages : R for data processing, and ObservableJS for data visualizations.</span>
<span id="cb34-32"><a href="#cb34-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-33"><a href="#cb34-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-34"><a href="#cb34-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-35"><a href="#cb34-35" aria-hidden="true" tabindex="-1"></a><span class="fu"># Data processing with R</span></span>
<span id="cb34-36"><a href="#cb34-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-37"><a href="#cb34-37" aria-hidden="true" tabindex="-1"></a>The entire R script can be found <span class="co">[</span><span class="ot">here</span><span class="co">](https://github.com/rysebaert/climbing_paris/blob/main/script.R)</span>.</span>
<span id="cb34-38"><a href="#cb34-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-39"><a href="#cb34-39" aria-hidden="true" tabindex="-1"></a><span class="fu">## Data sources</span></span>
<span id="cb34-40"><a href="#cb34-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-41"><a href="#cb34-41" aria-hidden="true" tabindex="-1"></a>Three data sources, coming from three data providers, will be used:</span>
<span id="cb34-42"><a href="#cb34-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-43"><a href="#cb34-43" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**IGN** : <span class="co">[</span><span class="ot">The Contour...IRIS® édition 2020</span><span class="co">]</span>(https://geoservices.ign.fr/contoursiris "Access to input geometries (France)"), which corresponds to the lowest territorial division in France (below the commune level).</span>
<span id="cb34-44"><a href="#cb34-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-45"><a href="#cb34-45" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**INSEE** : IRIS <span class="co">[</span><span class="ot">Median income</span><span class="co">](https://www.insee.fr/fr/statistiques/6049648 "Go to input data")</span> and <span class="co">[</span><span class="ot">population</span><span class="co">](https://www.insee.fr/fr/statistiques/5650720?sommaire=4658626 "Go to input data")</span> in 2019.</span>
<span id="cb34-46"><a href="#cb34-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-47"><a href="#cb34-47" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**OpenStreetMap** : download of Point Of Interest (POI) and travel time calculation by bike between IRIS centroids and POI, using the <span class="co">[</span><span class="ot">OSRM routing engine</span><span class="co">](http://project-osrm.org/ "Access to OSRM Website")</span>.</span>
<span id="cb34-48"><a href="#cb34-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-49"><a href="#cb34-49" aria-hidden="true" tabindex="-1"></a>Input data is not provided in the <span class="co">[</span><span class="ot">GitHub repository</span><span class="co">](https://github.com/rysebaert/climbing_paris)</span> (too large files), but can easily be downloaded and used (no constraints of use).</span>
<span id="cb34-50"><a href="#cb34-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-51"><a href="#cb34-51" aria-hidden="true" tabindex="-1"></a><span class="fu">## Map layout</span></span>
<span id="cb34-52"><a href="#cb34-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-53"><a href="#cb34-53" aria-hidden="true" tabindex="-1"></a>A bounding box of 5 km around Paris, without Bois de Boulogne et Bois de Vincennes for a better centering of the map layout.</span>
<span id="cb34-54"><a href="#cb34-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-55"><a href="#cb34-55" aria-hidden="true" tabindex="-1"></a>A second bounding box (10 km around Paris) is created to catch OpenStreetMap POI and IRIS in the neighbourhood of this study area and avoid "border effects" for the further calculation of travel-time indicators. </span>
<span id="cb34-56"><a href="#cb34-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-57"><a href="#cb34-57" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = FALSE}</span></span>
<span id="cb34-58"><a href="#cb34-58" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Map layout preparation at IRIS scale (source IGN)----</span></span>
<span id="cb34-59"><a href="#cb34-59" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb34-60"><a href="#cb34-60" aria-hidden="true" tabindex="-1"></a>iris <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">"data-raw/CONTOURS-IRIS.shp"</span>, <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span>
<span id="cb34-61"><a href="#cb34-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-62"><a href="#cb34-62" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract Paris and delete </span></span>
<span id="cb34-63"><a href="#cb34-63" aria-hidden="true" tabindex="-1"></a><span class="co"># Bois-de-Vincennes / Boulogne Iris for map template</span></span>
<span id="cb34-64"><a href="#cb34-64" aria-hidden="true" tabindex="-1"></a>iris<span class="sc">$</span>dep <span class="ot">&lt;-</span> <span class="fu">substr</span>(iris<span class="sc">$</span>INSEE_COM, <span class="dv">1</span>, <span class="dv">2</span>)</span>
<span id="cb34-65"><a href="#cb34-65" aria-hidden="true" tabindex="-1"></a>paris <span class="ot">&lt;-</span> iris[iris<span class="sc">$</span>dep <span class="sc">==</span> <span class="st">"75"</span>,]</span>
<span id="cb34-66"><a href="#cb34-66" aria-hidden="true" tabindex="-1"></a>paris <span class="ot">&lt;-</span> paris[<span class="sc">!</span>paris<span class="sc">$</span>NOM_IRIS <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Bois de Vincennes 1"</span>,</span>
<span id="cb34-67"><a href="#cb34-67" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"Bois de Vincennes 2"</span>,</span>
<span id="cb34-68"><a href="#cb34-68" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"Bois de Boulogne 1"</span>,</span>
<span id="cb34-69"><a href="#cb34-69" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"Bois de Boulogne 2"</span>,</span>
<span id="cb34-70"><a href="#cb34-70" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"Bois de Boulogne 3"</span>),]</span>
<span id="cb34-71"><a href="#cb34-71" aria-hidden="true" tabindex="-1"></a>paris <span class="ot">&lt;-</span> <span class="fu">st_union</span>(paris)</span>
<span id="cb34-72"><a href="#cb34-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-73"><a href="#cb34-73" aria-hidden="true" tabindex="-1"></a><span class="co"># 5 km around Paris map layout</span></span>
<span id="cb34-74"><a href="#cb34-74" aria-hidden="true" tabindex="-1"></a>paris5k <span class="ot">&lt;-</span> <span class="fu">st_buffer</span>(paris, <span class="dv">5000</span>)</span>
<span id="cb34-75"><a href="#cb34-75" aria-hidden="true" tabindex="-1"></a>paris5k <span class="ot">&lt;-</span> <span class="fu">st_as_sfc</span>(<span class="fu">st_bbox</span>(paris5k, <span class="at">crs =</span> <span class="dv">2154</span>))</span>
<span id="cb34-76"><a href="#cb34-76" aria-hidden="true" tabindex="-1"></a>paris <span class="ot">&lt;-</span> paris5k</span>
<span id="cb34-77"><a href="#cb34-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-78"><a href="#cb34-78" aria-hidden="true" tabindex="-1"></a><span class="co"># 10 km around Paris (get OSM data) in long/lat</span></span>
<span id="cb34-79"><a href="#cb34-79" aria-hidden="true" tabindex="-1"></a>paris10k <span class="ot">&lt;-</span> <span class="fu">st_buffer</span>(paris, <span class="dv">10000</span>)</span>
<span id="cb34-80"><a href="#cb34-80" aria-hidden="true" tabindex="-1"></a>paris10k <span class="ot">&lt;-</span> <span class="fu">st_as_sfc</span>(<span class="fu">st_bbox</span>(paris10k, <span class="at">crs =</span> <span class="dv">2154</span>))</span>
<span id="cb34-81"><a href="#cb34-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-82"><a href="#cb34-82" aria-hidden="true" tabindex="-1"></a><span class="co"># Intersection with IRIS</span></span>
<span id="cb34-83"><a href="#cb34-83" aria-hidden="true" tabindex="-1"></a>iris10k <span class="ot">&lt;-</span> <span class="fu">st_intersection</span>(iris, paris10k)</span>
<span id="cb34-84"><a href="#cb34-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-85"><a href="#cb34-85" aria-hidden="true" tabindex="-1"></a><span class="co"># Bounding box for osm extraxt</span></span>
<span id="cb34-86"><a href="#cb34-86" aria-hidden="true" tabindex="-1"></a>paris10k <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(paris10k, <span class="dv">4326</span>)</span>
<span id="cb34-87"><a href="#cb34-87" aria-hidden="true" tabindex="-1"></a>paris10k <span class="ot">&lt;-</span> <span class="fu">st_bbox</span>(paris10k) </span>
<span id="cb34-88"><a href="#cb34-88" aria-hidden="true" tabindex="-1"></a>paris10k <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(paris10k)</span>
<span id="cb34-89"><a href="#cb34-89" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-90"><a href="#cb34-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-91"><a href="#cb34-91" aria-hidden="true" tabindex="-1"></a><span class="fu">## Feed IRIS with socio-economic data (INSEE)</span></span>
<span id="cb34-92"><a href="#cb34-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-93"><a href="#cb34-93" aria-hidden="true" tabindex="-1"></a>Data is enriched by socio-economic data (disposible median income 2019 and total population 2018) for further analysis. We keep only "Habitation" IRIS (dedicated to dwellings) for origins-destinations calculations.</span>
<span id="cb34-94"><a href="#cb34-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-95"><a href="#cb34-95" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = FALSE}</span></span>
<span id="cb34-96"><a href="#cb34-96" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Feed IRIS layer by socio-economic data (INSEE) ----</span></span>
<span id="cb34-97"><a href="#cb34-97" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb34-98"><a href="#cb34-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-99"><a href="#cb34-99" aria-hidden="true" tabindex="-1"></a><span class="co"># Population 2018 (IRIS)</span></span>
<span id="cb34-100"><a href="#cb34-100" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">read_xlsx</span>(<span class="st">"data-raw/base-ic-evol-struct-pop-2018.xlsx"</span>, <span class="at">skip =</span> <span class="dv">5</span>, <span class="at">sheet =</span> <span class="st">"IRIS"</span>)</span>
<span id="cb34-101"><a href="#cb34-101" aria-hidden="true" tabindex="-1"></a>iris10k <span class="ot">&lt;-</span> <span class="fu">merge</span>(iris10k[,<span class="fu">c</span>(<span class="st">"CODE_IRIS"</span>, <span class="st">"NOM_IRIS"</span>, <span class="st">"TYP_IRIS"</span>, <span class="st">"NOM_COM"</span>)], </span>
<span id="cb34-102"><a href="#cb34-102" aria-hidden="true" tabindex="-1"></a>                 df[,<span class="fu">c</span>(<span class="st">"IRIS"</span>,<span class="st">"P18_POP"</span>)],</span>
<span id="cb34-103"><a href="#cb34-103" aria-hidden="true" tabindex="-1"></a>                 <span class="at">by.x =</span> <span class="st">"CODE_IRIS"</span>, <span class="at">by.y =</span> <span class="st">"IRIS"</span>, <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span>
<span id="cb34-104"><a href="#cb34-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-105"><a href="#cb34-105" aria-hidden="true" tabindex="-1"></a><span class="co"># Median Income (2018)</span></span>
<span id="cb34-106"><a href="#cb34-106" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">read_xlsx</span>(<span class="st">"data-raw/BASE_TD_FILO_DISP_IRIS_2019.xlsx"</span>, <span class="at">skip =</span> <span class="dv">5</span>, <span class="at">sheet =</span> <span class="st">"IRIS_DISP"</span>)</span>
<span id="cb34-107"><a href="#cb34-107" aria-hidden="true" tabindex="-1"></a>iris10k <span class="ot">&lt;-</span> <span class="fu">merge</span>(iris10k, df[,<span class="fu">c</span>(<span class="st">"IRIS"</span>,<span class="st">"DISP_MED19"</span>)],</span>
<span id="cb34-108"><a href="#cb34-108" aria-hidden="true" tabindex="-1"></a>                 <span class="at">by.x =</span> <span class="st">"CODE_IRIS"</span>, <span class="at">by.y =</span> <span class="st">"IRIS"</span>, <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span>
<span id="cb34-109"><a href="#cb34-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-110"><a href="#cb34-110" aria-hidden="true" tabindex="-1"></a><span class="co"># Intersection with study area</span></span>
<span id="cb34-111"><a href="#cb34-111" aria-hidden="true" tabindex="-1"></a>iris <span class="ot">&lt;-</span> <span class="fu">st_intersection</span>(iris10k, paris5k)</span>
<span id="cb34-112"><a href="#cb34-112" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-113"><a href="#cb34-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-114"><a href="#cb34-114" aria-hidden="true" tabindex="-1"></a><span class="fu">## Prepare IRIS for travel-time calculation</span></span>
<span id="cb34-115"><a href="#cb34-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-116"><a href="#cb34-116" aria-hidden="true" tabindex="-1"></a>IRIS centroids are extracted. These points will be used for the origins of travel-time calculations. Only IRIS including dwellings are kept (TYP_IRIS == "H").</span>
<span id="cb34-117"><a href="#cb34-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-118"><a href="#cb34-118" aria-hidden="true" tabindex="-1"></a>These <span class="in">`sf`</span> objects are transformed in latitude/longitude (origin-destination calculations requirements and for final export in geojson format).</span>
<span id="cb34-119"><a href="#cb34-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-120"><a href="#cb34-120" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = FALSE}</span></span>
<span id="cb34-121"><a href="#cb34-121" aria-hidden="true" tabindex="-1"></a><span class="co"># Keep only habitation IRIS for origins calculation</span></span>
<span id="cb34-122"><a href="#cb34-122" aria-hidden="true" tabindex="-1"></a>ori <span class="ot">&lt;-</span> iris10k[iris10k<span class="sc">$</span>TYP_IRIS <span class="sc">==</span> <span class="st">"H"</span>,]</span>
<span id="cb34-123"><a href="#cb34-123" aria-hidden="true" tabindex="-1"></a>ori <span class="ot">&lt;-</span> <span class="fu">st_centroid</span>(ori)</span>
<span id="cb34-124"><a href="#cb34-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-125"><a href="#cb34-125" aria-hidden="true" tabindex="-1"></a><span class="co"># Transofrm in long/lat</span></span>
<span id="cb34-126"><a href="#cb34-126" aria-hidden="true" tabindex="-1"></a>ori <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(ori, <span class="at">crs =</span> <span class="dv">4326</span>)</span>
<span id="cb34-127"><a href="#cb34-127" aria-hidden="true" tabindex="-1"></a>iris <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(iris, <span class="at">crs =</span> <span class="dv">4326</span>)</span>
<span id="cb34-128"><a href="#cb34-128" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-129"><a href="#cb34-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-130"><a href="#cb34-130" aria-hidden="true" tabindex="-1"></a><span class="fu">## Import OSM points of interest</span></span>
<span id="cb34-131"><a href="#cb34-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-132"><a href="#cb34-132" aria-hidden="true" tabindex="-1"></a>Indoor sport climbing points of interest are downloaded from OpenStreetMap thanks to the <span class="in">`osmdata`</span> R package (@osmdata).</span>
<span id="cb34-133"><a href="#cb34-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-134"><a href="#cb34-134" aria-hidden="true" tabindex="-1"></a>To access to these OSM features, the OSM key-value pair (or OSM tag) must be set. For climbing areas, the most appropriate is <span class="in">`sport=climbing`</span>. In the <span class="co">[</span><span class="ot">OpenStreetMap wiki</span><span class="co">](https://wiki.openstreetmap.org/wiki/Tag:sport%3Dclimbing "Tag:sport=climbing in OSM wiki")</span>, it is mentioned that "*sport=climbing should be preferably applied to noded for artificial climbing walls".* Thus, we only consider points responding to the query.</span>
<span id="cb34-135"><a href="#cb34-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-136"><a href="#cb34-136" aria-hidden="true" tabindex="-1"></a>The geographical coverage of the query covers a bounding box of 10 km around Paris (<span class="in">`paris10k`</span><span class="sc">\`</span>). </span>
<span id="cb34-137"><a href="#cb34-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-138"><a href="#cb34-138" aria-hidden="true" tabindex="-1"></a>The OSM attributes are transformed afterwards for further analytical purposes in order to differentiate private and associative structures, and bouldering areas and climbing walls (to different climbing practices).</span>
<span id="cb34-139"><a href="#cb34-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-140"><a href="#cb34-140" aria-hidden="true" tabindex="-1"></a>I argue that the accuracy and completeness of the data is quite good : I have edited missing points on OpenStreetMap with my personal knowledge and upstream investigation :-)</span>
<span id="cb34-141"><a href="#cb34-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-142"><a href="#cb34-142" aria-hidden="true" tabindex="-1"></a>For the presentation of the artificial climbing landscape in Paris and the difference between private - FSGT and FFME structures, have a look to <span class="co">[</span><span class="ot">this notebook</span><span class="co">](https://observablehq.com/@rysebaert/forewords)</span>.</span>
<span id="cb34-143"><a href="#cb34-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-144"><a href="#cb34-144" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = FALSE}</span></span>
<span id="cb34-145"><a href="#cb34-145" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Extract OSM objects (climbing and map layout)----</span></span>
<span id="cb34-146"><a href="#cb34-146" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(osmdata)</span>
<span id="cb34-147"><a href="#cb34-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-148"><a href="#cb34-148" aria-hidden="true" tabindex="-1"></a><span class="co"># define a bounding box</span></span>
<span id="cb34-149"><a href="#cb34-149" aria-hidden="true" tabindex="-1"></a>q0 <span class="ot">&lt;-</span> <span class="fu">opq</span>(<span class="at">bbox =</span> paris10k) </span>
<span id="cb34-150"><a href="#cb34-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-151"><a href="#cb34-151" aria-hidden="true" tabindex="-1"></a><span class="co"># extract climbing areas</span></span>
<span id="cb34-152"><a href="#cb34-152" aria-hidden="true" tabindex="-1"></a>q <span class="ot">&lt;-</span> <span class="fu">add_osm_feature</span>(<span class="at">opq =</span> q0, <span class="at">key =</span> <span class="st">'sport'</span>, <span class="at">value =</span> <span class="st">"climbing"</span>)</span>
<span id="cb34-153"><a href="#cb34-153" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">osmdata_sf</span>(q)</span>
<span id="cb34-154"><a href="#cb34-154" aria-hidden="true" tabindex="-1"></a>dest <span class="ot">&lt;-</span> res<span class="sc">$</span>osm_points</span>
<span id="cb34-155"><a href="#cb34-155" aria-hidden="true" tabindex="-1"></a>dest[,<span class="st">"name"</span>] <span class="ot">&lt;-</span> <span class="fu">iconv</span>(dest<span class="sc">$</span>name, <span class="at">from =</span> <span class="st">"UTF-8"</span>, <span class="at">to =</span> <span class="st">"UTF-8"</span>)</span>
<span id="cb34-156"><a href="#cb34-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-157"><a href="#cb34-157" aria-hidden="true" tabindex="-1"></a><span class="co"># Cleaning</span></span>
<span id="cb34-158"><a href="#cb34-158" aria-hidden="true" tabindex="-1"></a>private <span class="ot">&lt;-</span> dest[<span class="sc">!</span><span class="fu">is.na</span>(dest<span class="sc">$</span>brand),] <span class="co"># Manage private and associative areas</span></span>
<span id="cb34-159"><a href="#cb34-159" aria-hidden="true" tabindex="-1"></a>asso <span class="ot">&lt;-</span> dest[<span class="sc">!</span><span class="fu">is.na</span>(dest<span class="sc">$</span>federation),]</span>
<span id="cb34-160"><a href="#cb34-160" aria-hidden="true" tabindex="-1"></a>asso<span class="sc">$</span>type <span class="ot">&lt;-</span> <span class="st">"Associative structure"</span></span>
<span id="cb34-161"><a href="#cb34-161" aria-hidden="true" tabindex="-1"></a>private<span class="sc">$</span>type <span class="ot">&lt;-</span> <span class="st">"Speculative structure"</span></span>
<span id="cb34-162"><a href="#cb34-162" aria-hidden="true" tabindex="-1"></a>dest <span class="ot">&lt;-</span> <span class="fu">rbind</span>(asso, private)</span>
<span id="cb34-163"><a href="#cb34-163" aria-hidden="true" tabindex="-1"></a>dest<span class="sc">$</span>federation[<span class="fu">is.na</span>(dest<span class="sc">$</span>federation)] <span class="ot">&lt;-</span> <span class="st">"Private"</span></span>
<span id="cb34-164"><a href="#cb34-164" aria-hidden="true" tabindex="-1"></a><span class="co"># Find walls and boulders</span></span>
<span id="cb34-165"><a href="#cb34-165" aria-hidden="true" tabindex="-1"></a>dest[<span class="fu">c</span>(<span class="st">"climbing.toprope"</span>, <span class="st">"climbing.boulder"</span>)][<span class="fu">is.na</span>(dest[<span class="fu">c</span>(<span class="st">"climbing.toprope"</span>, <span class="st">"climbing.boulder"</span>)])] <span class="ot">&lt;-</span> <span class="st">"no"</span></span>
<span id="cb34-166"><a href="#cb34-166" aria-hidden="true" tabindex="-1"></a>dest<span class="sc">$</span>climbing_type <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(dest<span class="sc">$</span>climbing.toprope <span class="sc">==</span> <span class="st">'yes'</span> <span class="sc">&amp;</span> </span>
<span id="cb34-167"><a href="#cb34-167" aria-hidden="true" tabindex="-1"></a>                               dest<span class="sc">$</span>climbing.boulder <span class="sc">==</span> <span class="st">"yes"</span>, <span class="st">'Wall and bouldering'</span>,</span>
<span id="cb34-168"><a href="#cb34-168" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">ifelse</span>(dest<span class="sc">$</span>climbing.toprope <span class="sc">==</span> <span class="st">'yes'</span> <span class="sc">&amp;</span> </span>
<span id="cb34-169"><a href="#cb34-169" aria-hidden="true" tabindex="-1"></a>                                      dest<span class="sc">$</span>climbing.boulder <span class="sc">==</span> <span class="st">"no"</span> , <span class="st">'Wall'</span>,</span>
<span id="cb34-170"><a href="#cb34-170" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">ifelse</span>(dest<span class="sc">$</span>climbing.toprope <span class="sc">==</span> <span class="st">'no'</span> <span class="sc">&amp;</span> </span>
<span id="cb34-171"><a href="#cb34-171" aria-hidden="true" tabindex="-1"></a>                                             dest<span class="sc">$</span>climbing.boulder <span class="sc">==</span> <span class="st">"yes"</span> ,</span>
<span id="cb34-172"><a href="#cb34-172" aria-hidden="true" tabindex="-1"></a>                                           <span class="st">'Bouldering'</span>, <span class="cn">NA</span>)))</span>
<span id="cb34-173"><a href="#cb34-173" aria-hidden="true" tabindex="-1"></a><span class="co"># Keep only attributes of interest and rename it</span></span>
<span id="cb34-174"><a href="#cb34-174" aria-hidden="true" tabindex="-1"></a>cols <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"osm_id"</span>, <span class="st">"name"</span>, <span class="st">"climbing_type"</span>, <span class="st">"climbing.length"</span>,</span>
<span id="cb34-175"><a href="#cb34-175" aria-hidden="true" tabindex="-1"></a>          <span class="st">"climbing.routes"</span>, <span class="st">"type"</span>, <span class="st">"federation"</span>, <span class="st">"brand"</span>)</span>
<span id="cb34-176"><a href="#cb34-176" aria-hidden="true" tabindex="-1"></a>dest <span class="ot">&lt;-</span> dest[,cols]</span>
<span id="cb34-177"><a href="#cb34-177" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(dest)[<span class="dv">4</span><span class="sc">:</span><span class="dv">5</span>] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"climbing_length"</span>, <span class="st">"climbing_routes"</span>)</span>
<span id="cb34-178"><a href="#cb34-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-179"><a href="#cb34-179" aria-hidden="true" tabindex="-1"></a><span class="co"># Intersection with bouding box </span></span>
<span id="cb34-180"><a href="#cb34-180" aria-hidden="true" tabindex="-1"></a>poi <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(dest, <span class="dv">2154</span>)</span>
<span id="cb34-181"><a href="#cb34-181" aria-hidden="true" tabindex="-1"></a>poi <span class="ot">&lt;-</span> <span class="fu">st_intersection</span>(poi, paris5k)</span>
<span id="cb34-182"><a href="#cb34-182" aria-hidden="true" tabindex="-1"></a>poi <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(poi, <span class="dv">4326</span>)</span>
<span id="cb34-183"><a href="#cb34-183" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-184"><a href="#cb34-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-185"><a href="#cb34-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-186"><a href="#cb34-186" aria-hidden="true" tabindex="-1"></a>The data preparation allows to prepare origins-destinations layers for travel-time calculation. Origins correspond to the IRIS layer (only type H : 2141 points). Destinations to artificial climbing areas (45 points).</span>
<span id="cb34-187"><a href="#cb34-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-188"><a href="#cb34-188" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = TRUE, echo = FALSE, warning=FALSE}</span></span>
<span id="cb34-189"><a href="#cb34-189" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb34-190"><a href="#cb34-190" aria-hidden="true" tabindex="-1"></a>poi <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">"data-conso/poi.geojson"</span>, <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span>
<span id="cb34-191"><a href="#cb34-191" aria-hidden="true" tabindex="-1"></a>iris <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">"data-conso/iris.geojson"</span>, <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span>
<span id="cb34-192"><a href="#cb34-192" aria-hidden="true" tabindex="-1"></a>com <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">"data-conso/com.geojson"</span>, <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span>
<span id="cb34-193"><a href="#cb34-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-194"><a href="#cb34-194" aria-hidden="true" tabindex="-1"></a>poi <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(poi, <span class="dv">2154</span>)</span>
<span id="cb34-195"><a href="#cb34-195" aria-hidden="true" tabindex="-1"></a>iris <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(iris, <span class="dv">2154</span>)</span>
<span id="cb34-196"><a href="#cb34-196" aria-hidden="true" tabindex="-1"></a>com <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(com, <span class="dv">2154</span>)</span>
<span id="cb34-197"><a href="#cb34-197" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-198"><a href="#cb34-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-199"><a href="#cb34-199" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = TRUE, out.width= "100%", warning=FALSE}</span></span>
<span id="cb34-200"><a href="#cb34-200" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mapsf)</span>
<span id="cb34-201"><a href="#cb34-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-202"><a href="#cb34-202" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract centroids from IRIS dedicated to dwellings</span></span>
<span id="cb34-203"><a href="#cb34-203" aria-hidden="true" tabindex="-1"></a>ori <span class="ot">&lt;-</span> <span class="fu">st_centroid</span>(iris)</span>
<span id="cb34-204"><a href="#cb34-204" aria-hidden="true" tabindex="-1"></a>ori <span class="ot">&lt;-</span> ori[ori<span class="sc">$</span>TYP_IRIS <span class="sc">==</span> <span class="st">"H"</span>,]</span>
<span id="cb34-205"><a href="#cb34-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-206"><a href="#cb34-206" aria-hidden="true" tabindex="-1"></a><span class="co"># Map creation</span></span>
<span id="cb34-207"><a href="#cb34-207" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>))</span>
<span id="cb34-208"><a href="#cb34-208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-209"><a href="#cb34-209" aria-hidden="true" tabindex="-1"></a><span class="co"># Set a map theme (library mapsf)</span></span>
<span id="cb34-210"><a href="#cb34-210" aria-hidden="true" tabindex="-1"></a>my_theme <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">bg =</span> <span class="cn">NA</span>, <span class="at">fg =</span> <span class="cn">NA</span>, <span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>), <span class="at">tab =</span> <span class="cn">TRUE</span>, <span class="at">pos =</span> <span class="st">"left"</span>, </span>
<span id="cb34-211"><a href="#cb34-211" aria-hidden="true" tabindex="-1"></a>                  <span class="at">inner =</span> <span class="cn">TRUE</span>, <span class="at">line =</span> <span class="fl">1.3</span>, <span class="at">cex =</span> <span class="dv">1</span>, <span class="at">font =</span> <span class="dv">2</span>)</span>
<span id="cb34-212"><a href="#cb34-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-213"><a href="#cb34-213" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the map</span></span>
<span id="cb34-214"><a href="#cb34-214" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_init</span>(com, <span class="at">expandBB =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.4</span>,<span class="dv">0</span>,<span class="dv">0</span>), <span class="at">theme =</span> my_theme)</span>
<span id="cb34-215"><a href="#cb34-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-216"><a href="#cb34-216" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_typo</span>(</span>
<span id="cb34-217"><a href="#cb34-217" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> iris, <span class="at">var =</span> <span class="st">"TYP_IRIS"</span>, </span>
<span id="cb34-218"><a href="#cb34-218" aria-hidden="true" tabindex="-1"></a>  <span class="at">pal =</span> <span class="fu">c</span>(<span class="st">"peachpuff"</span>, <span class="st">"#feb8ff"</span>, <span class="st">"#f0e6f0"</span>, <span class="st">"#f1f7ab"</span>), <span class="at">lwd =</span> <span class="fl">0.25</span>,</span>
<span id="cb34-219"><a href="#cb34-219" aria-hidden="true" tabindex="-1"></a>  <span class="at">val_order =</span> <span class="fu">c</span>(<span class="st">"H"</span>, <span class="st">"A"</span>, <span class="st">"D"</span>, <span class="st">"Z"</span>), <span class="at">border =</span> <span class="st">"white"</span>, <span class="at">leg_pos =</span> <span class="fu">c</span>(<span class="dv">631000</span>, <span class="dv">6872000</span>),</span>
<span id="cb34-220"><a href="#cb34-220" aria-hidden="true" tabindex="-1"></a>  <span class="at">leg_title =</span> <span class="st">"IRIS types (H = dwellings)"</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb34-221"><a href="#cb34-221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-222"><a href="#cb34-222" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_map</span>(ori, <span class="at">pch =</span> <span class="dv">20</span>, <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">cex =</span> .<span class="dv">2</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb34-223"><a href="#cb34-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-224"><a href="#cb34-224" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_legend</span>(</span>
<span id="cb34-225"><a href="#cb34-225" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">"symb"</span>, <span class="at">pos =</span>  <span class="fu">c</span>(<span class="dv">631000</span>, <span class="dv">6864000</span>), <span class="at">val =</span> <span class="fu">c</span>(<span class="st">"H"</span>, <span class="st">"H"</span>),</span>
<span id="cb34-226"><a href="#cb34-226" aria-hidden="true" tabindex="-1"></a>  <span class="at">pt_pch =</span> <span class="fu">c</span>(<span class="dv">20</span>,<span class="dv">20</span>), <span class="at">pt_cex =</span>.<span class="dv">2</span>, <span class="at">title =</span> <span class="st">"Origins : IRIS centroids type H"</span>,</span>
<span id="cb34-227"><a href="#cb34-227" aria-hidden="true" tabindex="-1"></a>  <span class="at">pal =</span> <span class="fu">c</span>(<span class="st">"red"</span>, <span class="st">"red"</span>))</span>
<span id="cb34-228"><a href="#cb34-228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-229"><a href="#cb34-229" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_typo</span>(<span class="at">x =</span> poi, <span class="at">var =</span> <span class="st">"federation"</span>, <span class="at">pch =</span> <span class="dv">21</span>, <span class="at">cex =</span> .<span class="dv">7</span>,</span>
<span id="cb34-230"><a href="#cb34-230" aria-hidden="true" tabindex="-1"></a>        <span class="at">val_order =</span> <span class="fu">c</span>(<span class="st">"Private"</span>, <span class="st">"FSGT"</span>, <span class="st">"FFME"</span>),</span>
<span id="cb34-231"><a href="#cb34-231" aria-hidden="true" tabindex="-1"></a>        <span class="at">pal =</span> <span class="fu">c</span>(<span class="st">"#377eb8"</span>, <span class="st">"#e41a1c"</span>, <span class="st">"#ff7f00"</span>),</span>
<span id="cb34-232"><a href="#cb34-232" aria-hidden="true" tabindex="-1"></a>        <span class="at">leg_title =</span> <span class="st">"Destinations:</span><span class="sc">\n</span><span class="st">Artificial climbing areas"</span>,</span>
<span id="cb34-233"><a href="#cb34-233" aria-hidden="true" tabindex="-1"></a>        <span class="at">leg_pos =</span> <span class="fu">c</span>(<span class="dv">631000</span>, <span class="dv">6860000</span>),</span>
<span id="cb34-234"><a href="#cb34-234" aria-hidden="true" tabindex="-1"></a>        <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb34-235"><a href="#cb34-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-236"><a href="#cb34-236" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_map</span>(com, <span class="at">col =</span> <span class="cn">NA</span>, <span class="at">border =</span> <span class="st">"black"</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb34-237"><a href="#cb34-237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-238"><a href="#cb34-238" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_title</span>(<span class="st">"Layers presentation for origins-destinations calculation"</span>)</span>
<span id="cb34-239"><a href="#cb34-239" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_scale</span>(<span class="at">size =</span> <span class="dv">5</span>, <span class="at">col =</span> <span class="st">"black"</span>, <span class="at">pos =</span> <span class="st">"bottomright"</span>)</span>
<span id="cb34-240"><a href="#cb34-240" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_credits</span>(<span class="fu">paste0</span>(<span class="st">"Sources : © OpenStreetMap and Contributors, IGN, INSEE, 2022</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb34-241"><a href="#cb34-241" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Realisation : Ronan Ysebaert, 2022"</span>))</span>
<span id="cb34-242"><a href="#cb34-242" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-243"><a href="#cb34-243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-244"><a href="#cb34-244" aria-hidden="true" tabindex="-1"></a><span class="fu">## Travel-time calculations with OSRM</span></span>
<span id="cb34-245"><a href="#cb34-245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-246"><a href="#cb34-246" aria-hidden="true" tabindex="-1"></a>We have now required origins and destinations required to compute travel-time calculations. The computation is realized using the <span class="in">`osrm`</span> R package (@osrm). This package allows to compute routes, trips, isochrones and travel distances matrices (travel time and kilometric distance).</span>
<span id="cb34-247"><a href="#cb34-247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-248"><a href="#cb34-248" aria-hidden="true" tabindex="-1"></a>Considering that the input data are quite important (more than 2000 origin points and 48 destination points) and to avoid to overload the OSRM demo server, I have run my own instance of OSRM based on docker container. The procedure to implement this solution is explained in the <span class="co">[</span><span class="ot">following documentation</span><span class="co">](https://github.com/Project-OSRM/osrm-backend#using-docker "Run OSRM with docker")</span>, or more specifically for Windows <span class="co">[</span><span class="ot">here</span><span class="co">](https://gist.github.com/AlexandraKapp/e0eee2beacc93e765113aff43ec77789 "How to set up your own OSRM backend with Docker on Windows")</span>.</span>
<span id="cb34-249"><a href="#cb34-249" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-250"><a href="#cb34-250" aria-hidden="true" tabindex="-1"></a>Once it is done, the connection to the rounting engine is operational locally (with the URL <span class="in">`http://localhost:5000/`</span><span class="sc">\`</span> for me). </span>
<span id="cb34-251"><a href="#cb34-251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-252"><a href="#cb34-252" aria-hidden="true" tabindex="-1"></a>With OSRM, it is possible to choose several profiles depending on the routing we want to use (car, bike, walking). In our case, we choose the bike profile: Cycling is a widespread practice (with public transport) for climbers to reach their activities. Moreover, it allows also to avoid to use the car profile, which underestimates the travel-time in metropolitan areas (trafic congestion not taken into account).</span>
<span id="cb34-253"><a href="#cb34-253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-254"><a href="#cb34-254" aria-hidden="true" tabindex="-1"></a>The bicycle profile is described in the <span class="co">[</span><span class="ot">github OSRM repository</span><span class="co">](https://github.com/Project-OSRM/osrm-backend/blob/master/profiles/bicycle.lua "OSRM bicycle profile")</span>. Basically, the default speed is 15 km/h. It avoids the access to highways, reduce the driving speed by 30 % for unsafe roads. It is important to keep in mind that landforms (elevation) are not considered in the default profile. Some thoughts and solutions exist on the subject, using elevation rasters (<span class="co">[</span><span class="ot">Liedman, 2022</span><span class="co">](https://www.liedman.net/2015/04/13/add-elevation-data-to-osrm/ "Adding elevation data to OSRM")</span> ; <span class="co">[</span><span class="ot">Mapbox, 2015</span><span class="co">](https://blog.mapbox.com/elevation-aware-routing-profiles-in-mapbox-directions-21e182a85165 "Elevation-aware routing profiles in Mapbox Directions")</span>).</span>
<span id="cb34-255"><a href="#cb34-255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-256"><a href="#cb34-256" aria-hidden="true" tabindex="-1"></a><span class="fu">### IRIS to climbing areas</span></span>
<span id="cb34-257"><a href="#cb34-257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-258"><a href="#cb34-258" aria-hidden="true" tabindex="-1"></a>The code below compute travel-time calculation between the geometric center of IRIS (<span class="in">`ori`</span>) and artificial climbing areas (<span class="in">`dest`</span>). It is done for all climbing structures and reproduced according to the type of climbing structure : private or associative structures. For associative structures, we distinguish the FSGT and FFME federations, who do not exactly the same goals in term of practice.</span>
<span id="cb34-259"><a href="#cb34-259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-260"><a href="#cb34-260" aria-hidden="true" tabindex="-1"></a>Resulting travel-time matrixes are exported in the <span class="co">[</span><span class="ot">data-conso</span><span class="co">](https://github.com/rysebaert/climbing_paris/tree/main/data-conso)</span> folder for other possible uses (and to avoid runing these calculations systematically).</span>
<span id="cb34-261"><a href="#cb34-261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-262"><a href="#cb34-262" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = FALSE}</span></span>
<span id="cb34-263"><a href="#cb34-263" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. Origin - Destination calculation with OSRM ----</span></span>
<span id="cb34-264"><a href="#cb34-264" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(osrm)</span>
<span id="cb34-265"><a href="#cb34-265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-266"><a href="#cb34-266" aria-hidden="true" tabindex="-1"></a><span class="co"># Manage ids</span></span>
<span id="cb34-267"><a href="#cb34-267" aria-hidden="true" tabindex="-1"></a><span class="fu">row.names</span>(ori) <span class="ot">&lt;-</span> ori<span class="sc">$</span>CODE_IRIS</span>
<span id="cb34-268"><a href="#cb34-268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-269"><a href="#cb34-269" aria-hidden="true" tabindex="-1"></a><span class="co"># Connexion to osrm local server (the osrm container must running under docker)</span></span>
<span id="cb34-270"><a href="#cb34-270" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">osrm.server =</span> <span class="st">"http://localhost:5000/"</span>, <span class="at">osrm.profile =</span> <span class="st">"bike"</span>)</span>
<span id="cb34-271"><a href="#cb34-271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-272"><a href="#cb34-272" aria-hidden="true" tabindex="-1"></a><span class="co"># Origin-destination calculation</span></span>
<span id="cb34-273"><a href="#cb34-273" aria-hidden="true" tabindex="-1"></a><span class="co"># All structures</span></span>
<span id="cb34-274"><a href="#cb34-274" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">osrmTable</span>(<span class="at">src =</span> ori, <span class="at">dst =</span> dest, <span class="at">measure =</span> <span class="st">"duration"</span>)</span>
<span id="cb34-275"><a href="#cb34-275" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(df<span class="sc">$</span>duration)</span>
<span id="cb34-276"><a href="#cb34-276" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(df) <span class="ot">&lt;-</span> <span class="fu">as.character</span>(dest<span class="sc">$</span>osm_id)</span>
<span id="cb34-277"><a href="#cb34-277" aria-hidden="true" tabindex="-1"></a><span class="fu">row.names</span>(df) <span class="ot">&lt;-</span> <span class="fu">as.character</span>(ori<span class="sc">$</span>CODE_IRIS)</span>
<span id="cb34-278"><a href="#cb34-278" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(df, <span class="st">"data-conso/bike-duration.csv"</span>)</span>
<span id="cb34-279"><a href="#cb34-279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-280"><a href="#cb34-280" aria-hidden="true" tabindex="-1"></a><span class="co"># Private structures</span></span>
<span id="cb34-281"><a href="#cb34-281" aria-hidden="true" tabindex="-1"></a>dest_priv <span class="ot">&lt;-</span> dest[dest<span class="sc">$</span>type <span class="sc">==</span> <span class="st">"Speculative structure"</span>,] </span>
<span id="cb34-282"><a href="#cb34-282" aria-hidden="true" tabindex="-1"></a>df2 <span class="ot">&lt;-</span> <span class="fu">osrmTable</span>(<span class="at">src =</span> ori, <span class="at">dst =</span> dest_priv, <span class="at">measure =</span> <span class="st">"duration"</span>)</span>
<span id="cb34-283"><a href="#cb34-283" aria-hidden="true" tabindex="-1"></a>df2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(df2<span class="sc">$</span>duration)</span>
<span id="cb34-284"><a href="#cb34-284" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(df2) <span class="ot">&lt;-</span> <span class="fu">as.character</span>(dest_priv<span class="sc">$</span>osm_id)</span>
<span id="cb34-285"><a href="#cb34-285" aria-hidden="true" tabindex="-1"></a><span class="fu">row.names</span>(df2) <span class="ot">&lt;-</span> <span class="fu">as.character</span>(ori<span class="sc">$</span>CODE_IRIS)</span>
<span id="cb34-286"><a href="#cb34-286" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(df2, <span class="st">"data-conso/bike-duration-priv.csv"</span>)</span>
<span id="cb34-287"><a href="#cb34-287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-288"><a href="#cb34-288" aria-hidden="true" tabindex="-1"></a><span class="co"># FFME</span></span>
<span id="cb34-289"><a href="#cb34-289" aria-hidden="true" tabindex="-1"></a>dest_asso <span class="ot">&lt;-</span>dest[dest<span class="sc">$</span>type <span class="sc">==</span> <span class="st">"Associative structure"</span>,] </span>
<span id="cb34-290"><a href="#cb34-290" aria-hidden="true" tabindex="-1"></a>dest_ffme <span class="ot">&lt;-</span> dest_asso[dest_asso<span class="sc">$</span>federation <span class="sc">==</span> <span class="st">"FFME"</span>,]</span>
<span id="cb34-291"><a href="#cb34-291" aria-hidden="true" tabindex="-1"></a>df3 <span class="ot">&lt;-</span> <span class="fu">osrmTable</span>(<span class="at">src =</span> ori, <span class="at">dst =</span> dest_ffme, <span class="at">measure =</span> <span class="st">"duration"</span>)</span>
<span id="cb34-292"><a href="#cb34-292" aria-hidden="true" tabindex="-1"></a>df3 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(df3<span class="sc">$</span>duration)</span>
<span id="cb34-293"><a href="#cb34-293" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(df3) <span class="ot">&lt;-</span> <span class="fu">as.character</span>(dest_ffme<span class="sc">$</span>osm_id)</span>
<span id="cb34-294"><a href="#cb34-294" aria-hidden="true" tabindex="-1"></a><span class="fu">row.names</span>(df3) <span class="ot">&lt;-</span> <span class="fu">as.character</span>(ori<span class="sc">$</span>CODE_IRIS)</span>
<span id="cb34-295"><a href="#cb34-295" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(df3, <span class="st">"data-conso/bike-duration-ffme.csv"</span>)</span>
<span id="cb34-296"><a href="#cb34-296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-297"><a href="#cb34-297" aria-hidden="true" tabindex="-1"></a><span class="co"># FSGT</span></span>
<span id="cb34-298"><a href="#cb34-298" aria-hidden="true" tabindex="-1"></a>dest_fsgt <span class="ot">&lt;-</span> dest_asso[dest_asso<span class="sc">$</span>federation <span class="sc">==</span> <span class="st">"FSGT"</span>,]</span>
<span id="cb34-299"><a href="#cb34-299" aria-hidden="true" tabindex="-1"></a>df4 <span class="ot">&lt;-</span> <span class="fu">osrmTable</span>(<span class="at">src =</span> ori, <span class="at">dst =</span> dest_fsgt, <span class="at">measure =</span> <span class="st">"duration"</span>)</span>
<span id="cb34-300"><a href="#cb34-300" aria-hidden="true" tabindex="-1"></a>df4 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(df4<span class="sc">$</span>duration)</span>
<span id="cb34-301"><a href="#cb34-301" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(df4) <span class="ot">&lt;-</span> <span class="fu">as.character</span>(dest_fsgt<span class="sc">$</span>osm_id)</span>
<span id="cb34-302"><a href="#cb34-302" aria-hidden="true" tabindex="-1"></a><span class="fu">row.names</span>(df4) <span class="ot">&lt;-</span> <span class="fu">as.character</span>(ori<span class="sc">$</span>CODE_IRIS)</span>
<span id="cb34-303"><a href="#cb34-303" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(df4, <span class="st">"data-conso/bike-duration-fsgt.csv"</span>)</span>
<span id="cb34-304"><a href="#cb34-304" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-305"><a href="#cb34-305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-306"><a href="#cb34-306" aria-hidden="true" tabindex="-1"></a>This heavy matrix is then manipulated to extract for each IRIS the following information at IRIS level :</span>
<span id="cb34-307"><a href="#cb34-307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-308"><a href="#cb34-308" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Name of the nearest climbing structure by bike</span>
<span id="cb34-309"><a href="#cb34-309" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-310"><a href="#cb34-310" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Type of structure (associative or speculative)</span>
<span id="cb34-311"><a href="#cb34-311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-312"><a href="#cb34-312" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Time to reach it (in minutes)</span>
<span id="cb34-313"><a href="#cb34-313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-314"><a href="#cb34-314" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Number of artificial climbing areas at less than 15 minutes by bike (N)</span>
<span id="cb34-315"><a href="#cb34-315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-316"><a href="#cb34-316" aria-hidden="true" tabindex="-1"></a>This calculation is done for all climbing structures (ALL), private ones (PRIV), the FFME federation (FFME) and the FSGT one (FSGT). It is done with R base code. A function would reduce considerably the code length... Never mind, it is not the aim of this proof ;)</span>
<span id="cb34-317"><a href="#cb34-317" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-318"><a href="#cb34-318" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = FALSE}</span></span>
<span id="cb34-319"><a href="#cb34-319" aria-hidden="true" tabindex="-1"></a><span class="co"># 5. Accessibility indicator creation (IRIS) ----</span></span>
<span id="cb34-320"><a href="#cb34-320" aria-hidden="true" tabindex="-1"></a><span class="co"># Name of the nearest structure</span></span>
<span id="cb34-321"><a href="#cb34-321" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data-conso/bike-duration.csv"</span>, <span class="at">row.names =</span> <span class="st">"X"</span>)</span>
<span id="cb34-322"><a href="#cb34-322" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(df) <span class="ot">&lt;-</span> <span class="fu">as.character</span>(dest<span class="sc">$</span>osm_id)</span>
<span id="cb34-323"><a href="#cb34-323" aria-hidden="true" tabindex="-1"></a>osm_id <span class="ot">&lt;-</span> <span class="fu">colnames</span>(df)[<span class="fu">apply</span>(df, <span class="dv">1</span>, which.min)] <span class="co"># Name</span></span>
<span id="cb34-324"><a href="#cb34-324" aria-hidden="true" tabindex="-1"></a>osm_id <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(osm_id, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb34-325"><a href="#cb34-325" aria-hidden="true" tabindex="-1"></a>osm_id<span class="sc">$</span>iris <span class="ot">&lt;-</span> <span class="fu">row.names</span>(df)</span>
<span id="cb34-326"><a href="#cb34-326" aria-hidden="true" tabindex="-1"></a>osm_id <span class="ot">&lt;-</span> <span class="fu">merge</span>(osm_id, poi[,<span class="fu">c</span>(<span class="st">"osm_id"</span>, <span class="st">"name"</span>, <span class="st">"federation"</span>)], </span>
<span id="cb34-327"><a href="#cb34-327" aria-hidden="true" tabindex="-1"></a>                <span class="at">by =</span> <span class="st">"osm_id"</span>, <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span>
<span id="cb34-328"><a href="#cb34-328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-329"><a href="#cb34-329" aria-hidden="true" tabindex="-1"></a><span class="co"># Time to the nearest climbing area</span></span>
<span id="cb34-330"><a href="#cb34-330" aria-hidden="true" tabindex="-1"></a>time <span class="ot">&lt;-</span> <span class="fu">apply</span>(df, <span class="dv">1</span>, min) <span class="co"># Time</span></span>
<span id="cb34-331"><a href="#cb34-331" aria-hidden="true" tabindex="-1"></a>time <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(time, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb34-332"><a href="#cb34-332" aria-hidden="true" tabindex="-1"></a>time<span class="sc">$</span>iris <span class="ot">&lt;-</span> <span class="fu">row.names</span>(time)</span>
<span id="cb34-333"><a href="#cb34-333" aria-hidden="true" tabindex="-1"></a>osm_id <span class="ot">&lt;-</span> <span class="fu">merge</span>(osm_id, time, <span class="at">by =</span> <span class="st">"iris"</span>, <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span>
<span id="cb34-334"><a href="#cb34-334" aria-hidden="true" tabindex="-1"></a>osm_id<span class="sc">$</span>geometry <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb34-335"><a href="#cb34-335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-336"><a href="#cb34-336" aria-hidden="true" tabindex="-1"></a><span class="co"># Number of climbing area at less than 15 minutes by bike</span></span>
<span id="cb34-337"><a href="#cb34-337" aria-hidden="true" tabindex="-1"></a>n15mn <span class="ot">&lt;-</span> df</span>
<span id="cb34-338"><a href="#cb34-338" aria-hidden="true" tabindex="-1"></a>n15mn <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(df, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb34-339"><a href="#cb34-339" aria-hidden="true" tabindex="-1"></a>n15mn[n15mn <span class="sc">&lt;=</span> <span class="dv">15</span>] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb34-340"><a href="#cb34-340" aria-hidden="true" tabindex="-1"></a>n15mn[n15mn <span class="sc">&gt;</span> <span class="dv">15</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb34-341"><a href="#cb34-341" aria-hidden="true" tabindex="-1"></a>n15mn<span class="sc">$</span>N <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(n15mn)</span>
<span id="cb34-342"><a href="#cb34-342" aria-hidden="true" tabindex="-1"></a>n15mn<span class="sc">$</span>iris <span class="ot">&lt;-</span> <span class="fu">row.names</span>(n15mn)</span>
<span id="cb34-343"><a href="#cb34-343" aria-hidden="true" tabindex="-1"></a>osm_id <span class="ot">&lt;-</span> <span class="fu">merge</span>(osm_id, n15mn[,<span class="fu">c</span>(<span class="st">"iris"</span>, <span class="st">"N"</span>)], <span class="at">by =</span> <span class="st">"iris"</span>,</span>
<span id="cb34-344"><a href="#cb34-344" aria-hidden="true" tabindex="-1"></a>                <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span>
<span id="cb34-345"><a href="#cb34-345" aria-hidden="true" tabindex="-1"></a>osm_id <span class="ot">&lt;-</span> osm_id[,<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span><span class="sc">:</span><span class="dv">6</span>)]</span>
<span id="cb34-346"><a href="#cb34-346" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(osm_id) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"CODE_IRIS"</span>, <span class="st">"ALL_NAME"</span>, <span class="st">"TYPE_STRUCT"</span>, <span class="st">"ALL_TIME"</span>,</span>
<span id="cb34-347"><a href="#cb34-347" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"N_15MN"</span>)</span>
<span id="cb34-348"><a href="#cb34-348" aria-hidden="true" tabindex="-1"></a>iris <span class="ot">&lt;-</span> <span class="fu">merge</span>(iris, osm_id, <span class="at">by =</span> <span class="st">"CODE_IRIS"</span>, <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span>
<span id="cb34-349"><a href="#cb34-349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-350"><a href="#cb34-350" aria-hidden="true" tabindex="-1"></a><span class="co"># Prive climbing club (fees $$$)</span></span>
<span id="cb34-351"><a href="#cb34-351" aria-hidden="true" tabindex="-1"></a><span class="co"># Name of the nearest structure</span></span>
<span id="cb34-352"><a href="#cb34-352" aria-hidden="true" tabindex="-1"></a>df2 <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data-conso/bike-duration-priv.csv"</span>, <span class="at">row.names =</span> <span class="st">"X"</span>)</span>
<span id="cb34-353"><a href="#cb34-353" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(df2) <span class="ot">&lt;-</span> <span class="fu">as.character</span>(dest_priv<span class="sc">$</span>osm_id)</span>
<span id="cb34-354"><a href="#cb34-354" aria-hidden="true" tabindex="-1"></a>osm_id <span class="ot">&lt;-</span> <span class="fu">colnames</span>(df2)[<span class="fu">apply</span>(df2, <span class="dv">1</span>, which.min)] <span class="co"># Name</span></span>
<span id="cb34-355"><a href="#cb34-355" aria-hidden="true" tabindex="-1"></a>osm_id <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(osm_id, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb34-356"><a href="#cb34-356" aria-hidden="true" tabindex="-1"></a>osm_id<span class="sc">$</span>iris <span class="ot">&lt;-</span> <span class="fu">row.names</span>(df2)</span>
<span id="cb34-357"><a href="#cb34-357" aria-hidden="true" tabindex="-1"></a>osm_id <span class="ot">&lt;-</span> <span class="fu">merge</span>(osm_id, poi[,<span class="fu">c</span>(<span class="st">"osm_id"</span>, <span class="st">"name"</span>, <span class="st">"type"</span>)], </span>
<span id="cb34-358"><a href="#cb34-358" aria-hidden="true" tabindex="-1"></a>                <span class="at">by =</span> <span class="st">"osm_id"</span>, <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span>
<span id="cb34-359"><a href="#cb34-359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-360"><a href="#cb34-360" aria-hidden="true" tabindex="-1"></a><span class="co"># Time to the nearest climbing area</span></span>
<span id="cb34-361"><a href="#cb34-361" aria-hidden="true" tabindex="-1"></a>time <span class="ot">&lt;-</span> <span class="fu">apply</span>(df2, <span class="dv">1</span>, min) <span class="co"># Time</span></span>
<span id="cb34-362"><a href="#cb34-362" aria-hidden="true" tabindex="-1"></a>time <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(time, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb34-363"><a href="#cb34-363" aria-hidden="true" tabindex="-1"></a>time<span class="sc">$</span>iris <span class="ot">&lt;-</span> <span class="fu">row.names</span>(time)</span>
<span id="cb34-364"><a href="#cb34-364" aria-hidden="true" tabindex="-1"></a>osm_id <span class="ot">&lt;-</span> <span class="fu">merge</span>(osm_id, time, <span class="at">by =</span> <span class="st">"iris"</span>, <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span>
<span id="cb34-365"><a href="#cb34-365" aria-hidden="true" tabindex="-1"></a>osm_id<span class="sc">$</span>geometry <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb34-366"><a href="#cb34-366" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-367"><a href="#cb34-367" aria-hidden="true" tabindex="-1"></a><span class="co"># Number of climbing area at less than 15 minutes by bike</span></span>
<span id="cb34-368"><a href="#cb34-368" aria-hidden="true" tabindex="-1"></a>n15mn <span class="ot">&lt;-</span> df2</span>
<span id="cb34-369"><a href="#cb34-369" aria-hidden="true" tabindex="-1"></a>n15mn <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(df2, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb34-370"><a href="#cb34-370" aria-hidden="true" tabindex="-1"></a>n15mn[n15mn <span class="sc">&lt;=</span> <span class="dv">15</span>] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb34-371"><a href="#cb34-371" aria-hidden="true" tabindex="-1"></a>n15mn[n15mn <span class="sc">&gt;</span> <span class="dv">15</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb34-372"><a href="#cb34-372" aria-hidden="true" tabindex="-1"></a>n15mn<span class="sc">$</span>N <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(n15mn)</span>
<span id="cb34-373"><a href="#cb34-373" aria-hidden="true" tabindex="-1"></a>n15mn<span class="sc">$</span>iris <span class="ot">&lt;-</span> <span class="fu">row.names</span>(n15mn)</span>
<span id="cb34-374"><a href="#cb34-374" aria-hidden="true" tabindex="-1"></a>osm_id <span class="ot">&lt;-</span> <span class="fu">merge</span>(osm_id, n15mn[,<span class="fu">c</span>(<span class="st">"iris"</span>, <span class="st">"N"</span>)], <span class="at">by =</span> <span class="st">"iris"</span>,</span>
<span id="cb34-375"><a href="#cb34-375" aria-hidden="true" tabindex="-1"></a>                <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span>
<span id="cb34-376"><a href="#cb34-376" aria-hidden="true" tabindex="-1"></a>osm_id <span class="ot">&lt;-</span> osm_id[,<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">5</span><span class="sc">:</span><span class="dv">6</span>)]</span>
<span id="cb34-377"><a href="#cb34-377" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(osm_id) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"CODE_IRIS"</span>, <span class="st">"PRIV_NAME"</span>, <span class="st">"PRIV_TIME"</span>,</span>
<span id="cb34-378"><a href="#cb34-378" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"N_PRIV_15MN"</span>)</span>
<span id="cb34-379"><a href="#cb34-379" aria-hidden="true" tabindex="-1"></a>iris <span class="ot">&lt;-</span> <span class="fu">merge</span>(iris, osm_id, <span class="at">by =</span> <span class="st">"CODE_IRIS"</span>, <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span>
<span id="cb34-380"><a href="#cb34-380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-381"><a href="#cb34-381" aria-hidden="true" tabindex="-1"></a><span class="co"># FFME associative structure</span></span>
<span id="cb34-382"><a href="#cb34-382" aria-hidden="true" tabindex="-1"></a><span class="co"># Name of the nearest structure</span></span>
<span id="cb34-383"><a href="#cb34-383" aria-hidden="true" tabindex="-1"></a>df3 <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data-conso/bike-duration-ffme.csv"</span>, <span class="at">row.names =</span> <span class="st">"X"</span>)</span>
<span id="cb34-384"><a href="#cb34-384" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(df3) <span class="ot">&lt;-</span> <span class="fu">as.character</span>(dest_ffme<span class="sc">$</span>osm_id)</span>
<span id="cb34-385"><a href="#cb34-385" aria-hidden="true" tabindex="-1"></a>osm_id <span class="ot">&lt;-</span> <span class="fu">colnames</span>(df3)[<span class="fu">apply</span>(df3, <span class="dv">1</span>, which.min)] <span class="co"># Name</span></span>
<span id="cb34-386"><a href="#cb34-386" aria-hidden="true" tabindex="-1"></a>osm_id <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(osm_id, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb34-387"><a href="#cb34-387" aria-hidden="true" tabindex="-1"></a>osm_id<span class="sc">$</span>iris <span class="ot">&lt;-</span> <span class="fu">row.names</span>(df3)</span>
<span id="cb34-388"><a href="#cb34-388" aria-hidden="true" tabindex="-1"></a>osm_id <span class="ot">&lt;-</span> <span class="fu">merge</span>(osm_id, poi[,<span class="fu">c</span>(<span class="st">"osm_id"</span>, <span class="st">"name"</span>, <span class="st">"type"</span>)], </span>
<span id="cb34-389"><a href="#cb34-389" aria-hidden="true" tabindex="-1"></a>                <span class="at">by =</span> <span class="st">"osm_id"</span>, <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span>
<span id="cb34-390"><a href="#cb34-390" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-391"><a href="#cb34-391" aria-hidden="true" tabindex="-1"></a><span class="co"># Time to the nearest climbing area</span></span>
<span id="cb34-392"><a href="#cb34-392" aria-hidden="true" tabindex="-1"></a>time <span class="ot">&lt;-</span> <span class="fu">apply</span>(df3, <span class="dv">1</span>, min) <span class="co"># Time</span></span>
<span id="cb34-393"><a href="#cb34-393" aria-hidden="true" tabindex="-1"></a>time <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(time, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb34-394"><a href="#cb34-394" aria-hidden="true" tabindex="-1"></a>time<span class="sc">$</span>iris <span class="ot">&lt;-</span> <span class="fu">row.names</span>(time)</span>
<span id="cb34-395"><a href="#cb34-395" aria-hidden="true" tabindex="-1"></a>osm_id <span class="ot">&lt;-</span> <span class="fu">merge</span>(osm_id, time, <span class="at">by =</span> <span class="st">"iris"</span>, <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span>
<span id="cb34-396"><a href="#cb34-396" aria-hidden="true" tabindex="-1"></a>osm_id<span class="sc">$</span>geometry <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb34-397"><a href="#cb34-397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-398"><a href="#cb34-398" aria-hidden="true" tabindex="-1"></a><span class="co"># Number of climbing area at less than 15 minutes by bike</span></span>
<span id="cb34-399"><a href="#cb34-399" aria-hidden="true" tabindex="-1"></a>n15mn <span class="ot">&lt;-</span> df3</span>
<span id="cb34-400"><a href="#cb34-400" aria-hidden="true" tabindex="-1"></a>n15mn <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(df3, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb34-401"><a href="#cb34-401" aria-hidden="true" tabindex="-1"></a>n15mn[n15mn <span class="sc">&lt;=</span> <span class="dv">15</span>] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb34-402"><a href="#cb34-402" aria-hidden="true" tabindex="-1"></a>n15mn[n15mn <span class="sc">&gt;</span> <span class="dv">15</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb34-403"><a href="#cb34-403" aria-hidden="true" tabindex="-1"></a>n15mn<span class="sc">$</span>N <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(n15mn)</span>
<span id="cb34-404"><a href="#cb34-404" aria-hidden="true" tabindex="-1"></a>n15mn<span class="sc">$</span>iris <span class="ot">&lt;-</span> <span class="fu">row.names</span>(n15mn)</span>
<span id="cb34-405"><a href="#cb34-405" aria-hidden="true" tabindex="-1"></a>osm_id <span class="ot">&lt;-</span> <span class="fu">merge</span>(osm_id, n15mn[,<span class="fu">c</span>(<span class="st">"iris"</span>, <span class="st">"N"</span>)], <span class="at">by =</span> <span class="st">"iris"</span>,</span>
<span id="cb34-406"><a href="#cb34-406" aria-hidden="true" tabindex="-1"></a>                <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span>
<span id="cb34-407"><a href="#cb34-407" aria-hidden="true" tabindex="-1"></a>osm_id <span class="ot">&lt;-</span> osm_id[,<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">5</span><span class="sc">:</span><span class="dv">6</span>)]</span>
<span id="cb34-408"><a href="#cb34-408" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(osm_id) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"CODE_IRIS"</span>, <span class="st">"FFME_NAME"</span>, <span class="st">"FFME_TIME"</span>,</span>
<span id="cb34-409"><a href="#cb34-409" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"N_FFME_15MN"</span>)</span>
<span id="cb34-410"><a href="#cb34-410" aria-hidden="true" tabindex="-1"></a>iris <span class="ot">&lt;-</span> <span class="fu">merge</span>(iris, osm_id, <span class="at">by =</span> <span class="st">"CODE_IRIS"</span>, <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span>
<span id="cb34-411"><a href="#cb34-411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-412"><a href="#cb34-412" aria-hidden="true" tabindex="-1"></a><span class="co"># FSGT associative structure</span></span>
<span id="cb34-413"><a href="#cb34-413" aria-hidden="true" tabindex="-1"></a><span class="co"># Name of the nearest structure</span></span>
<span id="cb34-414"><a href="#cb34-414" aria-hidden="true" tabindex="-1"></a>df4 <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data-conso/bike-duration-fsgt.csv"</span>, <span class="at">row.names =</span> <span class="st">"X"</span>)</span>
<span id="cb34-415"><a href="#cb34-415" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(df4) <span class="ot">&lt;-</span> <span class="fu">as.character</span>(dest_fsgt<span class="sc">$</span>osm_id)</span>
<span id="cb34-416"><a href="#cb34-416" aria-hidden="true" tabindex="-1"></a>osm_id <span class="ot">&lt;-</span> <span class="fu">colnames</span>(df4)[<span class="fu">apply</span>(df4, <span class="dv">1</span>, which.min)] <span class="co"># Name</span></span>
<span id="cb34-417"><a href="#cb34-417" aria-hidden="true" tabindex="-1"></a>osm_id <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(osm_id, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb34-418"><a href="#cb34-418" aria-hidden="true" tabindex="-1"></a>osm_id<span class="sc">$</span>iris <span class="ot">&lt;-</span> <span class="fu">row.names</span>(df4)</span>
<span id="cb34-419"><a href="#cb34-419" aria-hidden="true" tabindex="-1"></a>osm_id <span class="ot">&lt;-</span> <span class="fu">merge</span>(osm_id, poi[,<span class="fu">c</span>(<span class="st">"osm_id"</span>, <span class="st">"name"</span>, <span class="st">"type"</span>)], </span>
<span id="cb34-420"><a href="#cb34-420" aria-hidden="true" tabindex="-1"></a>                <span class="at">by =</span> <span class="st">"osm_id"</span>, <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span>
<span id="cb34-421"><a href="#cb34-421" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-422"><a href="#cb34-422" aria-hidden="true" tabindex="-1"></a><span class="co"># Time to the nearest climbing area</span></span>
<span id="cb34-423"><a href="#cb34-423" aria-hidden="true" tabindex="-1"></a>time <span class="ot">&lt;-</span> <span class="fu">apply</span>(df4, <span class="dv">1</span>, min) <span class="co"># Time</span></span>
<span id="cb34-424"><a href="#cb34-424" aria-hidden="true" tabindex="-1"></a>time <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(time, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb34-425"><a href="#cb34-425" aria-hidden="true" tabindex="-1"></a>time<span class="sc">$</span>iris <span class="ot">&lt;-</span> <span class="fu">row.names</span>(time)</span>
<span id="cb34-426"><a href="#cb34-426" aria-hidden="true" tabindex="-1"></a>osm_id <span class="ot">&lt;-</span> <span class="fu">merge</span>(osm_id, time, <span class="at">by =</span> <span class="st">"iris"</span>, <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span>
<span id="cb34-427"><a href="#cb34-427" aria-hidden="true" tabindex="-1"></a>osm_id<span class="sc">$</span>geometry <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb34-428"><a href="#cb34-428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-429"><a href="#cb34-429" aria-hidden="true" tabindex="-1"></a><span class="co"># Number of climbing area at less than 15 minutes by bike</span></span>
<span id="cb34-430"><a href="#cb34-430" aria-hidden="true" tabindex="-1"></a>n15mn <span class="ot">&lt;-</span> df4</span>
<span id="cb34-431"><a href="#cb34-431" aria-hidden="true" tabindex="-1"></a>n15mn <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(df4, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb34-432"><a href="#cb34-432" aria-hidden="true" tabindex="-1"></a>n15mn[n15mn <span class="sc">&lt;=</span> <span class="dv">15</span>] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb34-433"><a href="#cb34-433" aria-hidden="true" tabindex="-1"></a>n15mn[n15mn <span class="sc">&gt;</span> <span class="dv">15</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb34-434"><a href="#cb34-434" aria-hidden="true" tabindex="-1"></a>n15mn<span class="sc">$</span>N <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(n15mn)</span>
<span id="cb34-435"><a href="#cb34-435" aria-hidden="true" tabindex="-1"></a>n15mn<span class="sc">$</span>iris <span class="ot">&lt;-</span> <span class="fu">row.names</span>(n15mn)</span>
<span id="cb34-436"><a href="#cb34-436" aria-hidden="true" tabindex="-1"></a>osm_id <span class="ot">&lt;-</span> <span class="fu">merge</span>(osm_id, n15mn[,<span class="fu">c</span>(<span class="st">"iris"</span>, <span class="st">"N"</span>)], <span class="at">by =</span> <span class="st">"iris"</span>,</span>
<span id="cb34-437"><a href="#cb34-437" aria-hidden="true" tabindex="-1"></a>                <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span>
<span id="cb34-438"><a href="#cb34-438" aria-hidden="true" tabindex="-1"></a>osm_id <span class="ot">&lt;-</span> osm_id[,<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">5</span><span class="sc">:</span><span class="dv">6</span>)]</span>
<span id="cb34-439"><a href="#cb34-439" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(osm_id) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"CODE_IRIS"</span>, <span class="st">"FSGT_NAME"</span>, <span class="st">"FSGT_TIME"</span>,</span>
<span id="cb34-440"><a href="#cb34-440" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"N_FSGT_15MN"</span>)</span>
<span id="cb34-441"><a href="#cb34-441" aria-hidden="true" tabindex="-1"></a>iris <span class="ot">&lt;-</span> <span class="fu">merge</span>(iris, osm_id, <span class="at">by =</span> <span class="st">"CODE_IRIS"</span>, <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span>
<span id="cb34-442"><a href="#cb34-442" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-443"><a href="#cb34-443" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-444"><a href="#cb34-444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-445"><a href="#cb34-445" aria-hidden="true" tabindex="-1"></a><span class="fu">### Characterizing the POI neighbourhood</span></span>
<span id="cb34-446"><a href="#cb34-446" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-447"><a href="#cb34-447" aria-hidden="true" tabindex="-1"></a>Then, for each climbing areas, we are interested in defining the socio-economic characteristics of their neighbourhood.</span>
<span id="cb34-448"><a href="#cb34-448" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-449"><a href="#cb34-449" aria-hidden="true" tabindex="-1"></a>The previous matrix is transposed (lines <span class="sc">\&lt;\&gt;</span> columns). For each climbing structure, we extract the IRIS located at less than 15 minutes by bike and to produce the following indicators :</span>
<span id="cb34-450"><a href="#cb34-450" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-451"><a href="#cb34-451" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Total population at less than 15 minutes by bike. This can be considered as an amount of "social demand".</span>
<span id="cb34-452"><a href="#cb34-452" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-453"><a href="#cb34-453" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Minimum, mean and maximum of median income of IRIS at less than 15 minutes by bike.</span>
<span id="cb34-454"><a href="#cb34-454" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-455"><a href="#cb34-455" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = FALSE}</span></span>
<span id="cb34-456"><a href="#cb34-456" aria-hidden="true" tabindex="-1"></a><span class="co"># 6. Characterise the POI neighbourhood ----</span></span>
<span id="cb34-457"><a href="#cb34-457" aria-hidden="true" tabindex="-1"></a>t.df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">t</span>(df))</span>
<span id="cb34-458"><a href="#cb34-458" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(t.df) <span class="ot">&lt;-</span> iris10k[iris10k<span class="sc">$</span>TYP_IRIS <span class="sc">==</span> <span class="st">"H"</span>,]<span class="sc">$</span>CODE_IRIS</span>
<span id="cb34-459"><a href="#cb34-459" aria-hidden="true" tabindex="-1"></a>t.df<span class="sc">$</span>osm_id <span class="ot">&lt;-</span> dest<span class="sc">$</span>osm_id</span>
<span id="cb34-460"><a href="#cb34-460" aria-hidden="true" tabindex="-1"></a>t.df <span class="ot">&lt;-</span> t.df[t.df<span class="sc">$</span>osm_id <span class="sc">%in%</span> poi<span class="sc">$</span>osm_id,]</span>
<span id="cb34-461"><a href="#cb34-461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-462"><a href="#cb34-462" aria-hidden="true" tabindex="-1"></a>poi_socio <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">matrix</span>(<span class="at">nrow =</span> <span class="dv">0</span>, <span class="at">ncol =</span> <span class="dv">5</span>))</span>
<span id="cb34-463"><a href="#cb34-463" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(poi_socio) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"osm_id"</span>, <span class="st">"SUM_POP18"</span>, <span class="st">"MIN_REV19"</span>, <span class="st">"MOY_REV19"</span>, <span class="st">"MAX_REV19"</span>)</span>
<span id="cb34-464"><a href="#cb34-464" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-465"><a href="#cb34-465" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(t.df)){</span>
<span id="cb34-466"><a href="#cb34-466" aria-hidden="true" tabindex="-1"></a>  tmp1 <span class="ot">&lt;-</span> t.df[, t.df[i, ] <span class="sc">&lt;</span> <span class="dv">15</span>]</span>
<span id="cb34-467"><a href="#cb34-467" aria-hidden="true" tabindex="-1"></a>  tmp2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">CODE_IRIS =</span> <span class="fu">colnames</span>(tmp1))</span>
<span id="cb34-468"><a href="#cb34-468" aria-hidden="true" tabindex="-1"></a>  tmp2 <span class="ot">&lt;-</span> <span class="fu">merge</span>(tmp2, iris10k[,<span class="fu">c</span>(<span class="st">"CODE_IRIS"</span>, <span class="st">"P18_POP"</span>, <span class="st">"DISP_MED19"</span>)],</span>
<span id="cb34-469"><a href="#cb34-469" aria-hidden="true" tabindex="-1"></a>             <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span>
<span id="cb34-470"><a href="#cb34-470" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb34-471"><a href="#cb34-471" aria-hidden="true" tabindex="-1"></a>  poi_socio[i,<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">row.names</span>(tmp1)[i]</span>
<span id="cb34-472"><a href="#cb34-472" aria-hidden="true" tabindex="-1"></a>  poi_socio[i,<span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="fu">sum</span>(tmp2<span class="sc">$</span>P18_POP, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb34-473"><a href="#cb34-473" aria-hidden="true" tabindex="-1"></a>  poi_socio[i,<span class="dv">3</span>] <span class="ot">&lt;-</span> <span class="fu">min</span>(tmp2<span class="sc">$</span>DISP_MED19, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb34-474"><a href="#cb34-474" aria-hidden="true" tabindex="-1"></a>  poi_socio[i,<span class="dv">4</span>] <span class="ot">&lt;-</span> <span class="fu">mean</span>(tmp2<span class="sc">$</span>DISP_MED19, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb34-475"><a href="#cb34-475" aria-hidden="true" tabindex="-1"></a>  poi_socio[i,<span class="dv">5</span>] <span class="ot">&lt;-</span> <span class="fu">max</span>(tmp2<span class="sc">$</span>DISP_MED19, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb34-476"><a href="#cb34-476" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb34-477"><a href="#cb34-477" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-478"><a href="#cb34-478" aria-hidden="true" tabindex="-1"></a>poi <span class="ot">&lt;-</span> <span class="fu">merge</span>(poi, poi_socio, <span class="at">by =</span> <span class="st">"osm_id"</span>, <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span>
<span id="cb34-479"><a href="#cb34-479" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-480"><a href="#cb34-480" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-481"><a href="#cb34-481" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-482"><a href="#cb34-482" aria-hidden="true" tabindex="-1"></a><span class="fu">### Output</span></span>
<span id="cb34-483"><a href="#cb34-483" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-484"><a href="#cb34-484" aria-hidden="true" tabindex="-1"></a>Here is one example of data produced at IRIS level. </span>
<span id="cb34-485"><a href="#cb34-485" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-486"><a href="#cb34-486" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = TRUE, out.width= "100%", warning=FALSE}</span></span>
<span id="cb34-487"><a href="#cb34-487" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mapsf)</span>
<span id="cb34-488"><a href="#cb34-488" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-489"><a href="#cb34-489" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the map</span></span>
<span id="cb34-490"><a href="#cb34-490" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_init</span>(com, <span class="at">expandBB =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.4</span>,<span class="dv">0</span>,<span class="dv">0</span>), <span class="at">theme =</span> my_theme)</span>
<span id="cb34-491"><a href="#cb34-491" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-492"><a href="#cb34-492" aria-hidden="true" tabindex="-1"></a>cols <span class="ot">&lt;-</span> <span class="fu">mf_get_pal</span>(<span class="at">n =</span> <span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">5</span>), <span class="at">pal =</span> <span class="fu">c</span>(<span class="st">"Reds 2"</span>, <span class="st">"Greens"</span>))</span>
<span id="cb34-493"><a href="#cb34-493" aria-hidden="true" tabindex="-1"></a>thr <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">2.5</span>, <span class="dv">5</span>, <span class="fl">7.5</span>, <span class="dv">10</span>, <span class="fl">12.5</span>, <span class="dv">15</span>, <span class="dv">20</span>, <span class="dv">25</span>, <span class="dv">30</span>, <span class="fu">max</span>(iris<span class="sc">$</span>ALL_TIME, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb34-494"><a href="#cb34-494" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-495"><a href="#cb34-495" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_choro</span>(</span>
<span id="cb34-496"><a href="#cb34-496" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> iris, <span class="at">var =</span> <span class="st">"ALL_TIME"</span>, </span>
<span id="cb34-497"><a href="#cb34-497" aria-hidden="true" tabindex="-1"></a>  <span class="at">pal =</span> cols, <span class="at">lwd =</span> <span class="fl">0.25</span>, <span class="at">breaks =</span> thr, <span class="at">border =</span> <span class="st">"white"</span>,</span>
<span id="cb34-498"><a href="#cb34-498" aria-hidden="true" tabindex="-1"></a>  <span class="at">leg_pos =</span> <span class="fu">c</span>(<span class="dv">631000</span>, <span class="dv">6872000</span>),</span>
<span id="cb34-499"><a href="#cb34-499" aria-hidden="true" tabindex="-1"></a>  <span class="at">leg_title =</span> <span class="st">"Nearest climbing area</span><span class="sc">\n</span><span class="st">(all structures, minutes)"</span>, </span>
<span id="cb34-500"><a href="#cb34-500" aria-hidden="true" tabindex="-1"></a>  <span class="at">col_na =</span> <span class="st">"lightgrey"</span>, <span class="at">leg_no_data =</span> <span class="st">"No dedicated to housing"</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb34-501"><a href="#cb34-501" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-502"><a href="#cb34-502" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_map</span>(<span class="at">x =</span> poi, <span class="at">pch =</span> <span class="dv">21</span>, <span class="at">cex =</span> .<span class="dv">9</span>, <span class="at">bg =</span> <span class="st">"black"</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb34-503"><a href="#cb34-503" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-504"><a href="#cb34-504" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_map</span>(com, <span class="at">col =</span> <span class="cn">NA</span>, <span class="at">border =</span> <span class="st">"black"</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb34-505"><a href="#cb34-505" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-506"><a href="#cb34-506" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_title</span>(<span class="st">"Time to reach the nearest climbing area"</span>)</span>
<span id="cb34-507"><a href="#cb34-507" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_scale</span>(<span class="at">size =</span> <span class="dv">5</span>, <span class="at">col =</span> <span class="st">"black"</span>, <span class="at">pos =</span> <span class="st">"bottomright"</span>)</span>
<span id="cb34-508"><a href="#cb34-508" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_credits</span>(<span class="fu">paste0</span>(<span class="st">"Sources : © OpenStreetMap and Contributors, IGN, INSEE, 2022</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb34-509"><a href="#cb34-509" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Realisation : Ronan Ysebaert, 2022"</span>))</span>
<span id="cb34-510"><a href="#cb34-510" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-511"><a href="#cb34-511" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-512"><a href="#cb34-512" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-513"><a href="#cb34-513" aria-hidden="true" tabindex="-1"></a><span class="fu">## Travel time isochrone Map</span></span>
<span id="cb34-514"><a href="#cb34-514" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-515"><a href="#cb34-515" aria-hidden="true" tabindex="-1"></a>Then, we are interested in building iscochrons of time-distance coming from climbing areas. This is done with the <span class="in">`potential`</span> R package (@potential) and its function <span class="in">`equipotential`</span>. Below are reminded the required steps to create polygons of equipotential from a regular grid of points :</span>
<span id="cb34-516"><a href="#cb34-516" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-517"><a href="#cb34-517" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Create a regular grid (150 resolution in our case) and extract the centroids. </span>
<span id="cb34-518"><a href="#cb34-518" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Compute travel time indicators with the <span class="in">`osrmtable`</span> function of the <span class="in">`osrm`</span> R package, from grid centroids to climbing areas. </span>
<span id="cb34-519"><a href="#cb34-519" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Get the minimum value of the resulting matrix and join the result to the regular grid layer</span>
<span id="cb34-520"><a href="#cb34-520" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Create polygons of equipotential, by defining the desired thresholds and the indicator we are interested in (which climbing area travel-time) </span>
<span id="cb34-521"><a href="#cb34-521" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-522"><a href="#cb34-522" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = FALSE}</span></span>
<span id="cb34-523"><a href="#cb34-523" aria-hidden="true" tabindex="-1"></a><span class="do">## 4.3 Isochrones from a regular grid to climbing areas ----</span></span>
<span id="cb34-524"><a href="#cb34-524" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute travel time from grid to climbing areas</span></span>
<span id="cb34-525"><a href="#cb34-525" aria-hidden="true" tabindex="-1"></a><span class="co"># Create grid and extract centroids (cell size = 150 m)</span></span>
<span id="cb34-526"><a href="#cb34-526" aria-hidden="true" tabindex="-1"></a>mygrid <span class="ot">&lt;-</span> <span class="fu">st_make_grid</span>(paris5k, <span class="at">cellsize =</span> <span class="dv">150</span>)</span>
<span id="cb34-527"><a href="#cb34-527" aria-hidden="true" tabindex="-1"></a>mygrid <span class="ot">&lt;-</span> <span class="fu">st_centroid</span>(mygrid)</span>
<span id="cb34-528"><a href="#cb34-528" aria-hidden="true" tabindex="-1"></a>mygrid <span class="ot">&lt;-</span> <span class="fu">st_sf</span>(<span class="at">ID =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(mygrid), <span class="at">geometry =</span> mygrid)</span>
<span id="cb34-529"><a href="#cb34-529" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-530"><a href="#cb34-530" aria-hidden="true" tabindex="-1"></a>dest <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(dest, <span class="dv">2154</span>)</span>
<span id="cb34-531"><a href="#cb34-531" aria-hidden="true" tabindex="-1"></a>dest_priv <span class="ot">&lt;-</span> dest[dest<span class="sc">$</span>type <span class="sc">==</span> <span class="st">"Speculative structure"</span>,] </span>
<span id="cb34-532"><a href="#cb34-532" aria-hidden="true" tabindex="-1"></a>dest_fsgt <span class="ot">&lt;-</span> dest[dest<span class="sc">$</span>federation <span class="sc">==</span> <span class="st">"FSGT"</span>,]</span>
<span id="cb34-533"><a href="#cb34-533" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-534"><a href="#cb34-534" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute travel time from grid centroids to all climbing areas</span></span>
<span id="cb34-535"><a href="#cb34-535" aria-hidden="true" tabindex="-1"></a>df5 <span class="ot">&lt;-</span> <span class="fu">osrmTable</span>(<span class="at">src =</span> mygrid, <span class="at">dst =</span> dest, <span class="at">measure =</span> <span class="st">"duration"</span>)</span>
<span id="cb34-536"><a href="#cb34-536" aria-hidden="true" tabindex="-1"></a>df5 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(df5<span class="sc">$</span>duration)</span>
<span id="cb34-537"><a href="#cb34-537" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(df5, <span class="st">"data-conso/grid-bike-duration.csv"</span>, <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span>
<span id="cb34-538"><a href="#cb34-538" aria-hidden="true" tabindex="-1"></a>df5 <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data-conso/grid-bike-duration.csv"</span>)</span>
<span id="cb34-539"><a href="#cb34-539" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(df5) <span class="ot">&lt;-</span> <span class="fu">as.character</span>(dest<span class="sc">$</span>osm_id)</span>
<span id="cb34-540"><a href="#cb34-540" aria-hidden="true" tabindex="-1"></a>time <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(mygrid<span class="sc">$</span>ID, <span class="fu">apply</span>(df5, <span class="dv">1</span>, min)) <span class="co"># find minimum value</span></span>
<span id="cb34-541"><a href="#cb34-541" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(time) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"ID"</span>, <span class="st">"TIME_ALL"</span>)</span>
<span id="cb34-542"><a href="#cb34-542" aria-hidden="true" tabindex="-1"></a>mygrid <span class="ot">&lt;-</span> <span class="fu">merge</span>(mygrid, time, <span class="at">by =</span> <span class="st">"ID"</span>, <span class="at">all.x =</span> <span class="cn">TRUE</span>) <span class="co"># merge time to grid</span></span>
<span id="cb34-543"><a href="#cb34-543" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-544"><a href="#cb34-544" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute travel time from grid centroids to private climbing areas</span></span>
<span id="cb34-545"><a href="#cb34-545" aria-hidden="true" tabindex="-1"></a>df6 <span class="ot">&lt;-</span> <span class="fu">osrmTable</span>(<span class="at">src =</span> mygrid, <span class="at">dst =</span> dest_priv, <span class="at">measure =</span> <span class="st">"duration"</span>)</span>
<span id="cb34-546"><a href="#cb34-546" aria-hidden="true" tabindex="-1"></a>df6 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(df6<span class="sc">$</span>duration)</span>
<span id="cb34-547"><a href="#cb34-547" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(df6, <span class="st">"data-conso/grid-bike-duration_priv.csv"</span>, <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span>
<span id="cb34-548"><a href="#cb34-548" aria-hidden="true" tabindex="-1"></a>df6 <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data-conso/grid-bike-duration_priv.csv"</span>)</span>
<span id="cb34-549"><a href="#cb34-549" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(df6) <span class="ot">&lt;-</span> <span class="fu">as.character</span>(dest_priv<span class="sc">$</span>osm_id)</span>
<span id="cb34-550"><a href="#cb34-550" aria-hidden="true" tabindex="-1"></a>time <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(mygrid<span class="sc">$</span>ID, <span class="fu">apply</span>(df6, <span class="dv">1</span>, min)) <span class="co"># find minimum value</span></span>
<span id="cb34-551"><a href="#cb34-551" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(time) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"ID"</span>, <span class="st">"TIME_PRIV"</span>)</span>
<span id="cb34-552"><a href="#cb34-552" aria-hidden="true" tabindex="-1"></a>mygrid <span class="ot">&lt;-</span> <span class="fu">merge</span>(mygrid, time, <span class="at">by =</span> <span class="st">"ID"</span>, <span class="at">all.x =</span> <span class="cn">TRUE</span>) <span class="co"># merge time to grid</span></span>
<span id="cb34-553"><a href="#cb34-553" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-554"><a href="#cb34-554" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute travel time from grid centroids to FSGT climbing areas</span></span>
<span id="cb34-555"><a href="#cb34-555" aria-hidden="true" tabindex="-1"></a>df7 <span class="ot">&lt;-</span> <span class="fu">osrmTable</span>(<span class="at">src =</span> mygrid, <span class="at">dst =</span> dest_fsgt, <span class="at">measure =</span> <span class="st">"duration"</span>)</span>
<span id="cb34-556"><a href="#cb34-556" aria-hidden="true" tabindex="-1"></a>df7 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(df7<span class="sc">$</span>duration)</span>
<span id="cb34-557"><a href="#cb34-557" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(df7, <span class="st">"data-conso/grid-bike-duration_fsgt.csv"</span>, <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span>
<span id="cb34-558"><a href="#cb34-558" aria-hidden="true" tabindex="-1"></a>df7 <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data-conso/grid-bike-duration_fsgt.csv"</span>)</span>
<span id="cb34-559"><a href="#cb34-559" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(df7) <span class="ot">&lt;-</span> <span class="fu">as.character</span>(dest_fsgt<span class="sc">$</span>osm_id)</span>
<span id="cb34-560"><a href="#cb34-560" aria-hidden="true" tabindex="-1"></a>time <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(mygrid<span class="sc">$</span>ID, <span class="fu">apply</span>(df7, <span class="dv">1</span>, min)) <span class="co"># find minimum value</span></span>
<span id="cb34-561"><a href="#cb34-561" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(time) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"ID"</span>, <span class="st">"TIME_FSGT"</span>)</span>
<span id="cb34-562"><a href="#cb34-562" aria-hidden="true" tabindex="-1"></a>mygrid <span class="ot">&lt;-</span> <span class="fu">merge</span>(mygrid, time, <span class="at">by =</span> <span class="st">"ID"</span>, <span class="at">all.x =</span> <span class="cn">TRUE</span>) <span class="co"># merge time to grid</span></span>
<span id="cb34-563"><a href="#cb34-563" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-564"><a href="#cb34-564" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute isochrones</span></span>
<span id="cb34-565"><a href="#cb34-565" aria-hidden="true" tabindex="-1"></a><span class="co"># define breaks (based on quantie analysis)</span></span>
<span id="cb34-566"><a href="#cb34-566" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(potential)</span>
<span id="cb34-567"><a href="#cb34-567" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-568"><a href="#cb34-568" aria-hidden="true" tabindex="-1"></a>thr <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">2.5</span>, <span class="dv">5</span>, <span class="fl">7.5</span>, <span class="dv">10</span>, <span class="fl">12.5</span>, <span class="dv">15</span>, <span class="dv">20</span>, <span class="dv">25</span>, <span class="dv">30</span>, <span class="fu">max</span>(mygrid<span class="sc">$</span>TIME_FSGT))</span>
<span id="cb34-569"><a href="#cb34-569" aria-hidden="true" tabindex="-1"></a>iso_all <span class="ot">&lt;-</span> <span class="fu">equipotential</span>(<span class="at">x =</span> mygrid, <span class="at">var =</span> <span class="st">"TIME_ALL"</span>, <span class="at">breaks =</span> thr,  <span class="at">mask =</span> paris5k)</span>
<span id="cb34-570"><a href="#cb34-570" aria-hidden="true" tabindex="-1"></a>iso_fsgt <span class="ot">&lt;-</span> <span class="fu">equipotential</span>(<span class="at">x =</span> mygrid, <span class="at">var =</span> <span class="st">"TIME_FSGT"</span>, <span class="at">breaks =</span> thr,  <span class="at">mask =</span> paris5k)</span>
<span id="cb34-571"><a href="#cb34-571" aria-hidden="true" tabindex="-1"></a>iso_priv <span class="ot">&lt;-</span> <span class="fu">equipotential</span>(<span class="at">x =</span> mygrid, <span class="at">var =</span> <span class="st">"TIME_PRIV"</span>, <span class="at">breaks =</span> thr,  <span class="at">mask =</span> paris5k)</span>
<span id="cb34-572"><a href="#cb34-572" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-573"><a href="#cb34-573" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-574"><a href="#cb34-574" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-575"><a href="#cb34-575" aria-hidden="true" tabindex="-1"></a><span class="fu">### Output</span></span>
<span id="cb34-576"><a href="#cb34-576" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-577"><a href="#cb34-577" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = TRUE, echo = FALSE, warning=FALSE}</span></span>
<span id="cb34-578"><a href="#cb34-578" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb34-579"><a href="#cb34-579" aria-hidden="true" tabindex="-1"></a>iso_all <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">"data-conso/iso_all.geojson"</span>, <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span>
<span id="cb34-580"><a href="#cb34-580" aria-hidden="true" tabindex="-1"></a>mygrid <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">"data-conso/mygrid.geojson"</span>, <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span>
<span id="cb34-581"><a href="#cb34-581" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-582"><a href="#cb34-582" aria-hidden="true" tabindex="-1"></a>iso_all <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(iso_all, <span class="dv">2154</span>)</span>
<span id="cb34-583"><a href="#cb34-583" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-584"><a href="#cb34-584" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-585"><a href="#cb34-585" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = TRUE, out.width= "100%", warning=FALSE}</span></span>
<span id="cb34-586"><a href="#cb34-586" aria-hidden="true" tabindex="-1"></a><span class="co"># thresholds, colors and backaground colors</span></span>
<span id="cb34-587"><a href="#cb34-587" aria-hidden="true" tabindex="-1"></a>thr <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">2.5</span>, <span class="dv">5</span>, <span class="fl">7.5</span>, <span class="dv">10</span>, <span class="fl">12.5</span>, <span class="dv">15</span>, <span class="dv">20</span>, <span class="dv">25</span>, <span class="dv">30</span>, <span class="fu">max</span>(mygrid<span class="sc">$</span>TIME_FSGT))</span>
<span id="cb34-588"><a href="#cb34-588" aria-hidden="true" tabindex="-1"></a>cols <span class="ot">&lt;-</span> <span class="fu">mf_get_pal</span>(<span class="at">n =</span> <span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">5</span>), <span class="at">pal =</span> <span class="fu">c</span>(<span class="st">"Reds 2"</span>, <span class="st">"Greens"</span>))</span>
<span id="cb34-589"><a href="#cb34-589" aria-hidden="true" tabindex="-1"></a>colsbg <span class="ot">&lt;-</span> <span class="fu">paste0</span>(cols, <span class="st">"80"</span>)</span>
<span id="cb34-590"><a href="#cb34-590" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-591"><a href="#cb34-591" aria-hidden="true" tabindex="-1"></a><span class="co"># Show impact</span></span>
<span id="cb34-592"><a href="#cb34-592" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_init</span>(com, <span class="at">expandBB =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.4</span>,<span class="dv">0</span>,<span class="dv">0</span>), <span class="at">theme =</span> my_theme)</span>
<span id="cb34-593"><a href="#cb34-593" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_map</span>(iso_all, <span class="at">var =</span> <span class="st">"center"</span>, <span class="at">type =</span> <span class="st">"choro"</span>, <span class="at">breaks =</span> thr, <span class="at">pal =</span> colsbg, </span>
<span id="cb34-594"><a href="#cb34-594" aria-hidden="true" tabindex="-1"></a>       <span class="at">border =</span> <span class="cn">NA</span>, <span class="at">leg_pos =</span> <span class="fu">c</span>(<span class="dv">631000</span>, <span class="dv">6872000</span>), </span>
<span id="cb34-595"><a href="#cb34-595" aria-hidden="true" tabindex="-1"></a>       <span class="at">leg_title =</span> <span class="st">"Time to reach</span><span class="sc">\n</span><span class="st">the nearest climbing area</span><span class="sc">\n</span><span class="st">from a 150m regular grid centroids"</span>,</span>
<span id="cb34-596"><a href="#cb34-596" aria-hidden="true" tabindex="-1"></a>       <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb34-597"><a href="#cb34-597" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_map</span>(mygrid, <span class="at">var =</span> <span class="st">"TIME_ALL"</span>, <span class="at">pch =</span> <span class="dv">21</span>, <span class="at">cex =</span> .<span class="dv">2</span>, <span class="at">border =</span> <span class="cn">NA</span>,</span>
<span id="cb34-598"><a href="#cb34-598" aria-hidden="true" tabindex="-1"></a>       <span class="at">type =</span> <span class="st">"choro"</span>, <span class="at">breaks =</span> thr, <span class="at">pal =</span> cols, <span class="at">leg_pos =</span> <span class="st">"n"</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb34-599"><a href="#cb34-599" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_map</span>(poi, <span class="at">pch =</span> <span class="dv">21</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb34-600"><a href="#cb34-600" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_map</span>(com, <span class="at">col =</span> <span class="cn">NA</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb34-601"><a href="#cb34-601" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-602"><a href="#cb34-602" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_title</span>(<span class="st">"Isochrones output from a travel-time calculation grid centroids - climbing areas"</span>)</span>
<span id="cb34-603"><a href="#cb34-603" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_scale</span>(<span class="at">size =</span> <span class="dv">5</span>, <span class="at">col =</span> <span class="st">"black"</span>, <span class="at">pos =</span> <span class="st">"bottomright"</span>)</span>
<span id="cb34-604"><a href="#cb34-604" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_credits</span>(<span class="fu">paste0</span>(<span class="st">"Sources : © OpenStreetMap and Contributors, IGN, INSEE, 2022</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb34-605"><a href="#cb34-605" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Realisation : Ronan Ysebaert, 2022"</span>))</span>
<span id="cb34-606"><a href="#cb34-606" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-607"><a href="#cb34-607" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-608"><a href="#cb34-608" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-609"><a href="#cb34-609" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-610"><a href="#cb34-610" aria-hidden="true" tabindex="-1"></a><span class="fu">## OSRM climbing trip</span></span>
<span id="cb34-611"><a href="#cb34-611" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-612"><a href="#cb34-612" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = FALSE}</span></span>
<span id="cb34-613"><a href="#cb34-613" aria-hidden="true" tabindex="-1"></a>dest_fsgt <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(dest_fsgt, <span class="dv">2154</span>)</span>
<span id="cb34-614"><a href="#cb34-614" aria-hidden="true" tabindex="-1"></a>dest_fsgt <span class="ot">&lt;-</span> <span class="fu">st_intersection</span>(dest_fsgt, paris_5k)</span>
<span id="cb34-615"><a href="#cb34-615" aria-hidden="true" tabindex="-1"></a>dest_fsgt <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(dest_fsgt, <span class="dv">4326</span>)</span>
<span id="cb34-616"><a href="#cb34-616" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-617"><a href="#cb34-617" aria-hidden="true" tabindex="-1"></a>trip <span class="ot">&lt;-</span> <span class="fu">osrmTrip</span>(<span class="at">loc =</span> dest_fsgt)</span>
<span id="cb34-618"><a href="#cb34-618" aria-hidden="true" tabindex="-1"></a>trip <span class="ot">&lt;-</span> trip[[<span class="dv">1</span>]]<span class="sc">$</span>trip</span>
<span id="cb34-619"><a href="#cb34-619" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-620"><a href="#cb34-620" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-621"><a href="#cb34-621" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-622"><a href="#cb34-622" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo = FALSE}</span></span>
<span id="cb34-623"><a href="#cb34-623" aria-hidden="true" tabindex="-1"></a>trip  <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">"data-conso/trip.geojson"</span>, <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span>
<span id="cb34-624"><a href="#cb34-624" aria-hidden="true" tabindex="-1"></a>dest_fsgt <span class="ot">&lt;-</span> poi[poi<span class="sc">$</span>federation <span class="sc">==</span> <span class="st">"FSGT"</span>,]</span>
<span id="cb34-625"><a href="#cb34-625" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-626"><a href="#cb34-626" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-627"><a href="#cb34-627" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-628"><a href="#cb34-628" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = TRUE}</span></span>
<span id="cb34-629"><a href="#cb34-629" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(trip<span class="sc">$</span>distance)</span>
<span id="cb34-630"><a href="#cb34-630" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(trip<span class="sc">$</span>duration)</span>
<span id="cb34-631"><a href="#cb34-631" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-632"><a href="#cb34-632" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-633"><a href="#cb34-633" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = TRUE}</span></span>
<span id="cb34-634"><a href="#cb34-634" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(maptiles)</span>
<span id="cb34-635"><a href="#cb34-635" aria-hidden="true" tabindex="-1"></a>osm <span class="ot">&lt;-</span> <span class="fu">get_tiles</span>(<span class="at">x =</span> trip, <span class="at">crop =</span> <span class="cn">TRUE</span>, <span class="at">zoom =</span> <span class="dv">13</span>)</span>
<span id="cb34-636"><a href="#cb34-636" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-637"><a href="#cb34-637" aria-hidden="true" tabindex="-1"></a>theme <span class="ot">&lt;-</span> <span class="fu">mf_theme</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="fl">1.2</span>,<span class="dv">0</span>), <span class="at">inner =</span> <span class="cn">FALSE</span>, <span class="at">line =</span> <span class="fl">1.2</span>, <span class="at">cex =</span> .<span class="dv">9</span>, </span>
<span id="cb34-638"><a href="#cb34-638" aria-hidden="true" tabindex="-1"></a>                  <span class="at">pos =</span> <span class="st">"center"</span>, <span class="at">tab =</span> <span class="cn">FALSE</span>)</span>
<span id="cb34-639"><a href="#cb34-639" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_raster</span>(osm)</span>
<span id="cb34-640"><a href="#cb34-640" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_map</span>(trip, <span class="at">lwd =</span> <span class="dv">4</span>, <span class="at">add =</span> <span class="cn">TRUE</span>, <span class="at">col =</span> <span class="st">"blue"</span>)</span>
<span id="cb34-641"><a href="#cb34-641" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_map</span>(trip, <span class="at">lwd =</span> <span class="dv">1</span>, <span class="at">col =</span> <span class="st">"white"</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb34-642"><a href="#cb34-642" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_map</span>(dest_fsgt, <span class="at">pch =</span> <span class="dv">20</span>, <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb34-643"><a href="#cb34-643" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_title</span>(<span class="st">"osrmRoute()"</span>)</span>
<span id="cb34-644"><a href="#cb34-644" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_credits</span>(<span class="fu">get_credit</span>(<span class="st">"OpenStreetMap"</span>), <span class="at">pos =</span> <span class="st">"bottomright"</span>, <span class="at">cex =</span> .<span class="dv">8</span>, </span>
<span id="cb34-645"><a href="#cb34-645" aria-hidden="true" tabindex="-1"></a>           <span class="at">bg =</span> <span class="st">"#ffffff80"</span>)</span>
<span id="cb34-646"><a href="#cb34-646" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-647"><a href="#cb34-647" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-648"><a href="#cb34-648" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-649"><a href="#cb34-649" aria-hidden="true" tabindex="-1"></a><span class="fu">### Manual corrections (out of OSM)</span></span>
<span id="cb34-650"><a href="#cb34-650" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-651"><a href="#cb34-651" aria-hidden="true" tabindex="-1"></a>I noticed that in the OpenStreetMap database some attributes could be specified more precisely. However, my use does not correspond to the one recommended by OSM : climbing_length is not climbin_max. Moreover, this attribute has been set directly in OSM by the private brand. </span>
<span id="cb34-652"><a href="#cb34-652" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-653"><a href="#cb34-653" aria-hidden="true" tabindex="-1"></a>Consequently, I prefer not to change these attributes in the OSM database, but directly in my R programme. </span>
<span id="cb34-654"><a href="#cb34-654" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-655"><a href="#cb34-655" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = FALSE}</span></span>
<span id="cb34-656"><a href="#cb34-656" aria-hidden="true" tabindex="-1"></a><span class="co"># Correct MurMur and Rename ESC15</span></span>
<span id="cb34-657"><a href="#cb34-657" aria-hidden="true" tabindex="-1"></a>poi[<span class="dv">17</span>,<span class="st">"climbing_length"</span>] <span class="ot">&lt;-</span> <span class="dv">17</span></span>
<span id="cb34-658"><a href="#cb34-658" aria-hidden="true" tabindex="-1"></a>poi[<span class="dv">16</span>,<span class="st">"name"</span>] <span class="ot">&lt;-</span> <span class="st">"ESC 15 - La Plaine"</span></span>
<span id="cb34-659"><a href="#cb34-659" aria-hidden="true" tabindex="-1"></a>poi[<span class="dv">31</span>,<span class="st">"name"</span>] <span class="ot">&lt;-</span> <span class="st">"ESC 15 - Croix Nivert"</span></span>
<span id="cb34-660"><a href="#cb34-660" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-661"><a href="#cb34-661" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-662"><a href="#cb34-662" aria-hidden="true" tabindex="-1"></a><span class="fu">## Simplify geometries</span></span>
<span id="cb34-663"><a href="#cb34-663" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-664"><a href="#cb34-664" aria-hidden="true" tabindex="-1"></a>Geometries are quite detailed. The library <span class="in">`rmapshaper`</span> (@rmapshaper) is used to simplify the layer. 9 % of the points constituting the polygons are kept. Then, the IRIS layer is aggregated in communes for the map layout.</span>
<span id="cb34-665"><a href="#cb34-665" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-666"><a href="#cb34-666" aria-hidden="true" tabindex="-1"></a>We also extract the IRIS located at less than 15 minutes from a artificial climbing area for some upcoming maps. </span>
<span id="cb34-667"><a href="#cb34-667" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-668"><a href="#cb34-668" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = FALSE}</span></span>
<span id="cb34-669"><a href="#cb34-669" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rmapshaper)</span>
<span id="cb34-670"><a href="#cb34-670" aria-hidden="true" tabindex="-1"></a>iris <span class="ot">&lt;-</span> <span class="fu">ms_simplify</span>(iris, <span class="at">keep =</span> <span class="fl">0.09</span>)</span>
<span id="cb34-671"><a href="#cb34-671" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-672"><a href="#cb34-672" aria-hidden="true" tabindex="-1"></a><span class="co"># Communes aggregation (layout)</span></span>
<span id="cb34-673"><a href="#cb34-673" aria-hidden="true" tabindex="-1"></a>com <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(iris[,<span class="fu">c</span>(<span class="st">"INSEE_COM"</span>, <span class="st">"NOM_COM"</span>)],</span>
<span id="cb34-674"><a href="#cb34-674" aria-hidden="true" tabindex="-1"></a>                 <span class="at">by =</span> <span class="fu">list</span>(iris<span class="sc">$</span>INSEE_COM),</span>
<span id="cb34-675"><a href="#cb34-675" aria-hidden="true" tabindex="-1"></a>                 <span class="at">FUN =</span> head, <span class="dv">1</span>)</span>
<span id="cb34-676"><a href="#cb34-676" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-677"><a href="#cb34-677" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract IRIS at less than 15 minutes by bike</span></span>
<span id="cb34-678"><a href="#cb34-678" aria-hidden="true" tabindex="-1"></a>iris15 <span class="ot">&lt;-</span> iris[iris<span class="sc">$</span>ALL_TIME <span class="sc">&lt;</span> <span class="dv">15</span>,]</span>
<span id="cb34-679"><a href="#cb34-679" aria-hidden="true" tabindex="-1"></a>iris15 <span class="ot">&lt;-</span> iris15[<span class="sc">!</span><span class="fu">is.na</span>(iris15<span class="sc">$</span>ALL_TIME),]</span>
<span id="cb34-680"><a href="#cb34-680" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-681"><a href="#cb34-681" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-682"><a href="#cb34-682" aria-hidden="true" tabindex="-1"></a><span class="fu">## Export results</span></span>
<span id="cb34-683"><a href="#cb34-683" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-684"><a href="#cb34-684" aria-hidden="true" tabindex="-1"></a>Data preparation is over, we can go the data visualization section. Resulting geojson (poi, iris ad communes) are exported in three separated geojson. These files are available in the <span class="co">[</span><span class="ot">Github repository</span><span class="co">](https://github.com/rysebaert/climbing_paris/tree/main/data-conso)</span>.</span>
<span id="cb34-685"><a href="#cb34-685" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-686"><a href="#cb34-686" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = FALSE}</span></span>
<span id="cb34-687"><a href="#cb34-687" aria-hidden="true" tabindex="-1"></a><span class="co"># Export IRIS, POI, com layers</span></span>
<span id="cb34-688"><a href="#cb34-688" aria-hidden="true" tabindex="-1"></a><span class="fu">st_write</span>(com, <span class="st">"data-conso/com.geojson"</span>)</span>
<span id="cb34-689"><a href="#cb34-689" aria-hidden="true" tabindex="-1"></a><span class="fu">st_write</span>(iris, <span class="st">"data-conso/iris.geojson"</span>)</span>
<span id="cb34-690"><a href="#cb34-690" aria-hidden="true" tabindex="-1"></a><span class="fu">st_write</span>(poi, <span class="st">"data-conso/poi.geojson"</span>)</span>
<span id="cb34-691"><a href="#cb34-691" aria-hidden="true" tabindex="-1"></a><span class="fu">st_write</span>(iris15, <span class="st">"data-conso/iris15.geojson"</span>)</span>
<span id="cb34-692"><a href="#cb34-692" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-693"><a href="#cb34-693" aria-hidden="true" tabindex="-1"></a><span class="co"># Export material related to isochrons</span></span>
<span id="cb34-694"><a href="#cb34-694" aria-hidden="true" tabindex="-1"></a>mygrid <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(mygrid, <span class="dv">4326</span>)</span>
<span id="cb34-695"><a href="#cb34-695" aria-hidden="true" tabindex="-1"></a>iso_all <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(iso_all, <span class="dv">4326</span>)</span>
<span id="cb34-696"><a href="#cb34-696" aria-hidden="true" tabindex="-1"></a>iso_fsgt <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(iso_fsgt, <span class="dv">4326</span>)</span>
<span id="cb34-697"><a href="#cb34-697" aria-hidden="true" tabindex="-1"></a>iso_priv <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(iso_priv, <span class="dv">4326</span>)</span>
<span id="cb34-698"><a href="#cb34-698" aria-hidden="true" tabindex="-1"></a><span class="fu">st_write</span>(mygrid, <span class="st">"data-conso/mygrid.geojson"</span>)</span>
<span id="cb34-699"><a href="#cb34-699" aria-hidden="true" tabindex="-1"></a><span class="fu">st_write</span>(iso_all, <span class="st">"data-conso/iso_all.geojson"</span>)</span>
<span id="cb34-700"><a href="#cb34-700" aria-hidden="true" tabindex="-1"></a><span class="fu">st_write</span>(iso_fsgt, <span class="st">"data-conso/iso_fsgt.geojson"</span>)</span>
<span id="cb34-701"><a href="#cb34-701" aria-hidden="true" tabindex="-1"></a><span class="fu">st_write</span>(iso_priv, <span class="st">"data-conso/iso_priv.geojson"</span>)</span>
<span id="cb34-702"><a href="#cb34-702" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-703"><a href="#cb34-703" aria-hidden="true" tabindex="-1"></a><span class="co"># Export material related to travel-trip</span></span>
<span id="cb34-704"><a href="#cb34-704" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-705"><a href="#cb34-705" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-706"><a href="#cb34-706" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-707"><a href="#cb34-707" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-708"><a href="#cb34-708" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-709"><a href="#cb34-709" aria-hidden="true" tabindex="-1"></a><span class="fu">## Session info (R)</span></span>
<span id="cb34-710"><a href="#cb34-710" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo=FALSE, message=FALSE}</span></span>
<span id="cb34-711"><a href="#cb34-711" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(osmdata)</span>
<span id="cb34-712"><a href="#cb34-712" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(osrm)</span>
<span id="cb34-713"><a href="#cb34-713" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb34-714"><a href="#cb34-714" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mapsf)</span>
<span id="cb34-715"><a href="#cb34-715" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rmapshaper)</span>
<span id="cb34-716"><a href="#cb34-716" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb34-717"><a href="#cb34-717" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-718"><a href="#cb34-718" aria-hidden="true" tabindex="-1"></a><span class="fu">sessionInfo</span>()</span>
<span id="cb34-719"><a href="#cb34-719" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-720"><a href="#cb34-720" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-721"><a href="#cb34-721" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-722"><a href="#cb34-722" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-723"><a href="#cb34-723" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-724"><a href="#cb34-724" aria-hidden="true" tabindex="-1"></a><span class="fu"># Data visualization with Observable JavaScript (ojs)</span></span>
<span id="cb34-725"><a href="#cb34-725" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-726"><a href="#cb34-726" aria-hidden="true" tabindex="-1"></a>Observable is a startup founded by Mike Bostock and Melody Mechfessel, who initiated an on-line plateform to collaboratively explore, analyze, visualize and communicate with data on the Web.</span>
<span id="cb34-727"><a href="#cb34-727" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-728"><a href="#cb34-728" aria-hidden="true" tabindex="-1"></a>The computing language is <span class="co">[</span><span class="ot">Observable JavaScript (ojs)</span><span class="co">](https://observablehq.com/\@observablehq/observables-not-javascript)</span>. It is possible to include this programming language in Quarto chunks.</span>
<span id="cb34-729"><a href="#cb34-729" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-730"><a href="#cb34-730" aria-hidden="true" tabindex="-1"></a>This section imports some visualizations realized in an <span class="co">[</span><span class="ot">Observable collection</span><span class="co">](https://observablehq.com/collection/\@rysebaert/climbing_paris)</span>. Have a look to this resource to see the overall project ! </span>
<span id="cb34-731"><a href="#cb34-731" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-732"><a href="#cb34-732" aria-hidden="true" tabindex="-1"></a>All the maps produced below use the bertin.js library. Have a look to the excellent documentation in its <span class="co">[</span><span class="ot">npm repository</span><span class="co">](https://www.npmjs.com/package/bertin)</span> or in this <span class="co">[</span><span class="ot">Observable Collection</span><span class="co">](https://observablehq.com/collection/@neocartocnrs/bertin)</span> to see the possibilities offered by this library to the map creator ! </span>
<span id="cb34-733"><a href="#cb34-733" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-734"><a href="#cb34-734" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-735"><a href="#cb34-735" aria-hidden="true" tabindex="-1"></a><span class="fu">## Import consolidated data </span></span>
<span id="cb34-736"><a href="#cb34-736" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-737"><a href="#cb34-737" aria-hidden="true" tabindex="-1"></a>Geojson files coming from the data preparation precessing realized in a R programming language and described above are imported.</span>
<span id="cb34-738"><a href="#cb34-738" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-741"><a href="#cb34-741" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb34-742"><a href="#cb34-742" aria-hidden="true" tabindex="-1"></a>iris <span class="op">=</span> <span class="fu">FileAttachment</span>(<span class="st">"data-conso/iris.geojson"</span>)<span class="op">.</span><span class="fu">json</span>()</span>
<span id="cb34-743"><a href="#cb34-743" aria-hidden="true" tabindex="-1"></a>poi <span class="op">=</span> <span class="fu">FileAttachment</span>(<span class="st">"data-conso/poi.geojson"</span>)<span class="op">.</span><span class="fu">json</span>()</span>
<span id="cb34-744"><a href="#cb34-744" aria-hidden="true" tabindex="-1"></a>com <span class="op">=</span> <span class="fu">FileAttachment</span>(<span class="st">"data-conso/com.geojson"</span>)<span class="op">.</span><span class="fu">json</span>()</span>
<span id="cb34-745"><a href="#cb34-745" aria-hidden="true" tabindex="-1"></a>iris15 <span class="op">=</span> <span class="fu">FileAttachment</span>(<span class="st">"data-conso/iris15.geojson"</span>)<span class="op">.</span><span class="fu">json</span>()</span>
<span id="cb34-746"><a href="#cb34-746" aria-hidden="true" tabindex="-1"></a><span class="vs">```</span></span>
<span id="cb34-747"><a href="#cb34-747" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-748"><a href="#cb34-748" aria-hidden="true" tabindex="-1"></a><span class="vs">Bertin.js (@bertin) and geoverview.js (@geoverview) libraries are imported. These libraries will be used for creating the maps. </span></span>
<span id="cb34-749"><a href="#cb34-749" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-752"><a href="#cb34-752" aria-hidden="true" tabindex="-1"></a><span class="vs">```</span>ojs</span>
<span id="cb34-753"><a href="#cb34-753" aria-hidden="true" tabindex="-1"></a>bertin <span class="op">=</span> <span class="pp">require</span>(<span class="st">'bertin@0.9.16'</span>)</span>
<span id="cb34-754"><a href="#cb34-754" aria-hidden="true" tabindex="-1"></a>view <span class="op">=</span> <span class="pp">require</span>(<span class="st">"geoverview@1.2"</span>)<span class="op">.</span><span class="fu">then</span>((f) <span class="kw">=&gt;</span> f<span class="op">.</span><span class="at">view</span>)</span>
<span id="cb34-755"><a href="#cb34-755" aria-hidden="true" tabindex="-1"></a><span class="vs">```</span></span>
<span id="cb34-756"><a href="#cb34-756" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-757"><a href="#cb34-757" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-758"><a href="#cb34-758" aria-hidden="true" tabindex="-1"></a><span class="vs">## Layers attributes and metadata</span></span>
<span id="cb34-759"><a href="#cb34-759" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-760"><a href="#cb34-760" aria-hidden="true" tabindex="-1"></a><span class="vs">Three geographical layers will be used :</span></span>
<span id="cb34-761"><a href="#cb34-761" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-762"><a href="#cb34-762" aria-hidden="true" tabindex="-1"></a><span class="vs">- **iris** : IRIS intersecting the study area (polygons layer).</span></span>
<span id="cb34-763"><a href="#cb34-763" aria-hidden="true" tabindex="-1"></a><span class="vs">- **poi** : climbing structures included the study area (points layer).</span></span>
<span id="cb34-764"><a href="#cb34-764" aria-hidden="true" tabindex="-1"></a><span class="vs">- **com** : Muncipilaties interesecting thhe study area (polygons layer). This layer will only be used for the map layout and better understand the location of the poi and iris layers : IRIS, the lowest territorial division in France, is not really known by the population. </span></span>
<span id="cb34-765"><a href="#cb34-765" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-766"><a href="#cb34-766" aria-hidden="true" tabindex="-1"></a><span class="vs">The first two geographical layers include attributes coming from the data preparation process, that will be mapped and ploted in the next section of the document. In this part, we present the layers in several ways to understand the information we have in hand for producing the data visualization. </span></span>
<span id="cb34-767"><a href="#cb34-767" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-768"><a href="#cb34-768" aria-hidden="true" tabindex="-1"></a><span class="vs">### Interactive map</span></span>
<span id="cb34-769"><a href="#cb34-769" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-770"><a href="#cb34-770" aria-hidden="true" tabindex="-1"></a><span class="vs">Made with geoverview library. Click on the points / polygons to have an overview of their respective attributes and values.</span></span>
<span id="cb34-771"><a href="#cb34-771" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-774"><a href="#cb34-774" aria-hidden="true" tabindex="-1"></a><span class="vs">```</span>ojs</span>
<span id="cb34-775"><a href="#cb34-775" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> <span class="kw">new</span> <span class="bu">Map</span>([</span>
<span id="cb34-776"><a href="#cb34-776" aria-hidden="true" tabindex="-1"></a>  [<span class="st">"Climbing areas (dots)"</span><span class="op">,</span> poi]<span class="op">,</span></span>
<span id="cb34-777"><a href="#cb34-777" aria-hidden="true" tabindex="-1"></a>  [<span class="st">"IRIS (polygons)"</span><span class="op">,</span> iris]<span class="op">,</span></span>
<span id="cb34-778"><a href="#cb34-778" aria-hidden="true" tabindex="-1"></a>  [<span class="st">"Layout municipalities (polygons)"</span><span class="op">,</span> com]</span>
<span id="cb34-779"><a href="#cb34-779" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb34-780"><a href="#cb34-780" aria-hidden="true" tabindex="-1"></a>viewof geojson <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">select</span>(data<span class="op">,</span> { <span class="dt">label</span><span class="op">:</span> <span class="st">"Select a geojson"</span> })</span>
<span id="cb34-781"><a href="#cb34-781" aria-hidden="true" tabindex="-1"></a>viewof style <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">select</span>([<span class="st">"voyager"</span><span class="op">,</span> <span class="st">"night"</span><span class="op">,</span> <span class="st">"fulldark"</span><span class="op">,</span><span class="st">"positron"</span><span class="op">,</span><span class="st">"icgc"</span><span class="op">,</span><span class="st">"osmbright"</span><span class="op">,</span><span class="st">"hibrid"</span>]<span class="op">,</span> { <span class="dt">label</span><span class="op">:</span> <span class="st">"Select a style"</span> })</span>
<span id="cb34-782"><a href="#cb34-782" aria-hidden="true" tabindex="-1"></a>map <span class="op">=</span> <span class="fu">view</span>(geojson<span class="op">,</span> {</span>
<span id="cb34-783"><a href="#cb34-783" aria-hidden="true" tabindex="-1"></a>  <span class="dt">style</span><span class="op">:</span> style</span>
<span id="cb34-784"><a href="#cb34-784" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb34-785"><a href="#cb34-785" aria-hidden="true" tabindex="-1"></a><span class="vs">```</span></span>
<span id="cb34-786"><a href="#cb34-786" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-787"><a href="#cb34-787" aria-hidden="true" tabindex="-1"></a><span class="vs">### Attributes and metadata</span></span>
<span id="cb34-788"><a href="#cb34-788" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-789"><a href="#cb34-789" aria-hidden="true" tabindex="-1"></a><span class="vs">**Attribute table (iris layer)** </span></span>
<span id="cb34-790"><a href="#cb34-790" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-793"><a href="#cb34-793" aria-hidden="true" tabindex="-1"></a><span class="vs">```</span>ojs</span>
<span id="cb34-794"><a href="#cb34-794" aria-hidden="true" tabindex="-1"></a>Inputs<span class="op">.</span><span class="fu">table</span>(iris<span class="op">.</span><span class="at">features</span><span class="op">.</span><span class="fu">map</span>((d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">properties</span>))</span>
<span id="cb34-795"><a href="#cb34-795" aria-hidden="true" tabindex="-1"></a><span class="vs">```</span></span>
<span id="cb34-796"><a href="#cb34-796" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-797"><a href="#cb34-797" aria-hidden="true" tabindex="-1"></a><span class="vs">**Indicators definition (iris layer)**</span></span>
<span id="cb34-798"><a href="#cb34-798" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-799"><a href="#cb34-799" aria-hidden="true" tabindex="-1"></a><span class="vs">| id          | Description                                                                                                                 | Data source                                       |</span></span>
<span id="cb34-800"><a href="#cb34-800" aria-hidden="true" tabindex="-1"></a><span class="vs">|-------------|-----------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------|</span></span>
<span id="cb34-801"><a href="#cb34-801" aria-hidden="true" tabindex="-1"></a><span class="vs">| CODE_IRIS   | IRIS code                                                                                                                   | INSEE, IGN                                        |</span></span>
<span id="cb34-802"><a href="#cb34-802" aria-hidden="true" tabindex="-1"></a><span class="vs">| NOM_IRIS    | IRIS Name                                                                                                                   | INSEE, IGN                                        |</span></span>
<span id="cb34-803"><a href="#cb34-803" aria-hidden="true" tabindex="-1"></a><span class="vs">| TYP_IRIS    | IRIS type (H for dwellings)                                                                                                 | INSEE, IGN                                        |</span></span>
<span id="cb34-804"><a href="#cb34-804" aria-hidden="true" tabindex="-1"></a><span class="vs">| P18_POP     | Population in 2018                                                                                                          | INSEE                                             |</span></span>
<span id="cb34-805"><a href="#cb34-805" aria-hidden="true" tabindex="-1"></a><span class="vs">| DISP_MED19  | Disposable median income in 2019                                                                                            | INSEE                                             |</span></span>
<span id="cb34-806"><a href="#cb34-806" aria-hidden="true" tabindex="-1"></a><span class="vs">| ALL_NAME    | Name of the nearest artificial climbing area reachable by bike (all structures)                                             | (c)OpenStreetMap and contributors, Ronan Ysebaert |</span></span>
<span id="cb34-807"><a href="#cb34-807" aria-hidden="true" tabindex="-1"></a><span class="vs">| TYPE_STRUCT | Manager of the nearest artificial climbing area reachable by bike (private, FSGT or FFME)                                   | (c)OpenStreetMap and contributors, Ronan Ysebaert |</span></span>
<span id="cb34-808"><a href="#cb34-808" aria-hidden="true" tabindex="-1"></a><span class="vs">| ALL_TIME    | Time by bike to reach the nearest artificial climbing area.                                                                 | (c)OpenStreetMap and contributors, Ronan Ysebaert |</span></span>
<span id="cb34-809"><a href="#cb34-809" aria-hidden="true" tabindex="-1"></a><span class="vs">| N_15MN      | Number of climbing areas accessible in 15 minutes by bike from the IRIS centroid (all structures)                           | (c)OpenStreetMap and contributors, Ronan Ysebaert |</span></span>
<span id="cb34-810"><a href="#cb34-810" aria-hidden="true" tabindex="-1"></a><span class="vs">| PRIV_NAME   | Name of the nearest artificial climbing area by bike (Private structure)                                                    | (c)OpenStreetMap and contributors, Ronan Ysebaert |</span></span>
<span id="cb34-811"><a href="#cb34-811" aria-hidden="true" tabindex="-1"></a><span class="vs">| PRIV_TIME   | Time by bike to reach the nearest artificial climbing area (Private structure)                                              | (c)OpenStreetMap and contributors, Ronan Ysebaert |</span></span>
<span id="cb34-812"><a href="#cb34-812" aria-hidden="true" tabindex="-1"></a><span class="vs">| N_PRIV_15MN | Number of climbing areas accessible in 15 minutes by bike from the IRIS centroid (private structures)                       | (c)OpenStreetMap and contributors, Ronan Ysebaert |</span></span>
<span id="cb34-813"><a href="#cb34-813" aria-hidden="true" tabindex="-1"></a><span class="vs">| FFME_NAME   | Name of the nearest artificial climbing area by bike (Associative structure, federation : FFME)                             | (c)OpenStreetMap and contributors, Ronan Ysebaert |</span></span>
<span id="cb34-814"><a href="#cb34-814" aria-hidden="true" tabindex="-1"></a><span class="vs">| FFME_TIME   | Time by bike to reach the nearest artificial climbing area (Associative structure, federation : FFME)                       | (c)OpenStreetMap and contributors, Ronan Ysebaert |</span></span>
<span id="cb34-815"><a href="#cb34-815" aria-hidden="true" tabindex="-1"></a><span class="vs">| N_FFME_15MN | Number of climbing areas accessible in 15 minutes by bike from the IRIS centroid (Associative structure, federation : FFME) | (c)OpenStreetMap and contributors, Ronan Ysebaert |</span></span>
<span id="cb34-816"><a href="#cb34-816" aria-hidden="true" tabindex="-1"></a><span class="vs">| FSGT_NAME   | Name of the nearest artificial climbing area by bike (Associative structure, federation : FSGT)                             | (c)OpenStreetMap and contributors, Ronan Ysebaert |</span></span>
<span id="cb34-817"><a href="#cb34-817" aria-hidden="true" tabindex="-1"></a><span class="vs">| FSGT_TIME   | Time by bike to reach the nearest artificial climbing area (Associative structure, federation : FSGT)                       | (c)OpenStreetMap and contributors, Ronan Ysebaert |</span></span>
<span id="cb34-818"><a href="#cb34-818" aria-hidden="true" tabindex="-1"></a><span class="vs">| N_FSGT_15MN | Number of climbing areas accessible in 15 minutes by bike from the IRIS centroid (Associative structure, federation : FSGT) | (c)OpenStreetMap and contributors, Ronan Ysebaert |</span></span>
<span id="cb34-819"><a href="#cb34-819" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-820"><a href="#cb34-820" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-821"><a href="#cb34-821" aria-hidden="true" tabindex="-1"></a><span class="vs">**Attribute table (poi layer)** </span></span>
<span id="cb34-822"><a href="#cb34-822" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-825"><a href="#cb34-825" aria-hidden="true" tabindex="-1"></a><span class="vs">```</span>ojs</span>
<span id="cb34-826"><a href="#cb34-826" aria-hidden="true" tabindex="-1"></a>Inputs<span class="op">.</span><span class="fu">table</span>(poi<span class="op">.</span><span class="at">features</span><span class="op">.</span><span class="fu">map</span>((d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">properties</span>))</span>
<span id="cb34-827"><a href="#cb34-827" aria-hidden="true" tabindex="-1"></a><span class="vs">```</span></span>
<span id="cb34-828"><a href="#cb34-828" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-829"><a href="#cb34-829" aria-hidden="true" tabindex="-1"></a><span class="vs">**Indicators definition (poi layer)**</span></span>
<span id="cb34-830"><a href="#cb34-830" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-831"><a href="#cb34-831" aria-hidden="true" tabindex="-1"></a><span class="vs">| id              | Description                                                                                                                                                                                       | Data source                                              |</span></span>
<span id="cb34-832"><a href="#cb34-832" aria-hidden="true" tabindex="-1"></a><span class="vs">|-----------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------|</span></span>
<span id="cb34-833"><a href="#cb34-833" aria-hidden="true" tabindex="-1"></a><span class="vs">| osm_id          | OpenStreetMap identifier (responding to the query sport=climbing in the bounding box of the study area)                                                                                           | (c)OpenStreetMap and contributors                        |</span></span>
<span id="cb34-834"><a href="#cb34-834" aria-hidden="true" tabindex="-1"></a><span class="vs">| name            | Name of the artificial climbing area                                                                                                                                                              | (c)OpenStreetMap and contributors                        |</span></span>
<span id="cb34-835"><a href="#cb34-835" aria-hidden="true" tabindex="-1"></a><span class="vs">| climbing_type   | If the articial climbing area is a wall (need a rope to climb), dedicated to bouldering, or both                                                                                                  | (c)OpenStreetMap and contributors, Ronan Ysebaert        |</span></span>
<span id="cb34-836"><a href="#cb34-836" aria-hidden="true" tabindex="-1"></a><span class="vs">| climbing_length | Max. height of the wall (if adapted, for walls and not for bouldering)                                                                                                                            | (c)OpenStreetMap and contributors                        |</span></span>
<span id="cb34-837"><a href="#cb34-837" aria-hidden="true" tabindex="-1"></a><span class="vs">| climbing_routes | Number of climbing routes, materialized by belay station (if adapted, for walls and not for bouldering). Note that in artificial climbing, a same belay station can serve several climbing routes | (c)OpenStreetMap and contributors                        |</span></span>
<span id="cb34-838"><a href="#cb34-838" aria-hidden="true" tabindex="-1"></a><span class="vs">| type            | If the climbing area is speculative (manage by a private brand) or associative                                                                                                                    | (c)OpenStreetMap and contributors, Ronan Ysebaert        |</span></span>
<span id="cb34-839"><a href="#cb34-839" aria-hidden="true" tabindex="-1"></a><span class="vs">| federation      | Name of the manager (FFME, FSGT or private)                                                                                                                                                       | (c)OpenStreetMap and contributors, Ronan Ysebaert        |</span></span>
<span id="cb34-840"><a href="#cb34-840" aria-hidden="true" tabindex="-1"></a><span class="vs">| brand           | Name of the brand managing the private structure                                                                                                                                                  | (c)OpenStreetMap and contributors                        |</span></span>
<span id="cb34-841"><a href="#cb34-841" aria-hidden="true" tabindex="-1"></a><span class="vs">| SUM_POP18       | Population at less than 15 minutes by bike of the artificial climbing area (IRIS centroids).                                                                                                      | INSEE, (c)OpenStreetMap and contributors, Ronan Ysebaert |</span></span>
<span id="cb34-842"><a href="#cb34-842" aria-hidden="true" tabindex="-1"></a><span class="vs">| MIN_REV19       | Mininum of the median income for the IRIS located at less than 15 minutes by bike                                                                                                                 | INSEE, (c)OpenStreetMap and contributors, Ronan Ysebaert |</span></span>
<span id="cb34-843"><a href="#cb34-843" aria-hidden="true" tabindex="-1"></a><span class="vs">| MOY_REV19       | Mean of the Median income for the IRIS located at less than 15 minutes by bike                                                                                                                    | INSEE, (c)OpenStreetMap and contributors, Ronan Ysebaert |</span></span>
<span id="cb34-844"><a href="#cb34-844" aria-hidden="true" tabindex="-1"></a><span class="vs">| MAX_REV19       | Maximum of the Median income for the IRIS located at less than 15 minutes by bike                                                                                                                 | INSEE, (c)OpenStreetMap and contributors, Ronan Ysebaert |</span></span>
<span id="cb34-845"><a href="#cb34-845" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-846"><a href="#cb34-846" aria-hidden="true" tabindex="-1"></a><span class="vs">## Wall's characteristics</span></span>
<span id="cb34-847"><a href="#cb34-847" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-848"><a href="#cb34-848" aria-hidden="true" tabindex="-1"></a><span class="vs">This interactive map displays the artificial climbing offer in Paris and its surroundings, according artificial climbing specificities: top rope climbing (walls) / bouldering, climbing height, number of routes, manager of the articial climbing area.</span></span>
<span id="cb34-849"><a href="#cb34-849" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-852"><a href="#cb34-852" aria-hidden="true" tabindex="-1"></a><span class="vs">```</span>ojs</span>
<span id="cb34-853"><a href="#cb34-853" aria-hidden="true" tabindex="-1"></a><span class="co">//Manage map projection</span></span>
<span id="cb34-854"><a href="#cb34-854" aria-hidden="true" tabindex="-1"></a>lambert93 <span class="op">=</span> <span class="st">"+proj=lcc +lat_1=49 +lat_2=44 +lat_0=46.5 +lon_0=3 +x_0=700000 +y_0=6600000 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs"</span></span>
<span id="cb34-855"><a href="#cb34-855" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-856"><a href="#cb34-856" aria-hidden="true" tabindex="-1"></a><span class="co">// Map parameters to play with it</span></span>
<span id="cb34-857"><a href="#cb34-857" aria-hidden="true" tabindex="-1"></a>viewof ind <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">radio</span>([<span class="st">"climbing_length"</span><span class="op">,</span> <span class="st">"climbing_routes"</span>]<span class="op">,</span> {<span class="dt">label</span><span class="op">:</span> <span class="st">"Wall height / Number of routes"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="st">"climbing_length"</span>})</span>
<span id="cb34-858"><a href="#cb34-858" aria-hidden="true" tabindex="-1"></a>viewof k <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">10</span><span class="op">,</span> <span class="dv">300</span>]<span class="op">,</span> { <span class="dt">label</span><span class="op">:</span> <span class="st">"Spikes height"</span><span class="op">,</span> <span class="dt">step</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="dv">90</span> })</span>
<span id="cb34-859"><a href="#cb34-859" aria-hidden="true" tabindex="-1"></a>viewof w <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">2</span><span class="op">,</span> <span class="dv">30</span>]<span class="op">,</span> { <span class="dt">label</span><span class="op">:</span> <span class="st">"Spikes / dots width"</span><span class="op">,</span> <span class="dt">step</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="dv">15</span> })</span>
<span id="cb34-860"><a href="#cb34-860" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-861"><a href="#cb34-861" aria-hidden="true" tabindex="-1"></a><span class="co">// Spike map with tooltips</span></span>
<span id="cb34-862"><a href="#cb34-862" aria-hidden="true" tabindex="-1"></a>map1 <span class="op">=</span> bertin<span class="op">.</span><span class="fu">draw</span>({</span>
<span id="cb34-863"><a href="#cb34-863" aria-hidden="true" tabindex="-1"></a>  <span class="dt">params</span><span class="op">:</span> {</span>
<span id="cb34-864"><a href="#cb34-864" aria-hidden="true" tabindex="-1"></a>    <span class="dt">width</span><span class="op">:</span> <span class="dv">750</span><span class="op">,</span></span>
<span id="cb34-865"><a href="#cb34-865" aria-hidden="true" tabindex="-1"></a>    <span class="dt">projection</span><span class="op">:</span> lambert93<span class="op">,</span></span>
<span id="cb34-866"><a href="#cb34-866" aria-hidden="true" tabindex="-1"></a>    <span class="dt">extent</span><span class="op">:</span> com</span>
<span id="cb34-867"><a href="#cb34-867" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb34-868"><a href="#cb34-868" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-869"><a href="#cb34-869" aria-hidden="true" tabindex="-1"></a>  <span class="dt">layers</span><span class="op">:</span> [</span>
<span id="cb34-870"><a href="#cb34-870" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb34-871"><a href="#cb34-871" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"spikes"</span><span class="op">,</span></span>
<span id="cb34-872"><a href="#cb34-872" aria-hidden="true" tabindex="-1"></a>      <span class="dt">geojson</span><span class="op">:</span> poi<span class="op">,</span></span>
<span id="cb34-873"><a href="#cb34-873" aria-hidden="true" tabindex="-1"></a>      <span class="dt">values</span><span class="op">:</span> ind<span class="op">,</span></span>
<span id="cb34-874"><a href="#cb34-874" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fillOpacity</span><span class="op">:</span> <span class="fl">0.2</span><span class="op">,</span></span>
<span id="cb34-875"><a href="#cb34-875" aria-hidden="true" tabindex="-1"></a>      <span class="dt">k</span><span class="op">:</span> k<span class="op">,</span></span>
<span id="cb34-876"><a href="#cb34-876" aria-hidden="true" tabindex="-1"></a>      <span class="dt">w</span><span class="op">:</span> w<span class="op">,</span></span>
<span id="cb34-877"><a href="#cb34-877" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> {</span>
<span id="cb34-878"><a href="#cb34-878" aria-hidden="true" tabindex="-1"></a>        <span class="dt">type</span><span class="op">:</span> <span class="st">"typo"</span><span class="op">,</span></span>
<span id="cb34-879"><a href="#cb34-879" aria-hidden="true" tabindex="-1"></a>        <span class="dt">values</span><span class="op">:</span> <span class="st">"federation"</span><span class="op">,</span></span>
<span id="cb34-880"><a href="#cb34-880" aria-hidden="true" tabindex="-1"></a>        <span class="dt">colors</span><span class="op">:</span> [<span class="st">"#9990f0"</span><span class="op">,</span> <span class="st">"#fcb456"</span><span class="op">,</span> <span class="st">"#ba0b25"</span>]<span class="op">,</span></span>
<span id="cb34-881"><a href="#cb34-881" aria-hidden="true" tabindex="-1"></a>        <span class="dt">leg_title</span><span class="op">:</span> <span class="vs">`Wall's managers`</span><span class="op">,</span></span>
<span id="cb34-882"><a href="#cb34-882" aria-hidden="true" tabindex="-1"></a>        <span class="dt">leg_x</span><span class="op">:</span> <span class="dv">600</span><span class="op">,</span></span>
<span id="cb34-883"><a href="#cb34-883" aria-hidden="true" tabindex="-1"></a>        <span class="dt">leg_y</span><span class="op">:</span> <span class="dv">550</span></span>
<span id="cb34-884"><a href="#cb34-884" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb34-885"><a href="#cb34-885" aria-hidden="true" tabindex="-1"></a>      <span class="dt">stroke</span><span class="op">:</span> {</span>
<span id="cb34-886"><a href="#cb34-886" aria-hidden="true" tabindex="-1"></a>        <span class="dt">type</span><span class="op">:</span> <span class="st">"typo"</span><span class="op">,</span></span>
<span id="cb34-887"><a href="#cb34-887" aria-hidden="true" tabindex="-1"></a>        <span class="dt">values</span><span class="op">:</span> <span class="st">"federation"</span><span class="op">,</span></span>
<span id="cb34-888"><a href="#cb34-888" aria-hidden="true" tabindex="-1"></a>        <span class="dt">colors</span><span class="op">:</span> [<span class="st">"#9990f0"</span><span class="op">,</span> <span class="st">"#fcb456"</span><span class="op">,</span> <span class="st">"#ba0b25"</span>]</span>
<span id="cb34-889"><a href="#cb34-889" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb34-890"><a href="#cb34-890" aria-hidden="true" tabindex="-1"></a>      <span class="dt">leg_x</span><span class="op">:</span> <span class="dv">15</span><span class="op">,</span></span>
<span id="cb34-891"><a href="#cb34-891" aria-hidden="true" tabindex="-1"></a>      <span class="dt">leg_y</span><span class="op">:</span> <span class="dv">15</span><span class="op">,</span></span>
<span id="cb34-892"><a href="#cb34-892" aria-hidden="true" tabindex="-1"></a>      <span class="dt">leg_round</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb34-893"><a href="#cb34-893" aria-hidden="true" tabindex="-1"></a>      <span class="dt">leg_title</span><span class="op">:</span> <span class="vs">`Height (meters) or routes number`</span><span class="op">,</span></span>
<span id="cb34-894"><a href="#cb34-894" aria-hidden="true" tabindex="-1"></a>      <span class="dt">tooltip</span><span class="op">:</span> {</span>
<span id="cb34-895"><a href="#cb34-895" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fields</span><span class="op">:</span> [</span>
<span id="cb34-896"><a href="#cb34-896" aria-hidden="true" tabindex="-1"></a>          <span class="st">"$name"</span><span class="op">,</span></span>
<span id="cb34-897"><a href="#cb34-897" aria-hidden="true" tabindex="-1"></a>          <span class="st">"$climbing_length"</span><span class="op">,</span></span>
<span id="cb34-898"><a href="#cb34-898" aria-hidden="true" tabindex="-1"></a>          <span class="st">"(height in meters)"</span><span class="op">,</span></span>
<span id="cb34-899"><a href="#cb34-899" aria-hidden="true" tabindex="-1"></a>          <span class="st">"$climbing_routes"</span><span class="op">,</span></span>
<span id="cb34-900"><a href="#cb34-900" aria-hidden="true" tabindex="-1"></a>          <span class="st">"(nb. routes)"</span><span class="op">,</span></span>
<span id="cb34-901"><a href="#cb34-901" aria-hidden="true" tabindex="-1"></a>          <span class="st">"$federation"</span><span class="op">,</span></span>
<span id="cb34-902"><a href="#cb34-902" aria-hidden="true" tabindex="-1"></a>          <span class="st">"(manager)"</span></span>
<span id="cb34-903"><a href="#cb34-903" aria-hidden="true" tabindex="-1"></a>        ]<span class="op">,</span></span>
<span id="cb34-904"><a href="#cb34-904" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fill</span><span class="op">:</span> [<span class="st">"black"</span><span class="op">,</span> <span class="st">"black"</span><span class="op">,</span> <span class="st">"black"</span><span class="op">,</span> <span class="st">"black"</span><span class="op">,</span> <span class="st">"black"</span><span class="op">,</span> <span class="st">"black"</span><span class="op">,</span> <span class="st">"black"</span>]<span class="op">,</span></span>
<span id="cb34-905"><a href="#cb34-905" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fontWeight</span><span class="op">:</span> [</span>
<span id="cb34-906"><a href="#cb34-906" aria-hidden="true" tabindex="-1"></a>          <span class="st">"bold"</span><span class="op">,</span></span>
<span id="cb34-907"><a href="#cb34-907" aria-hidden="true" tabindex="-1"></a>          <span class="st">"normal"</span><span class="op">,</span></span>
<span id="cb34-908"><a href="#cb34-908" aria-hidden="true" tabindex="-1"></a>          <span class="st">"normal"</span><span class="op">,</span></span>
<span id="cb34-909"><a href="#cb34-909" aria-hidden="true" tabindex="-1"></a>          <span class="st">"normal"</span><span class="op">,</span></span>
<span id="cb34-910"><a href="#cb34-910" aria-hidden="true" tabindex="-1"></a>          <span class="st">"normal"</span><span class="op">,</span></span>
<span id="cb34-911"><a href="#cb34-911" aria-hidden="true" tabindex="-1"></a>          <span class="st">"normal"</span><span class="op">,</span></span>
<span id="cb34-912"><a href="#cb34-912" aria-hidden="true" tabindex="-1"></a>          <span class="st">"normal"</span></span>
<span id="cb34-913"><a href="#cb34-913" aria-hidden="true" tabindex="-1"></a>        ]<span class="op">,</span></span>
<span id="cb34-914"><a href="#cb34-914" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fontSize</span><span class="op">:</span> [<span class="dv">14</span><span class="op">,</span> <span class="dv">12</span><span class="op">,</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">12</span><span class="op">,</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">12</span><span class="op">,</span> <span class="dv">10</span>]<span class="op">,</span></span>
<span id="cb34-915"><a href="#cb34-915" aria-hidden="true" tabindex="-1"></a>        <span class="dt">col</span><span class="op">:</span> <span class="st">"white"</span></span>
<span id="cb34-916"><a href="#cb34-916" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb34-917"><a href="#cb34-917" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb34-918"><a href="#cb34-918" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-919"><a href="#cb34-919" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb34-920"><a href="#cb34-920" aria-hidden="true" tabindex="-1"></a>      <span class="dt">geojson</span><span class="op">:</span> poi<span class="op">,</span></span>
<span id="cb34-921"><a href="#cb34-921" aria-hidden="true" tabindex="-1"></a>      <span class="dt">symbol_size</span><span class="op">:</span> <span class="dv">10</span> <span class="op">*</span> w<span class="op">,</span></span>
<span id="cb34-922"><a href="#cb34-922" aria-hidden="true" tabindex="-1"></a>      <span class="dt">symbol</span><span class="op">:</span> <span class="st">"circle"</span><span class="op">,</span></span>
<span id="cb34-923"><a href="#cb34-923" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> {</span>
<span id="cb34-924"><a href="#cb34-924" aria-hidden="true" tabindex="-1"></a>        <span class="dt">type</span><span class="op">:</span> <span class="st">"typo"</span><span class="op">,</span></span>
<span id="cb34-925"><a href="#cb34-925" aria-hidden="true" tabindex="-1"></a>        <span class="dt">values</span><span class="op">:</span> <span class="st">"climbing_type"</span><span class="op">,</span></span>
<span id="cb34-926"><a href="#cb34-926" aria-hidden="true" tabindex="-1"></a>        <span class="dt">colors</span><span class="op">:</span> [<span class="st">"white"</span><span class="op">,</span> <span class="st">"lightgrey"</span><span class="op">,</span> <span class="st">"grey"</span>]<span class="op">,</span></span>
<span id="cb34-927"><a href="#cb34-927" aria-hidden="true" tabindex="-1"></a>        <span class="dt">leg_title</span><span class="op">:</span> <span class="vs">`Climbing type`</span><span class="op">,</span></span>
<span id="cb34-928"><a href="#cb34-928" aria-hidden="true" tabindex="-1"></a>        <span class="dt">leg_x</span><span class="op">:</span> <span class="dv">600</span><span class="op">,</span></span>
<span id="cb34-929"><a href="#cb34-929" aria-hidden="true" tabindex="-1"></a>        <span class="dt">leg_y</span><span class="op">:</span> <span class="dv">430</span></span>
<span id="cb34-930"><a href="#cb34-930" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb34-931"><a href="#cb34-931" aria-hidden="true" tabindex="-1"></a>      <span class="dt">stroke</span><span class="op">:</span> {</span>
<span id="cb34-932"><a href="#cb34-932" aria-hidden="true" tabindex="-1"></a>        <span class="dt">type</span><span class="op">:</span> <span class="st">"typo"</span><span class="op">,</span></span>
<span id="cb34-933"><a href="#cb34-933" aria-hidden="true" tabindex="-1"></a>        <span class="dt">values</span><span class="op">:</span> <span class="st">"federation"</span><span class="op">,</span></span>
<span id="cb34-934"><a href="#cb34-934" aria-hidden="true" tabindex="-1"></a>        <span class="dt">colors</span><span class="op">:</span> [<span class="st">"#9990f0"</span><span class="op">,</span> <span class="st">"#fcb456"</span><span class="op">,</span> <span class="st">"#ba0b25"</span>]</span>
<span id="cb34-935"><a href="#cb34-935" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb34-936"><a href="#cb34-936" aria-hidden="true" tabindex="-1"></a>      <span class="dt">strokeWidth</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span></span>
<span id="cb34-937"><a href="#cb34-937" aria-hidden="true" tabindex="-1"></a>      <span class="dt">tooltip</span><span class="op">:</span> {</span>
<span id="cb34-938"><a href="#cb34-938" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fields</span><span class="op">:</span> [<span class="st">"$name"</span><span class="op">,</span> <span class="st">"$climbing_type"</span>]<span class="op">,</span></span>
<span id="cb34-939"><a href="#cb34-939" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fill</span><span class="op">:</span> [<span class="st">"black"</span><span class="op">,</span> <span class="st">"black"</span>]<span class="op">,</span></span>
<span id="cb34-940"><a href="#cb34-940" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fontWeight</span><span class="op">:</span> [<span class="st">"bold"</span><span class="op">,</span> <span class="st">"normal"</span>]<span class="op">,</span></span>
<span id="cb34-941"><a href="#cb34-941" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fontSize</span><span class="op">:</span> [<span class="dv">12</span><span class="op">,</span> <span class="dv">10</span>]<span class="op">,</span></span>
<span id="cb34-942"><a href="#cb34-942" aria-hidden="true" tabindex="-1"></a>        <span class="dt">col</span><span class="op">:</span> <span class="st">"white"</span></span>
<span id="cb34-943"><a href="#cb34-943" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb34-944"><a href="#cb34-944" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb34-945"><a href="#cb34-945" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-946"><a href="#cb34-946" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb34-947"><a href="#cb34-947" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"text"</span><span class="op">,</span></span>
<span id="cb34-948"><a href="#cb34-948" aria-hidden="true" tabindex="-1"></a>      <span class="dt">position</span><span class="op">:</span> <span class="st">"topright"</span><span class="op">,</span></span>
<span id="cb34-949"><a href="#cb34-949" aria-hidden="true" tabindex="-1"></a>      <span class="dt">text</span><span class="op">:</span> <span class="st">"Climbing hot spots"</span><span class="op">,</span></span>
<span id="cb34-950"><a href="#cb34-950" aria-hidden="true" tabindex="-1"></a>      <span class="dt">frame_opacity</span><span class="op">:</span> <span class="fl">0.7</span><span class="op">,</span></span>
<span id="cb34-951"><a href="#cb34-951" aria-hidden="true" tabindex="-1"></a>      <span class="dt">baseline</span><span class="op">:</span> <span class="st">"hanging"</span><span class="op">,</span></span>
<span id="cb34-952"><a href="#cb34-952" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> <span class="st">"black"</span><span class="op">,</span></span>
<span id="cb34-953"><a href="#cb34-953" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fontSize</span><span class="op">:</span> <span class="dv">25</span><span class="op">,</span></span>
<span id="cb34-954"><a href="#cb34-954" aria-hidden="true" tabindex="-1"></a>      <span class="dt">margin</span><span class="op">:</span> <span class="dv">4</span><span class="op">,</span></span>
<span id="cb34-955"><a href="#cb34-955" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fontWeight</span><span class="op">:</span> <span class="st">"bold"</span><span class="op">,</span></span>
<span id="cb34-956"><a href="#cb34-956" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fontFamily</span><span class="op">:</span> <span class="st">"Ubuntu"</span></span>
<span id="cb34-957"><a href="#cb34-957" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb34-958"><a href="#cb34-958" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-959"><a href="#cb34-959" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb34-960"><a href="#cb34-960" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"layer"</span><span class="op">,</span></span>
<span id="cb34-961"><a href="#cb34-961" aria-hidden="true" tabindex="-1"></a>      <span class="dt">geojson</span><span class="op">:</span> com<span class="op">,</span></span>
<span id="cb34-962"><a href="#cb34-962" aria-hidden="true" tabindex="-1"></a>      <span class="dt">stroke</span><span class="op">:</span> <span class="st">"white"</span><span class="op">,</span></span>
<span id="cb34-963"><a href="#cb34-963" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> <span class="st">"peachpuff"</span><span class="op">,</span></span>
<span id="cb34-964"><a href="#cb34-964" aria-hidden="true" tabindex="-1"></a>      <span class="dt">tooltip</span><span class="op">:</span> [<span class="st">"$NOM_COM"</span>]</span>
<span id="cb34-965"><a href="#cb34-965" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb34-966"><a href="#cb34-966" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-967"><a href="#cb34-967" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb34-968"><a href="#cb34-968" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"scalebar"</span><span class="op">,</span></span>
<span id="cb34-969"><a href="#cb34-969" aria-hidden="true" tabindex="-1"></a>      <span class="dt">units</span><span class="op">:</span> <span class="st">"miles"</span></span>
<span id="cb34-970"><a href="#cb34-970" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb34-971"><a href="#cb34-971" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-972"><a href="#cb34-972" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb34-973"><a href="#cb34-973" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"footer"</span><span class="op">,</span></span>
<span id="cb34-974"><a href="#cb34-974" aria-hidden="true" tabindex="-1"></a>      <span class="dt">text</span><span class="op">:</span></span>
<span id="cb34-975"><a href="#cb34-975" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Sources: (c)OpenStreetMap and contributors, INSEE, IGN, 2022</span><span class="sc">\n</span><span class="st">Realisation: Ronan Ysebaert, 2022"</span></span>
<span id="cb34-976"><a href="#cb34-976" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb34-977"><a href="#cb34-977" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb34-978"><a href="#cb34-978" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb34-979"><a href="#cb34-979" aria-hidden="true" tabindex="-1"></a><span class="vs">```</span></span>
<span id="cb34-980"><a href="#cb34-980" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-981"><a href="#cb34-981" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-982"><a href="#cb34-982" aria-hidden="true" tabindex="-1"></a><span class="vs">## Nearest wall</span></span>
<span id="cb34-983"><a href="#cb34-983" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-984"><a href="#cb34-984" aria-hidden="true" tabindex="-1"></a><span class="vs">The nearest climbing area by bike from each populated IRIS by wall manager: private or associative (FSGT or FFME).</span></span>
<span id="cb34-985"><a href="#cb34-985" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-988"><a href="#cb34-988" aria-hidden="true" tabindex="-1"></a><span class="vs">```</span>ojs</span>
<span id="cb34-989"><a href="#cb34-989" aria-hidden="true" tabindex="-1"></a><span class="co">// Categorical map with tooltips</span></span>
<span id="cb34-990"><a href="#cb34-990" aria-hidden="true" tabindex="-1"></a>map2 <span class="op">=</span> bertin<span class="op">.</span><span class="fu">draw</span>({</span>
<span id="cb34-991"><a href="#cb34-991" aria-hidden="true" tabindex="-1"></a>  <span class="dt">params</span><span class="op">:</span> {</span>
<span id="cb34-992"><a href="#cb34-992" aria-hidden="true" tabindex="-1"></a>    <span class="dt">width</span><span class="op">:</span> <span class="dv">750</span><span class="op">,</span></span>
<span id="cb34-993"><a href="#cb34-993" aria-hidden="true" tabindex="-1"></a>    <span class="dt">projection</span><span class="op">:</span> lambert93<span class="op">,</span></span>
<span id="cb34-994"><a href="#cb34-994" aria-hidden="true" tabindex="-1"></a>    <span class="dt">extent</span><span class="op">:</span> com</span>
<span id="cb34-995"><a href="#cb34-995" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb34-996"><a href="#cb34-996" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-997"><a href="#cb34-997" aria-hidden="true" tabindex="-1"></a>  <span class="dt">layers</span><span class="op">:</span> [</span>
<span id="cb34-998"><a href="#cb34-998" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb34-999"><a href="#cb34-999" aria-hidden="true" tabindex="-1"></a>      <span class="dt">geojson</span><span class="op">:</span> poi<span class="op">,</span></span>
<span id="cb34-1000"><a href="#cb34-1000" aria-hidden="true" tabindex="-1"></a>      <span class="dt">symbol_size</span><span class="op">:</span> <span class="dv">100</span><span class="op">,</span></span>
<span id="cb34-1001"><a href="#cb34-1001" aria-hidden="true" tabindex="-1"></a>      <span class="dt">symbol</span><span class="op">:</span> <span class="st">"circle"</span><span class="op">,</span></span>
<span id="cb34-1002"><a href="#cb34-1002" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> <span class="st">"white"</span><span class="op">,</span></span>
<span id="cb34-1003"><a href="#cb34-1003" aria-hidden="true" tabindex="-1"></a>      <span class="dt">strokeWidth</span><span class="op">:</span> <span class="fl">2.5</span><span class="op">,</span></span>
<span id="cb34-1004"><a href="#cb34-1004" aria-hidden="true" tabindex="-1"></a>      <span class="dt">stroke</span><span class="op">:</span> {</span>
<span id="cb34-1005"><a href="#cb34-1005" aria-hidden="true" tabindex="-1"></a>        <span class="dt">type</span><span class="op">:</span> <span class="st">"typo"</span><span class="op">,</span></span>
<span id="cb34-1006"><a href="#cb34-1006" aria-hidden="true" tabindex="-1"></a>        <span class="dt">values</span><span class="op">:</span> <span class="st">"federation"</span><span class="op">,</span></span>
<span id="cb34-1007"><a href="#cb34-1007" aria-hidden="true" tabindex="-1"></a>        <span class="dt">colors</span><span class="op">:</span> [<span class="st">"#9990f0"</span><span class="op">,</span> <span class="st">"#fcb456"</span><span class="op">,</span> <span class="st">"#ba0b25"</span>]</span>
<span id="cb34-1008"><a href="#cb34-1008" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb34-1009"><a href="#cb34-1009" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb34-1010"><a href="#cb34-1010" aria-hidden="true" tabindex="-1"></a>      <span class="dt">tooltip</span><span class="op">:</span> {</span>
<span id="cb34-1011"><a href="#cb34-1011" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fields</span><span class="op">:</span> [<span class="st">"$name"</span><span class="op">,</span> <span class="st">"$federation"</span>]<span class="op">,</span></span>
<span id="cb34-1012"><a href="#cb34-1012" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fill</span><span class="op">:</span> [<span class="st">"black"</span><span class="op">,</span> <span class="st">"black"</span>]<span class="op">,</span></span>
<span id="cb34-1013"><a href="#cb34-1013" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fontWeight</span><span class="op">:</span> [<span class="st">"bold"</span><span class="op">,</span> <span class="st">"normal"</span>]<span class="op">,</span></span>
<span id="cb34-1014"><a href="#cb34-1014" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fontSize</span><span class="op">:</span> [<span class="dv">12</span><span class="op">,</span> <span class="dv">10</span>]<span class="op">,</span></span>
<span id="cb34-1015"><a href="#cb34-1015" aria-hidden="true" tabindex="-1"></a>        <span class="dt">col</span><span class="op">:</span> <span class="st">"white"</span></span>
<span id="cb34-1016"><a href="#cb34-1016" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb34-1017"><a href="#cb34-1017" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb34-1018"><a href="#cb34-1018" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb34-1019"><a href="#cb34-1019" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb34-1020"><a href="#cb34-1020" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"text"</span><span class="op">,</span></span>
<span id="cb34-1021"><a href="#cb34-1021" aria-hidden="true" tabindex="-1"></a>      <span class="dt">position</span><span class="op">:</span> <span class="st">"topright"</span><span class="op">,</span></span>
<span id="cb34-1022"><a href="#cb34-1022" aria-hidden="true" tabindex="-1"></a>      <span class="dt">text</span><span class="op">:</span> <span class="st">"Nearest climbing area</span><span class="sc">\n</span><span class="st">manager"</span><span class="op">,</span></span>
<span id="cb34-1023"><a href="#cb34-1023" aria-hidden="true" tabindex="-1"></a>      <span class="dt">frame_opacity</span><span class="op">:</span> <span class="fl">0.7</span><span class="op">,</span></span>
<span id="cb34-1024"><a href="#cb34-1024" aria-hidden="true" tabindex="-1"></a>      <span class="dt">baseline</span><span class="op">:</span> <span class="st">"hanging"</span><span class="op">,</span></span>
<span id="cb34-1025"><a href="#cb34-1025" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> <span class="st">"black"</span><span class="op">,</span></span>
<span id="cb34-1026"><a href="#cb34-1026" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fontSize</span><span class="op">:</span> <span class="dv">25</span><span class="op">,</span></span>
<span id="cb34-1027"><a href="#cb34-1027" aria-hidden="true" tabindex="-1"></a>      <span class="dt">margin</span><span class="op">:</span> <span class="dv">4</span><span class="op">,</span></span>
<span id="cb34-1028"><a href="#cb34-1028" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fontWeight</span><span class="op">:</span> <span class="st">"bold"</span><span class="op">,</span></span>
<span id="cb34-1029"><a href="#cb34-1029" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fontFamily</span><span class="op">:</span> <span class="st">"Ubuntu"</span></span>
<span id="cb34-1030"><a href="#cb34-1030" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb34-1031"><a href="#cb34-1031" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1032"><a href="#cb34-1032" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb34-1033"><a href="#cb34-1033" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"layer"</span><span class="op">,</span></span>
<span id="cb34-1034"><a href="#cb34-1034" aria-hidden="true" tabindex="-1"></a>      <span class="dt">geojson</span><span class="op">:</span> com<span class="op">,</span></span>
<span id="cb34-1035"><a href="#cb34-1035" aria-hidden="true" tabindex="-1"></a>      <span class="dt">stroke</span><span class="op">:</span> <span class="st">"black"</span><span class="op">,</span></span>
<span id="cb34-1036"><a href="#cb34-1036" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> <span class="st">"none"</span></span>
<span id="cb34-1037"><a href="#cb34-1037" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb34-1038"><a href="#cb34-1038" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1039"><a href="#cb34-1039" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb34-1040"><a href="#cb34-1040" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"layer"</span><span class="op">,</span></span>
<span id="cb34-1041"><a href="#cb34-1041" aria-hidden="true" tabindex="-1"></a>      <span class="dt">geojson</span><span class="op">:</span> iris<span class="op">,</span></span>
<span id="cb34-1042"><a href="#cb34-1042" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> {</span>
<span id="cb34-1043"><a href="#cb34-1043" aria-hidden="true" tabindex="-1"></a>        <span class="dt">type</span><span class="op">:</span> <span class="st">"typo"</span><span class="op">,</span></span>
<span id="cb34-1044"><a href="#cb34-1044" aria-hidden="true" tabindex="-1"></a>        <span class="dt">values</span><span class="op">:</span> <span class="st">"TYPE_STRUCT"</span><span class="op">,</span></span>
<span id="cb34-1045"><a href="#cb34-1045" aria-hidden="true" tabindex="-1"></a>        <span class="dt">strokeWidth</span><span class="op">:</span> <span class="fl">0.3</span><span class="op">,</span></span>
<span id="cb34-1046"><a href="#cb34-1046" aria-hidden="true" tabindex="-1"></a>        <span class="dt">colors</span><span class="op">:</span> [<span class="st">"#fcb45680"</span><span class="op">,</span> <span class="st">"#ba0b2580"</span><span class="op">,</span> <span class="st">"#9990f080"</span>]<span class="op">,</span></span>
<span id="cb34-1047"><a href="#cb34-1047" aria-hidden="true" tabindex="-1"></a>        <span class="dt">leg_title</span><span class="op">:</span> <span class="vs">`Manager name`</span><span class="op">,</span></span>
<span id="cb34-1048"><a href="#cb34-1048" aria-hidden="true" tabindex="-1"></a>        <span class="dt">leg_x</span><span class="op">:</span> <span class="dv">15</span><span class="op">,</span></span>
<span id="cb34-1049"><a href="#cb34-1049" aria-hidden="true" tabindex="-1"></a>        <span class="dt">leg_y</span><span class="op">:</span> <span class="dv">15</span><span class="op">,</span></span>
<span id="cb34-1050"><a href="#cb34-1050" aria-hidden="true" tabindex="-1"></a>        <span class="dt">col_missing</span><span class="op">:</span> <span class="st">"lightgrey"</span><span class="op">,</span></span>
<span id="cb34-1051"><a href="#cb34-1051" aria-hidden="true" tabindex="-1"></a>        <span class="dt">txt_missing</span><span class="op">:</span> <span class="st">"Non dedicated to housing"</span></span>
<span id="cb34-1052"><a href="#cb34-1052" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb34-1053"><a href="#cb34-1053" aria-hidden="true" tabindex="-1"></a>      <span class="dt">tooltip</span><span class="op">:</span> {</span>
<span id="cb34-1054"><a href="#cb34-1054" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fields</span><span class="op">:</span> [</span>
<span id="cb34-1055"><a href="#cb34-1055" aria-hidden="true" tabindex="-1"></a>          <span class="st">"$NOM_IRIS"</span><span class="op">,</span></span>
<span id="cb34-1056"><a href="#cb34-1056" aria-hidden="true" tabindex="-1"></a>          <span class="st">"$ALL_NAME"</span><span class="op">,</span></span>
<span id="cb34-1057"><a href="#cb34-1057" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Name of the nearest artificial climbing structure"</span></span>
<span id="cb34-1058"><a href="#cb34-1058" aria-hidden="true" tabindex="-1"></a>        ]<span class="op">,</span></span>
<span id="cb34-1059"><a href="#cb34-1059" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fill</span><span class="op">:</span> <span class="st">"white"</span><span class="op">,</span></span>
<span id="cb34-1060"><a href="#cb34-1060" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fontWeight</span><span class="op">:</span> [<span class="st">"bold"</span><span class="op">,</span> <span class="st">"normal"</span><span class="op">,</span> <span class="st">"normal"</span>]<span class="op">,</span></span>
<span id="cb34-1061"><a href="#cb34-1061" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fontSize</span><span class="op">:</span> [<span class="dv">11</span><span class="op">,</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">8</span>]<span class="op">,</span></span>
<span id="cb34-1062"><a href="#cb34-1062" aria-hidden="true" tabindex="-1"></a>        <span class="dt">col</span><span class="op">:</span> [<span class="st">"black"</span><span class="op">,</span> <span class="st">"black"</span><span class="op">,</span> <span class="st">"black"</span>]</span>
<span id="cb34-1063"><a href="#cb34-1063" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb34-1064"><a href="#cb34-1064" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb34-1065"><a href="#cb34-1065" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1066"><a href="#cb34-1066" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb34-1067"><a href="#cb34-1067" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"scalebar"</span><span class="op">,</span></span>
<span id="cb34-1068"><a href="#cb34-1068" aria-hidden="true" tabindex="-1"></a>      <span class="dt">units</span><span class="op">:</span> <span class="st">"miles"</span><span class="op">,</span></span>
<span id="cb34-1069"><a href="#cb34-1069" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb34-1070"><a href="#cb34-1070" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb34-1071"><a href="#cb34-1071" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb34-1072"><a href="#cb34-1072" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"footer"</span><span class="op">,</span></span>
<span id="cb34-1073"><a href="#cb34-1073" aria-hidden="true" tabindex="-1"></a>      <span class="dt">text</span><span class="op">:</span></span>
<span id="cb34-1074"><a href="#cb34-1074" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Sources: (c)OpenStreetMap and contributors, INSEE, IGN, 2022</span><span class="sc">\n</span><span class="st">Realisation: Ronan Ysebaert, 2022"</span></span>
<span id="cb34-1075"><a href="#cb34-1075" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb34-1076"><a href="#cb34-1076" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb34-1077"><a href="#cb34-1077" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb34-1078"><a href="#cb34-1078" aria-hidden="true" tabindex="-1"></a><span class="vs">```</span></span>
<span id="cb34-1079"><a href="#cb34-1079" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1080"><a href="#cb34-1080" aria-hidden="true" tabindex="-1"></a><span class="vs">## Time to climb</span></span>
<span id="cb34-1081"><a href="#cb34-1081" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1082"><a href="#cb34-1082" aria-hidden="true" tabindex="-1"></a><span class="vs">It displays the time by bike required to reach the nearest climbing area, for all structures or by manager type. </span></span>
<span id="cb34-1083"><a href="#cb34-1083" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1086"><a href="#cb34-1086" aria-hidden="true" tabindex="-1"></a><span class="vs">```</span>ojs</span>
<span id="cb34-1087"><a href="#cb34-1087" aria-hidden="true" tabindex="-1"></a><span class="co">// Map parameters to play with it</span></span>
<span id="cb34-1088"><a href="#cb34-1088" aria-hidden="true" tabindex="-1"></a><span class="co">// select indicator</span></span>
<span id="cb34-1089"><a href="#cb34-1089" aria-hidden="true" tabindex="-1"></a>viewof ind2 <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">radio</span>([<span class="st">"ALL_TIME"</span><span class="op">,</span> <span class="st">"PRIV_TIME"</span><span class="op">,</span> <span class="st">"FSGT_TIME"</span><span class="op">,</span> <span class="st">"FFME_TIME"</span>]<span class="op">,</span></span>
<span id="cb34-1090"><a href="#cb34-1090" aria-hidden="true" tabindex="-1"></a>{<span class="dt">value</span><span class="op">:</span> <span class="st">"ALL_TIME"</span>})</span>
<span id="cb34-1091"><a href="#cb34-1091" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1092"><a href="#cb34-1092" aria-hidden="true" tabindex="-1"></a><span class="co">// Discretization method</span></span>
<span id="cb34-1093"><a href="#cb34-1093" aria-hidden="true" tabindex="-1"></a>viewof method2 <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">select</span>([<span class="st">"jenks"</span><span class="op">,</span> <span class="st">"q6"</span><span class="op">,</span> <span class="st">"quantile"</span><span class="op">,</span> <span class="st">"equal"</span><span class="op">,</span> <span class="st">"msd"</span>]<span class="op">,</span> {</span>
<span id="cb34-1094"><a href="#cb34-1094" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="st">"method"</span><span class="op">,</span></span>
<span id="cb34-1095"><a href="#cb34-1095" aria-hidden="true" tabindex="-1"></a>  <span class="dt">value</span><span class="op">:</span> <span class="st">"quantile"</span></span>
<span id="cb34-1096"><a href="#cb34-1096" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb34-1097"><a href="#cb34-1097" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1098"><a href="#cb34-1098" aria-hidden="true" tabindex="-1"></a><span class="co">// nbreaks</span></span>
<span id="cb34-1099"><a href="#cb34-1099" aria-hidden="true" tabindex="-1"></a>viewof nbreaks2 <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">3</span><span class="op">,</span> <span class="dv">9</span>]<span class="op">,</span> { <span class="dt">label</span><span class="op">:</span> <span class="st">"nbreaks"</span><span class="op">,</span> <span class="dt">step</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="dv">8</span> })</span>
<span id="cb34-1100"><a href="#cb34-1100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1101"><a href="#cb34-1101" aria-hidden="true" tabindex="-1"></a><span class="co">// color palettes</span></span>
<span id="cb34-1102"><a href="#cb34-1102" aria-hidden="true" tabindex="-1"></a>viewof pal2 <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">select</span>(</span>
<span id="cb34-1103"><a href="#cb34-1103" aria-hidden="true" tabindex="-1"></a>  [<span class="st">"Blues"</span><span class="op">,</span>  <span class="st">"Greens"</span><span class="op">,</span>  <span class="st">"Greys"</span><span class="op">,</span> <span class="st">"Oranges"</span><span class="op">,</span> <span class="st">"Purples"</span><span class="op">,</span> <span class="st">"BuGn"</span><span class="op">,</span> <span class="st">"BuPu"</span><span class="op">,</span> <span class="st">"GnBu"</span><span class="op">,</span></span>
<span id="cb34-1104"><a href="#cb34-1104" aria-hidden="true" tabindex="-1"></a>  <span class="st">"OrRd"</span><span class="op">,</span> <span class="st">"PuBuGn"</span><span class="op">,</span> <span class="st">"PuBu"</span><span class="op">,</span> <span class="st">"PuRd"</span><span class="op">,</span> <span class="st">"RdPu"</span><span class="op">,</span> <span class="st">"YlGnBu"</span><span class="op">,</span> <span class="st">"YlGn"</span><span class="op">,</span> <span class="st">"YlOrBr"</span><span class="op">,</span> <span class="st">"YlOrRd"</span><span class="op">,</span></span>
<span id="cb34-1105"><a href="#cb34-1105" aria-hidden="true" tabindex="-1"></a>  <span class="st">"BrBG"</span><span class="op">,</span> <span class="st">"PRGn"</span><span class="op">,</span> <span class="st">"PiYG"</span><span class="op">,</span> <span class="st">"PuOr"</span><span class="op">,</span> <span class="st">"RdBu"</span><span class="op">,</span> <span class="st">"RdGy"</span><span class="op">,</span> <span class="st">"RdYlBu"</span><span class="op">,</span> <span class="st">"RdYlGn"</span><span class="op">,</span> <span class="st">"Spectral"</span> ]<span class="op">,</span></span>
<span id="cb34-1106"><a href="#cb34-1106" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb34-1107"><a href="#cb34-1107" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="st">"colors"</span><span class="op">,</span></span>
<span id="cb34-1108"><a href="#cb34-1108" aria-hidden="true" tabindex="-1"></a>    <span class="dt">value</span><span class="op">:</span> <span class="st">"RdYlBu"</span></span>
<span id="cb34-1109"><a href="#cb34-1109" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb34-1110"><a href="#cb34-1110" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb34-1111"><a href="#cb34-1111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1112"><a href="#cb34-1112" aria-hidden="true" tabindex="-1"></a><span class="co">// Choropleth map with tooltips</span></span>
<span id="cb34-1113"><a href="#cb34-1113" aria-hidden="true" tabindex="-1"></a>map3 <span class="op">=</span> bertin<span class="op">.</span><span class="fu">draw</span>({</span>
<span id="cb34-1114"><a href="#cb34-1114" aria-hidden="true" tabindex="-1"></a>  <span class="dt">params</span><span class="op">:</span> {</span>
<span id="cb34-1115"><a href="#cb34-1115" aria-hidden="true" tabindex="-1"></a>    <span class="dt">width</span><span class="op">:</span> <span class="dv">750</span><span class="op">,</span></span>
<span id="cb34-1116"><a href="#cb34-1116" aria-hidden="true" tabindex="-1"></a>    <span class="dt">projection</span><span class="op">:</span> lambert93<span class="op">,</span></span>
<span id="cb34-1117"><a href="#cb34-1117" aria-hidden="true" tabindex="-1"></a>    <span class="dt">extent</span><span class="op">:</span> com</span>
<span id="cb34-1118"><a href="#cb34-1118" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb34-1119"><a href="#cb34-1119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1120"><a href="#cb34-1120" aria-hidden="true" tabindex="-1"></a>  <span class="dt">layers</span><span class="op">:</span> [</span>
<span id="cb34-1121"><a href="#cb34-1121" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb34-1122"><a href="#cb34-1122" aria-hidden="true" tabindex="-1"></a>      <span class="dt">geojson</span><span class="op">:</span> poi<span class="op">,</span></span>
<span id="cb34-1123"><a href="#cb34-1123" aria-hidden="true" tabindex="-1"></a>      <span class="dt">symbol_size</span><span class="op">:</span> <span class="dv">100</span><span class="op">,</span></span>
<span id="cb34-1124"><a href="#cb34-1124" aria-hidden="true" tabindex="-1"></a>      <span class="dt">symbol</span><span class="op">:</span> <span class="st">"circle"</span><span class="op">,</span></span>
<span id="cb34-1125"><a href="#cb34-1125" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> <span class="st">"white"</span><span class="op">,</span></span>
<span id="cb34-1126"><a href="#cb34-1126" aria-hidden="true" tabindex="-1"></a>      <span class="dt">strokeWidth</span><span class="op">:</span> <span class="fl">2.5</span><span class="op">,</span></span>
<span id="cb34-1127"><a href="#cb34-1127" aria-hidden="true" tabindex="-1"></a>      <span class="dt">stroke</span><span class="op">:</span> {</span>
<span id="cb34-1128"><a href="#cb34-1128" aria-hidden="true" tabindex="-1"></a>        <span class="dt">type</span><span class="op">:</span> <span class="st">"typo"</span><span class="op">,</span></span>
<span id="cb34-1129"><a href="#cb34-1129" aria-hidden="true" tabindex="-1"></a>        <span class="dt">values</span><span class="op">:</span> <span class="st">"federation"</span><span class="op">,</span></span>
<span id="cb34-1130"><a href="#cb34-1130" aria-hidden="true" tabindex="-1"></a>        <span class="dt">colors</span><span class="op">:</span> [<span class="st">"#9990f0"</span><span class="op">,</span> <span class="st">"#fcb456"</span><span class="op">,</span> <span class="st">"#ba0b25"</span>]</span>
<span id="cb34-1131"><a href="#cb34-1131" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb34-1132"><a href="#cb34-1132" aria-hidden="true" tabindex="-1"></a>      <span class="dt">tooltip</span><span class="op">:</span> {</span>
<span id="cb34-1133"><a href="#cb34-1133" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fields</span><span class="op">:</span> [<span class="st">"$name"</span><span class="op">,</span> <span class="st">"$federation"</span>]<span class="op">,</span></span>
<span id="cb34-1134"><a href="#cb34-1134" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fill</span><span class="op">:</span> [<span class="st">"black"</span><span class="op">,</span> <span class="st">"black"</span>]<span class="op">,</span></span>
<span id="cb34-1135"><a href="#cb34-1135" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fontWeight</span><span class="op">:</span> [<span class="st">"bold"</span><span class="op">,</span> <span class="st">"normal"</span>]<span class="op">,</span></span>
<span id="cb34-1136"><a href="#cb34-1136" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fontSize</span><span class="op">:</span> [<span class="dv">12</span><span class="op">,</span> <span class="dv">10</span>]<span class="op">,</span></span>
<span id="cb34-1137"><a href="#cb34-1137" aria-hidden="true" tabindex="-1"></a>        <span class="dt">col</span><span class="op">:</span> <span class="st">"white"</span></span>
<span id="cb34-1138"><a href="#cb34-1138" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb34-1139"><a href="#cb34-1139" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb34-1140"><a href="#cb34-1140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1141"><a href="#cb34-1141" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb34-1142"><a href="#cb34-1142" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"text"</span><span class="op">,</span></span>
<span id="cb34-1143"><a href="#cb34-1143" aria-hidden="true" tabindex="-1"></a>      <span class="dt">position</span><span class="op">:</span> <span class="st">"topright"</span><span class="op">,</span></span>
<span id="cb34-1144"><a href="#cb34-1144" aria-hidden="true" tabindex="-1"></a>      <span class="dt">text</span><span class="op">:</span> <span class="st">"Time to reach the nearest</span><span class="sc">\n</span><span class="st">artificial climbing area"</span><span class="op">,</span></span>
<span id="cb34-1145"><a href="#cb34-1145" aria-hidden="true" tabindex="-1"></a>      <span class="dt">frame_opacity</span><span class="op">:</span> <span class="fl">0.7</span><span class="op">,</span></span>
<span id="cb34-1146"><a href="#cb34-1146" aria-hidden="true" tabindex="-1"></a>      <span class="dt">baseline</span><span class="op">:</span> <span class="st">"hanging"</span><span class="op">,</span></span>
<span id="cb34-1147"><a href="#cb34-1147" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> <span class="st">"black"</span><span class="op">,</span></span>
<span id="cb34-1148"><a href="#cb34-1148" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fontSize</span><span class="op">:</span> <span class="dv">25</span><span class="op">,</span></span>
<span id="cb34-1149"><a href="#cb34-1149" aria-hidden="true" tabindex="-1"></a>      <span class="dt">margin</span><span class="op">:</span> <span class="dv">4</span><span class="op">,</span></span>
<span id="cb34-1150"><a href="#cb34-1150" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fontWeight</span><span class="op">:</span> <span class="st">"bold"</span><span class="op">,</span></span>
<span id="cb34-1151"><a href="#cb34-1151" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fontFamily</span><span class="op">:</span> <span class="st">"Ubuntu"</span></span>
<span id="cb34-1152"><a href="#cb34-1152" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb34-1153"><a href="#cb34-1153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1154"><a href="#cb34-1154" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb34-1155"><a href="#cb34-1155" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"layer"</span><span class="op">,</span></span>
<span id="cb34-1156"><a href="#cb34-1156" aria-hidden="true" tabindex="-1"></a>      <span class="dt">geojson</span><span class="op">:</span> com<span class="op">,</span></span>
<span id="cb34-1157"><a href="#cb34-1157" aria-hidden="true" tabindex="-1"></a>      <span class="dt">stroke</span><span class="op">:</span> <span class="st">"black"</span><span class="op">,</span></span>
<span id="cb34-1158"><a href="#cb34-1158" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> <span class="st">"none"</span></span>
<span id="cb34-1159"><a href="#cb34-1159" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb34-1160"><a href="#cb34-1160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1161"><a href="#cb34-1161" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb34-1162"><a href="#cb34-1162" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"layer"</span><span class="op">,</span></span>
<span id="cb34-1163"><a href="#cb34-1163" aria-hidden="true" tabindex="-1"></a>      <span class="dt">geojson</span><span class="op">:</span> iris<span class="op">,</span></span>
<span id="cb34-1164"><a href="#cb34-1164" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> {</span>
<span id="cb34-1165"><a href="#cb34-1165" aria-hidden="true" tabindex="-1"></a>        <span class="dt">type</span><span class="op">:</span> <span class="st">"choro"</span><span class="op">,</span></span>
<span id="cb34-1166"><a href="#cb34-1166" aria-hidden="true" tabindex="-1"></a>        <span class="dt">values</span><span class="op">:</span> ind2<span class="op">,</span></span>
<span id="cb34-1167"><a href="#cb34-1167" aria-hidden="true" tabindex="-1"></a>        <span class="dt">nbreaks</span><span class="op">:</span> <span class="dv">8</span><span class="op">,</span></span>
<span id="cb34-1168"><a href="#cb34-1168" aria-hidden="true" tabindex="-1"></a>        <span class="dt">method</span><span class="op">:</span> method2<span class="op">,</span></span>
<span id="cb34-1169"><a href="#cb34-1169" aria-hidden="true" tabindex="-1"></a>        <span class="dt">colors</span><span class="op">:</span> pal2<span class="op">,</span></span>
<span id="cb34-1170"><a href="#cb34-1170" aria-hidden="true" tabindex="-1"></a>        <span class="dt">leg_round</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span></span>
<span id="cb34-1171"><a href="#cb34-1171" aria-hidden="true" tabindex="-1"></a>        <span class="dt">leg_title</span><span class="op">:</span> <span class="vs">`By bike (minutes)`</span><span class="op">,</span></span>
<span id="cb34-1172"><a href="#cb34-1172" aria-hidden="true" tabindex="-1"></a>        <span class="dt">leg_x</span><span class="op">:</span> <span class="dv">15</span><span class="op">,</span></span>
<span id="cb34-1173"><a href="#cb34-1173" aria-hidden="true" tabindex="-1"></a>        <span class="dt">leg_y</span><span class="op">:</span> <span class="dv">15</span><span class="op">,</span></span>
<span id="cb34-1174"><a href="#cb34-1174" aria-hidden="true" tabindex="-1"></a>        <span class="dt">col_missing</span><span class="op">:</span> <span class="st">"lightgrey"</span><span class="op">,</span></span>
<span id="cb34-1175"><a href="#cb34-1175" aria-hidden="true" tabindex="-1"></a>        <span class="dt">txt_missing</span><span class="op">:</span> <span class="st">"Non dedicated to housing"</span></span>
<span id="cb34-1176"><a href="#cb34-1176" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb34-1177"><a href="#cb34-1177" aria-hidden="true" tabindex="-1"></a>      <span class="dt">tooltip</span><span class="op">:</span> {</span>
<span id="cb34-1178"><a href="#cb34-1178" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fields</span><span class="op">:</span> [</span>
<span id="cb34-1179"><a href="#cb34-1179" aria-hidden="true" tabindex="-1"></a>          <span class="st">"$NOM_IRIS"</span><span class="op">,</span></span>
<span id="cb34-1180"><a href="#cb34-1180" aria-hidden="true" tabindex="-1"></a>          <span class="st">"$NOM_COM"</span><span class="op">,</span></span>
<span id="cb34-1181"><a href="#cb34-1181" aria-hidden="true" tabindex="-1"></a>          <span class="st">"$ALL_TIME"</span><span class="op">,</span></span>
<span id="cb34-1182"><a href="#cb34-1182" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Bike time to the nearest Indoor climbing area"</span></span>
<span id="cb34-1183"><a href="#cb34-1183" aria-hidden="true" tabindex="-1"></a>        ]<span class="op">,</span></span>
<span id="cb34-1184"><a href="#cb34-1184" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fill</span><span class="op">:</span> <span class="st">"white"</span><span class="op">,</span></span>
<span id="cb34-1185"><a href="#cb34-1185" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fontWeight</span><span class="op">:</span> [<span class="st">"bold"</span><span class="op">,</span> <span class="st">"normal"</span><span class="op">,</span> <span class="st">"normal"</span><span class="op">,</span> <span class="st">"normal"</span>]<span class="op">,</span></span>
<span id="cb34-1186"><a href="#cb34-1186" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fontSize</span><span class="op">:</span> [<span class="dv">11</span><span class="op">,</span> <span class="dv">11</span><span class="op">,</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">8</span>]<span class="op">,</span></span>
<span id="cb34-1187"><a href="#cb34-1187" aria-hidden="true" tabindex="-1"></a>        <span class="dt">col</span><span class="op">:</span> [<span class="st">"black"</span><span class="op">,</span> <span class="st">"black"</span><span class="op">,</span> <span class="st">"black"</span><span class="op">,</span> <span class="st">"black"</span>]</span>
<span id="cb34-1188"><a href="#cb34-1188" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb34-1189"><a href="#cb34-1189" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb34-1190"><a href="#cb34-1190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1191"><a href="#cb34-1191" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb34-1192"><a href="#cb34-1192" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"scalebar"</span><span class="op">,</span></span>
<span id="cb34-1193"><a href="#cb34-1193" aria-hidden="true" tabindex="-1"></a>      <span class="dt">units</span><span class="op">:</span> <span class="st">"kilometers"</span><span class="op">,</span></span>
<span id="cb34-1194"><a href="#cb34-1194" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb34-1195"><a href="#cb34-1195" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb34-1196"><a href="#cb34-1196" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb34-1197"><a href="#cb34-1197" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"footer"</span><span class="op">,</span></span>
<span id="cb34-1198"><a href="#cb34-1198" aria-hidden="true" tabindex="-1"></a>      <span class="dt">text</span><span class="op">:</span></span>
<span id="cb34-1199"><a href="#cb34-1199" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Sources: (c)OpenStreetMap and contributors, INSEE, IGN, 2022</span><span class="sc">\n</span><span class="st">Realisation: Ronan Ysebaert, 2022"</span></span>
<span id="cb34-1200"><a href="#cb34-1200" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb34-1201"><a href="#cb34-1201" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb34-1202"><a href="#cb34-1202" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb34-1203"><a href="#cb34-1203" aria-hidden="true" tabindex="-1"></a><span class="vs">```</span></span>
<span id="cb34-1204"><a href="#cb34-1204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1205"><a href="#cb34-1205" aria-hidden="true" tabindex="-1"></a><span class="vs">## Climbing in 15 minutes?</span></span>
<span id="cb34-1206"><a href="#cb34-1206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1207"><a href="#cb34-1207" aria-hidden="true" tabindex="-1"></a><span class="vs">The number of climbing areas reachable in 15 minutes by bike from the geometric centroid of each IRIS of the study area.</span></span>
<span id="cb34-1208"><a href="#cb34-1208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1211"><a href="#cb34-1211" aria-hidden="true" tabindex="-1"></a><span class="vs">```</span>ojs</span>
<span id="cb34-1212"><a href="#cb34-1212" aria-hidden="true" tabindex="-1"></a><span class="co">// Map parameters to play with it</span></span>
<span id="cb34-1213"><a href="#cb34-1213" aria-hidden="true" tabindex="-1"></a><span class="co">// select indicator</span></span>
<span id="cb34-1214"><a href="#cb34-1214" aria-hidden="true" tabindex="-1"></a>viewof ind4 <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">radio</span>([<span class="st">"N_15MN"</span><span class="op">,</span> <span class="st">"N_PRIV_15MN"</span><span class="op">,</span> <span class="st">"N_FSGT_15MN"</span><span class="op">,</span> <span class="st">"N_FFME_15MN"</span>]<span class="op">,</span></span>
<span id="cb34-1215"><a href="#cb34-1215" aria-hidden="true" tabindex="-1"></a>{<span class="dt">label</span><span class="op">:</span> <span class="st">"Number - all / private / FSGT / FFME - indoor climbing areas at less than 15 minutes"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="st">"N_15MN"</span>})</span>
<span id="cb34-1216"><a href="#cb34-1216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1217"><a href="#cb34-1217" aria-hidden="true" tabindex="-1"></a><span class="co">// color palettes</span></span>
<span id="cb34-1218"><a href="#cb34-1218" aria-hidden="true" tabindex="-1"></a>viewof pal4 <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">select</span>(</span>
<span id="cb34-1219"><a href="#cb34-1219" aria-hidden="true" tabindex="-1"></a>  [<span class="st">"Blues"</span><span class="op">,</span> <span class="st">"Greens"</span><span class="op">,</span> <span class="st">"Greys"</span><span class="op">,</span> <span class="st">"Oranges"</span><span class="op">,</span> <span class="st">"Purples"</span><span class="op">,</span> <span class="st">"BuGn"</span><span class="op">,</span> <span class="st">"BuPu"</span><span class="op">,</span> <span class="st">"GnBu"</span><span class="op">,</span> </span>
<span id="cb34-1220"><a href="#cb34-1220" aria-hidden="true" tabindex="-1"></a>  <span class="st">"OrRd"</span><span class="op">,</span> <span class="st">"PuBuGn"</span><span class="op">,</span> <span class="st">"PuBu"</span><span class="op">,</span> <span class="st">"PuRd"</span><span class="op">,</span> <span class="st">"RdPu"</span><span class="op">,</span></span>
<span id="cb34-1221"><a href="#cb34-1221" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">,</span></span>
<span id="cb34-1222"><a href="#cb34-1222" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb34-1223"><a href="#cb34-1223" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="st">"colors"</span><span class="op">,</span></span>
<span id="cb34-1224"><a href="#cb34-1224" aria-hidden="true" tabindex="-1"></a>    <span class="dt">value</span><span class="op">:</span> <span class="st">"Greens"</span></span>
<span id="cb34-1225"><a href="#cb34-1225" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb34-1226"><a href="#cb34-1226" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb34-1227"><a href="#cb34-1227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1228"><a href="#cb34-1228" aria-hidden="true" tabindex="-1"></a><span class="co">// choropleth map with tooltips</span></span>
<span id="cb34-1229"><a href="#cb34-1229" aria-hidden="true" tabindex="-1"></a>map4 <span class="op">=</span> bertin<span class="op">.</span><span class="fu">draw</span>({</span>
<span id="cb34-1230"><a href="#cb34-1230" aria-hidden="true" tabindex="-1"></a>  <span class="dt">params</span><span class="op">:</span> {</span>
<span id="cb34-1231"><a href="#cb34-1231" aria-hidden="true" tabindex="-1"></a>    <span class="dt">width</span><span class="op">:</span> <span class="dv">750</span><span class="op">,</span></span>
<span id="cb34-1232"><a href="#cb34-1232" aria-hidden="true" tabindex="-1"></a>    <span class="dt">projection</span><span class="op">:</span> lambert93<span class="op">,</span></span>
<span id="cb34-1233"><a href="#cb34-1233" aria-hidden="true" tabindex="-1"></a>    <span class="dt">extent</span><span class="op">:</span> com</span>
<span id="cb34-1234"><a href="#cb34-1234" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb34-1235"><a href="#cb34-1235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1236"><a href="#cb34-1236" aria-hidden="true" tabindex="-1"></a>  <span class="dt">layers</span><span class="op">:</span> [</span>
<span id="cb34-1237"><a href="#cb34-1237" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb34-1238"><a href="#cb34-1238" aria-hidden="true" tabindex="-1"></a>      <span class="dt">geojson</span><span class="op">:</span> poi<span class="op">,</span></span>
<span id="cb34-1239"><a href="#cb34-1239" aria-hidden="true" tabindex="-1"></a>      <span class="dt">symbol_size</span><span class="op">:</span> <span class="dv">100</span><span class="op">,</span></span>
<span id="cb34-1240"><a href="#cb34-1240" aria-hidden="true" tabindex="-1"></a>      <span class="dt">symbol</span><span class="op">:</span> <span class="st">"circle"</span><span class="op">,</span></span>
<span id="cb34-1241"><a href="#cb34-1241" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> <span class="st">"white"</span><span class="op">,</span></span>
<span id="cb34-1242"><a href="#cb34-1242" aria-hidden="true" tabindex="-1"></a>      <span class="dt">strokeWidth</span><span class="op">:</span> <span class="fl">2.5</span><span class="op">,</span></span>
<span id="cb34-1243"><a href="#cb34-1243" aria-hidden="true" tabindex="-1"></a>      <span class="dt">stroke</span><span class="op">:</span> {</span>
<span id="cb34-1244"><a href="#cb34-1244" aria-hidden="true" tabindex="-1"></a>        <span class="dt">type</span><span class="op">:</span> <span class="st">"typo"</span><span class="op">,</span></span>
<span id="cb34-1245"><a href="#cb34-1245" aria-hidden="true" tabindex="-1"></a>        <span class="dt">values</span><span class="op">:</span> <span class="st">"federation"</span><span class="op">,</span></span>
<span id="cb34-1246"><a href="#cb34-1246" aria-hidden="true" tabindex="-1"></a>        <span class="dt">colors</span><span class="op">:</span> [<span class="st">"#9990f0"</span><span class="op">,</span> <span class="st">"#fcb456"</span><span class="op">,</span> <span class="st">"#ba0b25"</span>]</span>
<span id="cb34-1247"><a href="#cb34-1247" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb34-1248"><a href="#cb34-1248" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb34-1249"><a href="#cb34-1249" aria-hidden="true" tabindex="-1"></a>      <span class="dt">tooltip</span><span class="op">:</span> {</span>
<span id="cb34-1250"><a href="#cb34-1250" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fields</span><span class="op">:</span> [<span class="st">"$name"</span><span class="op">,</span> <span class="st">"$federation"</span>]<span class="op">,</span></span>
<span id="cb34-1251"><a href="#cb34-1251" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fill</span><span class="op">:</span> [<span class="st">"black"</span><span class="op">,</span> <span class="st">"black"</span>]<span class="op">,</span></span>
<span id="cb34-1252"><a href="#cb34-1252" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fontWeight</span><span class="op">:</span> [<span class="st">"bold"</span><span class="op">,</span> <span class="st">"normal"</span>]<span class="op">,</span></span>
<span id="cb34-1253"><a href="#cb34-1253" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fontSize</span><span class="op">:</span> [<span class="dv">12</span><span class="op">,</span> <span class="dv">10</span>]<span class="op">,</span></span>
<span id="cb34-1254"><a href="#cb34-1254" aria-hidden="true" tabindex="-1"></a>        <span class="dt">col</span><span class="op">:</span> <span class="st">"white"</span></span>
<span id="cb34-1255"><a href="#cb34-1255" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb34-1256"><a href="#cb34-1256" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb34-1257"><a href="#cb34-1257" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb34-1258"><a href="#cb34-1258" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb34-1259"><a href="#cb34-1259" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"text"</span><span class="op">,</span></span>
<span id="cb34-1260"><a href="#cb34-1260" aria-hidden="true" tabindex="-1"></a>      <span class="dt">position</span><span class="op">:</span> <span class="st">"topright"</span><span class="op">,</span></span>
<span id="cb34-1261"><a href="#cb34-1261" aria-hidden="true" tabindex="-1"></a>      <span class="dt">text</span><span class="op">:</span> <span class="st">"Number of climbing areas reachable</span><span class="sc">\n</span><span class="st">in less than 15 minutes"</span><span class="op">,</span></span>
<span id="cb34-1262"><a href="#cb34-1262" aria-hidden="true" tabindex="-1"></a>      <span class="dt">frame_opacity</span><span class="op">:</span> <span class="fl">0.7</span><span class="op">,</span></span>
<span id="cb34-1263"><a href="#cb34-1263" aria-hidden="true" tabindex="-1"></a>      <span class="dt">baseline</span><span class="op">:</span> <span class="st">"hanging"</span><span class="op">,</span></span>
<span id="cb34-1264"><a href="#cb34-1264" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> <span class="st">"black"</span><span class="op">,</span></span>
<span id="cb34-1265"><a href="#cb34-1265" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fontSize</span><span class="op">:</span> <span class="dv">25</span><span class="op">,</span></span>
<span id="cb34-1266"><a href="#cb34-1266" aria-hidden="true" tabindex="-1"></a>      <span class="dt">margin</span><span class="op">:</span> <span class="dv">4</span><span class="op">,</span></span>
<span id="cb34-1267"><a href="#cb34-1267" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fontWeight</span><span class="op">:</span> <span class="st">"bold"</span><span class="op">,</span></span>
<span id="cb34-1268"><a href="#cb34-1268" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fontFamily</span><span class="op">:</span> <span class="st">"Ubuntu"</span></span>
<span id="cb34-1269"><a href="#cb34-1269" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb34-1270"><a href="#cb34-1270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1271"><a href="#cb34-1271" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb34-1272"><a href="#cb34-1272" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"layer"</span><span class="op">,</span></span>
<span id="cb34-1273"><a href="#cb34-1273" aria-hidden="true" tabindex="-1"></a>      <span class="dt">geojson</span><span class="op">:</span> com<span class="op">,</span></span>
<span id="cb34-1274"><a href="#cb34-1274" aria-hidden="true" tabindex="-1"></a>      <span class="dt">stroke</span><span class="op">:</span> <span class="st">"black"</span><span class="op">,</span></span>
<span id="cb34-1275"><a href="#cb34-1275" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> <span class="st">"none"</span></span>
<span id="cb34-1276"><a href="#cb34-1276" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb34-1277"><a href="#cb34-1277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1278"><a href="#cb34-1278" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb34-1279"><a href="#cb34-1279" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"layer"</span><span class="op">,</span></span>
<span id="cb34-1280"><a href="#cb34-1280" aria-hidden="true" tabindex="-1"></a>      <span class="dt">geojson</span><span class="op">:</span> iris<span class="op">,</span></span>
<span id="cb34-1281"><a href="#cb34-1281" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> {</span>
<span id="cb34-1282"><a href="#cb34-1282" aria-hidden="true" tabindex="-1"></a>        <span class="dt">type</span><span class="op">:</span> <span class="st">"choro"</span><span class="op">,</span></span>
<span id="cb34-1283"><a href="#cb34-1283" aria-hidden="true" tabindex="-1"></a>        <span class="dt">values</span><span class="op">:</span> ind4<span class="op">,</span></span>
<span id="cb34-1284"><a href="#cb34-1284" aria-hidden="true" tabindex="-1"></a>        <span class="dt">breaks</span><span class="op">:</span> [<span class="dv">1</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="dv">3</span><span class="op">,</span> <span class="dv">4</span><span class="op">,</span> <span class="dv">5</span><span class="op">,</span> <span class="dv">6</span><span class="op">,</span> <span class="dv">7</span><span class="op">,</span> <span class="dv">8</span><span class="op">,</span> <span class="dv">9</span>]<span class="op">,</span></span>
<span id="cb34-1285"><a href="#cb34-1285" aria-hidden="true" tabindex="-1"></a>        <span class="dt">colors</span><span class="op">:</span> pal4<span class="op">,</span></span>
<span id="cb34-1286"><a href="#cb34-1286" aria-hidden="true" tabindex="-1"></a>        <span class="dt">leg_round</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span></span>
<span id="cb34-1287"><a href="#cb34-1287" aria-hidden="true" tabindex="-1"></a>        <span class="dt">leg_title</span><span class="op">:</span> <span class="vs">`Structures numbers`</span><span class="op">,</span></span>
<span id="cb34-1288"><a href="#cb34-1288" aria-hidden="true" tabindex="-1"></a>        <span class="dt">leg_x</span><span class="op">:</span> <span class="dv">15</span><span class="op">,</span></span>
<span id="cb34-1289"><a href="#cb34-1289" aria-hidden="true" tabindex="-1"></a>        <span class="dt">leg_y</span><span class="op">:</span> <span class="dv">15</span><span class="op">,</span></span>
<span id="cb34-1290"><a href="#cb34-1290" aria-hidden="true" tabindex="-1"></a>        <span class="dt">col_missing</span><span class="op">:</span> <span class="st">"lightgrey"</span><span class="op">,</span></span>
<span id="cb34-1291"><a href="#cb34-1291" aria-hidden="true" tabindex="-1"></a>        <span class="dt">txt_missing</span><span class="op">:</span> <span class="st">"Non dedicated to housing"</span></span>
<span id="cb34-1292"><a href="#cb34-1292" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb34-1293"><a href="#cb34-1293" aria-hidden="true" tabindex="-1"></a>      <span class="dt">tooltip</span><span class="op">:</span> {</span>
<span id="cb34-1294"><a href="#cb34-1294" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fields</span><span class="op">:</span> [</span>
<span id="cb34-1295"><a href="#cb34-1295" aria-hidden="true" tabindex="-1"></a>          <span class="st">"$NOM_IRIS"</span><span class="op">,</span></span>
<span id="cb34-1296"><a href="#cb34-1296" aria-hidden="true" tabindex="-1"></a>          <span class="st">"$N_15MN"</span><span class="op">,</span></span>
<span id="cb34-1297"><a href="#cb34-1297" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Climbing areas at less than 15 minutes by bike"</span></span>
<span id="cb34-1298"><a href="#cb34-1298" aria-hidden="true" tabindex="-1"></a>        ]<span class="op">,</span></span>
<span id="cb34-1299"><a href="#cb34-1299" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fill</span><span class="op">:</span> <span class="st">"white"</span><span class="op">,</span></span>
<span id="cb34-1300"><a href="#cb34-1300" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fontWeight</span><span class="op">:</span> [<span class="st">"bold"</span><span class="op">,</span> <span class="st">"normal"</span><span class="op">,</span> <span class="st">"normal"</span>]<span class="op">,</span></span>
<span id="cb34-1301"><a href="#cb34-1301" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fontSize</span><span class="op">:</span> [<span class="dv">11</span><span class="op">,</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">8</span>]<span class="op">,</span></span>
<span id="cb34-1302"><a href="#cb34-1302" aria-hidden="true" tabindex="-1"></a>        <span class="dt">col</span><span class="op">:</span> [<span class="st">"black"</span><span class="op">,</span> <span class="st">"black"</span><span class="op">,</span> <span class="st">"black"</span>]</span>
<span id="cb34-1303"><a href="#cb34-1303" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb34-1304"><a href="#cb34-1304" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb34-1305"><a href="#cb34-1305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1306"><a href="#cb34-1306" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb34-1307"><a href="#cb34-1307" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"scalebar"</span><span class="op">,</span></span>
<span id="cb34-1308"><a href="#cb34-1308" aria-hidden="true" tabindex="-1"></a>      <span class="dt">units</span><span class="op">:</span> <span class="st">"miles"</span><span class="op">,</span></span>
<span id="cb34-1309"><a href="#cb34-1309" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb34-1310"><a href="#cb34-1310" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb34-1311"><a href="#cb34-1311" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb34-1312"><a href="#cb34-1312" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"footer"</span><span class="op">,</span></span>
<span id="cb34-1313"><a href="#cb34-1313" aria-hidden="true" tabindex="-1"></a>      <span class="dt">text</span><span class="op">:</span></span>
<span id="cb34-1314"><a href="#cb34-1314" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Sources: (c)OpenStreetMap and contributors, INSEE, IGN, 2022</span><span class="sc">\n</span><span class="st">Realisation: Ronan Ysebaert, 2022"</span></span>
<span id="cb34-1315"><a href="#cb34-1315" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb34-1316"><a href="#cb34-1316" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb34-1317"><a href="#cb34-1317" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb34-1318"><a href="#cb34-1318" aria-hidden="true" tabindex="-1"></a><span class="vs">```</span></span>
<span id="cb34-1319"><a href="#cb34-1319" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1320"><a href="#cb34-1320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1321"><a href="#cb34-1321" aria-hidden="true" tabindex="-1"></a><span class="vs">## Demographic neighbourhood</span></span>
<span id="cb34-1322"><a href="#cb34-1322" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1323"><a href="#cb34-1323" aria-hidden="true" tabindex="-1"></a><span class="vs">Visualize the demographic neighbourhood of each climbing area : IRIS population at less than 15 minutes by bike from each climbing area.</span></span>
<span id="cb34-1324"><a href="#cb34-1324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1327"><a href="#cb34-1327" aria-hidden="true" tabindex="-1"></a><span class="vs">```</span>ojs</span>
<span id="cb34-1328"><a href="#cb34-1328" aria-hidden="true" tabindex="-1"></a><span class="co">// Map parameters to play with it</span></span>
<span id="cb34-1329"><a href="#cb34-1329" aria-hidden="true" tabindex="-1"></a><span class="co">// Circle radius</span></span>
<span id="cb34-1330"><a href="#cb34-1330" aria-hidden="true" tabindex="-1"></a>viewof k5 <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">1</span><span class="op">,</span> <span class="dv">100</span>]<span class="op">,</span> { <span class="dt">label</span><span class="op">:</span> <span class="st">"radius max"</span><span class="op">,</span> <span class="dt">step</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="dv">18</span> })</span>
<span id="cb34-1331"><a href="#cb34-1331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1332"><a href="#cb34-1332" aria-hidden="true" tabindex="-1"></a><span class="co">// Proportional map and tooltips</span></span>
<span id="cb34-1333"><a href="#cb34-1333" aria-hidden="true" tabindex="-1"></a>map5 <span class="op">=</span> bertin<span class="op">.</span><span class="fu">draw</span>({</span>
<span id="cb34-1334"><a href="#cb34-1334" aria-hidden="true" tabindex="-1"></a>  <span class="dt">params</span><span class="op">:</span> {</span>
<span id="cb34-1335"><a href="#cb34-1335" aria-hidden="true" tabindex="-1"></a>    <span class="dt">width</span><span class="op">:</span> <span class="dv">750</span><span class="op">,</span></span>
<span id="cb34-1336"><a href="#cb34-1336" aria-hidden="true" tabindex="-1"></a>    <span class="dt">projection</span><span class="op">:</span> lambert93<span class="op">,</span></span>
<span id="cb34-1337"><a href="#cb34-1337" aria-hidden="true" tabindex="-1"></a>    <span class="dt">extent</span><span class="op">:</span> com</span>
<span id="cb34-1338"><a href="#cb34-1338" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb34-1339"><a href="#cb34-1339" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1340"><a href="#cb34-1340" aria-hidden="true" tabindex="-1"></a>  <span class="dt">layers</span><span class="op">:</span> [</span>
<span id="cb34-1341"><a href="#cb34-1341" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb34-1342"><a href="#cb34-1342" aria-hidden="true" tabindex="-1"></a>      <span class="dt">geojson</span><span class="op">:</span> poi<span class="op">,</span></span>
<span id="cb34-1343"><a href="#cb34-1343" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"bubble"</span><span class="op">,</span></span>
<span id="cb34-1344"><a href="#cb34-1344" aria-hidden="true" tabindex="-1"></a>      <span class="dt">k</span><span class="op">:</span> k5<span class="op">,</span></span>
<span id="cb34-1345"><a href="#cb34-1345" aria-hidden="true" tabindex="-1"></a>      <span class="dt">values</span><span class="op">:</span> <span class="st">"SUM_POP18"</span><span class="op">,</span></span>
<span id="cb34-1346"><a href="#cb34-1346" aria-hidden="true" tabindex="-1"></a>      <span class="dt">leg_title</span><span class="op">:</span> <span class="vs">`Population in 15mn by bike neighbourhood`</span><span class="op">,</span> </span>
<span id="cb34-1347"><a href="#cb34-1347" aria-hidden="true" tabindex="-1"></a>      <span class="dt">leg_x</span><span class="op">:</span> <span class="dv">15</span><span class="op">,</span></span>
<span id="cb34-1348"><a href="#cb34-1348" aria-hidden="true" tabindex="-1"></a>      <span class="dt">leg_y</span><span class="op">:</span> <span class="dv">15</span><span class="op">,</span></span>
<span id="cb34-1349"><a href="#cb34-1349" aria-hidden="true" tabindex="-1"></a>      <span class="dt">leg_round</span><span class="op">:</span> <span class="op">-</span><span class="dv">2</span><span class="op">,</span></span>
<span id="cb34-1350"><a href="#cb34-1350" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> {</span>
<span id="cb34-1351"><a href="#cb34-1351" aria-hidden="true" tabindex="-1"></a>        <span class="dt">type</span><span class="op">:</span> <span class="st">"typo"</span><span class="op">,</span></span>
<span id="cb34-1352"><a href="#cb34-1352" aria-hidden="true" tabindex="-1"></a>        <span class="dt">values</span><span class="op">:</span> <span class="st">"federation"</span><span class="op">,</span></span>
<span id="cb34-1353"><a href="#cb34-1353" aria-hidden="true" tabindex="-1"></a>        <span class="dt">colors</span><span class="op">:</span> [<span class="st">"#9990f0"</span><span class="op">,</span> <span class="st">"#fcb456"</span><span class="op">,</span> <span class="st">"#ba0b25"</span>]<span class="op">,</span></span>
<span id="cb34-1354"><a href="#cb34-1354" aria-hidden="true" tabindex="-1"></a>        <span class="dt">leg_title</span><span class="op">:</span> <span class="vs">`Wall's managers`</span><span class="op">,</span></span>
<span id="cb34-1355"><a href="#cb34-1355" aria-hidden="true" tabindex="-1"></a>        <span class="dt">leg_x</span><span class="op">:</span> <span class="dv">600</span><span class="op">,</span></span>
<span id="cb34-1356"><a href="#cb34-1356" aria-hidden="true" tabindex="-1"></a>        <span class="dt">leg_y</span><span class="op">:</span> <span class="dv">550</span></span>
<span id="cb34-1357"><a href="#cb34-1357" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb34-1358"><a href="#cb34-1358" aria-hidden="true" tabindex="-1"></a>      <span class="dt">strokeWidth</span><span class="op">:</span> <span class="fl">2.5</span><span class="op">,</span></span>
<span id="cb34-1359"><a href="#cb34-1359" aria-hidden="true" tabindex="-1"></a>      <span class="dt">stroke</span><span class="op">:</span> <span class="st">"white"</span><span class="op">,</span></span>
<span id="cb34-1360"><a href="#cb34-1360" aria-hidden="true" tabindex="-1"></a>      <span class="dt">tooltip</span><span class="op">:</span> {</span>
<span id="cb34-1361"><a href="#cb34-1361" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fields</span><span class="op">:</span> [<span class="st">"$name"</span><span class="op">,</span> <span class="st">"$federation"</span><span class="op">,</span> <span class="st">"$SUM_POP18"</span><span class="op">,</span> <span class="st">"(Inhabitants in 15mn by bike neighbourhood)"</span>]<span class="op">,</span></span>
<span id="cb34-1362"><a href="#cb34-1362" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fill</span><span class="op">:</span> [<span class="st">"black"</span><span class="op">,</span> <span class="st">"black"</span><span class="op">,</span> <span class="st">"black"</span><span class="op">,</span> <span class="st">"black"</span>]<span class="op">,</span></span>
<span id="cb34-1363"><a href="#cb34-1363" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fontWeight</span><span class="op">:</span> [<span class="st">"bold"</span><span class="op">,</span> <span class="st">"normal"</span><span class="op">,</span> <span class="st">"normal"</span><span class="op">,</span> <span class="st">"normal"</span>]<span class="op">,</span></span>
<span id="cb34-1364"><a href="#cb34-1364" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fontSize</span><span class="op">:</span> [<span class="dv">14</span><span class="op">,</span> <span class="dv">12</span><span class="op">,</span> <span class="dv">12</span><span class="op">,</span> <span class="dv">10</span>]<span class="op">,</span></span>
<span id="cb34-1365"><a href="#cb34-1365" aria-hidden="true" tabindex="-1"></a>        <span class="dt">col</span><span class="op">:</span> <span class="st">"white"</span></span>
<span id="cb34-1366"><a href="#cb34-1366" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb34-1367"><a href="#cb34-1367" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb34-1368"><a href="#cb34-1368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1369"><a href="#cb34-1369" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb34-1370"><a href="#cb34-1370" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"text"</span><span class="op">,</span></span>
<span id="cb34-1371"><a href="#cb34-1371" aria-hidden="true" tabindex="-1"></a>      <span class="dt">position</span><span class="op">:</span> <span class="st">"topright"</span><span class="op">,</span></span>
<span id="cb34-1372"><a href="#cb34-1372" aria-hidden="true" tabindex="-1"></a>      <span class="dt">text</span><span class="op">:</span> <span class="st">"Population</span><span class="sc">\n</span><span class="st">in climbing area's neighbourhood"</span><span class="op">,</span></span>
<span id="cb34-1373"><a href="#cb34-1373" aria-hidden="true" tabindex="-1"></a>      <span class="dt">frame_opacity</span><span class="op">:</span> <span class="fl">0.7</span><span class="op">,</span></span>
<span id="cb34-1374"><a href="#cb34-1374" aria-hidden="true" tabindex="-1"></a>      <span class="dt">baseline</span><span class="op">:</span> <span class="st">"hanging"</span><span class="op">,</span></span>
<span id="cb34-1375"><a href="#cb34-1375" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> <span class="st">"black"</span><span class="op">,</span></span>
<span id="cb34-1376"><a href="#cb34-1376" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fontSize</span><span class="op">:</span> <span class="dv">25</span><span class="op">,</span></span>
<span id="cb34-1377"><a href="#cb34-1377" aria-hidden="true" tabindex="-1"></a>      <span class="dt">margin</span><span class="op">:</span> <span class="dv">4</span><span class="op">,</span></span>
<span id="cb34-1378"><a href="#cb34-1378" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fontWeight</span><span class="op">:</span> <span class="st">"bold"</span><span class="op">,</span></span>
<span id="cb34-1379"><a href="#cb34-1379" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fontFamily</span><span class="op">:</span> <span class="st">"Ubuntu"</span></span>
<span id="cb34-1380"><a href="#cb34-1380" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb34-1381"><a href="#cb34-1381" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1382"><a href="#cb34-1382" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb34-1383"><a href="#cb34-1383" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"layer"</span><span class="op">,</span></span>
<span id="cb34-1384"><a href="#cb34-1384" aria-hidden="true" tabindex="-1"></a>      <span class="dt">geojson</span><span class="op">:</span> com<span class="op">,</span></span>
<span id="cb34-1385"><a href="#cb34-1385" aria-hidden="true" tabindex="-1"></a>      <span class="dt">stroke</span><span class="op">:</span> <span class="st">"black"</span><span class="op">,</span></span>
<span id="cb34-1386"><a href="#cb34-1386" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> <span class="st">"none"</span></span>
<span id="cb34-1387"><a href="#cb34-1387" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb34-1388"><a href="#cb34-1388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1389"><a href="#cb34-1389" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb34-1390"><a href="#cb34-1390" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"layer"</span><span class="op">,</span></span>
<span id="cb34-1391"><a href="#cb34-1391" aria-hidden="true" tabindex="-1"></a>      <span class="dt">geojson</span><span class="op">:</span> iris15<span class="op">,</span></span>
<span id="cb34-1392"><a href="#cb34-1392" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> <span class="st">"peachpuff"</span><span class="op">,</span></span>
<span id="cb34-1393"><a href="#cb34-1393" aria-hidden="true" tabindex="-1"></a>      <span class="dt">tooltip</span><span class="op">:</span> {</span>
<span id="cb34-1394"><a href="#cb34-1394" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fields</span><span class="op">:</span> [</span>
<span id="cb34-1395"><a href="#cb34-1395" aria-hidden="true" tabindex="-1"></a>          <span class="st">"$NOM_IRIS"</span><span class="op">,</span></span>
<span id="cb34-1396"><a href="#cb34-1396" aria-hidden="true" tabindex="-1"></a>          <span class="st">"$NOM_COM"</span><span class="op">,</span></span>
<span id="cb34-1397"><a href="#cb34-1397" aria-hidden="true" tabindex="-1"></a>          <span class="st">"$P18_POP"</span><span class="op">,</span></span>
<span id="cb34-1398"><a href="#cb34-1398" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Total population (2018)"</span></span>
<span id="cb34-1399"><a href="#cb34-1399" aria-hidden="true" tabindex="-1"></a>        ]<span class="op">,</span></span>
<span id="cb34-1400"><a href="#cb34-1400" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fill</span><span class="op">:</span> <span class="st">"white"</span><span class="op">,</span></span>
<span id="cb34-1401"><a href="#cb34-1401" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fontWeight</span><span class="op">:</span> [<span class="st">"bold"</span><span class="op">,</span> <span class="st">"normal"</span><span class="op">,</span> <span class="st">"normal"</span><span class="op">,</span> <span class="st">"normal"</span>]<span class="op">,</span></span>
<span id="cb34-1402"><a href="#cb34-1402" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fontSize</span><span class="op">:</span> [<span class="dv">11</span><span class="op">,</span> <span class="dv">11</span><span class="op">,</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">8</span>]<span class="op">,</span></span>
<span id="cb34-1403"><a href="#cb34-1403" aria-hidden="true" tabindex="-1"></a>        <span class="dt">col</span><span class="op">:</span> [<span class="st">"black"</span><span class="op">,</span> <span class="st">"black"</span><span class="op">,</span> <span class="st">"black"</span><span class="op">,</span> <span class="st">"black"</span>]</span>
<span id="cb34-1404"><a href="#cb34-1404" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb34-1405"><a href="#cb34-1405" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb34-1406"><a href="#cb34-1406" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1407"><a href="#cb34-1407" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb34-1408"><a href="#cb34-1408" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"scalebar"</span><span class="op">,</span></span>
<span id="cb34-1409"><a href="#cb34-1409" aria-hidden="true" tabindex="-1"></a>      <span class="dt">units</span><span class="op">:</span> <span class="st">"kilometers"</span><span class="op">,</span></span>
<span id="cb34-1410"><a href="#cb34-1410" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb34-1411"><a href="#cb34-1411" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb34-1412"><a href="#cb34-1412" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb34-1413"><a href="#cb34-1413" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"footer"</span><span class="op">,</span></span>
<span id="cb34-1414"><a href="#cb34-1414" aria-hidden="true" tabindex="-1"></a>      <span class="dt">text</span><span class="op">:</span></span>
<span id="cb34-1415"><a href="#cb34-1415" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Sources: (c)OpenStreetMap and contributors, INSEE, IGN, 2022</span><span class="sc">\n</span><span class="st">Realisation: Ronan Ysebaert, 2022"</span></span>
<span id="cb34-1416"><a href="#cb34-1416" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb34-1417"><a href="#cb34-1417" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb34-1418"><a href="#cb34-1418" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb34-1419"><a href="#cb34-1419" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1420"><a href="#cb34-1420" aria-hidden="true" tabindex="-1"></a><span class="vs">```</span></span>
<span id="cb34-1421"><a href="#cb34-1421" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1422"><a href="#cb34-1422" aria-hidden="true" tabindex="-1"></a><span class="vs">## Income neighbourhood</span></span>
<span id="cb34-1423"><a href="#cb34-1423" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1424"><a href="#cb34-1424" aria-hidden="true" tabindex="-1"></a><span class="vs">Visualize the level of wealth of each climbing area neighbourhood : IRIS median income at less than 15 minutes by bike from a climbing area. User can choose the minimum income, average income or maximum income of the IRIS at less than 15 minutes.</span></span>
<span id="cb34-1425"><a href="#cb34-1425" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1428"><a href="#cb34-1428" aria-hidden="true" tabindex="-1"></a><span class="vs">```</span>ojs</span>
<span id="cb34-1429"><a href="#cb34-1429" aria-hidden="true" tabindex="-1"></a><span class="co">// Map parameters to play with it</span></span>
<span id="cb34-1430"><a href="#cb34-1430" aria-hidden="true" tabindex="-1"></a><span class="co">// select indicator</span></span>
<span id="cb34-1431"><a href="#cb34-1431" aria-hidden="true" tabindex="-1"></a>viewof ind6 <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">radio</span>([<span class="st">"MIN_REV19"</span><span class="op">,</span> <span class="st">"MOY_REV19"</span><span class="op">,</span> <span class="st">"MAX_REV19"</span>]<span class="op">,</span> {<span class="dt">label</span><span class="op">:</span> <span class="st">"Min/average/max median income in a 15 minutes by bike neighbourhood"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="st">"MOY_REV19"</span>})</span>
<span id="cb34-1432"><a href="#cb34-1432" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1433"><a href="#cb34-1433" aria-hidden="true" tabindex="-1"></a><span class="co">// Discretization method</span></span>
<span id="cb34-1434"><a href="#cb34-1434" aria-hidden="true" tabindex="-1"></a>viewof method6 <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">select</span>([<span class="st">"jenks"</span><span class="op">,</span> <span class="st">"q6"</span><span class="op">,</span> <span class="st">"quantile"</span><span class="op">,</span> <span class="st">"equal"</span><span class="op">,</span> <span class="st">"msd"</span>]<span class="op">,</span> {</span>
<span id="cb34-1435"><a href="#cb34-1435" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="st">"method"</span><span class="op">,</span></span>
<span id="cb34-1436"><a href="#cb34-1436" aria-hidden="true" tabindex="-1"></a>  <span class="dt">value</span><span class="op">:</span> <span class="st">"quantile"</span></span>
<span id="cb34-1437"><a href="#cb34-1437" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb34-1438"><a href="#cb34-1438" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1439"><a href="#cb34-1439" aria-hidden="true" tabindex="-1"></a><span class="co">// Nbreaks</span></span>
<span id="cb34-1440"><a href="#cb34-1440" aria-hidden="true" tabindex="-1"></a>viewof nbreaks6 <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">3</span><span class="op">,</span> <span class="dv">9</span>]<span class="op">,</span> { <span class="dt">label</span><span class="op">:</span> <span class="st">"nbreaks"</span><span class="op">,</span> <span class="dt">step</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="dv">6</span> })</span>
<span id="cb34-1441"><a href="#cb34-1441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1442"><a href="#cb34-1442" aria-hidden="true" tabindex="-1"></a><span class="co">// Color palette</span></span>
<span id="cb34-1443"><a href="#cb34-1443" aria-hidden="true" tabindex="-1"></a>viewof pal6 <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">select</span>(</span>
<span id="cb34-1444"><a href="#cb34-1444" aria-hidden="true" tabindex="-1"></a>  [<span class="st">"Blues"</span><span class="op">,</span> <span class="st">"Greens"</span><span class="op">,</span> <span class="st">"Greys"</span><span class="op">,</span> <span class="st">"Oranges"</span><span class="op">,</span> <span class="st">"Purples"</span><span class="op">,</span> <span class="st">"BuGn"</span><span class="op">,</span> <span class="st">"BuPu"</span><span class="op">,</span> <span class="st">"GnBu"</span><span class="op">,</span></span>
<span id="cb34-1445"><a href="#cb34-1445" aria-hidden="true" tabindex="-1"></a>  <span class="st">"OrRd"</span><span class="op">,</span> <span class="st">"PuBuGn"</span><span class="op">,</span> <span class="st">"PuBu"</span><span class="op">,</span> <span class="st">"PuRd"</span><span class="op">,</span> <span class="st">"RdPu"</span><span class="op">,</span> <span class="st">"YlGnBu"</span><span class="op">,</span> <span class="st">"YlGn"</span><span class="op">,</span> <span class="st">"YlOrBr"</span><span class="op">,</span> </span>
<span id="cb34-1446"><a href="#cb34-1446" aria-hidden="true" tabindex="-1"></a>  <span class="st">"YlOrRd"</span><span class="op">,</span> <span class="st">"BrBG"</span><span class="op">,</span> <span class="st">"PRGn"</span><span class="op">,</span> <span class="st">"PiYG"</span><span class="op">,</span> <span class="st">"PuOr"</span><span class="op">,</span> <span class="st">"RdBu"</span><span class="op">,</span> <span class="st">"RdGy"</span><span class="op">,</span> <span class="st">"RdYlBu"</span><span class="op">,</span> <span class="st">"RdYlGn"</span><span class="op">,</span></span>
<span id="cb34-1447"><a href="#cb34-1447" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Spectral"</span></span>
<span id="cb34-1448"><a href="#cb34-1448" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">,</span></span>
<span id="cb34-1449"><a href="#cb34-1449" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb34-1450"><a href="#cb34-1450" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="st">"colors"</span><span class="op">,</span></span>
<span id="cb34-1451"><a href="#cb34-1451" aria-hidden="true" tabindex="-1"></a>    <span class="dt">value</span><span class="op">:</span> <span class="st">"PuOr"</span></span>
<span id="cb34-1452"><a href="#cb34-1452" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb34-1453"><a href="#cb34-1453" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb34-1454"><a href="#cb34-1454" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1455"><a href="#cb34-1455" aria-hidden="true" tabindex="-1"></a><span class="co">// IRIS layer opacity</span></span>
<span id="cb34-1456"><a href="#cb34-1456" aria-hidden="true" tabindex="-1"></a>viewof opacity6 <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span> {<span class="dt">label</span><span class="op">:</span> <span class="st">"IRIS income opacity"</span><span class="op">,</span> <span class="dt">step</span><span class="op">:</span> <span class="fl">0.1</span>})</span>
<span id="cb34-1457"><a href="#cb34-1457" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1458"><a href="#cb34-1458" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1459"><a href="#cb34-1459" aria-hidden="true" tabindex="-1"></a><span class="co">// Resulting map with a lot of things :) </span></span>
<span id="cb34-1460"><a href="#cb34-1460" aria-hidden="true" tabindex="-1"></a>map6 <span class="op">=</span> bertin<span class="op">.</span><span class="fu">draw</span>({</span>
<span id="cb34-1461"><a href="#cb34-1461" aria-hidden="true" tabindex="-1"></a>  <span class="dt">params</span><span class="op">:</span> {</span>
<span id="cb34-1462"><a href="#cb34-1462" aria-hidden="true" tabindex="-1"></a>    <span class="dt">width</span><span class="op">:</span> <span class="dv">750</span><span class="op">,</span></span>
<span id="cb34-1463"><a href="#cb34-1463" aria-hidden="true" tabindex="-1"></a>    <span class="dt">projection</span><span class="op">:</span> lambert93<span class="op">,</span></span>
<span id="cb34-1464"><a href="#cb34-1464" aria-hidden="true" tabindex="-1"></a>    <span class="dt">extent</span><span class="op">:</span> com</span>
<span id="cb34-1465"><a href="#cb34-1465" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb34-1466"><a href="#cb34-1466" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1467"><a href="#cb34-1467" aria-hidden="true" tabindex="-1"></a>  <span class="dt">layers</span><span class="op">:</span> [</span>
<span id="cb34-1468"><a href="#cb34-1468" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb34-1469"><a href="#cb34-1469" aria-hidden="true" tabindex="-1"></a>      <span class="dt">geojson</span><span class="op">:</span> poi<span class="op">,</span></span>
<span id="cb34-1470"><a href="#cb34-1470" aria-hidden="true" tabindex="-1"></a>      <span class="dt">symbol_size</span><span class="op">:</span> <span class="dv">300</span><span class="op">,</span></span>
<span id="cb34-1471"><a href="#cb34-1471" aria-hidden="true" tabindex="-1"></a>      <span class="dt">symbol</span><span class="op">:</span> <span class="st">"triangle"</span><span class="op">,</span></span>
<span id="cb34-1472"><a href="#cb34-1472" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> {</span>
<span id="cb34-1473"><a href="#cb34-1473" aria-hidden="true" tabindex="-1"></a>        <span class="dt">type</span><span class="op">:</span> <span class="st">"choro"</span><span class="op">,</span></span>
<span id="cb34-1474"><a href="#cb34-1474" aria-hidden="true" tabindex="-1"></a>        <span class="dt">values</span><span class="op">:</span> ind6<span class="op">,</span></span>
<span id="cb34-1475"><a href="#cb34-1475" aria-hidden="true" tabindex="-1"></a>        <span class="dt">nbreaks</span><span class="op">:</span> nbreaks6<span class="op">,</span></span>
<span id="cb34-1476"><a href="#cb34-1476" aria-hidden="true" tabindex="-1"></a>        <span class="dt">method</span><span class="op">:</span> method6<span class="op">,</span></span>
<span id="cb34-1477"><a href="#cb34-1477" aria-hidden="true" tabindex="-1"></a>        <span class="dt">colors</span><span class="op">:</span> pal6<span class="op">,</span></span>
<span id="cb34-1478"><a href="#cb34-1478" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb34-1479"><a href="#cb34-1479" aria-hidden="true" tabindex="-1"></a>      <span class="dt">strokeWidth</span><span class="op">:</span> <span class="fl">2.5</span><span class="op">,</span></span>
<span id="cb34-1480"><a href="#cb34-1480" aria-hidden="true" tabindex="-1"></a>      <span class="dt">stroke</span><span class="op">:</span> {</span>
<span id="cb34-1481"><a href="#cb34-1481" aria-hidden="true" tabindex="-1"></a>        <span class="dt">type</span><span class="op">:</span> <span class="st">"typo"</span><span class="op">,</span></span>
<span id="cb34-1482"><a href="#cb34-1482" aria-hidden="true" tabindex="-1"></a>        <span class="dt">values</span><span class="op">:</span> <span class="st">"federation"</span><span class="op">,</span></span>
<span id="cb34-1483"><a href="#cb34-1483" aria-hidden="true" tabindex="-1"></a>        <span class="dt">colors</span><span class="op">:</span> [<span class="st">"#9990f0"</span><span class="op">,</span> <span class="st">"#fcb456"</span><span class="op">,</span> <span class="st">"#ba0b25"</span>]<span class="op">,</span></span>
<span id="cb34-1484"><a href="#cb34-1484" aria-hidden="true" tabindex="-1"></a>        <span class="dt">leg_title</span><span class="op">:</span> <span class="vs">`Wall's managers`</span><span class="op">,</span></span>
<span id="cb34-1485"><a href="#cb34-1485" aria-hidden="true" tabindex="-1"></a>        <span class="dt">leg_x</span><span class="op">:</span> <span class="dv">600</span><span class="op">,</span></span>
<span id="cb34-1486"><a href="#cb34-1486" aria-hidden="true" tabindex="-1"></a>        <span class="dt">leg_y</span><span class="op">:</span> <span class="dv">550</span></span>
<span id="cb34-1487"><a href="#cb34-1487" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb34-1488"><a href="#cb34-1488" aria-hidden="true" tabindex="-1"></a>      <span class="dt">tooltip</span><span class="op">:</span> {</span>
<span id="cb34-1489"><a href="#cb34-1489" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fields</span><span class="op">:</span> [<span class="st">"$name"</span><span class="op">,</span> <span class="st">"$federation"</span><span class="op">,</span> <span class="st">"$MIN_REV19"</span><span class="op">,</span> <span class="st">"(Minimum income in 15mn by bike neighbourhood)"</span><span class="op">,</span> <span class="st">"$MOY_REV19"</span><span class="op">,</span> <span class="st">"(Average income in 15mn by bike neighbourhood)"</span><span class="op">,</span> <span class="st">"$MAX_REV19"</span><span class="op">,</span> <span class="st">"(Average income in 15mn by bike neighbourhood)"</span>]<span class="op">,</span></span>
<span id="cb34-1490"><a href="#cb34-1490" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fill</span><span class="op">:</span> [<span class="st">"black"</span><span class="op">,</span> <span class="st">"black"</span><span class="op">,</span> <span class="st">"black"</span><span class="op">,</span> <span class="st">"black"</span><span class="op">,</span> <span class="st">"black"</span><span class="op">,</span> <span class="st">"black"</span><span class="op">,</span> <span class="st">"black"</span><span class="op">,</span> <span class="st">"black"</span>]<span class="op">,</span></span>
<span id="cb34-1491"><a href="#cb34-1491" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fontWeight</span><span class="op">:</span> [<span class="st">"bold"</span><span class="op">,</span> <span class="st">"normal"</span><span class="op">,</span> <span class="st">"normal"</span><span class="op">,</span> <span class="st">"normal"</span><span class="op">,</span> <span class="st">"normal"</span><span class="op">,</span> <span class="st">"normal"</span><span class="op">,</span> <span class="st">"normal"</span><span class="op">,</span> <span class="st">"normal"</span>]<span class="op">,</span></span>
<span id="cb34-1492"><a href="#cb34-1492" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fontSize</span><span class="op">:</span> [<span class="dv">14</span><span class="op">,</span> <span class="dv">12</span><span class="op">,</span> <span class="dv">12</span><span class="op">,</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">12</span><span class="op">,</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">12</span><span class="op">,</span> <span class="dv">10</span>]<span class="op">,</span></span>
<span id="cb34-1493"><a href="#cb34-1493" aria-hidden="true" tabindex="-1"></a>        <span class="dt">col</span><span class="op">:</span> <span class="st">"white"</span></span>
<span id="cb34-1494"><a href="#cb34-1494" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb34-1495"><a href="#cb34-1495" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb34-1496"><a href="#cb34-1496" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1497"><a href="#cb34-1497" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb34-1498"><a href="#cb34-1498" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"text"</span><span class="op">,</span></span>
<span id="cb34-1499"><a href="#cb34-1499" aria-hidden="true" tabindex="-1"></a>      <span class="dt">position</span><span class="op">:</span> <span class="st">"topright"</span><span class="op">,</span></span>
<span id="cb34-1500"><a href="#cb34-1500" aria-hidden="true" tabindex="-1"></a>      <span class="dt">text</span><span class="op">:</span> <span class="st">"Income</span><span class="sc">\n</span><span class="st">in climbing area's neighbourhood"</span><span class="op">,</span></span>
<span id="cb34-1501"><a href="#cb34-1501" aria-hidden="true" tabindex="-1"></a>      <span class="dt">frame_opacity</span><span class="op">:</span> <span class="fl">0.7</span><span class="op">,</span></span>
<span id="cb34-1502"><a href="#cb34-1502" aria-hidden="true" tabindex="-1"></a>      <span class="dt">baseline</span><span class="op">:</span> <span class="st">"hanging"</span><span class="op">,</span></span>
<span id="cb34-1503"><a href="#cb34-1503" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> <span class="st">"black"</span><span class="op">,</span></span>
<span id="cb34-1504"><a href="#cb34-1504" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fontSize</span><span class="op">:</span> <span class="dv">25</span><span class="op">,</span></span>
<span id="cb34-1505"><a href="#cb34-1505" aria-hidden="true" tabindex="-1"></a>      <span class="dt">margin</span><span class="op">:</span> <span class="dv">4</span><span class="op">,</span></span>
<span id="cb34-1506"><a href="#cb34-1506" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fontWeight</span><span class="op">:</span> <span class="st">"bold"</span><span class="op">,</span></span>
<span id="cb34-1507"><a href="#cb34-1507" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fontFamily</span><span class="op">:</span> <span class="st">"Ubuntu"</span></span>
<span id="cb34-1508"><a href="#cb34-1508" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb34-1509"><a href="#cb34-1509" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1510"><a href="#cb34-1510" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb34-1511"><a href="#cb34-1511" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"layer"</span><span class="op">,</span></span>
<span id="cb34-1512"><a href="#cb34-1512" aria-hidden="true" tabindex="-1"></a>      <span class="dt">geojson</span><span class="op">:</span> com<span class="op">,</span></span>
<span id="cb34-1513"><a href="#cb34-1513" aria-hidden="true" tabindex="-1"></a>      <span class="dt">stroke</span><span class="op">:</span> <span class="st">"black"</span><span class="op">,</span></span>
<span id="cb34-1514"><a href="#cb34-1514" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> <span class="st">"none"</span></span>
<span id="cb34-1515"><a href="#cb34-1515" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb34-1516"><a href="#cb34-1516" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1517"><a href="#cb34-1517" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb34-1518"><a href="#cb34-1518" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"layer"</span><span class="op">,</span></span>
<span id="cb34-1519"><a href="#cb34-1519" aria-hidden="true" tabindex="-1"></a>      <span class="dt">geojson</span><span class="op">:</span> iris15<span class="op">,</span></span>
<span id="cb34-1520"><a href="#cb34-1520" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> {</span>
<span id="cb34-1521"><a href="#cb34-1521" aria-hidden="true" tabindex="-1"></a>        <span class="dt">type</span><span class="op">:</span> <span class="st">"choro"</span><span class="op">,</span></span>
<span id="cb34-1522"><a href="#cb34-1522" aria-hidden="true" tabindex="-1"></a>        <span class="dt">values</span><span class="op">:</span> <span class="st">"DISP_MED19"</span><span class="op">,</span></span>
<span id="cb34-1523"><a href="#cb34-1523" aria-hidden="true" tabindex="-1"></a>        <span class="dt">nbreaks</span><span class="op">:</span> nbreaks6<span class="op">,</span></span>
<span id="cb34-1524"><a href="#cb34-1524" aria-hidden="true" tabindex="-1"></a>        <span class="dt">method</span><span class="op">:</span> method6<span class="op">,</span></span>
<span id="cb34-1525"><a href="#cb34-1525" aria-hidden="true" tabindex="-1"></a>        <span class="dt">colors</span><span class="op">:</span> pal6<span class="op">,</span></span>
<span id="cb34-1526"><a href="#cb34-1526" aria-hidden="true" tabindex="-1"></a>        <span class="dt">leg_round</span><span class="op">:</span> <span class="op">-</span><span class="dv">2</span><span class="op">,</span></span>
<span id="cb34-1527"><a href="#cb34-1527" aria-hidden="true" tabindex="-1"></a>        <span class="dt">leg_title</span><span class="op">:</span> <span class="vs">`Median income (2019, euros)</span><span class="sc">\n</span><span class="vs">for IRIS at less than 15km by bike</span><span class="sc">\n</span><span class="vs">from a climbing area`</span><span class="op">,</span></span>
<span id="cb34-1528"><a href="#cb34-1528" aria-hidden="true" tabindex="-1"></a>        <span class="dt">leg_x</span><span class="op">:</span> <span class="dv">15</span><span class="op">,</span></span>
<span id="cb34-1529"><a href="#cb34-1529" aria-hidden="true" tabindex="-1"></a>        <span class="dt">leg_y</span><span class="op">:</span> <span class="dv">15</span><span class="op">,</span></span>
<span id="cb34-1530"><a href="#cb34-1530" aria-hidden="true" tabindex="-1"></a>        <span class="dt">col_missing</span><span class="op">:</span> <span class="st">"lightgrey"</span><span class="op">,</span></span>
<span id="cb34-1531"><a href="#cb34-1531" aria-hidden="true" tabindex="-1"></a>        <span class="dt">txt_missing</span><span class="op">:</span> <span class="st">"Non dedicated to housing"</span></span>
<span id="cb34-1532"><a href="#cb34-1532" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb34-1533"><a href="#cb34-1533" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fillOpacity</span><span class="op">:</span> opacity6<span class="op">,</span></span>
<span id="cb34-1534"><a href="#cb34-1534" aria-hidden="true" tabindex="-1"></a>      <span class="dt">tooltip</span><span class="op">:</span> {</span>
<span id="cb34-1535"><a href="#cb34-1535" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fields</span><span class="op">:</span> [</span>
<span id="cb34-1536"><a href="#cb34-1536" aria-hidden="true" tabindex="-1"></a>          <span class="st">"$NOM_IRIS"</span><span class="op">,</span></span>
<span id="cb34-1537"><a href="#cb34-1537" aria-hidden="true" tabindex="-1"></a>          <span class="st">"$NOM_COM"</span><span class="op">,</span></span>
<span id="cb34-1538"><a href="#cb34-1538" aria-hidden="true" tabindex="-1"></a>          <span class="st">"$DISP_MED19"</span><span class="op">,</span></span>
<span id="cb34-1539"><a href="#cb34-1539" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Median income (2019, euros)"</span></span>
<span id="cb34-1540"><a href="#cb34-1540" aria-hidden="true" tabindex="-1"></a>        ]<span class="op">,</span></span>
<span id="cb34-1541"><a href="#cb34-1541" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fill</span><span class="op">:</span> <span class="st">"white"</span><span class="op">,</span></span>
<span id="cb34-1542"><a href="#cb34-1542" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fontWeight</span><span class="op">:</span> [<span class="st">"bold"</span><span class="op">,</span> <span class="st">"normal"</span><span class="op">,</span> <span class="st">"normal"</span><span class="op">,</span> <span class="st">"normal"</span>]<span class="op">,</span></span>
<span id="cb34-1543"><a href="#cb34-1543" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fontSize</span><span class="op">:</span> [<span class="dv">11</span><span class="op">,</span> <span class="dv">11</span><span class="op">,</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">8</span>]<span class="op">,</span></span>
<span id="cb34-1544"><a href="#cb34-1544" aria-hidden="true" tabindex="-1"></a>        <span class="dt">col</span><span class="op">:</span> [<span class="st">"black"</span><span class="op">,</span> <span class="st">"black"</span><span class="op">,</span> <span class="st">"black"</span><span class="op">,</span> <span class="st">"black"</span>]</span>
<span id="cb34-1545"><a href="#cb34-1545" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb34-1546"><a href="#cb34-1546" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb34-1547"><a href="#cb34-1547" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1548"><a href="#cb34-1548" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb34-1549"><a href="#cb34-1549" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"scalebar"</span><span class="op">,</span></span>
<span id="cb34-1550"><a href="#cb34-1550" aria-hidden="true" tabindex="-1"></a>      <span class="dt">units</span><span class="op">:</span> <span class="st">"kilometers"</span><span class="op">,</span></span>
<span id="cb34-1551"><a href="#cb34-1551" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb34-1552"><a href="#cb34-1552" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb34-1553"><a href="#cb34-1553" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb34-1554"><a href="#cb34-1554" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"footer"</span><span class="op">,</span></span>
<span id="cb34-1555"><a href="#cb34-1555" aria-hidden="true" tabindex="-1"></a>      <span class="dt">text</span><span class="op">:</span></span>
<span id="cb34-1556"><a href="#cb34-1556" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Sources: (c)OpenStreetMap and contributors, INSEE, IGN, 2022</span><span class="sc">\n</span><span class="st">Realisation: Ronan Ysebaert, 2022"</span></span>
<span id="cb34-1557"><a href="#cb34-1557" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb34-1558"><a href="#cb34-1558" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb34-1559"><a href="#cb34-1559" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb34-1560"><a href="#cb34-1560" aria-hidden="true" tabindex="-1"></a><span class="vs">```</span></span>
<span id="cb34-1561"><a href="#cb34-1561" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1562"><a href="#cb34-1562" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1563"><a href="#cb34-1563" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1564"><a href="#cb34-1564" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1565"><a href="#cb34-1565" aria-hidden="true" tabindex="-1"></a><span class="vs"># Concluding methodological remarks</span></span>
<span id="cb34-1566"><a href="#cb34-1566" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1567"><a href="#cb34-1567" aria-hidden="true" tabindex="-1"></a><span class="vs">## Extend the analysis</span></span>
<span id="cb34-1568"><a href="#cb34-1568" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1569"><a href="#cb34-1569" aria-hidden="true" tabindex="-1"></a><span class="vs">This methodological example showed a general methodology to combine institutional and crowd-sourced data to develop some simple indicators of accessibility to services of interest using open-source routing engines, and disseminate this with data visualizations frameworks. It is one possible implementation, among others. Other implementations could easily be envisaged. </span></span>
<span id="cb34-1570"><a href="#cb34-1570" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1571"><a href="#cb34-1571" aria-hidden="true" tabindex="-1"></a><span class="vs">- **Geographical coverage**: The data preparation process presented above requires the definition of a geographical bounding box to extract OpenStreetMap points of interest (destinations of travel-time calculations) and an existing territorial division (the centroids being the origins of the travel-time calculations). This could be easily extented to other areas of interest, by modifying the Xmin, Xmax, Ymin and Ymax of the bounding box, or using other territorial divisions (a regular grid, for instance). The important things to consider is  </span></span>
<span id="cb34-1572"><a href="#cb34-1572" aria-hidden="true" tabindex="-1"></a><span class="vs">- **Use other points of interest**:  This example used the OpenStreetMap tag defined by the key-value `</span>sport<span class="op">=</span><span class="fu">climbing</span><span class="vs">`. Other [map features](https://wiki.openstreetmap.org/wiki/Map_features) could be investigated, such as [amenities](https://wiki.openstreetmap.org/wiki/Key:amenity), [tourism facilities](https://wiki.openstreetmap.org/wiki/Map_features#Tourism) or [shops](https://wiki.openstreetmap.org/wiki/Map_features#Shop). The only element to consider is the geometric reference of the object in the OpenStreetMap database ; it could be nodes, ways or relations. In the case of sport=climbing tag, the [OpenStreetMap Wiki](https://wiki.openstreetmap.org/wiki/Tag%3Asport%3Dclimbing) reminds that *sport=climbing should preferably applied to nodes for artificial climbing walls*, our case. If the tag combines nodes and areas, it requires also to extract polygons responding to the tag and transform it into points, checking if the information is not included twice in the OpenStreetMap database.   </span></span>
<span id="cb34-1573"><a href="#cb34-1573" aria-hidden="true" tabindex="-1"></a><span class="vs">- **Apply other profiles**: In this example, the standard bike profile has been applied. The pedestrian and the car profile are also available and may be also used depending on the objective of the analysis. Whatever the profile used, it reminds important to the parameters of the profiles ([car here](https://github.com/Project-OSRM/osrm-backend/blob/master/profiles/car.lua), [bike here](https://github.com/Project-OSRM/osrm-backend/blob/master/profiles/bicycle.lua) and [pedestrian here](https://github.com/Project-OSRM/osrm-backend/blob/master/profiles/foot.lua)) to understand the calculations realized with routing engines, and their limitations. It is also possible to implement its [own profile](https://github.com/Project-OSRM/osrm-backend/blob/master/docs/profiles.md). </span></span>
<span id="cb34-1574"><a href="#cb34-1574" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1575"><a href="#cb34-1575" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1576"><a href="#cb34-1576" aria-hidden="true" tabindex="-1"></a><span class="vs">## Usage precautions</span></span>
<span id="cb34-1577"><a href="#cb34-1577" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1578"><a href="#cb34-1578" aria-hidden="true" tabindex="-1"></a><span class="vs">One persisting criticism made to OpenStreetMap is its lack of quality, mainly due to its general and contributive organisations implying a high heterogeneity of contribution practices. Known problems are due to [geometric accuracy](https://wiki.openstreetmap.org/wiki/Accuracy) (geographical positioning of OSM objects), completeness</span></span>
<span id="cb34-1579"><a href="#cb34-1579" aria-hidden="true" tabindex="-1"></a><span class="vs">[accuracy](https://wiki.openstreetmap.org/wiki/Accuracy) and [completeness](https://wiki.openstreetmap.org/wiki/Completeness) (missing information, not up-to-date) or problems due to the [tags](https://wiki.openstreetmap.org/wiki/Category:Tagging_Mistakes) describing OSM objects (missing important tags, bad practices). </span></span>
<span id="cb34-1580"><a href="#cb34-1580" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1581"><a href="#cb34-1581" aria-hidden="true" tabindex="-1"></a><span class="vs">In that case, I made a personal survey to complete missing information (around 30 % of the information was missing) in OpenStreetMap database. It meant add some missing points in some cases, and in others to describe it with [relevant climbing tags](https://wiki.openstreetmap.org/wiki/Climbing) identified in the OpenStreetMap Wiki. At the end, it is sure that the input information is not perfect and would require double-checks by the community, but we can argue that it was not worst than in the begginning. </span></span>
<span id="cb34-1582"><a href="#cb34-1582" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1583"><a href="#cb34-1583" aria-hidden="true" tabindex="-1"></a><span class="vs">**Whatever the use of OpenStreetMap you may made, taking a step back to these questions is very important to control** ***a minima*** **the input information used for the travel-time calculations**.  </span></span>
<span id="cb34-1584"><a href="#cb34-1584" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1585"><a href="#cb34-1585" aria-hidden="true" tabindex="-1"></a><span class="vs">Another point to have in mind is the default parameters of osrm profiles: bike profile does not take into account the slope of the road ; the car profile does not take into account the trafic congestion. It may have significant impact on the travel-time calculations. </span></span>
<span id="cb34-1586"><a href="#cb34-1586" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1587"><a href="#cb34-1587" aria-hidden="true" tabindex="-1"></a><span class="vs">Nevertheless, we argue that OpenStreetMap is a wonderful initiative and as we try to demonstrate in this notebook, it is not too difficult to produce innovative indicators and data visualizations using open-source database and libraries. </span></span>
<span id="cb34-1588"><a href="#cb34-1588" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1589"><a href="#cb34-1589" aria-hidden="true" tabindex="-1"></a><span class="vs">Enjoy ! </span></span>
<span id="cb34-1590"><a href="#cb34-1590" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1591"><a href="#cb34-1591" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1592"><a href="#cb34-1592" aria-hidden="true" tabindex="-1"></a><span class="vs"># References</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>